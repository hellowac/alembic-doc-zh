<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>alembic 中文文档</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="zh/_front_matter.html">前言</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="zh/00_tutorial.html"><strong aria-hidden="true">1.</strong> 指南</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/00_01_the_migration_enviroment.html"><strong aria-hidden="true">1.1.</strong> 迁移环境</a></li><li class="chapter-item "><a href="zh/00_02_creating_an_enviroment.html"><strong aria-hidden="true">1.2.</strong> 创建环境</a></li><li class="chapter-item "><a href="zh/00_03_Editing_the_ini_file.html"><strong aria-hidden="true">1.3.</strong> 编辑.ini文件</a></li><li class="chapter-item "><a href="zh/00_04_create_a_migration_script.html"><strong aria-hidden="true">1.4.</strong> 创建迁移脚本</a></li><li class="chapter-item "><a href="zh/00_05_Running_our_first_migration.html"><strong aria-hidden="true">1.5.</strong> 初次运行迁移</a></li><li class="chapter-item "><a href="zh/00_06_Running_our_second_migration.html"><strong aria-hidden="true">1.6.</strong> 再次运行迁移</a></li><li class="chapter-item "><a href="zh/00_07_partial_revision_identifiers.html"><strong aria-hidden="true">1.7.</strong> 部分修订标识符</a></li><li class="chapter-item "><a href="zh/00_08_relative_migration_identifiers.html"><strong aria-hidden="true">1.8.</strong> 相对迁移标识符</a></li><li class="chapter-item "><a href="zh/00_09_getting_information.html"><strong aria-hidden="true">1.9.</strong> 获取信息</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/00_09_01_viewing_history_ranges.html"><strong aria-hidden="true">1.9.1.</strong> 查看历史范围</a></li></ol></li><li class="chapter-item "><a href="zh/00_10_downgrading.html"><strong aria-hidden="true">1.10.</strong> 降级</a></li><li class="chapter-item "><a href="zh/00_11_next_steps.html"><strong aria-hidden="true">1.11.</strong> 下一步</a></li></ol></li><li class="chapter-item expanded "><a href="zh/01_auto_generating_migrations.html"><strong aria-hidden="true">2.</strong> 基于自动生成的迁移</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/01_01_what_does_autogenerate_detect.html"><strong aria-hidden="true">2.1.</strong> Autogenerate 检测什么</a></li><li class="chapter-item "><a href="zh/01_02_autogenerating_multiple_metadata_collections.html"><strong aria-hidden="true">2.2.</strong> 自动生成多个元数据集合</a></li><li class="chapter-item "><a href="zh/01_03_controlling_what_to_be_autogenerated.html"><strong aria-hidden="true">2.3.</strong> 控制要自动生成的内容</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/01_03_01_omitting_schema_names_from_the_autogenerate_process.html"><strong aria-hidden="true">2.3.1.</strong> 从自动生成过程中过滤模式名称</a></li><li class="chapter-item "><a href="zh/01_03_02_omitting_table_names_from_the_autogenerate_process.html"><strong aria-hidden="true">2.3.2.</strong> 从自动生成过程中过滤表名</a></li><li class="chapter-item "><a href="zh/01_03_03_omitting_based_on_object.html"><strong aria-hidden="true">2.3.3.</strong> 基于对象的过滤</a></li></ol></li><li class="chapter-item "><a href="zh/01_04_comparing_and_rendering_types.html"><strong aria-hidden="true">2.4.</strong> 比较和渲染类型</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/01_04_01_controlling_the_module_prefix.html"><strong aria-hidden="true">2.4.1.</strong> 控制模块前缀</a></li><li class="chapter-item "><a href="zh/01_04_02_affecting_the_rendering_of_types_themselves.html"><strong aria-hidden="true">2.4.2.</strong> 影响类型本身的渲染</a></li><li class="chapter-item "><a href="zh/01_04_03_comparing_types.html"><strong aria-hidden="true">2.4.3.</strong> 比较类型</a></li></ol></li><li class="chapter-item "><a href="zh/01_05_applying_post_processing.html"><strong aria-hidden="true">2.5.</strong> 将提交处理过程和 Python 代码格式化程序应用于生成的修订</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/01_05_01_basic_formatter_configuration.html"><strong aria-hidden="true">2.5.1.</strong> 基本格式化程序配置</a></li><li class="chapter-item "><a href="zh/01_05_02_writing_custom_hooks_as_python_functions.html"><strong aria-hidden="true">2.5.2.</strong> 自定义Python函数钩子</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="zh/02_generating_sql_scripts.html"><strong aria-hidden="true">3.</strong> 生成SQL脚本(又称离线模式)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/02_01_getting_the_start_version.html"><strong aria-hidden="true">3.1.</strong> 获取起始版本</a></li><li class="chapter-item "><a href="zh/02_02_writing_migration_scripts_to_support_script_generation.html"><strong aria-hidden="true">3.2.</strong> 编写支持生成脚本的迁移脚本</a></li><li class="chapter-item "><a href="zh/02_03_customizing_the_environment.html"><strong aria-hidden="true">3.3.</strong> 自定义环境</a></li></ol></li><li class="chapter-item expanded "><a href="zh/03_the_importance_of_naming_constraints.html"><strong aria-hidden="true">4.</strong> 命名约束的重要性</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/03_01_integration_of_naming_conventions_into_operations_autogenerate.html"><strong aria-hidden="true">4.1.</strong> 将命名约定集成到操作中以及自动生成中</a></li></ol></li><li class="chapter-item expanded "><a href="zh/04_running_batch_migrations_for_sqlite_and_other_databases.html"><strong aria-hidden="true">5.</strong> 在SQLite和其他数据中运行&quot;批处理&quot;迁移脚本</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/04_01_controlling_table_reflection.html"><strong aria-hidden="true">5.1.</strong> 控制表反射</a></li><li class="chapter-item "><a href="zh/04_02_dealing_with_constraints.html"><strong aria-hidden="true">5.2.</strong> 处理约束</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/04_02_01_dropping_unnamed_or_named_foreign_key_constraints.html"><strong aria-hidden="true">5.2.1.</strong> 删除未命名或命名的外键约束</a></li><li class="chapter-item "><a href="zh/04_02_02_including_unnamed_unique_constraints.html"><strong aria-hidden="true">5.2.2.</strong> 包含未命名的 UNIQUE 约束</a></li><li class="chapter-item "><a href="zh/04_02_03_changing_the_type_of_boolean.html"><strong aria-hidden="true">5.2.3.</strong> 更改布尔、枚举和其他隐式 CHECK 数据类型的类型</a></li><li class="chapter-item "><a href="zh/04_02_04_including_check_constraints.html"><strong aria-hidden="true">5.2.4.</strong> 包括 CHECK 约束</a></li><li class="chapter-item "><a href="zh/04_02_05_dealing_with_referencing_foreign_keys.html"><strong aria-hidden="true">5.2.5.</strong> 处理引用外键</a></li></ol></li><li class="chapter-item "><a href="zh/04_03_working_in_offline_mode.html"><strong aria-hidden="true">5.3.</strong> 在离线模式下工作</a></li><li class="chapter-item "><a href="zh/04_04_batch_mode_with_autogenerate.html"><strong aria-hidden="true">5.4.</strong> 带自动生成的批处理模式</a></li><li class="chapter-item "><a href="zh/04_05_batch_mode_with_databases_other_than_sqlite.html"><strong aria-hidden="true">5.5.</strong> SQLite 以外的数据库的批处理模式</a></li></ol></li><li class="chapter-item expanded "><a href="zh/05_working_with_branches.html"><strong aria-hidden="true">6.</strong> 工作分支</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/05_01_merging_branches.html"><strong aria-hidden="true">6.1.</strong> 合并分支</a></li><li class="chapter-item "><a href="zh/05_02_working_with_explicit_branches.html"><strong aria-hidden="true">6.2.</strong> 使用显式分支</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/05_02_01_referring_to_all_heads_at_once.html"><strong aria-hidden="true">6.2.1.</strong> 一次引用到所有的head</a></li><li class="chapter-item "><a href="zh/05_02_02_referring_to_a_specific_version.html"><strong aria-hidden="true">6.2.2.</strong> 引用特定版本</a></li><li class="chapter-item "><a href="zh/05_02_03_working_with_branch_labels.html"><strong aria-hidden="true">6.2.3.</strong> 使用分支标注</a></li><li class="chapter-item "><a href="zh/05_02_04_more_label_syntaxes.html"><strong aria-hidden="true">6.2.4.</strong> 更多标注语法</a></li></ol></li><li class="chapter-item "><a href="zh/05_03_working_with_multiple_bases.html"><strong aria-hidden="true">6.3.</strong> 基于多个base工作</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/05_03_01_setting_up_multiple_version_directories.html"><strong aria-hidden="true">6.3.1.</strong> 设置多版本目录</a></li><li class="chapter-item "><a href="zh/05_03_01_creating_a_labeled_base_revision.html"><strong aria-hidden="true">6.3.2.</strong> 创建带标注的基本修订</a></li><li class="chapter-item "><a href="zh/05_03_02_running_with_multiple_bases.html"><strong aria-hidden="true">6.3.3.</strong> 基于多个base运行</a></li></ol></li><li class="chapter-item "><a href="zh/05_04_branch_dependencies.html"><strong aria-hidden="true">6.4.</strong> 分支依赖</a></li></ol></li><li class="chapter-item expanded "><a href="zh/06_operation_reference.html"><strong aria-hidden="true">7.</strong> 操作参考</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/06_01_operations.html"><strong aria-hidden="true">7.1.</strong> alembic.operations.Operations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/06_01_01_add_column.html"><strong aria-hidden="true">7.1.1.</strong> add_column</a></li><li class="chapter-item "><a href="zh/06_01_02_alter_column.html"><strong aria-hidden="true">7.1.2.</strong> alter_column</a></li><li class="chapter-item "><a href="zh/06_01_03_batch_alter_table.html"><strong aria-hidden="true">7.1.3.</strong> batch_alter_table</a></li><li class="chapter-item "><a href="zh/06_01_04_bulk_insert.html"><strong aria-hidden="true">7.1.4.</strong> bulk_insert</a></li><li class="chapter-item "><a href="zh/06_01_05_create_check_constraint.html"><strong aria-hidden="true">7.1.5.</strong> create_check_constraint</a></li><li class="chapter-item "><a href="zh/06_01_06_create_exclude_constraint.html"><strong aria-hidden="true">7.1.6.</strong> create_exclude_constraint</a></li><li class="chapter-item "><a href="zh/06_01_07_create_foreign_key.html"><strong aria-hidden="true">7.1.7.</strong> create_foreign_key</a></li><li class="chapter-item "><a href="zh/06_01_08_create_index.html"><strong aria-hidden="true">7.1.8.</strong> create_index</a></li><li class="chapter-item "><a href="zh/06_01_09_create_primary_key.html"><strong aria-hidden="true">7.1.9.</strong> create_primary_key</a></li><li class="chapter-item "><a href="zh/06_01_10_create_table.html"><strong aria-hidden="true">7.1.10.</strong> create_table</a></li><li class="chapter-item "><a href="zh/06_01_11_create_table_comment.html"><strong aria-hidden="true">7.1.11.</strong> create_table_comment</a></li><li class="chapter-item "><a href="zh/06_01_12_create_unique_constraint.html"><strong aria-hidden="true">7.1.12.</strong> create_unique_constraint</a></li><li class="chapter-item "><a href="zh/06_01_13_drop_column.html"><strong aria-hidden="true">7.1.13.</strong> drop_column</a></li><li class="chapter-item "><a href="zh/06_01_14_drop_constraint.html"><strong aria-hidden="true">7.1.14.</strong> drop_constraint</a></li><li class="chapter-item "><a href="zh/06_01_15_drop_index.html"><strong aria-hidden="true">7.1.15.</strong> drop_index</a></li><li class="chapter-item "><a href="zh/06_01_16_drop_table.html"><strong aria-hidden="true">7.1.16.</strong> drop_table</a></li><li class="chapter-item "><a href="zh/06_01_17_drop_table_comment.html"><strong aria-hidden="true">7.1.17.</strong> drop_table_comment</a></li><li class="chapter-item "><a href="zh/06_01_18_execute.html"><strong aria-hidden="true">7.1.18.</strong> execute</a></li><li class="chapter-item "><a href="zh/06_01_19_f.html"><strong aria-hidden="true">7.1.19.</strong> f</a></li><li class="chapter-item "><a href="zh/06_01_20_get_bind.html"><strong aria-hidden="true">7.1.20.</strong> get_bind</a></li><li class="chapter-item "><a href="zh/06_01_21_get_context.html"><strong aria-hidden="true">7.1.21.</strong> get_context</a></li><li class="chapter-item "><a href="zh/06_01_22_implementation_for.html"><strong aria-hidden="true">7.1.22.</strong> implementation_for</a></li><li class="chapter-item "><a href="zh/06_01_23_inline_literal.html"><strong aria-hidden="true">7.1.23.</strong> inline_literal</a></li><li class="chapter-item "><a href="zh/06_01_24_invoke.html"><strong aria-hidden="true">7.1.24.</strong> invoke</a></li><li class="chapter-item "><a href="zh/06_01_25_register_operation.html"><strong aria-hidden="true">7.1.25.</strong> register_operation</a></li><li class="chapter-item "><a href="zh/06_01_26_rename_table.html"><strong aria-hidden="true">7.1.26.</strong> rename_table</a></li></ol></li><li class="chapter-item "><a href="zh/06_02_batch_operations.html"><strong aria-hidden="true">7.2.</strong> alembic.operations.BatchOperations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/06_02_01_add_column.html"><strong aria-hidden="true">7.2.1.</strong> add_column</a></li><li class="chapter-item "><a href="zh/06_02_02_alter_column.html"><strong aria-hidden="true">7.2.2.</strong> alter_column</a></li><li class="chapter-item "><a href="zh/06_02_03_create_check_constraint.html"><strong aria-hidden="true">7.2.3.</strong> create_check_constraint</a></li><li class="chapter-item "><a href="zh/06_02_04_create_exclude_constraint.html"><strong aria-hidden="true">7.2.4.</strong> create_exclude_constraint</a></li><li class="chapter-item "><a href="zh/06_02_05_create_foreign_key.html"><strong aria-hidden="true">7.2.5.</strong> create_foreign_key</a></li><li class="chapter-item "><a href="zh/06_02_06_create_index.html"><strong aria-hidden="true">7.2.6.</strong> create_index</a></li><li class="chapter-item "><a href="zh/06_02_07_create_primary_key.html"><strong aria-hidden="true">7.2.7.</strong> create_primary_key</a></li><li class="chapter-item "><a href="zh/06_02_08_create_table_comment.html"><strong aria-hidden="true">7.2.8.</strong> create_table_comment</a></li><li class="chapter-item "><a href="zh/06_02_09_create_unique_constraint.html"><strong aria-hidden="true">7.2.9.</strong> create_unique_constraint</a></li><li class="chapter-item "><a href="zh/06_02_10_drop_column.html"><strong aria-hidden="true">7.2.10.</strong> drop_column</a></li><li class="chapter-item "><a href="zh/06_02_11_drop_constraint.html"><strong aria-hidden="true">7.2.11.</strong> drop_constraint</a></li><li class="chapter-item "><a href="zh/06_02_12_drop_index.html"><strong aria-hidden="true">7.2.12.</strong> drop_index</a></li><li class="chapter-item "><a href="zh/06_02_13_drop_table_comment.html"><strong aria-hidden="true">7.2.13.</strong> drop_table_comment</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="zh/07_cook_book.html"><strong aria-hidden="true">8.</strong> cookbook</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/07_01_building_an_up_to_date_database_from_scratch.html"><strong aria-hidden="true">8.1.</strong> 从头开始构建最新的数据库</a></li><li class="chapter-item "><a href="zh/07_02_conditional_migration_elements.html"><strong aria-hidden="true">8.2.</strong> 条件迁移元素</a></li><li class="chapter-item "><a href="zh/07_03_sharing_a_connection_with_a_series_of_migration_commands_and_environments.html"><strong aria-hidden="true">8.3.</strong> 与一系列迁移命令和环境共享连接</a></li><li class="chapter-item "><a href="zh/07_04_replaceable_objects.html"><strong aria-hidden="true">8.4.</strong> 可替换对象</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/07_04_01_the_replaceable_object_structure.html"><strong aria-hidden="true">8.4.1.</strong> 可替换对象结构</a></li><li class="chapter-item "><a href="zh/07_04_02_create_operations_for_the_target_objects.html"><strong aria-hidden="true">8.4.2.</strong> 为目标对象创建操作</a></li><li class="chapter-item "><a href="zh/07_04_03_create_initial_migrations.html"><strong aria-hidden="true">8.4.3.</strong> 创建初始迁移</a></li><li class="chapter-item "><a href="zh/07_04_04_create_revision_migrations.html"><strong aria-hidden="true">8.4.4.</strong> 创建修订迁移</a></li></ol></li><li class="chapter-item "><a href="zh/07_05_rudimental_schema_level_multi_tenancy_for_postgresql_databases.html"><strong aria-hidden="true">8.5.</strong> PostgreSQL 数据库的基础架构级多租户</a></li><li class="chapter-item "><a href="zh/07_06_dont_generate_empty_migrations_with_autogenerate.html"><strong aria-hidden="true">8.6.</strong> 不要使用 Autogenerate 生成空迁移</a></li><li class="chapter-item "><a href="zh/07_07_dont_emit_drop_index_when_the_table_is_to_be_dropped_as_well.html"><strong aria-hidden="true">8.7.</strong> 当表也将被删除时不要发出 DROP INDEX</a></li><li class="chapter-item "><a href="zh/07_08_dont_generate_any_drop_table_directives_with_autogenerate.html"><strong aria-hidden="true">8.8.</strong> 不要使用autogenerate生成任何 DROP TABLE 指令</a></li><li class="chapter-item "><a href="zh/07_09_apply_custom_sorting_to_table_columns_within_create_table.html"><strong aria-hidden="true">8.9.</strong> 将自定义排序应用于 CREATE TABLE 中的表列</a></li><li class="chapter-item "><a href="zh/07_10_dont_emit_create_table_statements_for_views.html"><strong aria-hidden="true">8.10.</strong> 不要为视图发出 CREATE TABLE 语句</a></li><li class="chapter-item "><a href="zh/07_11_run_multiple_alembic_environments_from_one_ini_file.html"><strong aria-hidden="true">8.11.</strong> 从一个 .ini 文件运行多个 Alembic 环境</a></li><li class="chapter-item "><a href="zh/07_12_print_python_code_to_generate_particular_database_tables.html"><strong aria-hidden="true">8.12.</strong> 打印 Python 代码以生成特定的数据库表</a></li><li class="chapter-item "><a href="zh/07_13_run_alembic_operation_objects_directly_as_in_from_autogenerate.html"><strong aria-hidden="true">8.13.</strong> 直接运行 Alembic 操作对象（如来自autogenerate）</a></li><li class="chapter-item "><a href="zh/07_14_test_current_database_revision_is_at_heads.html"><strong aria-hidden="true">8.14.</strong> 测试当前的数据库修订版本处于head</a></li><li class="chapter-item "><a href="zh/07_15_using_asyncio_with_alembic.html"><strong aria-hidden="true">8.15.</strong> 将 Asyncio 与 Alembic 结合使用</a></li></ol></li><li class="chapter-item expanded "><a href="zh/08_api_details.html"><strong aria-hidden="true">9.</strong> API详细</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_01_overview.html"><strong aria-hidden="true">9.1.</strong> 概览</a></li><li class="chapter-item "><a href="zh/08_02_runtime_objects.html"><strong aria-hidden="true">9.2.</strong> 运行时对象</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_02_01_the_environment_context.html"><strong aria-hidden="true">9.2.1.</strong> Environment Context</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_02_01_01_begin_transaction.html"><strong aria-hidden="true">9.2.1.1.</strong> begin_transaction</a></li><li class="chapter-item "><a href="zh/08_02_01_16_config.html"><strong aria-hidden="true">9.2.1.2.</strong> config</a></li><li class="chapter-item "><a href="zh/08_02_01_02_configure.html"><strong aria-hidden="true">9.2.1.3.</strong> configure</a></li><li class="chapter-item "><a href="zh/08_02_01_03_execute.html"><strong aria-hidden="true">9.2.1.4.</strong> execute</a></li><li class="chapter-item "><a href="zh/08_02_01_04_get_bind.html"><strong aria-hidden="true">9.2.1.5.</strong> get_bind</a></li><li class="chapter-item "><a href="zh/08_02_01_05_get_context.html"><strong aria-hidden="true">9.2.1.6.</strong> get_context</a></li><li class="chapter-item "><a href="zh/08_02_01_06_get_head_revision.html"><strong aria-hidden="true">9.2.1.7.</strong> get_head_revision</a></li><li class="chapter-item "><a href="zh/08_02_01_07_get_head_revisions.html"><strong aria-hidden="true">9.2.1.8.</strong> get_head_revisions</a></li><li class="chapter-item "><a href="zh/08_02_01_08_get_revision_argument.html"><strong aria-hidden="true">9.2.1.9.</strong> get_revision_argument</a></li><li class="chapter-item "><a href="zh/08_02_01_09_get_starting_revision_argument.html"><strong aria-hidden="true">9.2.1.10.</strong> get_starting_revision_argument</a></li><li class="chapter-item "><a href="zh/08_02_01_10_get_tag_argument.html"><strong aria-hidden="true">9.2.1.11.</strong> get_tag_argument</a></li><li class="chapter-item "><a href="zh/08_02_01_11_get_x_argument.html"><strong aria-hidden="true">9.2.1.12.</strong> get_x_argument</a></li><li class="chapter-item "><a href="zh/08_02_01_12_is_offline_mode.html"><strong aria-hidden="true">9.2.1.13.</strong> is_offline_mode</a></li><li class="chapter-item "><a href="zh/08_02_01_13_is_transactional_ddl.html"><strong aria-hidden="true">9.2.1.14.</strong> is_transactional_ddl</a></li><li class="chapter-item "><a href="zh/08_02_01_14_run_migrations.html"><strong aria-hidden="true">9.2.1.15.</strong> run_migrations</a></li><li class="chapter-item "><a href="zh/08_02_01_17_script.html"><strong aria-hidden="true">9.2.1.16.</strong> script</a></li><li class="chapter-item "><a href="zh/08_02_01_15_static_output.html"><strong aria-hidden="true">9.2.1.17.</strong> static_output</a></li></ol></li><li class="chapter-item "><a href="zh/08_02_02_the_migration_context.html"><strong aria-hidden="true">9.2.2.</strong> Migration Context</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_02_02_01_autocommit_block.html"><strong aria-hidden="true">9.2.2.1.</strong> autocommit_block</a></li><li class="chapter-item "><a href="zh/08_02_02_02_begin_transaction.html"><strong aria-hidden="true">9.2.2.2.</strong> begin_transaction</a></li><li class="chapter-item "><a href="zh/08_02_02_09_bind.html"><strong aria-hidden="true">9.2.2.3.</strong> bind</a></li><li class="chapter-item "><a href="zh/08_02_02_10_config.html"><strong aria-hidden="true">9.2.2.4.</strong> config</a></li><li class="chapter-item "><a href="zh/08_02_02_03_configure.html"><strong aria-hidden="true">9.2.2.5.</strong> configure</a></li><li class="chapter-item "><a href="zh/08_02_02_04_execute.html"><strong aria-hidden="true">9.2.2.6.</strong> execute</a></li><li class="chapter-item "><a href="zh/08_02_02_05_get_current_heads.html"><strong aria-hidden="true">9.2.2.7.</strong> get_current_heads</a></li><li class="chapter-item "><a href="zh/08_02_02_06_get_current_revision.html"><strong aria-hidden="true">9.2.2.8.</strong> get_current_revision</a></li><li class="chapter-item "><a href="zh/08_02_02_07_run_migrations.html"><strong aria-hidden="true">9.2.2.9.</strong> run_migrations</a></li><li class="chapter-item "><a href="zh/08_02_02_08_stamp.html"><strong aria-hidden="true">9.2.2.10.</strong> stamp</a></li></ol></li></ol></li><li class="chapter-item "><a href="zh/08_03_configuration.html"><strong aria-hidden="true">9.3.</strong> 配置</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_03_01_attributes.html"><strong aria-hidden="true">9.3.1.</strong> attributes</a></li><li class="chapter-item "><a href="zh/08_03_02_cmd_opts.html"><strong aria-hidden="true">9.3.2.</strong> cmd_opts</a></li><li class="chapter-item "><a href="zh/08_03_03_config_file_name.html"><strong aria-hidden="true">9.3.3.</strong> config_file_name</a></li><li class="chapter-item "><a href="zh/08_03_04_config_ini_section.html"><strong aria-hidden="true">9.3.4.</strong> config_ini_section</a></li><li class="chapter-item "><a href="zh/08_03_05_file_config.html"><strong aria-hidden="true">9.3.5.</strong> file_config</a></li><li class="chapter-item "><a href="zh/08_03_06_get_main_option.html"><strong aria-hidden="true">9.3.6.</strong> get_main_option</a></li><li class="chapter-item "><a href="zh/08_03_07_get_section.html"><strong aria-hidden="true">9.3.7.</strong> get_section</a></li><li class="chapter-item "><a href="zh/08_03_08_get_section_option.html"><strong aria-hidden="true">9.3.8.</strong> get_section_option</a></li><li class="chapter-item "><a href="zh/08_03_09_get_template_directory.html"><strong aria-hidden="true">9.3.9.</strong> get_template_directory</a></li><li class="chapter-item "><a href="zh/08_03_10_print_stdout.html"><strong aria-hidden="true">9.3.10.</strong> print_stdout</a></li><li class="chapter-item "><a href="zh/08_03_11_set_main_option.html"><strong aria-hidden="true">9.3.11.</strong> set_main_option</a></li><li class="chapter-item "><a href="zh/08_03_12_set_section_option.html"><strong aria-hidden="true">9.3.12.</strong> set_section_option</a></li><li class="chapter-item "><a href="zh/08_03_13_main.html"><strong aria-hidden="true">9.3.13.</strong> main</a></li></ol></li><li class="chapter-item "><a href="zh/08_04_commands.html"><strong aria-hidden="true">9.4.</strong> 命令</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_04_01_branches.html"><strong aria-hidden="true">9.4.1.</strong> branches</a></li><li class="chapter-item "><a href="zh/08_04_02_current.html"><strong aria-hidden="true">9.4.2.</strong> current</a></li><li class="chapter-item "><a href="zh/08_04_03_downgrade.html"><strong aria-hidden="true">9.4.3.</strong> downgrade</a></li><li class="chapter-item "><a href="zh/08_04_04_edit.html"><strong aria-hidden="true">9.4.4.</strong> edit</a></li><li class="chapter-item "><a href="zh/08_04_05_ensure_version.html"><strong aria-hidden="true">9.4.5.</strong> ensure_version</a></li><li class="chapter-item "><a href="zh/08_04_06_heads.html"><strong aria-hidden="true">9.4.6.</strong> heads</a></li><li class="chapter-item "><a href="zh/08_04_07_history.html"><strong aria-hidden="true">9.4.7.</strong> history</a></li><li class="chapter-item "><a href="zh/08_04_08_init.html"><strong aria-hidden="true">9.4.8.</strong> init</a></li><li class="chapter-item "><a href="zh/08_04_09_list_templates.html"><strong aria-hidden="true">9.4.9.</strong> list_templates</a></li><li class="chapter-item "><a href="zh/08_04_10_merge.html"><strong aria-hidden="true">9.4.10.</strong> merge</a></li><li class="chapter-item "><a href="zh/08_04_11_revision.html"><strong aria-hidden="true">9.4.11.</strong> revision</a></li><li class="chapter-item "><a href="zh/08_04_12_show.html"><strong aria-hidden="true">9.4.12.</strong> show</a></li><li class="chapter-item "><a href="zh/08_04_13_stamp.html"><strong aria-hidden="true">9.4.13.</strong> stamp</a></li><li class="chapter-item "><a href="zh/08_04_14_upgrade.html"><strong aria-hidden="true">9.4.14.</strong> upgrade</a></li></ol></li><li class="chapter-item "><a href="zh/08_05_operation_directives.html"><strong aria-hidden="true">9.5.</strong> 操作指令</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_05_01_operation_plugins.html"><strong aria-hidden="true">9.5.1.</strong> 操作插件</a></li><li class="chapter-item "><a href="zh/08_05_02_built_in_operation_objects.html"><strong aria-hidden="true">9.5.2.</strong> 内置操作对象</a></li></ol></li><li class="chapter-item "><a href="zh/08_06_autogeneration.html"><strong aria-hidden="true">9.6.</strong> 自动生成</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_06_01_getting_diffs.html"><strong aria-hidden="true">9.6.1.</strong> 获取差异</a></li><li class="chapter-item "><a href="zh/08_06_02_customizing_revision_generation.html"><strong aria-hidden="true">9.6.2.</strong> 生成自定义修订</a></li><li class="chapter-item "><a href="zh/08_06_03_autogenerating_custom_operation_directives.html"><strong aria-hidden="true">9.6.3.</strong> Autogenerate自定义操作指令</a></li></ol></li><li class="chapter-item "><a href="zh/08_07_script_directory.html"><strong aria-hidden="true">9.7.</strong> 脚本目录</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_07_01_revision.html"><strong aria-hidden="true">9.7.1.</strong> 修订</a></li><li class="chapter-item "><a href="zh/08_07_02_write_hooks.html"><strong aria-hidden="true">9.7.2.</strong> 写钩子</a></li></ol></li><li class="chapter-item "><a href="zh/08_08_ddl_internals.html"><strong aria-hidden="true">9.8.</strong> DDL 内部结构</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="zh/08_08_01_mysql.html"><strong aria-hidden="true">9.8.1.</strong> MySQL</a></li><li class="chapter-item "><a href="zh/08_08_02_ms_sql.html"><strong aria-hidden="true">9.8.2.</strong> MS-SQL</a></li><li class="chapter-item "><a href="zh/08_08_03_postgresql.html"><strong aria-hidden="true">9.8.3.</strong> Postgresql</a></li><li class="chapter-item "><a href="zh/08_08_04_sqlite.html"><strong aria-hidden="true">9.8.4.</strong> SQLite</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="zh/09_change_log.html"><strong aria-hidden="true">10.</strong> 更新历史</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="en/genindex.html">index</a></li><li class="chapter-item expanded affix "><a href="en/py-modindex.html">module-index</a></li><li class="chapter-item expanded affix "><a href="en/index.html">Document-English</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">alembic 中文文档</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="前言"><a class="header" href="#前言">前言</a></h1>
<p><a href="https://alembic.sqlalchemy.org/">Alembic</a> is a lightweight database migration tool for usage with the SQLAlchemy Database Toolkit for Python.</p>
<blockquote>
<p><a href="https://alembic.sqlalchemy.org/">Alembic</a> 是一种轻量级数据库迁移工具，可与<a href="https://www.python.org/">Python</a>的 <a href="https://docs.sqlalchemy.org/">SQLAlchemy</a> 数据库库工具包一起使用。</p>
</blockquote>
<h1 id="front-matter-指南"><a class="header" href="#front-matter-指南">Front Matter (指南)</a></h1>
<p>Information about the Alembic project.</p>
<blockquote>
<p>有关 Alembic 项目的信息。</p>
</blockquote>
<h2 id="project-homepage-项目主页"><a class="header" href="#project-homepage-项目主页">Project Homepage (项目主页)</a></h2>
<p>Alembic is hosted on GitHub at <a href="https://github.com/sqlalchemy/alembic">https://github.com/sqlalchemy/alembic</a> under the SQLAlchemy organization.</p>
<blockquote>
<p>Alembic 托管在 GitHub 上，网址为 <a href="https://github.com/sqlalchemy/alembic">https://github.com/sqlalchemy/alembic</a>，隶属于 SQLAlchemy 组织。</p>
</blockquote>
<p>Releases and project status are available on Pypi at <a href="https://pypi.python.org/pypi/alembic">https://pypi.python.org/pypi/alembic</a>.</p>
<blockquote>
<p>发布和项目状态可在 Pypi 上获取，网址为 <a href="https://pypi.python.org/pypi/alembic">https://pypi.python.org/pypi/alembic</a>。</p>
</blockquote>
<p>The most recent published version of this documentation should be at <a href="https://alembic.sqlalchemy.org">https://alembic.sqlalchemy.org</a>.</p>
<blockquote>
<p>本文档的最新发布版本位于 <a href="https://alembic.sqlalchemy.org">https://alembic.sqlalchemy.org</a>。</p>
</blockquote>
<h2 id="installation-安装"><a class="header" href="#installation-安装">Installation （安装）</a></h2>
<p>While Alembic can be installed system wide, it’s more common that it’s installed local to a <a href="https://docs.python.org/3/tutorial/venv.html">virtual environment</a> , as it also uses libraries such as SQLAlchemy and database drivers that are more appropriate for local installations.</p>
<blockquote>
<p>虽然 Alembic 可以在系统范围内安装，但更常见的是将其安装在本地<a href="https://docs.python.org/3/tutorial/venv.html">虚拟环境</a>中，因为它还使用更适合本地安装的 SQLAlchemy 和数据库驱动程序等库。</p>
</blockquote>
<p>The documentation below is only one kind of approach to installing Alembic for a project; there are many such approaches. The documentation below is provided only for those users who otherwise have no specific project setup chosen.</p>
<blockquote>
<p>下面的文档只是为项目安装 Alembic 的一种方法； 有很多这样的方法。 下面的文档仅提供给那些没有选择特定项目设置的用户。</p>
</blockquote>
<p>To build a virtual environment for a specific project, first we assume that <a href="https://pypi.org/project/virtualenv/">Python virtualenv</a> is installed systemwide. Then:</p>
<blockquote>
<p>要为特定项目构建虚拟环境，首先我们假设 <a href="https://pypi.org/project/virtualenv/">Python virtualenv</a> 已安装在系统范围内。 然后：</p>
</blockquote>
<pre><code class="language-bash">cd /path/to/your/project
virtualenv .venv
</code></pre>
<p>There is now a Python interpreter that you can access in <code>/path/to/your/project/.venv/bin/python</code>, as well as the pip installer tool in <code>/path/to/your/project/.venv/bin/pip</code>.</p>
<blockquote>
<p>现在有一个 Python 解释器，您可以在 <code>/path/to/your/project/.venv/bin/python</code> 中访问，以及 <code>/path/to/your/project/.venv/bin/pip</code> 中的 pip 安装程序工具.</p>
</blockquote>
<p>We now install Alembic as follows:</p>
<blockquote>
<p>我们现在按如下方式安装 Alembic：</p>
</blockquote>
<pre><code class="language-bash">/path/to/your/project/.venv/bin/pip install alembic
</code></pre>
<p>The install will add the alembic command to the virtual environment. All operations with Alembic in terms of this specific virtual environment will then proceed through the usage of this command, as in:</p>
<blockquote>
<p>安装会将 alembic 命令添加到虚拟环境中。 然后，在此特定虚拟环境中使用 Alembic 的所有操作都将通过使用此命令进行，如下所示：</p>
</blockquote>
<pre><code class="language-bash">/path/to/your/project/.venv/bin/alembic init .
</code></pre>
<p>The next step is optional. If our project itself has a setup.py file, we can also install it in the local virtual environment in <a href="https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs">editable mode</a>:</p>
<blockquote>
<p>下一步是可选的。 如果我们的项目本身有setup.py文件，我们也可以在本地虚拟环境中以<a href="https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs">可编辑的模式</a>安装：</p>
</blockquote>
<pre><code class="language-bash">/path/to/your/project/.venv/bin/pip install -e .
</code></pre>
<p>If we don’t “install” the project locally, that’s fine as well; the default alembic.ini file includes a directive <code>prepend_sys_path = .</code> so that the local path is also in sys.path. This allows us to run the alembic command line tool from this directory without our project being “installed” in that environment.</p>
<blockquote>
<p>如果我们不在本地“安装”项目，那也没关系； 默认的 alembic.ini 文件包含一个指令 <code>prepend_sys_path = .</code> 这样本地路径也在 <code>sys.path</code> 中。 这允许我们从该目录运行 alembic 命令行工具，而无需在该环境中“安装”我们的项目。</p>
</blockquote>
<blockquote>
<p><em>Changed in version 1.5.5: Fixed a long-standing issue where the <code>alembic</code> command-line tool would not preserve the default <code>sys.path</code> of <code>.</code> by implementing <code>prepend_sys_path</code> option.</em></p>
</blockquote>
<blockquote>
<p>1.5.5版本更新: 修复了一个长期存在的问题，即 alembic 命令行工具不会通过实现 <code>prepend_sys_path</code> 选项来保留当前目录(<code>.</code>)在<code>sys.path</code>中。</p>
</blockquote>
<p>As a final step, the <a href="https://virtualenv.pypa.io/en/latest/userguide/#activate-script">virtualenv activate</a> tool can be used so that the <code>alembic</code> command is available without any path information, within the context of the current shell:</p>
<blockquote>
<p>作为最后一步，可以使用 <a href="https://virtualenv.pypa.io/en/latest/userguide/#activate-script">virtualenv activate</a> 工具，以便在当前 shell 的上下文中无需任何路径信息即可使用 <code>alembic</code> 命令：</p>
</blockquote>
<pre><code class="language-bash">source /path/to/your/project/.venv/bin/activate
</code></pre>
<h3 id="dependencies-依赖"><a class="header" href="#dependencies-依赖">Dependencies (依赖)</a></h3>
<p>Alembic’s install process will ensure that <a href="https://docs.sqlalchemy.org/">SQLAlchemy</a> is installed, in addition to other dependencies. Alembic will work with SQLAlchemy as of version 1.3.0.</p>
<blockquote>
<p>除了其他依赖项外，<a href="https://alembic.sqlalchemy.org/">Alembic</a> 安装过程将确保安装 <a href="https://docs.sqlalchemy.org/">SQLAlchemy</a>。 从 1.3.0 版本开始，<a href="https://alembic.sqlalchemy.org/">Alembic</a> 将与 <a href="https://docs.sqlalchemy.org/">SQLAlchemy</a> 一起使用。</p>
</blockquote>
<blockquote>
<p>Changed in version 1.5.0: Support for SQLAlchemy older than 1.3.0 was dropped.</p>
</blockquote>
<blockquote>
<p>版本1.5.0更新: 不再支持 1.3.0 版本之前的 SQLAlchemy。</p>
</blockquote>
<p>Alembic supports Python versions 3.6 and above</p>
<blockquote>
<p>Alembic 支持 Python 3.6 及以上版本</p>
</blockquote>
<blockquote>
<p>Changed in version 1.7: Alembic now supports Python 3.6 and newer; support for Python 2.7 has been dropped.</p>
</blockquote>
<blockquote>
<p>版本1.7更新: Alembic 现在支持 Python 3.6 及更新的版本； 已取消对 Python 2.7 的支持。</p>
</blockquote>
<h2 id="community-社区"><a class="header" href="#community-社区">Community (社区)</a></h2>
<p>Alembic is developed by <a href="http://techspot.zzzeek.org/">Mike Bayer</a>, and is loosely associated with the <a href="https://docs.sqlalchemy.org/">SQLAlchemy</a>, <a href="http://www.pylonsproject.org/">Pylons</a>, and <a href="http://www.openstack.org/">Openstack</a> projects.</p>
<blockquote>
<p>Alembic 由 <a href="http://techspot.zzzeek.org/">Mike Bayer</a> 开发，与 <a href="https://docs.sqlalchemy.org/">SQLAlchemy</a>、<a href="http://www.pylonsproject.org/">Pylons</a> 和 <a href="http://www.openstack.org/">Openstack</a> 项目松散关联。</p>
</blockquote>
<p>User issues, discussion of potential bugs and features should be posted to the Alembic Google Group at <a href="https://groups.google.com/group/sqlalchemy-alembic">sqlalchemy-alembic</a>.</p>
<blockquote>
<p>用户问题、潜在错误和功能的讨论应发布到 Alembic 在 Google Group群组上的 <a href="https://groups.google.com/group/sqlalchemy-alembic">sqlalchemy-alembic</a>。</p>
</blockquote>
<h2 id="bugs-问题"><a class="header" href="#bugs-问题">Bugs (问题)</a></h2>
<p>Bugs and feature enhancements to Alembic should be reported on the <a href="https://github.com/sqlalchemy/alembic/issues/">GitHub issue tracker</a>.</p>
<blockquote>
<p>应在 <a href="https://github.com/sqlalchemy/alembic/issues/">GitHub issue tracker</a> 上报告 Alembic 的错误和功能加强。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tutorial"><a class="header" href="#tutorial">Tutorial</a></h1>
<p><strong>指南</strong></p>
<p>Alembic provides for the creation, management, and invocation of change management scripts for a relational database, using SQLAlchemy as the underlying engine. This tutorial will provide a full introduction to the theory and usage of this tool.</p>
<blockquote>
<p>Alembic 使用 SQLAlchemy 作为底层引擎，为关系数据库提供变更管理脚本的创建、管理和调用。 本教程将全面介绍该工具的理论和用法。</p>
</blockquote>
<p>To begin, make sure Alembic is installed as described at <a href="zh//zh/_front_matter.html#installation-%E5%AE%89%E8%A3%85">Installation</a>. As stated in the linked document, it is usually preferable that Alembic is installed in the <strong>same module / Python path as that of the target project</strong>, usually using a <a href="https://docs.python.org/3/tutorial/venv.html">Python virtual environment</a>, so that when the <code>alembic</code> command is run, the Python script which is invoked by <code>alembic</code>, namely your project’s <code>env.py</code> script, will have access to your application’s models. This is not strictly necessary in all cases, however in the vast majority of cases is usually preferred.</p>
<blockquote>
<p>首先，请确保按照 <a href="zh//zh/_front_matter.html#installation-%E5%AE%89%E8%A3%85">安装</a> 中的说明安装 <code>Alembic</code> 。 如文档中所述，通常最好将 <code>Alembic</code> 安装在与目标项目相同的 / Python 路径的模块中，通常使用<a href="https://docs.python.org/3/tutorial/venv.html">Python 虚拟环境</a>，以便在运行 alembic 命令时，Python 脚本 由 alembic 调用，即你项目的 <code>env.py</code> 脚本，将可以访问您的应用程序模型。 这并非在所有情况下都严格必要，但在绝大多数情况下通常是首选。</p>
</blockquote>
<p>The tutorial below assumes the <code>alembic</code> command line utility is present in the local path and when invoked, will have access to the same Python module environment as that of the target project.</p>
<blockquote>
<p>下面的教程假设 <code>alembic</code> 命令行实用程序存在于本地路径中，并且在调用时，将可以访问与目标项目相同的 Python 模块环境。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="迁移环境"><a class="header" href="#迁移环境">迁移环境</a></h1>
<p>Usage of Alembic starts with creation of the <em>Migration Environment</em>. This is a directory of scripts that is specific to a particular application. The migration environment is created just once, and is then maintained along with the application’s source code itself. The environment is created using the <em>init</em> command of Alembic, and is then customizable to suit the specific needs of the application.</p>
<blockquote>
<p>使用 Alembic 从创建<em><strong>迁移环境</strong></em>开始。这是独立于应用程序的特别脚本目录。迁移环境只创建一次，然后与应用程序的源代码本身一起维护。该环境是使用 Alembic 的 <code>init</code> 命令创建的，然后可以自定义以满足应用程序的特别需求。</p>
</blockquote>
<p>The structure of this environment, including some generated migration scripts, looks like:</p>
<blockquote>
<p>这个环境的结构，包括一些生成的迁移脚本，看起来像：</p>
</blockquote>
<pre><code class="language-text">yourproject/
    alembic/
        env.py
        README
        script.py.mako
        versions/
            3512b954651e_add_account.py
            2b1ae634e5cd_add_order_id.py
            3adcc9a56557_rename_username_field.py
</code></pre>
<p>The directory includes these directories/files:</p>
<blockquote>
<p>该目录包括以下目录/文件：</p>
</blockquote>
<ul>
<li>
<p><strong>yourproject</strong> - this is the root of your application’s source code, or some directory within it.</p>
</li>
<li>
<blockquote>
<p><strong>yourproject</strong> - 这是应用程序源代码的根目录，或其中的某个目录。</p>
</blockquote>
</li>
<li>
<p><strong>alembic</strong> - this directory lives within your application’s source tree and is the home of the migration environment. It can be named anything, and a project that uses multiple databases may even have more than one.</p>
</li>
<li>
<blockquote>
<p><strong>alembic</strong> - 该目录位于应用程序的源代码树中，是迁移环境的主目录。 它可以命名为任何名称，一个使用多个数据库的项目甚至可能有多个。</p>
</blockquote>
</li>
<li>
<p><strong>env.py</strong> - This is a Python script that is run whenever the alembic migration tool is invoked. At the very least, it contains instructions to configure and generate a SQLAlchemy engine, procure a connection from that engine along with a transaction, and then invoke the migration engine, using the connection as a source of database connectivity.</p>
</li>
<li>
<blockquote>
<p><strong>env.py</strong> - 这是一个 Python 脚本，只要调用 alembic 迁移工具就会运行。至少，它包含配置和生成 SQLAlchemy 引擎的指令，从该引擎获取连接以及事务，然后调用迁移引擎，使用该连接作为数据库连接的来源。</p>
</blockquote>
<p>The <code>env.py</code> script is part of the generated environment so that the way migrations run is entirely customizable. The exact specifics of how to connect are here, as well as the specifics of how the migration environment are invoked. The script can be modified so that multiple engines can be operated upon, custom arguments can be passed into the migration environment, application-specific libraries and models can be loaded in and made available.</p>
<blockquote>
<p><code>env.py</code> 脚本是生成环境的一部分，因此迁移运行的方式是完全可定制的。 如何连接的确切细节在这里，以及如何调用迁移环境的细节。 可以修改脚本以便可以操作多个引擎，可以将自定义参数传递到迁移环境中，可以加载特定于应用程序的库和模型并使其可用。</p>
</blockquote>
<p>Alembic includes a set of initialization templates which feature different varieties of <code>env.py</code> for different use cases.</p>
<blockquote>
<p>Alembic 包含一组初始化模板，其中包含针对不同用例的不同类型的 <code>env.py</code>。</p>
</blockquote>
</li>
<li>
<p><strong>README</strong> - included with the various environment templates, should have something informative.</p>
</li>
<li>
<blockquote>
<p><strong>README</strong> - 包含在各种环境模板中，应该有的一些说明信息。</p>
</blockquote>
</li>
<li>
<p><strong>script.py.mako</strong> - This is a <a href="http://www.makotemplates.org/">Mako</a> template file which is used to generate new migration scripts. Whatever is here is used to generate new files within <code>versions/</code>. This is scriptable so that the structure of each migration file can be controlled, including standard imports to be within each, as well as changes to the structure of the <code>upgrade()</code> and <code>downgrade()</code> functions. For example, the <code>multidb</code> environment allows for multiple functions to be generated using a naming scheme <code>upgrade_engine1()</code>, <code>upgrade_engine2()</code>.</p>
</li>
<li>
<blockquote>
<p><strong>script.py.mako</strong> - 这是一个 <a href="http://www.makotemplates.org/">Mako</a> 模板文件，用于生成新的迁移脚本。 这里的任何内容都用于在 <code>versions/</code> 中生成新文件。 这是可编的写脚本，因此可以控制每个迁移文件的结构，包括每个迁移文件中的标准导入，以及对 <code>upgrade()</code> 和 <code>downgrade()</code> 函数结构的更改。 例如，多数据库(multidb)环境允许使用命名方案<code>upgrade_engine1()</code>、<code>upgrade_engine2()</code>生成多个函数。</p>
</blockquote>
</li>
<li>
<p><strong>versions/</strong> - This directory holds the individual version scripts. Users of other migration tools may notice that the files here don’t use ascending integers, and instead use a partial GUID approach. In Alembic, the ordering of version scripts is relative to directives within the scripts themselves, and it is theoretically possible to “splice” version files in between others, allowing migration sequences from different branches to be merged, albeit carefully by hand.</p>
</li>
<li>
<blockquote>
<p><strong>versions/</strong> 该目录包含各个版本的脚本。 其他迁移工具的用户可能会注意到这里的文件不使用升序整数，而是使用部分 GUID 方法。 在 Alembic 中，版本脚本的排序与脚本本身内的指令相关，理论上可以在其他版本文件之间“拼接”版本文件，允许合并来自不同分支的迁移序列，尽管需要小心的手动合并。</p>
</blockquote>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-an-environment"><a class="header" href="#creating-an-environment">Creating an Environment</a></h1>
<p><strong>创建环境</strong></p>
<p>With a basic understanding of what the environment is, we can create one using <code>alembic init</code>. This will create an environment using the “generic” template:</p>
<p>对环境是什么有了基本的了解后，我们可以使用 <code>alembic init</code> 创建一个。 这将使用“通用（generic）”模板创建一个环境：</p>
<pre><code class="language-bash">cd /path/to/yourproject
source /path/to/yourproject/.venv/bin/activate   # assuming a local virtualenv (激活一个本地环境)
alembic init alembic
</code></pre>
<p>Where above, the init command was called to generate a migrations directory called alembic:</p>
<p>在上面的地方，调用了 <code>init</code> 命令来生成一个名为 alembic 的迁移目录：</p>
<pre><code class="language-bash">Creating directory /path/to/yourproject/alembic...done
Creating directory /path/to/yourproject/alembic/versions...done
Generating /path/to/yourproject/alembic.ini...done
Generating /path/to/yourproject/alembic/env.py...done
Generating /path/to/yourproject/alembic/README...done
Generating /path/to/yourproject/alembic/script.py.mako...done
Please edit configuration/connection/logging settings in '/path/to/yourproject/alembic.ini' before proceeding.
</code></pre>
<p>Alembic also includes other environment templates. These can be listed out using the <code>list_templates</code> command:</p>
<p>Alembic 还包括其他环境模板。 这些可以使用 <code>list_templates</code> 命令列出：</p>
<pre><code class="language-bash">$ alembic list_templates
Available templates:

generic - Generic single-database configuration.
async - Generic single-database configuration with an async dbapi.
multidb - Rudimentary multi-database configuration.
pylons - Configuration that reads from a Pylons project environment.

Templates are used via the 'init' command, e.g.:

  alembic init --template pylons ./scripts
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="editing-the-ini-file"><a class="header" href="#editing-the-ini-file">Editing the .ini File</a></h1>
<p><strong>编辑.ini文件</strong></p>
<p>Alembic placed a file <code>alembic.ini</code> into the current directory. This is a file that the <code>alembic</code> script looks for when invoked. This file can exist in a different directory, with the location to it specified by either the <code>--config</code> option for the <code>alembic</code> runner or the <code>ALEMBIC_CONFIG</code> environment variable (the former takes precedence).</p>
<blockquote>
<p>Alembic 将文件 <code>alembic.ini</code> 放入当前目录。 这是 <code>alembic</code> 脚本在调用时查找的文件。 该文件可以存在于不同的目录中，其位置由 alembic runner 的 <code>--config</code> 选项或 <code>ALEMBIC_CONFIG</code> 环境变量（前者优先）指定。</p>
</blockquote>
<p>The file generated with the “generic” configuration looks like:</p>
<blockquote>
<p>使用“通用(generic)”配置生成的文件如下所示：</p>
</blockquote>
<pre><code class="language-ini"># A generic, single database configuration.
# 通用的单一数据库配置。

[alembic]
# path to migration scripts
# 迁移脚本的路径
script_location = alembic

# template used to generate migration files
# 用于生成迁移文件的模板
# file_template = %%(rev)s_%%(slug)s

# sys.path path, will be prepended to sys.path if present.
# defaults to the current working directory.
# (new in 1.5.5)

# sys.path 路径，如果存在，将被添加到 sys.path 之前。
# 默认为当前工作目录。
# 版本1.5.5中新增
prepend_sys_path = .

# timezone to use when rendering the date within the migration file
# as well as the filename.
# If specified, requires the python-dateutil library that can be
# installed by adding `alembic[tz]` to the pip requirements
# string value is passed to dateutil.tz.gettz()
# leave blank for localtime

# 在迁移文件中呈现日期以及文件名时要使用的时区。
# 如果指定，则需要可以通过将 `alembic[tz]` 添加到 pip 要求来安装的 python-dateutil 库
# 字符串值将传递给 dateutil.tz.gettz() 
# 本地时间留空
# timezone =

# max length of characters to apply to the
# &quot;slug&quot; field

# 应用于“slug”字段的最大字符长度
# truncate_slug_length = 40

# set to 'true' to run the environment during
# the 'revision' command, regardless of autogenerate

# 设置为 'true' 以在 'revision' 命令期间运行环境，而无论是否自动生成
# revision_environment = false

# set to 'true' to allow .pyc and .pyo files without
# a source .py file to be detected as revisions in the
# versions/ directory

# 设置为“true”以允许将没有源 .py 文件的 .pyc 和 .pyo 文件检测为 `versions/` 目录中的版本文件
# sourceless = false

# version location specification; This defaults
# to ${script_location}/versions.  When using multiple version
# directories, initial revisions must be specified with --version-path.
# The path separator used here should be the separator specified by &quot;version_path_separator&quot; below.

# 版本位置规范； 这默认为`${script_location}/versions`。 使用多个版本目录时，必须使用 --version-path 指定初始版本。
# 这里使用的路径分隔符应该是下面“version_path_separator”指定的分隔符。
# version_locations = %(here)s/bar:%(here)s/bat:${script_location}/versions

# version path separator; As mentioned above, this is the character used to split
# version_locations. The default within new alembic.ini files is &quot;os&quot;, which uses os.pathsep.
# If this key is omitted entirely, it falls back to the legacy behavior of splitting on spaces and/or commas.
# Valid values for version_path_separator are:
#
# 版本路径分隔符； 如上所述，这是用于拆分 version_locations 的字符。 新 alembic.ini 文件中的默认值是“os”，它使用 os.pathsep。
# 如果这个键被完全省略，它会退回到在空格和/或逗号上分割的传统行为。
# version_path_separator 的有效值为：
# 
# version_path_separator = :
# version_path_separator = ;
# version_path_separator = space
version_path_separator = os  # Use os.pathsep. Default configuration used for new projects. (使用 os.pathsep。 用于新项目的默认配置。)

# the output encoding used when revision files
# are written from script.py.mako
# 从 script.py.mako 写入修订文件时使用的输出编码
# output_encoding = utf-8

sqlalchemy.url = driver://user:pass@localhost/dbname

# [post_write_hooks]
# This section defines scripts or Python functions that are run
# on newly generated revision scripts.  See the documentation for further
# detail and examples
# 本节定义在新生成的修订脚本上运行的脚本或 Python 函数。 有关更多详细信息和示例，请参阅文档

# format using &quot;black&quot; - use the console_scripts runner,
# against the &quot;black&quot; entrypoint
# 使用“black”格式 - 使用 console_scripts runner，针对“black”入口点
# hooks = black
# black.type = console_scripts
# black.entrypoint = black
# black.options = -l 79 REVISION_SCRIPT_FILENAME

# Logging configuration
# 日志记录配置
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
</code></pre>
<p>The file is read using <strong>Python’s ConfigParser.SafeConfigParser</strong> object. The <code>%(here)s</code> variable is provided as a substitution variable, which can be used to produce absolute pathnames to directories and files, as we do above with the path to the Alembic script location.</p>
<blockquote>
<p>该文件是使用 Python 的 <strong>ConfigParser.SafeConfigParser</strong> 对象读取的。 <strong>%(here)s</strong> 变量作为替代变量提供，可用于生成目录和文件的绝对路径名，就像我们上面对 Alembic 脚本位置的路径所做的那样。</p>
</blockquote>
<p>This file contains the following features:</p>
<blockquote>
<p>该文件包含以下功能：</p>
</blockquote>
<ul>
<li>
<p>[alembic] - this is the section read by Alembic to determine configuration. Alembic itself does not directly read any other areas of the file. The name “alembic” can be customized using the <strong>--name</strong> commandline flag; see <a href="zh//zh/07_cook_book.html">Run Multiple Alembic Environments from one .ini</a> file for a basic example of this.</p>
</li>
<li>
<blockquote>
<p>[alembic] - 这是 Alembic 读取的用于确定配置的部分。 Alembic 本身不直接读取文件的任何其他区域。 可以使用 <strong>--name</strong> 命令行标志自定义名称“alembic”； 有关此操作的基本示例，请参阅<a href="zh//zh/07_cook_book.html">从一个 .ini 文件运行多个 Alembic 环境</a>。</p>
</blockquote>
</li>
<li>
<p><strong>script_location</strong> - this is the location of the Alembic environment. It is normally specified as a filesystem location, either relative or absolute. If the location is a relative path, it’s interpreted as relative to the current directory.</p>
</li>
<li>
<blockquote>
<p><strong>script_location</strong> - 这是 Alembic 环境的位置。 它通常被指定为相对或绝对的文件系统位置。 如果位置是相对路径，则将其解释为相对于当前目录。</p>
</blockquote>
<p>This is the only key required by Alembic in all cases. The generation of the .ini file by the command <code>alembic init alembic</code> automatically placed the directory name <code>alembic</code> here. The special variable <code>%(here)s</code> can also be used, as in <code>%(here)s/alembic</code>.</p>
<blockquote>
<p>这是 Alembic 在所有情况下都需要的唯一密钥。 通过命令 <code>alembic init alembic</code> 生成的 <code>.ini</code> 文件会自动将目录名 <code>alembic</code> 放置在这里。 也可以使用特殊变量 <code>%(here)s</code>，如 <code>%(here)s/alembic</code>。</p>
</blockquote>
<p>For support of applications that package themselves into .egg files, the value can also be specified as a <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html">package resource</a>, in which case <strong>resource_filename()</strong> is used to find the file (new in 0.2.2). Any non-absolute URI which contains colons is interpreted here as a resource name, rather than a straight filename.</p>
<blockquote>
<p>为了支持将自身打包成 .egg 文件的应用程序，该值也可以指定为<a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html">包资源</a>，在这种情况下，<strong>resource_filename()</strong> 用于查找文件（版本0.2.2 中的新功能）。 任何包含冒号的非绝对 URI 在这里都被解释为资源名称，而不是直接的文件名。</p>
</blockquote>
</li>
<li>
<p><strong>file_template</strong> - this is the naming scheme used to generate new migration files. The value present is the default, so is commented out. Tokens available include:</p>
</li>
<li>
<blockquote>
<p><strong>file_template</strong> - 这是用于生成新迁移文件的命名方案。 存在的值是默认值，因此被注释掉。 可用的token包括：</p>
</blockquote>
<ul>
<li><strong>%%(rev)s</strong> - revision id (修订号)</li>
<li><strong>%%(slug)s</strong> - a truncated string derived from the revision message (从修订消息派生的截断字符串)</li>
<li><strong>%%(year)d</strong>, <strong>%%(month).2d</strong>, <strong>%%(day).2d</strong>, <strong>%%(hour).2d</strong>, <strong>%%(minute).2d</strong>, <strong>%%(second).2d</strong> - components of the create date, by default <strong>datetime.datetime.now()</strong> unless the <strong>timezone</strong> configuration option is also used. （创建日期的组成部分，默认为 <strong>datetime.datetime.now()</strong> 除非还使用了 <strong>timezone</strong> 配置选项。）</li>
</ul>
</li>
<li>
<p><strong>timezone</strong> - an optional timezone name (e.g. UTC, EST5EDT, etc.) that will be applied to the timestamp which renders inside the migration file’s comment as well as within the filename. This option requires installing the <strong>python-dateutil</strong> library. If <strong>timezone</strong> is specified, the create date object is no longer derived from <strong>datetime.datetime.now()</strong> and is instead generated as:</p>
</li>
<li>
<blockquote>
<p><strong>timezone</strong> - 一个可选的时区名称（例如 UTC、EST5EDT 等），它将应用于在迁移文件的注释以及文件名中呈现的时间戳。 此选项需要安装 <strong>python-dateutil</strong> 库。 如果指定了时区，则创建日期对象不再从 <strong>datetime.datetime.now()</strong> 派生，而是生成为：</p>
</blockquote>
<pre><code class="language-python">datetime.datetime.utcnow().replace(
    tzinfo=dateutil.tz.tzutc()
).astimezone(
    dateutil.tz.gettz(&lt;timezone&gt;)
)
</code></pre>
</li>
<li>
<p><strong>truncate_slug_length</strong> - defaults to 40, the max number of characters to include in the “slug” field.</p>
</li>
<li>
<blockquote>
<p><strong>truncate_slug_length</strong> - 默认为 40，即“slug”字段中包含的最大字符数。</p>
</blockquote>
</li>
<li>
<p><strong>sqlalchemy.url</strong> - A URL to connect to the database via SQLAlchemy. This configuration value is only used if the <strong>env.py</strong> file calls upon them; in the “generic” template, the call to <strong>config.get_main_option(&quot;sqlalchemy.url&quot;)</strong> in the <strong>run_migrations_offline()</strong> function and the call to <strong>engine_from_config(prefix=&quot;sqlalchemy.&quot;)</strong> in the <strong>run_migrations_online()</strong> function are where this key is referenced. If the SQLAlchemy URL should come from some other source, such as from environment variables or a global registry, or if the migration environment makes use of multiple database URLs, the developer is encouraged to alter the <strong>env.py</strong> file to use whatever methods are appropriate in order to acquire the database URL or URLs.</p>
</li>
<li>
<blockquote>
<p><strong>sqlalchemy.url</strong> - 通过 SQLAlchemy 连接到数据库的 URL。 此配置值仅在 <strong>env.py</strong> 文件调用它们时使用； 在“通用”模板中，<strong>run_migrations_offline()</strong> 函数中对 <strong>config.get_main_option(&quot;sqlalchemy.url&quot;)</strong> 的调用和 <strong>run_migrations_online()</strong> 函数中对 <strong>engine_from_config(prefix=&quot;sqlalchemy.&quot;)</strong> 的调用是该键所在的位置参考。 如果 SQLAlchemy URL 应该来自某些其他源，例如来自环境变量或全局注册表，或者如果迁移环境使用多个数据库 URL，则鼓励开发人员更改 <strong>env.py</strong> 文件以使用任何合适的方法以获取数据库 URL 或 其他URL。</p>
</blockquote>
</li>
<li>
<p><strong>revision_environment</strong> - this is a flag which when set to the value ‘true’, will indicate that the migration environment script <strong>env.py</strong> should be run unconditionally when generating new revision files, as well as when running the <strong>alembic history</strong> command.</p>
</li>
<li>
<blockquote>
<p><strong>revision_environment</strong> - 这是一个标志，当设置为值“true”时，将指示在生成新修订文件以及运行 alembic 历史命令时应无条件运行迁移环境脚本 <strong>env.py</strong>。</p>
</blockquote>
</li>
<li>
<p><strong>sourceless</strong> - when set to ‘true’, revision files that only exist as .pyc or .pyo files in the versions directory will be used as versions, allowing “sourceless” versioning folders. When left at the default of ‘false’, only .py files are consumed as version files.</p>
</li>
<li>
<blockquote>
<p><strong>sourceless</strong> - 当设置为“true”时，版本目录中仅作为 .pyc 或 .pyo 文件存在的修订文件将用作版本，允许“无源”版本控制文件夹。 当保留默认值“false”时，只有 .py 文件被用作版本文件。</p>
</blockquote>
</li>
<li>
<p><strong>version_locations</strong> - an optional list of revision file locations, to allow revisions to exist in multiple directories simultaneously. See <a href="zh//zh/07_cook_book.html">Working with Multiple Bases</a> for examples.</p>
</li>
<li>
<blockquote>
<p><strong>version_locations</strong> - 一个可选的修订文件位置列表，允许修订同时存在于多个目录中。 有关示例，请参阅 <a href="zh//zh/07_cook_book.html">Working with Multiple Bases</a>。</p>
</blockquote>
</li>
<li>
<p><strong>version_path_separator</strong> - a separator of <strong>version_locations</strong> paths. It should be defined if multiple version_locations is used. See <a href="zh//zh/07_cook_book.html">Working with Multiple Bases</a> for examples.</p>
</li>
<li>
<blockquote>
<p><strong>version_path_separator</strong> - version_locations 路径的分隔符。 如果使用多个 <strong>version_locations</strong>，则应定义它。 有关示例，请参阅<a href="zh//zh/07_cook_book.html">Working with Multiple Bases</a>。</p>
</blockquote>
</li>
<li>
<p><strong>output_encoding</strong> - the encoding to use when Alembic writes the <strong>script.py.mako</strong> file into a new migration file. Defaults to <code>'utf-8'</code>.</p>
</li>
<li>
<blockquote>
<p><strong>output_encoding</strong> - 当 Alembic 将 <strong>script.py.mako</strong> 文件写入新的迁移文件时使用的编码。 默认为“utf-8”。</p>
</blockquote>
</li>
<li>
<p>[loggers], [handlers], [formatters], [logger_<em>], [handler_</em>], [formatter_*] - these sections are all part of Python’s standard logging configuration, the mechanics of which are documented at <a href="http://docs.python.org/library/logging.config.html#configuration-file-format">Configuration File Format</a>. As is the case with the database connection, these directives are used directly as the result of the <strong>logging.config.fileConfig()</strong> call present in the <strong>env.py</strong> script, which you’re free to modify.</p>
</li>
<li>
<blockquote>
<p>[loggers], [handlers], [formatters], [logger_<em>], [handler_</em>], [formatter_*] - 这些部分都是 Python 标准日志配置的一部分，其机制记录在配置文件格式中。 与数据库连接的情况一样，这些指令直接作为 <strong>env.py</strong> 脚本中存在的 <strong>logging.config.fileConfig()</strong> 调用的结果使用，您可以自由修改。</p>
</blockquote>
</li>
</ul>
<p>For starting up with just a single database and the generic configuration, setting up the SQLAlchemy URL is all that’s needed:</p>
<blockquote>
<p>对于只使用单个数据库和通用配置的启动，只需要设置 SQLAlchemy URL：</p>
</blockquote>
<pre><code class="language-python">sqlalchemy.url = postgresql://scott:tiger@localhost/test
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-a-migration-script"><a class="header" href="#create-a-migration-script">Create a Migration Script</a></h1>
<p><strong>创建迁移脚本</strong></p>
<p>With the environment in place we can create a new revision, using <code>alembic revision</code>:</p>
<blockquote>
<p>环境准备好后，我们可以使用 <code>alembic revision</code> 创建一个新修订：</p>
</blockquote>
<pre><code class="language-bash">$ alembic revision -m &quot;create account table&quot;
Generating /path/to/yourproject/alembic/versions/1975ea83b712_create_accoun
t_table.py...done
</code></pre>
<p>A new file <code>1975ea83b712_create_account_table.py</code> is generated. Looking inside the file:</p>
<blockquote>
<p>生成了一个新文件<code>1975ea83b712_create_account_table.py</code>。 文件内容如下:</p>
</blockquote>
<pre><code class="language-python">&quot;&quot;&quot;create account table

Revision ID: 1975ea83b712
Revises:
Create Date: 2011-11-08 11:40:27.089406

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '1975ea83b712'
down_revision = None
branch_labels = None

from alembic import op
import sqlalchemy as sa

def upgrade():
    pass

def downgrade():
    pass
</code></pre>
<p>The file contains some header information, identifiers for the current revision and a “downgrade” revision, an import of basic Alembic directives, and empty <code>upgrade()</code> and <code>downgrade()</code> functions. Our job here is to populate the <code>upgrade()</code> and <code>downgrade()</code> functions with directives that will apply a set of changes to our database. Typically, <code>upgrade()</code> is required while <code>downgrade()</code> is only needed if down-revision capability is desired, though it’s probably a good idea.</p>
<blockquote>
<p>该文件包含一些标题信息、当前修订和“downgrade”修订的标识符、Alembic 基本的导入指令以及空的 <code>upgrade()</code> 和 <code>downgrade()</code> 函数。我们在这里的工作是使用指令填充 <code>upgrade()</code> 和 <code>downgrade()</code> 函数，这些指令将对我们的数据库应用一组更改。通常，<code>upgrade()</code> 是必需的，而 <code>downgrade()</code> 仅在向下修订功能需要时才使用，尽管这可能是一个好主意。</p>
</blockquote>
<p>Another thing to notice is the <code>down_revision</code> variable. This is how Alembic knows the correct order in which to apply migrations. When we create the next revision, the new file’s <code>down_revision</code> identifier would point to this one:</p>
<blockquote>
<p>另一件需要注意的是 <code>down_revision</code> 变量。 这就是 Alembic 知道应用迁移的正确顺序的方式。 当我们创建下一个修订版时，新文件的 <code>down_revision</code> 标识符将指向这个：</p>
</blockquote>
<pre><code class="language-python"># revision identifiers, used by Alembic.
revision = 'ae1027a6acf'
down_revision = '1975ea83b712'
</code></pre>
<p>Every time Alembic runs an operation against the <code>versions/</code> directory, it reads all the files in, and composes a list based on how the <code>down_revision</code> identifiers link together, with the <code>down_revision</code> of <code>None</code> representing the first file. In theory, if a migration environment had thousands of migrations, this could begin to add some latency to startup, but in practice a project should probably prune old migrations anyway (see the section <a href="zh//en/cookbook.html#building-uptodate">Building an Up to Date Database from Scratch</a> for a description on how to do this, while maintaining the ability to build the current database fully).</p>
<blockquote>
<p>每次 Alembic 对 <code>versions/</code> 目录运行操作时，它都会读取所有文件，并根据 <code>down_revision</code> 标识符链接在一起的方式组成一个列表，其中<code>down_revision</code> 变量为 <code>None</code> 的文件代表第一个迁移文件。 理论上，如果迁移环境有数千次迁移，这在开始迁移时增加一些延迟，但在项目实践中，无论如何都应该精简旧的迁移(有关如何执行此操作的说明，请参阅<a href="zh//en/cookbook.html#building-uptodate">从头开始构建最新数据库部分</a>，同时保持完全构建当前数据库的能力).</p>
</blockquote>
<p>We can then add some directives to our script, suppose adding a new table <code>account</code>:</p>
<blockquote>
<p>然后我们可以向我们的脚本添加一些指令，假设添加一个新表 <code>account</code>：</p>
</blockquote>
<pre><code class="language-python">def upgrade():
    op.create_table(
        'account',
        sa.Column('id', sa.Integer, primary_key=True),
        sa.Column('name', sa.String(50), nullable=False),
        sa.Column('description', sa.Unicode(200)),
    )

def downgrade():
    op.drop_table('account')
</code></pre>
<p><a href="zh//en/ops.html#alembic.operations.Operations.create_table">create_table()</a> and <a href="zh//en/ops.html#alembic.operations.Operations.drop_table">drop_table()</a> are Alembic directives. Alembic provides all the basic database migration operations via these directives, which are designed to be as simple and minimalistic as possible; there’s no reliance upon existing table metadata for most of these directives. They draw upon a global “context” that indicates how to get at a database connection (if any; migrations can dump SQL/DDL directives to files as well) in order to invoke the command. This global context is set up, like everything else, in the <code>env.py</code> script.</p>
<blockquote>
<p><a href="zh//en/ops.html#alembic.operations.Operations.create_table">create_table()</a> 和 <a href="zh//en/ops.html#alembic.operations.Operations.drop_table">drop_table()</a> 是 Alembic 指令。 Alembic 通过这些指令提供了所有基本的数据库迁移操作，这些指令设计得尽可能简单和简约； 大多数这些指令不依赖现有的表元数据。 它们利用一个全局“上下文”来指示如何获得数据库连接（如果有的话；迁移也可以将 SQL/DDL 指令转储到文件）以调用命令。 与其他所有内容一样，此全局上下文在 <code>env.py</code> 脚本中设置。</p>
</blockquote>
<p>An overview of all Alembic directives is at <a href="zh//en/ops.html#ops">Operation Reference</a>.</p>
<blockquote>
<p>所有 Alembic 指令的概述位于 <a href="zh//en/ops.html#ops">操作参考</a>。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-our-first-migration"><a class="header" href="#running-our-first-migration">Running our First Migration</a></h1>
<p><strong>运行我们的第一次迁移</strong></p>
<p>We now want to run our migration. Assuming our database is totally clean, it’s as yet unversioned. The <code>alembic upgrade</code> command will run upgrade operations, proceeding from the current database revision, in this example <code>None</code>, to the given target revision. We can specify <code>1975ea83b712</code> as the revision we’d like to upgrade to, but it’s easier in most cases just to tell it “the most recent”, in this case <code>head</code>:</p>
<blockquote>
<p>我们现在想要运行我们的迁移。 假设我们的数据库完全干净，它还没有版本化。 <code>alembic upgrade</code> 命令将运行升级操作，从当前数据库修订版（在本例中为“<strong>None</strong>”）到给定的目标修订版。 我们可以指定 <code>1975ea83b712</code> 作为我们想要升级到的修订版，但在大多数情况下，告诉它“<strong>最新的</strong>”更容易，在这种情况下是 <code>head</code>：</p>
</blockquote>
<pre><code class="language-bash">$ alembic upgrade head
INFO  [alembic.context] Context class PostgresqlContext.
INFO  [alembic.context] Will assume transactional DDL.
INFO  [alembic.context] Running upgrade None -&gt; 1975ea83b712
</code></pre>
<p>Wow that rocked! Note that the information we see on the screen is the result of the logging configuration set up in <code>alembic.ini</code> - logging the <code>alembic</code> stream to the console (standard error, specifically).</p>
<blockquote>
<p>哇，震撼！ 请注意，我们在屏幕上看到的信息是在 <code>alembic.ini</code> 中设置的日志配置的结果 - 将 <code>alembic</code> 流记录到控制台（特别是标准错误）。</p>
</blockquote>
<p>The process which occurred here included that Alembic first checked if the database had a table called <code>alembic_version</code>, and if not, created it. It looks in this table for the current version, if any, and then calculates the path from this version to the version requested, in this case <code>head</code>, which is known to be <code>1975ea83b712</code>. It then invokes the <code>upgrade()</code> method in each file to get to the target revision.</p>
<blockquote>
<p>此处发生的过程包括 Alembic 首先检查数据库是否有名为“<strong>alembic_version</strong>”的表，如果没有，则创建它。 它在此表中查找当前版本（如果有），然后计算从该版本到请求版本的路径，在本例中为 <code>head</code>，已知为 <code>1975ea83b712</code>。 然后它调用每个文件中的 <code>upgrade()</code> 方法以获取目标修订版。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id=""><a class="header" href="#"></a></h1>
<p><strong>再次运行迁移</strong></p>
<p>Let’s do another one so we have some things to play with. We again create a revision file:</p>
<blockquote>
<p>让我们再做一个，这样我们就有一些东西可以玩了。 我们再次创建一个修订文件：</p>
</blockquote>
<pre><code class="language-bash">$ alembic revision -m &quot;Add a column&quot;
Generating /path/to/yourapp/alembic/versions/ae1027a6acf_add_a_column.py...
done
</code></pre>
<p>Let’s edit this file and add a new column to the <code>account</code> table:</p>
<blockquote>
<p>让我们编辑这个文件并向 <code>account</code> 表中添加一个新列：</p>
</blockquote>
<pre><code class="language-python">&quot;&quot;&quot;Add a column

Revision ID: ae1027a6acf
Revises: 1975ea83b712
Create Date: 2011-11-08 12:37:36.714947

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = 'ae1027a6acf'
down_revision = '1975ea83b712'

from alembic import op
import sqlalchemy as sa

def upgrade():
    op.add_column('account', sa.Column('last_transaction_date', sa.DateTime))

def downgrade():
    op.drop_column('account', 'last_transaction_date')
</code></pre>
<p>Running again to <code>head</code>:</p>
<blockquote>
<p>再次运行到<code>head</code>：</p>
</blockquote>
<pre><code class="language-bash">$ alembic upgrade head
INFO  [alembic.context] Context class PostgresqlContext.
INFO  [alembic.context] Will assume transactional DDL.
INFO  [alembic.context] Running upgrade 1975ea83b712 -&gt; ae1027a6acf
</code></pre>
<p>We’ve now added the <code>last_transaction_date</code> column to the database.</p>
<blockquote>
<p>我们现在已将 <code>last_transaction_date</code> 列添加到数据库中。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partial-revision-identifiers"><a class="header" href="#partial-revision-identifiers">Partial Revision Identifiers</a></h1>
<p><strong>部分修订标识符</strong></p>
<p>Any time we need to refer to a revision number explicitly, we have the option to use a partial number. As long as this number uniquely identifies the version, it may be used in any command in any place that version numbers are accepted:</p>
<blockquote>
<p>任何时候我们需要明确引用修订号，我们都可以选择使用部分编号。 只要这个数字唯一标识版本，它就可以在任何接受版本号的地方用在任何命令中：</p>
</blockquote>
<pre><code class="language-bash">alembic upgrade ae1
</code></pre>
<p>Above, we use <code>ae1</code> to refer to revision <code>ae1027a6acf</code>. Alembic will stop and let you know if more than one version starts with that prefix.</p>
<blockquote>
<p>上面，我们使用 <code>ae1</code> 来指代修订版 <code>ae1027a6acf</code>。 如果有多个版本以该前缀开头，Alembic 将停止并通知您。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="relative-migration-identifiers"><a class="header" href="#relative-migration-identifiers">Relative Migration Identifiers</a></h1>
<p><strong>相对迁移标识符</strong></p>
<p>Relative upgrades/downgrades are also supported. To move two versions from the current, a decimal value “+N” can be supplied:</p>
<blockquote>
<p>还支持相对升级/降级。 要从当前移动两个版本，可以提供十进制值“+N”：</p>
</blockquote>
<pre><code class="language-bash">alembic upgrade +2
</code></pre>
<p>Negative values are accepted for downgrades:</p>
<blockquote>
<p>降级接受负值：</p>
</blockquote>
<pre><code class="language-bash">alembic downgrade -1
</code></pre>
<p>Relative identifiers may also be in terms of a specific revision. For example, to upgrade to revision <code>ae1027a6acf</code> plus two additional steps:</p>
<blockquote>
<p>相对标识符也可以是特定版本。 例如，要升级到修订版 <code>ae1027a6acf</code> 加上两个额外的步骤：</p>
</blockquote>
<pre><code class="language-bash">alembic upgrade ae10+2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-information"><a class="header" href="#getting-information">Getting Information</a></h1>
<p><strong>获取信息</strong></p>
<p>With a few revisions present we can get some information about the state of things.</p>
<blockquote>
<p>通过一些修改，我们可以获得一些关于迁移版本状态的信息。</p>
</blockquote>
<p>First we can view the current revision:</p>
<blockquote>
<p>首先我们可以查看当前版本：</p>
</blockquote>
<pre><code class="language-bash">$ alembic current
INFO  [alembic.context] Context class PostgresqlContext.
INFO  [alembic.context] Will assume transactional DDL.
Current revision for postgresql://scott:XXXXX@localhost/test: 1975ea83b712 -&gt; ae1027a6acf (head), Add a column
</code></pre>
<p><code>head</code> is displayed only if the revision identifier for this database matches the head revision.</p>
<blockquote>
<p>仅当此数据库的修订标识符与头部修订匹配时才显示 <code>head</code>。</p>
</blockquote>
<p>We can also view history with <code>alembic history</code>; the <code>--verbose</code> option (accepted by several commands, including <code>history</code>, <code>current</code>, <code>heads</code> and <code>branches</code>) will show us full information about each revision:</p>
<blockquote>
<p>我们也可以用<code>alembic history</code>命令查看历史； <code>--verbose</code> 选项（多个命令都接受改选项，包括 <code>history</code>、<code>current</code>、<code>heads</code> 和 <code>branches</code>）将向我们显示每个版本的完整信息：</p>
</blockquote>
<pre><code class="language-bash">$ alembic history --verbose

Rev: ae1027a6acf (head)
Parent: 1975ea83b712
Path: /path/to/yourproject/alembic/versions/ae1027a6acf_add_a_column.py

    add a column

    Revision ID: ae1027a6acf
    Revises: 1975ea83b712
    Create Date: 2014-11-20 13:02:54.849677

Rev: 1975ea83b712
Parent: &lt;base&gt;
Path: /path/to/yourproject/alembic/versions/1975ea83b712_add_account_table.py

    create account table

    Revision ID: 1975ea83b712
    Revises:
    Create Date: 2014-11-20 13:02:46.257104
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="viewing-history-ranges"><a class="header" href="#viewing-history-ranges">Viewing History Ranges</a></h1>
<p><strong>查看历史范围</strong></p>
<p>Using the <code>-r</code> option to <code>alembic history</code>, we can also view various slices of history. The <code>-r</code> argument accepts an argument <code>[start]:[end]</code>, where either may be a revision number, symbols like <code>head</code>, <code>heads</code> or <code>base</code>, <code>current</code> to specify the current revision(s), as well as negative relative ranges for <code>[start]</code> and positive relative ranges for <code>[end]</code>:</p>
<blockquote>
<p>使用 <code>alembic history</code> 的 <code>-r</code> 选项，我们还可以查看历史片段。 <code>-r</code> 参数接受一个参数 <code>[start]:[end]</code>，其中可以是一个修订号，像 <code>head</code>、<code>heads</code> 或 <code>base</code>、<code>current</code> 这样的符号来指定当前的修订版本，以及<code>[start]</code> 的负相对范围和<code>[end]</code> 的正相对范围：</p>
</blockquote>
<pre><code class="language-bash">alembic history -r1975ea:ae1027
</code></pre>
<p>A relative range starting from three revisions ago up to current migration, which will invoke the migration environment against the database to get the current migration:</p>
<blockquote>
<p>从前三个修订版本到当前迁移版本的相对范围，它将针对数据库调用迁移环境以获取当前迁移：</p>
</blockquote>
<pre><code class="language-bash">alembic history -r-3:current
</code></pre>
<p>View all revisions from <code>1975</code> to the <code>head</code>:</p>
<blockquote>
<p>查看从<code>1975</code>到<code>head</code>的所有修订：</p>
</blockquote>
<pre><code class="language-bash">alembic history -r1975ea:
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="downgrading"><a class="header" href="#downgrading">Downgrading</a></h1>
<p><strong>降级</strong></p>
<p>We can illustrate a downgrade back to nothing, by calling <code>alembic downgrade</code> back to the beginning, which in Alembic is called <code>base</code>:</p>
<blockquote>
<p>我们可以通过调用 <code>alembic downgrade</code> 回到最初始状态, 来演示降级到迁移最初始状态，在 Alembic 中称为 <code>base</code>：</p>
</blockquote>
<pre><code class="language-bash">$ alembic downgrade base
INFO  [alembic.context] Context class PostgresqlContext.
INFO  [alembic.context] Will assume transactional DDL.
INFO  [alembic.context] Running downgrade ae1027a6acf -&gt; 1975ea83b712
INFO  [alembic.context] Running downgrade 1975ea83b712 -&gt; None
</code></pre>
<p>Back to nothing - and up again:</p>
<blockquote>
<p>降级到最初始状态 - 然后再次升级:</p>
</blockquote>
<pre><code class="language-bash">$ alembic upgrade head
INFO  [alembic.context] Context class PostgresqlContext.
INFO  [alembic.context] Will assume transactional DDL.
INFO  [alembic.context] Running upgrade None -&gt; 1975ea83b712
INFO  [alembic.context] Running upgrade 1975ea83b712 -&gt; ae1027a6acf
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h1>
<p><strong>下一步</strong></p>
<p>The vast majority of Alembic environments make heavy use of the “autogenerate” feature. Continue onto the next section, <a href="zh//zh/01_auto_generating_migrations.html">Auto Generating Migrations</a>.</p>
<blockquote>
<p>绝大多数 Alembic 环境大量使用“自动生成”功能。 继续下一部分，<a href="zh//zh/01_auto_generating_migrations.html">自动生成迁移</a>。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="auto-generating-migrations"><a class="header" href="#auto-generating-migrations">Auto Generating Migrations</a></h1>
<p><strong>自动生成迁移</strong></p>
<p>Alembic can view the status of the database and compare against the table metadata in the application, generating the “obvious” migrations based on a comparison. This is achieved using the <code>--autogenerate</code> option to the <code>alembic revision</code> command, which places so-called candidate migrations into our new migrations file. We review and modify these by hand as needed, then proceed normally.</p>
<blockquote>
<p>Alembic 可以查看数据库的状态并与应用程序中的表元数据进行比较，根据比较生成“显而易见”的迁移。 这是通过使用 <code>alembic revision</code> 命令的 <code>--autogenerate</code> 选项来实现的，它将所有的待迁移放入我们的新迁移文件中。 我们根据需要手动审查和修改这些，然后正常进行。</p>
</blockquote>
<p>To use autogenerate, we first need to modify our <code>env.py</code> so that it gets access to a table metadata object that contains the target. Suppose our application has a <a href="https://docs.sqlalchemy.org/en/14/orm/extensions/declarative/index.html#declarative-toplevel">declarative base</a> in <code>myapp.mymodel</code>. This base contains a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object which contains <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> objects defining our database. We make sure this is loaded in <code>env.py</code> and then passed to <a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a> via the <code>target_metadata</code> argument. The <code>env.py</code> sample script used in the generic template already has a variable declaration near the top for our convenience, where we replace <code>None</code> with our <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong>. Starting with:</p>
<blockquote>
<p>要使用自动生成，我们首先需要修改我们的 <code>env.py</code> 以便它可以访问包含目标的表元数据对象。 假设我们的应用程序在 <code>myapp.mymodel</code> 中有一个 <a href="https://docs.sqlalchemy.org/en/14/orm/extensions/declarative/index.html#declarative-toplevel">declarative base</a>。 该 <strong>base</strong> 包含一个 <strong>MetaData</strong> 对象，该对象包含我们定义的数据库的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> 对象。 我们确保它被加载到 <code>env.py</code> 中，然后通过 <code>target_metadata</code> 参数传递给 <a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a>。 为方便起见，通用模板中使用的 <code>env.py</code> 示例脚本在靠近顶部的地方已经有一个变量声明，我们用 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 替换了 <code>None</code>。 比如：</p>
</blockquote>
<pre><code class="language-python"># add your model's MetaData object here
# for 'autogenerate' support
# from myapp import mymodel
# target_metadata = mymodel.Base.metadata
target_metadata = None
</code></pre>
<p>we change to:</p>
<blockquote>
<p>我们改变成:</p>
</blockquote>
<pre><code class="language-python">from myapp.mymodel import Base
target_metadata = Base.metadata
</code></pre>
<ul>
<li>
<p><strong>Note</strong>: The above example refers to the <code>generic alembic env.py template</code>, e.g. the one created by default when calling upon <code>alembic init</code>, and not the special-use templates such as <code>multidb</code>. Please consult the source code and comments within the <code>env.py</code> script directly for specific guidance on where and how the autogenerate metadata is established.</p>
</li>
<li>
<blockquote>
<p><strong>注意</strong>: 上面的例子指的是“通用的 alembic env.py 模板”，例如 调用<code>alembic init</code>时默认创建的那个，而不是像<code>multidb</code>这样的特殊模板。 请直接查阅“env.py”脚本中的源代码和注释，以获取有关在何处以及如何建立自动生成元数据的具体指导。</p>
</blockquote>
</li>
</ul>
<p>If we look later in the script, down in <code>run_migrations_online()</code>, we can see the directive passed to <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong>:</p>
<blockquote>
<p>如果我们稍后查看脚本，在 <code>run_migrations_online()</code> 中，我们可以看到传递给 <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> 的指令：</p>
</blockquote>
<pre><code class="language-python">def run_migrations_online():
    engine = engine_from_config(
                config.get_section(config.config_ini_section), prefix='sqlalchemy.')

    with engine.connect() as connection:
        context.configure(
                    connection=connection,
                    target_metadata=target_metadata
                    )

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p>We can then use the <code>alembic revision</code> command in conjunction with the <code>--autogenerate</code> option. Suppose our <a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a> contained a definition for the <code>account</code> table, and the database did not. We’d get output like:</p>
<blockquote>
<p>然后我们可以将<code>alembic revision</code> 命令与<code>--autogenerate</code> 选项结合使用。 假设我们的 <a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a> 包含对 <code>account</code> 表的定义，而数据库没有。 我们会得到如下输出：</p>
</blockquote>
<pre><code class="language-bash">$ alembic revision --autogenerate -m &quot;Added account table&quot;
INFO [alembic.context] Detected added table 'account'
Generating /path/to/foo/alembic/versions/27c6a30d7c24.py...done
</code></pre>
<p>We can then view our file <code>27c6a30d7c24.py</code> and see that a rudimentary migration is already present:</p>
<blockquote>
<p>然后我们可以查看我们的 <code>27c6a30d7c24.py</code> 文件, 并看到一个基本的迁移已经存在：</p>
</blockquote>
<pre><code class="language-python">&quot;&quot;&quot;empty message

Revision ID: 27c6a30d7c24
Revises: None
Create Date: 2011-11-08 11:40:27.089406

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '27c6a30d7c24'
down_revision = None

from alembic import op
import sqlalchemy as sa

def upgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
    'account',
    sa.Column('id', sa.Integer()),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.Column('description', sa.VARCHAR(200)),
    sa.Column('last_transaction_date', sa.DateTime()),
    sa.PrimaryKeyConstraint('id')
    )
    ### end Alembic commands ###

def downgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.drop_table(&quot;account&quot;)
    ### end Alembic commands ###
</code></pre>
<p>The migration hasn’t actually run yet, of course. We do that via the usual <code>upgrade</code> command. We should also go into our migration file and alter it as needed, including adjustments to the directives as well as the addition of other directives which these may be dependent on - specifically data changes in between creates/alters/drops.</p>
<blockquote>
<p>当然，迁移还没有真正运行。 我们通过常用的<code>upgrade</code>命令来做到这一点。 我们还应该进入我们的迁移文件并根据需要更改它，包括对指令的调整以及添加这些可能依赖的其他指令 - 特别是在创建/更改/删除之间的数据更改。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-does-autogenerate-detect"><a class="header" href="#what-does-autogenerate-detect">What does Autogenerate Detect</a></h1>
<p>The vast majority of user issues with Alembic centers on the topic of what kinds of changes autogenerate can and cannot detect reliably, as well as how it renders Python code for what it does detect. It is critical to note that <strong>autogenerate is not intended to be perfect</strong>. It is <em>always</em> necessary to manually review and correct the <strong>candidate migrations</strong> that autogenerate produces. The feature is getting more and more comprehensive and error-free as releases continue, but one should take note of the current limitations.</p>
<blockquote>
<p>Alembic 的绝大多数用户问题都集中在自动生成哪些类型的更改可以和不能可靠检测的主题上，以及它如何为检测到的内容呈现 Python 代码。 重要的是要注意自动生成并不是完美的。 始终需要手动检查和更正自动生成的候选迁移。 随着版本的不断发布，该功能变得越来越全面且无错误，但应注意当前的限制。</p>
</blockquote>
<p>Autogenerate <strong>will detect</strong>:</p>
<ul>
<li>Table additions, removals.</li>
<li>Column additions, removals.</li>
<li>Change of nullable status on columns.</li>
<li>Basic changes in indexes and explicitly-named unique constraints</li>
<li>Basic changes in foreign key constraints</li>
</ul>
<blockquote>
<p>Autogenerate 将<strong>检测</strong>：</p>
<ul>
<li>表的添加、删除。</li>
<li>列添加、删除。</li>
<li>列可为空状态的更改。</li>
<li>索引和显式命名的唯一约束的基本变化.</li>
<li>外键约束的基本变化</li>
</ul>
</blockquote>
<p>Autogenerate can <strong>optionally detect</strong>:</p>
<ul>
<li>
<p>Change of column type. This will occur if you set the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> parameter to <code>True</code>. The default implementation will reliably detect major changes, such as between <strong>Numeric</strong> and <strong>String</strong>, as well as accommodate for the types generated by SQLAlchemy’s “generic” types such as <strong>Boolean</strong>. Arguments that are shared between both types, such as length and precision values, will also be compared. If either the metadata type or database type has <strong>additional</strong> arguments beyond that of the other type, these are <strong>not</strong> compared, such as if one numeric type featured a “scale” and other type did not, this would be seen as the backing database not supporting the value, or reporting on a default that the metadata did not specify.</p>
<p>The type comparison logic is fully extensible as well; see <a href="zh/../en/autogenerate.html#compare-types">Comparing Types</a> for details.</p>
<blockquote>
<p>Changed in version 1.4: type comparison code has been reworked such that column types are compared based on their rendered DDL, which should allow the functionality enabled by <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> to be much more accurate, correctly accounting for the behavior of SQLAlchemy “generic” types as well as major arguments specified within types.</p>
</blockquote>
</li>
<li>
<p>Change of server default. This will occur if you set the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_server_default">EnvironmentContext.configure.compare_server_default</a></strong> parameter to True, or to a custom callable function. This feature works well for simple cases but cannot always produce accurate results. The Postgresql backend will actually invoke the “detected” and “metadata” values against the database to determine equivalence. The feature is off by default so that it can be tested on the target schema first. Like type comparison, it can also be customized by passing a callable; see the function’s documentation for details.</p>
</li>
</ul>
<blockquote>
<p>Autogenerate <strong>可以选择检测</strong>：</p>
<ul>
<li>
<p>列类型的更改。 如果您将 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> 参数设置为 <code>True</code> ，则会发生这种情况。 默认实现将可靠地检测主要更改，例如 <strong>Numeric</strong> 和 <strong>String</strong> 之间的更改，并适应 SQLAlchemy 生成的“通用”类型（例如 <strong>Boolean</strong> 类型）。 两种类型之间共享的参数，如长度和精度值，也将进行比较。如果元数据类型或数据库类型有其他类型的额外参数，则<strong>不会</strong>比较这些参数，例如如果一个 numeric 类型 具有 “scale” 而其他类型没有，这将被视为后端数据库不支持该值或者报告为元数据未指定的默认值。</p>
<p>类型比较逻辑也是完全可扩展的； 有关详细信息，请参阅<a href="zh/../en/autogenerate.html#compare-types">Comparing Types</a>。</p>
<ul>
<li><em>版本 1.4 更新</em>: 类型比较代码已经过重新设计，以便根据它们呈现的 DDL 比较列类型，这应该允许 EnvironmentContext.configure.compare_type 启用的功能更加准确，更准确的解释 SQLAlchemy 的“通用”类型的行为以及类型中指定的主要参数。</li>
</ul>
</li>
<li>
<p>更改服务端默认设置。 如果您将 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_server_default">EnvironmentContext.configure.compare_server_default</a></strong> 参数设置为 True 或自定义可调用函数，则会发生这种情况。 此功能适用于简单的情况，但不能始终产生准确的结果。Postgresql 后端实际上会针对数据库调用 “detected” 和 “metadata” 值以确定等效性。该功能默认处于关闭状态，因此可以先在目标架构上进行测试。 和类型比较一样，也可以通过传递一个callable来自定义； 有关详细信息，请参阅该函数的文档。</p>
</li>
</ul>
</blockquote>
<p>Autogenerate can <strong>not detect</strong>:</p>
<ul>
<li>Changes of table name. These will come out as an add/drop of two different tables, and should be hand-edited into a name change instead.</li>
<li>Changes of column name. Like table name changes, these are detected as a column add/drop pair, which is not at all the same as a name change.</li>
<li>Anonymously named constraints. Give your constraints a name, e.g. <strong>UniqueConstraint('col1', 'col2', name=&quot;my_name&quot;)</strong>. See the section <a href="zh/../zh/03_the_importance_of_naming_constraints.html">The Importance of Naming Constraints</a> for background on how to configure automatic naming schemes for constraints.</li>
<li>Special SQLAlchemy types such as <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> when generated on a backend which doesn’t support ENUM directly - this because the representation of such a type in the non-supporting database, i.e. a CHAR+ CHECK constraint, could be any kind of CHAR+CHECK. For SQLAlchemy to determine that this is actually an ENUM would only be a guess, something that’s generally a bad idea. To implement your own “guessing” function here, use the <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.column_reflect">sqlalchemy.events.DDLEvents.column_reflect()</a></strong> event to detect when a CHAR (or whatever the target type is) is reflected, and change it to an ENUM (or whatever type is desired) if it is known that that’s the intent of the type. The <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.after_parent_attach">sqlalchemy.events.DDLEvents.after_parent_attach()</a></strong> can be used within the autogenerate process to intercept and un-attach unwanted CHECK constraints.</li>
</ul>
<blockquote>
<p>Autogenerate <strong>不能检测</strong>:</p>
<ul>
<li>表名的变化。 这些将作为两个不同表的新增/删除出现，并且应该手动编辑表名更改。</li>
<li>列名的变化。 与表名更改一样，这些被检测为列添加/删除两种操作，这与名称更改完全不同。</li>
<li>匿名命名的约束。 给你的约束一个名字， 例如 <strong>UniqueConstraint('col1', 'col2', name=&quot;my_name&quot;)</strong>. 有关如何为约束配置自动命名方案的信息，请参阅<a href="zh/../zh/03_the_importance_of_naming_constraints.html">命名约束的重要性</a>一节。</li>
<li>在不直接支持 ENUM 的后端生成的特殊 SQLAlchemy 的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> 类型 - 这是因为这种类型是在不支持 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> 类型 的数据库中的表示，即 CHAR+CHECK 约束，可以是任何类型的 CHAR+CHECK。 对于 SQLAlchemy 确定这实际上是一个 ENUM 只是一个猜测，这通常是一个坏主意。要在这里实现你自己的“guessing”方法, 当 CHAR (或任何目标类型)被反射并更改为 ENUM 时(或所需的任何类型)时, 请使用 <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.column_reflect">sqlalchemy.events.DDLEvents.column_reflect()</a></strong> 事件检测，如果这是改变目标类型的目的。 <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.after_parent_attach">sqlalchemy.events.DDLEvents.after_parent_attach()</a></strong> 可以在自动生成过程中用来拦截和取消额外不需要的 CHECK 约束。</li>
</ul>
</blockquote>
<p>Autogenerate can’t currently, but <strong>will eventually detect</strong>:</p>
<ul>
<li>Some free-standing constraint additions and removals may not be supported, including PRIMARY KEY, EXCLUDE, CHECK; these are not necessarily implemented within the autogenerate detection system and also may not be supported by the supporting SQLAlchemy dialect.</li>
<li>Sequence additions, removals - not yet implemented.</li>
</ul>
<blockquote>
<p>Autogenerate 不能实时, 但<strong>最终会检测</strong>:</p>
<ul>
<li>可能不支持某些独立约束的添加和删除，包括 PRIMARY KEY、EXCLUDE、CHECK； 这些不一定在Autogenerate系统中实现，SQLAlchemy 支持的方言也可能不支持。</li>
<li>序列的添加、删除 - 尚未实现。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="autogenerating-multiple-metadata-collections"><a class="header" href="#autogenerating-multiple-metadata-collections">Autogenerating Multiple MetaData collections</a></h1>
<p><strong>自动生成多个元数据集合</strong></p>
<p>The <code>target_metadata</code> collection may also be defined as a sequence if an application has multiple <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> collections involved:</p>
<blockquote>
<p>如果应用程序涉及多个 <strong>MetaData</strong> 集合，则 <code>target_metadata</code> 集合也可以定义为一个序列：</p>
</blockquote>
<pre><code class="language-python">from myapp.mymodel1 import Model1Base
from myapp.mymodel2 import Model2Base
target_metadata = [Model1Base.metadata, Model2Base.metadata]
</code></pre>
<p>The sequence of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> collections will be consulted in order during the autogenerate process. Note that each <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> must contain <strong>unique</strong> table keys (e.g. the “key” is the combination of the table’s name and schema); if two <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> objects contain a table with the same schema/name combination, an error is raised.</p>
<blockquote>
<p>在自动生成过程中，将按顺序查询 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 集合的顺序。 请注意，每个 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 必须包含唯一的表键（例如，“键”是表名和模式的组合）； 如果两个 MetaData 对象包含一个具有相同模式/名称组合的表，则会引发错误。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="controlling-what-to-be-autogenerated"><a class="header" href="#controlling-what-to-be-autogenerated">Controlling What to be Autogenerated</a></h1>
<p>The autogenerate process scans across all table objects within the database that is referred towards by the current database connection in use.</p>
<blockquote>
<p>自动生成过程扫描数据库中由当前正在使用的数据库连接引用的所有表对象。</p>
</blockquote>
<p>The list of objects that are scanned in the target database connection include:</p>
<blockquote>
<p>在目标数据库连接中扫描的对象列表包括：</p>
</blockquote>
<ul>
<li>The “default” schema currently referred towards by the database connection.</li>
<li>If the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> is set to <code>True</code>, all non-default “schemas”, which are those names returned by the <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_schema_names">get_schema_names()</a></strong> method of <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector">Inspector</a></strong>. The SQLAlchemy document <a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#schema-table-schema-name">Specifying the Schema Name</a> discusses the concept of a “schema” in detail.</li>
<li>Within each “schema”, all tables present are scanned using the <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names">get_table_names()</a></strong> method of <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector">Inspector</a></strong>.</li>
<li>Within each “table”, most sub-objects of the each <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> construct are scanned, including columns and some forms of constraints. This process ultimately involves the use of methods on <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector">Inspector</a></strong> including <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_columns">get_columns()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes">get_indexes()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints">get_unique_constraints()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_foreign_keys">get_foreign_keys()</a></strong> (as of this writing, CHECK constraints and primary key constraints are not yet included).</li>
</ul>
<blockquote>
<ul>
<li>数据库连接的当前引用为“default”模式。</li>
<li>如果 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> 设置为 <code>True</code>, 将包含所有从 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector">Inspector</a></strong> 的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_schema_names">get_schema_names()</a></strong> 返回的非默认“schemas”名称。SQLAlchemy 的文档里面<a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#schema-table-schema-name">指定模式名称</a>详细讨论了模式(Schema)的概念。</li>
<li>在每个模式(Schema)中，使用 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector">Inspector</a></strong> 的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names">get_table_names()</a></strong> 方法扫描所有存在的表。</li>
<li>在每个“Table”中，会扫描每个 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> 构造的大多数子对象，包括列和某些形式的约束。 这个过程最终涉及使用 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector">Inspector</a></strong> 上的方法，包括 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_columns">get_columns()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes">get_indexes()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints">get_unique_constraints()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_foreign_keys">get_foreign_keys()</a></strong>（在撰写本文时，CHECK 约束和主键约束尚未包括在内）。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="omitting-schema-names-from-the-autogenerate-process"><a class="header" href="#omitting-schema-names-from-the-autogenerate-process">Omitting Schema Names from the Autogenerate Process</a></h1>
<p>As the above set of database objects are typically to be compared to the contents of a single <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object, particularly when the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> flag is enabled there is an important need to filter out unwanted “schemas”, which for some database backends might be the list of all the databases present. This filtering is best performed using the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook, which provides for a callable that may return a boolean true/false indicating if a particular schema name should be included:</p>
<blockquote>
<p>由于上述数据库对象集通常与单个 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 对象的内容进行比较，特别是在启用 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> 标志时，非常需要过滤掉不需要的“模式”，这对于某些数据库后端 可能是所有存在的数据库的列表。 最好使用 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> 钩子执行此过滤，它提供了一个可调用对象，该可调用对象可能返回一个布尔值 true/false，指示是否应包含特定的模式名称：</p>
</blockquote>
<pre><code class="language-python">def include_name(name, type_, parent_names):
    if type_ == &quot;schema&quot;:
        # note this will not include the default schema
        return name in [&quot;schema_one&quot;, &quot;schema_two&quot;]
    else:
        return True

context.configure(
    # ...
    include_schemas = True,
    include_name = include_name
)
</code></pre>
<p>Above, when the list of schema names is first retrieved, the names will be filtered through the above <code>include_name</code> function so that only schemas named <code>&quot;schema_one&quot;</code> and <code>&quot;schema_two&quot;</code> will be considered by the autogenerate process.</p>
<blockquote>
<p>上面，当第一次检索模式名称列表时，将通过上述 <code>include_name</code> 函数过滤名称，以便自动生成过程仅考虑名为<code>“schema_one”</code>和“<code>schema_two”</code>的模式。</p>
</blockquote>
<p>In order to include <strong>the default schema</strong>, that is, the schema that is referred towards by the database connection <strong>without</strong> any explicit schema being specified, the name passed to the hook is <code>None</code>. To alter our above example to also include the default schema, we compare to <code>None</code> as well:</p>
<blockquote>
<p>为了包含默认架构，即数据库连接所引用的架构，而没有指定任何显式架构，传递给钩子的名称为 <code>None</code>。 为了将上面的示例更改为也包含默认模式，我们还将与 <code>None</code> 进行比较：</p>
</blockquote>
<pre><code class="language-python">def include_name(name, type_, parent_names):
    if type_ == &quot;schema&quot;:
        # this **will* include the default schema
        return name in [None, &quot;schema_one&quot;, &quot;schema_two&quot;]
    else:
        return True

context.configure(
    # ...
    include_schemas = True,
    include_name = include_name
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="omitting-table-names-from-the-autogenerate-process"><a class="header" href="#omitting-table-names-from-the-autogenerate-process">Omitting Table Names from the Autogenerate Process</a></h1>
<p>The <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook is also most appropriate to limit the names of tables in the target database to be considered. If a target database has many tables that are not part of the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong>, the autogenerate process will normally assume these are extraneous tables in the database to be dropped, and it will generate a <strong><a href="http://localhost:3002/en/ops.html#alembic.operations.Operations.drop_table">Operations.drop_table()</a></strong> operation for each. To prevent this, the <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook may be used to search for each name within the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData.tables">tables</a></strong> collection of the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object and ensure names which aren’t present are not included:</p>
<blockquote>
<p><strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> 钩子也最适合限制目标数据库中的表名。 如果目标数据库有许多不属于元数据的表，自动生成过程通常会假定这些是数据库中要删除的无关表，并且将为每个表生成一个 <strong><a href="http://localhost:3002/en/ops.html#alembic.operations.Operations.drop_table">Operations.drop_table()</a></strong>  操作。 为了防止这种情况，<strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> 钩子可用于搜索 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 对象的<strong>表集合</strong>(<strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData.tables">tables</a></strong>)中的每个名称，并确保不包含不存在的名称：</p>
</blockquote>
<pre><code class="language-python">target_metadata = MyModel.metadata

def include_name(name, type_, parent_names):
    if type_ == &quot;table&quot;:
        return name in target_metadata.tables
    else:
        return True

context.configure(
    # ...
    target_metadata = target_metadata,
    include_name = include_name,
    include_schemas = False
)
</code></pre>
<p>The above example is limited to table names present in the default schema only. In order to search within a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> collection for schema-qualified table names as well, a table present in the non default schema will be present under a name of the form <code>&lt;schemaname&gt;.&lt;tablename&gt;</code>. The <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook will present this schema name on a per-tablename basis in the <code>parent_names</code> dictionary, using the key <code>&quot;schema_name&quot;</code> that refers to the name of the schema currently being considered, or <code>None</code> if the schema is the default schema of the database connection:</p>
<blockquote>
<p>上面的示例仅限于默认模式中存在的表名。 为了在 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 集合中搜索模式限定的表名，非默认模式中的表将以 <code>&lt;schemaname&gt;.&lt;tablename&gt;</code> 形式的名称出现。 <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> 钩子将在 <code>parent_names</code> 字典中基于每个表名显示此模式名称，使用键<code>“schema_name”</code>表示当前正在考虑的模式的名称，或者如果数据库连接模式是默认模式，则为 <code>None</code>：</p>
</blockquote>
<pre><code class="language-python"># example fragment

if parent_names[&quot;schema_name&quot;] is None:
    return name in target_metadata.tables
else:
    # build out schema-qualified name explicitly...
    return (
        &quot;%s.%s&quot; % (parent_names[&quot;schema_name&quot;], name) in
        target_metadata.tables
    )
</code></pre>
<p>However more simply, the <code>parent_names</code> dictionary will also include the dot-concatenated name already constructed under the key <code>&quot;schema_qualified_table_name&quot;</code>, which will also be suitably formatted for tables in the default schema as well with the dot omitted. So the full example of omitting tables with schema support may look like:</p>
<blockquote>
<p>然而更简单地说，<code>parent_names</code> 字典还将包括已经在键<code>“schema_qualified_table_name”</code>下构建的点连接名称，该名称也将适用于默认模式中的表以及过滤点的格式。 因此，过滤具有模式支持的表的完整示例可能如下所示：</p>
</blockquote>
<pre><code class="language-python">target_metadata = MyModel.metadata

def include_name(name, type_, parent_names):
    if type_ == &quot;schema&quot;:
        return name in [None, &quot;schema_one&quot;, &quot;schema_two&quot;]
    elif type_ == &quot;table&quot;:
        # use schema_qualified_table_name directly
        return (
            parent_names[&quot;schema_qualified_table_name&quot;] in
            target_metadata.tables
        )
    else:
        return True

context.configure(
    # ...
    target_metadata = target_metadata,
    include_name = include_name,
    include_schemas = True
)
</code></pre>
<p>The <code>parent_names</code> dictionary will also include the key <code>&quot;table_name&quot;</code> when the name being considered is that of a column or constraint object local to a particular table.</p>
<blockquote>
<p>当所考虑的名称是特定表本地的列或约束对象的名称时，<code>parent_names</code> 字典还将包括键<code>“table_name”</code>。</p>
</blockquote>
<p>The <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook only refers to <strong>reflected</strong> objects, and not those located within the target <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> collection. For more fine-grained rules that include both <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> and reflected object, the <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> hook discussed in the next section is more appropriate.</p>
<blockquote>
<p><strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> 钩子仅引用反射对象，而不是位于目标 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 集合中的对象。 对于同时包含 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 和反射对象的更细粒度的规则，下一节讨论的 <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> 钩子更合适。</p>
</blockquote>
<blockquote>
<p>New in version 1.5: added the <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook.</p>
</blockquote>
<blockquote>
<p>版本1.5更新: 新增 <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> 钩子</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="omitting-based-on-object"><a class="header" href="#omitting-based-on-object">Omitting Based on Object</a></h1>
<p>The <strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> hook provides for object-level inclusion/exclusion rules based on the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object being reflected as well as the elements within it. This hook can be used to limit objects both from the local <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> collection as well as from the target database. The limitation is that when it reports on objects in the database, it will have fully reflected that object, which can be expensive if a large number of objects will be omitted. The example below refers to a fine-grained rule that will skip changes on <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> objects that have a user-defined flag <code>skip_autogenerate</code> placed into the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column.info">info</a></strong> dictionary:</p>
<blockquote>
<p><strong><a href="http://localhost:3002/en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> 钩子提供了基于被反映的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> 对象以及其中的元素的对象级包含/排除规则。 此钩子可用于限制来自本地 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 集合以及来自目标数据库的对象。 限制是，当它报告数据库中的对象时，它会完全反映该对象，如果将省略大量对象，这可能会很昂贵。 下面的示例引用了一个细粒度的规则，该规则将跳过对 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> 对象的更改，这些对象将用户定义的标志 <code>skip_autogenerate</code> 放置到 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column.info">info</a></strong> 字典中：</p>
</blockquote>
<pre><code class="language-python">def include_object(object, name, type_, reflected, compare_to):
    if (type_ == &quot;column&quot; and
        not reflected and
        object.info.get(&quot;skip_autogenerate&quot;, False)):
        return False
    else:
        return True

context.configure(
    # ...
    include_object = include_object
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="comparing-and-rendering-types"><a class="header" href="#comparing-and-rendering-types">Comparing and Rendering Types</a></h1>
<p>The area of autogenerate’s behavior of comparing and rendering Python-based type objects in migration scripts presents a challenge, in that there’s a very wide variety of types to be rendered in scripts, including those part of SQLAlchemy as well as user-defined types. A few options are given to help out with this task.</p>
<blockquote>
<p>在迁移脚本中比较和呈现基于 Python 的类型对象的自动生成行为领域提出了一个挑战，因为在脚本中需要呈现各种各样的类型，包括 SQLAlchemy 的那些部分以及用户定义的类型。 提供了一些选项来帮助完成此任务。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="controlling-the-module-prefix"><a class="header" href="#controlling-the-module-prefix">Controlling the Module Prefix</a></h1>
<p>When types are rendered, they are generated with a <strong>module prefix</strong>, so that they are available based on a relatively small number of imports. The rules for what the prefix is is based on the kind of datatype as well as configurational settings. For example, when Alembic renders SQLAlchemy types, it will by default prefix the type name with the prefix <code>sa.</code>:</p>
<blockquote>
<p>渲染类型时，会使用 <strong>模块前缀</strong> 生成它们，以便它们基于相对少量的导入可用。 前缀的规则基于数据类型的种类以及配置设置。 例如，当 Alembic 呈现 SQLAlchemy 类型时，默认情况下，它会在类型名称前加上前缀 <code>sa.</code>：</p>
</blockquote>
<pre><code class="language-python">Column(&quot;my_column&quot;, sa.Integer())
</code></pre>
<p>The use of the sa. prefix is controllable by altering the value of <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.sqlalchemy_module_prefix">EnvironmentContext.configure.sqlalchemy_module_prefix</a></strong>:</p>
<blockquote>
<p>使用<code>sa.</code>前缀可以通过改变 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.sqlalchemy_module_prefix">EnvironmentContext.configure.sqlalchemy_module_prefix</a></strong> 的值来控制：</p>
</blockquote>
<pre><code class="language-python">def run_migrations_online():
    # ...

    context.configure(
                connection=connection,
                target_metadata=target_metadata,
                sqlalchemy_module_prefix=&quot;sqla.&quot;,
                # ...
                )

    # ...
</code></pre>
<p>In either case, the <code>sa.</code> prefix, or whatever prefix is desired, should also be included in the imports section of <code>script.py.mako</code>; it also defaults to <code>import sqlalchemy as sa.</code></p>
<blockquote>
<p>在任何一种情况下，<code>sa.</code> 前缀，或任何需要的前缀，也应该包含在 <code>script.py.mako</code> 的导入部分中； 它还默认为<code>import sqlalchemy as sa.</code></p>
</blockquote>
<p>For user-defined types, that is, any custom type that is not within the <code>sqlalchemy.</code> module namespace, by default Alembic will use the <strong>value of __module__ for the custom type</strong>:</p>
<blockquote>
<p>对于用户定义的类型，即不在 <code>sqlalchemy.</code> 模块命名空间内的任何自定义类型，默认情况下，Alembic 将使用 <strong>value of __module__ 作为自定义类型</strong>：</p>
</blockquote>
<pre><code class="language-python">Column(&quot;my_column&quot;, myapp.models.utils.types.MyCustomType())
</code></pre>
<p>The imports for the above type again must be made present within the migration, either manually, or by adding it to <code>script.py.mako</code>.</p>
<blockquote>
<p>上述类型的导入必须再次出现在迁移中，要么手动，要么通过将其添加到 <code>script.py.mako</code>。</p>
</blockquote>
<p>The above custom type has a long and cumbersome name based on the use of <code>__module__</code> directly, which also implies that lots of imports would be needed in order to accommodate lots of types. For this reason, it is recommended that user-defined types used in migration scripts be made available from a single module. Suppose we call it <code>myapp.migration_types</code>:</p>
<blockquote>
<p>基于直接使用 <code>__module__</code> ，上述自定义类型的名称又长又麻烦，这也意味着需要大量导入才能容纳大量类型。 因此，建议将迁移脚本中使用的用户定义类型提供给单个模块。 假设我们称之为 <code>myapp.migration_types</code>：</p>
</blockquote>
<pre><code class="language-python"># myapp/migration_types.py

from myapp.models.utils.types import MyCustomType
</code></pre>
<p>We can first add an import for <code>migration_types</code> to our <code>script.py.mako</code>:</p>
<blockquote>
<p>我们可以首先将 <code>migration_types</code> 的导入添加到 <code>script.py.mako</code> 中：</p>
</blockquote>
<pre><code class="language-python">from alembic import op
import sqlalchemy as sa
import myapp.migration_types
${imports if imports else &quot;&quot;}
</code></pre>
<p>We then override Alembic’s use of <code>__module__</code> by providing a fixed prefix, using the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.user_module_prefix">EnvironmentContext.configure.user_module_prefix</a></strong> option:</p>
<blockquote>
<p>然后，我们通过使用 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.user_module_prefix">EnvironmentContext.configure.user_module_prefix</a></strong> 选项提供固定前缀来覆盖 Alembic 对 <code>__module__</code> 的使用：</p>
</blockquote>
<pre><code class="language-python">def run_migrations_online():
    # ...

    context.configure(
                connection=connection,
                target_metadata=target_metadata,
                user_module_prefix=&quot;myapp.migration_types.&quot;,
                # ...
                )

    # ...
</code></pre>
<p>Above, we now would get a migration like:</p>
<blockquote>
<p>经过上面设置，我们现在会得到如下迁移：</p>
</blockquote>
<pre><code class="language-python">Column(&quot;my_column&quot;, myapp.migration_types.MyCustomType())
</code></pre>
<p>Now, when we inevitably refactor our application to move <code>MyCustomType</code> somewhere else, we only need modify the <code>myapp.migration_types</code> module, instead of searching and replacing all instances within our migration scripts.</p>
<blockquote>
<p>现在，当我们不可避免地重构我们的应用程序以将 <code>MyCustomType</code> 移动到其他地方时，我们只需要修改 <code>myapp.migration_types</code> 模块，而不是搜索和替换迁移脚本中的所有实例。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="affecting-the-rendering-of-types-themselves"><a class="header" href="#affecting-the-rendering-of-types-themselves">Affecting the Rendering of Types Themselves</a></h1>
<p>The methodology Alembic uses to generate SQLAlchemy and user-defined type constructs as Python code is plain old <code>__repr__()</code>. SQLAlchemy’s built-in types for the most part have a <code>__repr__()</code> that faithfully renders a Python-compatible constructor call, but there are some exceptions, particularly in those cases when a constructor accepts arguments that aren’t compatible with <code>__repr__()</code>, such as a pickling function.</p>
<blockquote>
<p>Alembic 用来生成 SQLAlchemy 和 用户自定义的类型的构造方法是 Python 的旧的生成文本的 <code>__repr__()</code> 方法。 SQLAlchemy 的内置类型大部分都有一个 <code>__repr__()</code>，它忠实地呈现与 Python 兼容的构造函数调用，但也有一些例外，特别是在构造函数接受与 <code>__repr__()</code> 不兼容的参数的情况下，例如 pick 函数。</p>
</blockquote>
<p>When building a custom type that will be rendered into a migration script, it is often necessary to explicitly give the type a <code>__repr__()</code> that will faithfully reproduce the constructor for that type. This, in combination with <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.user_module_prefix">EnvironmentContext.configure.user_module_prefix</a></strong>, is usually enough. However, if additional behaviors are needed, a more comprehensive hook is the <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_item">EnvironmentContext.configure.render_item</a></strong> option. This hook allows one to provide a callable function within <code>env.py</code> that will fully take over how a type is rendered, including its module prefix:</p>
<blockquote>
<p>在构建将呈现到迁移脚本中的自定义类型时，通常需要显式地为该类型指定一个 <code>__repr__()</code>，以便忠实地重现该类型的构造函数。 这与 <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.user_module_prefix">EnvironmentContext.configure.user_module_prefix</a></strong> 结合使用通常就足够了。 但是，如果需要额外的行为，更全面的钩子是 <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_item">EnvironmentContext.configure.render_item</a></strong> 选项。 这个钩子允许在 <code>env.py</code> 中提供一个可调用函数，它将完全接管一个类型的呈现方式，包括它的模块前缀：</p>
</blockquote>
<pre><code class="language-python">def render_item(type_, obj, autogen_context):
    &quot;&quot;&quot;Apply custom rendering for selected items.&quot;&quot;&quot;

    if type_ == 'type' and isinstance(obj, MySpecialType):
        return &quot;mypackage.%r&quot; % obj

    # default rendering for other objects
    return False

def run_migrations_online():
    # ...

    context.configure(
                connection=connection,
                target_metadata=target_metadata,
                render_item=render_item,
                # ...
                )

    # ...
</code></pre>
<p>In the above example, we’d ensure our <code>MySpecialType</code> includes an appropriate <code>__repr__()</code> method, which is invoked when we call it against <code>&quot;%r&quot;</code>.</p>
<blockquote>
<p>在上面的示例中，我们将确保我们的 <code>MySpecialType</code> 包含一个适当的 <code>__repr__()</code> 方法，当我们针对 <code>&quot;%r&quot;</code> 调用它时会调用它。</p>
</blockquote>
<p>The callable we use for <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_item">EnvironmentContext.configure.render_item</a></strong> can also add imports to our migration script. The <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext">AutogenContext</a></strong> passed in contains a datamember called <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.imports">AutogenContext.imports</a></strong>, which is a Python <code>set()</code> for which we can add new imports. For example, if <code>MySpecialType</code> were in a module called <code>mymodel.types</code>, we can add the import for it as we encounter the type:</p>
<blockquote>
<p>我们用于 <strong><a href="zh//en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_item">EnvironmentContext.configure.render_item</a></strong> 的可调用对象也可以将导入添加到我们的迁移脚本中。 传入的 <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext">AutogenContext</a></strong> 包含一个名为 <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.imports">AutogenContext.imports</a></strong> 的数据成员，它是一个 Python <code>set()</code>，我们可以为其添加新的导入。 例如，如果 <code>MySpecialType</code> 在名为 <code>mymodel.types</code> 的模块中，我们可以在遇到类型时为其添加导入：</p>
</blockquote>
<pre><code class="language-python">def render_item(type_, obj, autogen_context):
    &quot;&quot;&quot;Apply custom rendering for selected items.&quot;&quot;&quot;

    if type_ == 'type' and isinstance(obj, MySpecialType):
        # add import for this type
        autogen_context.imports.add(&quot;from mymodel import types&quot;)
        return &quot;types.%r&quot; % obj

    # default rendering for other objects
    return False
</code></pre>
<p>The finished migration script will include our imports where the <code>${imports}</code> expression is used, producing output such as:</p>
<blockquote>
<p>完成的迁移脚本将包含我们的导入，其中使用了 <code>${imports}</code> 表达式，产生如下输出：</p>
</blockquote>
<pre><code class="language-python">from alembic import op
import sqlalchemy as sa
from mymodel import types

def upgrade():
    op.add_column('sometable', Column('mycolumn', types.MySpecialType()))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="comparing-types"><a class="header" href="#comparing-types">Comparing Types</a></h1>
<p>The default type comparison logic will work for SQLAlchemy built in types as well as basic user defined types. This logic is only enabled if the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> parameter is set to <code>True</code>:</p>
<blockquote>
<p>默认类型比较逻辑适用于 SQLAlchemy 内置类型以及基本用户定义类型。 此逻辑仅在 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> 参数设置为 <code>True</code> 时启用：</p>
</blockquote>
<pre><code class="language-python">context.configure(
    # ...
    compare_type = True
)
</code></pre>
<blockquote>
<p><strong>Note</strong>: The default type comparison logic (which is end-user extensible) currently (as of Alembic version 1.4.0) works by comparing the generated SQL for a column. It does this in two steps-</p>
<ul>
<li>First, it compares the outer type of each column such as VARCHAR or TEXT. Dialect implementations can have synonyms that are considered equivalent- this is because some databases support types by converting them to another type. For example, NUMERIC and DECIMAL are considered equivalent on all backends, while on the Oracle backend the additional synonyms BIGINT, INTEGER, NUMBER, SMALLINT are added to this list of equivalents</li>
<li>Next, the arguments within the type, such as the lengths of strings, precision values for numerics, the elements inside of an enumeration are compared. If BOTH columns have arguments AND they are different, a change will be detected. If one column is just set to the default and the other has arguments, Alembic will pass on attempting to compare these. The rationale is that it is difficult to detect what a database backend sets as a default value without generating false positives.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>注意</strong>: 当前（从 Alembic 版本 1.4.0 开始）默认类型比较逻辑（最终用户可扩展）通过比较为列生成的 SQL 来工作。 它分两步完成 -</p>
<ul>
<li>首先，它比较每列的外部类型，例如 VARCHAR 或 TEXT。 方言实现可以具有被视为等效的同义词——这是因为某些数据库通过将类型转换为另一种类型来支持类型。 例如，NUMERIC 和 DECIMAL 在所有后端都被认为是等效的，而在 Oracle 后端，其他同义词 BIGINT、INTEGER、NUMBER、SMALLINT 被添加到此等效列表中</li>
<li>接下来，比较类型中的参数，例如字符串的长度、数字的精度值、枚举中的元素。 如果两列都有参数并且它们不同，则将检测到更改。 如果一列只是设置为默认值，而另一列有参数，Alembic 将继续尝试比较这些。 基本原理是很难检测数据库后端设置的默认值而不产生误报。</li>
</ul>
</blockquote>
<blockquote>
<p><em>Changed in version 1.4.0</em>: Added the text and keyword comparison for column types</p>
</blockquote>
<blockquote>
<p><em>版本1.4.0更新</em>：添加了列类型的文本和关键字比较</p>
</blockquote>
<p>Alternatively, the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> parameter accepts a callable function which may be used to implement custom type comparison logic, for cases such as where special user defined types are being used:</p>
<blockquote>
<p>或者，<strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> 参数接受可用于实现自定义类型比较逻辑的可调用函数，例如使用特殊用户定义类型的情况：</p>
</blockquote>
<pre><code class="language-python">def my_compare_type(context, inspected_column,
            metadata_column, inspected_type, metadata_type):
    # return False if the metadata_type is the same as the inspected_type
    # or None to allow the default implementation to compare these
    # types. a return value of True means the two types do not
    # match and should result in a type change operation.
    return None

context.configure(
    # ...
    compare_type = my_compare_type
)
</code></pre>
<p>Above, <code>inspected_column</code> is a <strong>[sqlalchemy.schema.Column]</strong> as returned by <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.reflect_table">sqlalchemy.engine.reflection.Inspector.reflect_table()</a></strong>, whereas metadata_column is a <strong>[sqlalchemy.schema.Column]</strong> from the local model environment. A return value of <code>None</code> indicates that default type comparison to proceed.</p>
<blockquote>
<p>上面，<code>inspected_column</code> 是由 <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.reflect_table">sqlalchemy.engine.reflection.Inspector.reflect_table()</a></strong> 返回的 <strong>[sqlalchemy.schema.Column]</strong>，而 metadata_column 是 <strong>[sqlalchemy.schema.Column]</strong> 来自本地模型环境。 <code>None</code> 的返回值表示要进行默认类型比较。</p>
</blockquote>
<p>Additionally, custom types that are part of imported or third party packages which have special behaviors such as per-dialect behavior should implement a method called <code>compare_against_backend()</code> on their SQLAlchemy type. If this method is present, it will be called where it can also return True or False to specify the types compare as equivalent or not; if it returns None, default type comparison logic will proceed:</p>
<blockquote>
<p>此外，作为具有特殊行为（例如每种方言行为）的导入包或第三方包的一部分的自定义类型应在其 SQLAlchemy 类型上实现名为<code>“compare_against_backend()”</code>的方法。 如果此方法存在，它将被调用，它还可以返回 <code>True</code> 或 <code>False</code> 以指定类型比较是否等效； 如果它返回 <code>None</code> ，默认类型比较逻辑将继续：</p>
</blockquote>
<pre><code class="language-python">class MySpecialType(TypeDecorator):

    # ...

    def compare_against_backend(self, dialect, conn_type):
        # return True if this type is the same as the given database type,
        # or None to allow the default implementation to compare these
        # types. a return value of False means the given type does not
        # match this type.

        if dialect.name == 'postgresql':
            return isinstance(conn_type, postgresql.UUID)
        else:
            return isinstance(conn_type, String)
</code></pre>
<blockquote>
<p><strong>Warning</strong>: The boolean return values for the above <code>compare_against_backend</code> method, which is part of SQLAlchemy and not Alembic,are <strong>the opposite</strong> of that of the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> callable, returning <code>True</code> for types that are the same vs. <code>False</code> for types that are different.The <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> callable on the other hand should return <code>True</code> for types that are <strong>different</strong>.</p>
</blockquote>
<blockquote>
<p><strong>警告</strong>：上述 <code>compare_against_backend</code> 方法的布尔返回值，它是 SQLAlchemy 的一部分，而不是 Alembic，与 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> 可调用的方法相反，对于相同的类型返回  <code>True</code> ，对于不相同的类型返回 <code>False</code>。另一方面，<strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> 可调用应该为不同的类型返回 <code>True</code> 。</p>
</blockquote>
<p>The order of precedence regarding the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> callable vs. the type itself implementing <code>compare_against_backend</code> is that the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> callable is favored first; if it returns <code>None</code>, then the <code>compare_against_backend</code> method will be used, if present on the metadata type. If that returns <code>None</code>, then a basic check for type equivalence is run.</p>
<blockquote>
<p>关于 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong>  可调用对象与实现 <code>compare_against_backend</code> 的类型本身的优先顺序是 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong> 可调用对象优先； 如果它返回 <code>None</code> ，则将使用 <code>compare_against_backend</code> 方法（如果存在于元数据类型上）。 如果返回 <code>None</code> ，则运行类型等价的基本检查。</p>
</blockquote>
<blockquote>
<p><em>New in version 1.4.0</em>: - added column keyword comparisons and the type_synonyms property.</p>
</blockquote>
<blockquote>
<p><em>版本1.4.0新功能</em>: 添加了列关键字比较和 type_synonyms 属性。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="applying-post-processing-and-python-code-formatters-to-generated-revisions"><a class="header" href="#applying-post-processing-and-python-code-formatters-to-generated-revisions">Applying Post Processing and Python Code Formatters to Generated Revisions</a></h1>
<p>Revision scripts generated by the <code>alembic revision</code> command can optionally be piped through a series of post-production functions which may analyze or rewrite Python source code generated by Alembic, within the scope of running the <code>revision</code> command. The primary intended use of this feature is to run code-formatting tools such as <a href="https://black.readthedocs.io/">Black</a> or <a href="https://pypi.org/project/autopep8/">autopep8</a>, as well as custom-written formatting and linter functions, on revision files as Alembic generates them. Any number of hooks can be configured and they will be run in series, given the path to the newly generated file as well as configuration options.</p>
<blockquote>
<p>由 alembic 修订命令生成的修订脚本可以选择通过一系列后期制作功能进行管道传输，这些功能可以在运行修订命令的范围内分析或重写 Alembic 生成的 Python 源代码。 此功能的主要预期用途是在 Alembic 生成修订文件时在修订文件上运行代码格式化工具，例如 <a href="https://black.readthedocs.io/">Black</a> 或 <strong>autopep8</strong> ，以及自定义编写的格式化和 linter 函数。 给定新生成文件的路径以及配置选项，可以配置任意数量的钩子，并且它们将连续运行。</p>
</blockquote>
<p>The post write hooks, when configured, run against generated revision files regardless of whether or not the autogenerate feature was used.</p>
<blockquote>
<p>对于提交的钩子，在配置后，无论是否使用自动生成功能，都会针对生成的修订文件运行。</p>
</blockquote>
<blockquote>
<p>New in version 1.2.0</p>
</blockquote>
<blockquote>
<p>版本1.2.0 新增</p>
</blockquote>
<blockquote>
<p><strong>Note</strong>: Alembic’s post write system is partially inspired by the <a href="https://pre-commit.com/">pre-commit</a> tool, which configures git hooks that reformat source files as they are committed to a git repository. Pre-commit can serve this role for Alembic revision files as well, applying code formatters to them as they are committed. Alembic’s post write hooks are useful only in that they can format the files immediately upon generation, rather than at commit time, and also can be useful for projects that prefer not to use pre-commit.</p>
</blockquote>
<blockquote>
<p><strong>注意:</strong> Alembic 的写后系统部分受到 <a href="https://pre-commit.com/">pre-commit</a> 工具的启发，该工具配置了 git 钩子，在源文件提交到 git 存储库时重新格式化它们。 预提交也可以为 Alembic 修订文件服务，在提交时将代码格式化程序应用于它们。 Alembic 的 post write hook 的用处仅在于它们可以在生成文件时立即格式化文件，而不是在提交时格式化，并且对于不喜欢使用 pre-commit 的项目也很有用。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basic-formatter-configuration"><a class="header" href="#basic-formatter-configuration">Basic Formatter Configuration</a></h1>
<p>The <code>alembic.ini</code> samples now include commented-out configuration illustrating how to configure code-formatting tools to run against the newly generated file path. Example:</p>
<blockquote>
<p><code>alembic.ini</code> 示例现在包含注释掉的配置，说明如何配置代码格式化工具以针对新生成的文件路径运行。 例子：</p>
</blockquote>
<pre><code class="language-ini">[post_write_hooks]

# format using &quot;black&quot;
hooks=black

black.type = console_scripts
black.entrypoint = black
black.options = -l 79
</code></pre>
<p>Above, we configure <code>hooks</code> to be a single post write hook labeled <code>&quot;black&quot;</code>. Note that this label is arbitrary. We then define the configuration for the <code>&quot;black&quot;</code> post write hook, which includes:</p>
<blockquote>
<p>上面，我们将 <code>hooks</code> 配置为标记为 <code>&quot;black&quot;</code> 的单个 post write hook。 请注意，此标签是任意的。 然后我们定义了<code>&quot;black&quot;</code> post write hook的配置，包括：</p>
</blockquote>
<ul>
<li><code>type</code> - this is the type of hook we are running. Alembic includes a hook runner called <code>&quot;console_scripts&quot;</code>, which is specifically a Python function that uses <code>subprocess.run()</code> to invoke a separate Python script against the revision file. For a custom-written hook function, this configuration variable would refer to the name under which the custom hook was registered; see the next section for an example.</li>
</ul>
<blockquote>
<ul>
<li><code>type</code> - 这是我们正在运行的钩子类型。 Alembic 包含一个名为 <code>&quot;console_scripts&quot;</code> 的钩子运行器，它专门是一个 Python 函数，它使用 <code>subprocess.run()</code> 针对修订文件调用单独的 Python 脚本。 对于自定义编写的钩子函数，此配置变量将引用注册自定义钩子的名称； 有关示例，请参见下一节。</li>
</ul>
</blockquote>
<p>The following configuration options are specific to the <code>&quot;console_scripts&quot;</code> hook runner:</p>
<blockquote>
<p>以下配置选项特定于 <code>&quot;console_scripts&quot;</code> 钩子运行：</p>
</blockquote>
<ul>
<li>
<p><code>entrypoint</code> - the name of the <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#entry-points">setuptools entrypoint</a> that is used to define the console script. Within the scope of standard Python console scripts, this name will match the name of the shell command that is usually run for the code formatting tool, in this case <code>black</code>.</p>
</li>
<li>
<p><code>options</code> - a line of command-line options that will be passed to the code formatting tool. In this case, we want to run the command <code>black /path/to/revision.py -l 79</code>. By default, the revision path is positioned as the first argument. In order specify a different position, we can use the <code>REVISION_SCRIPT_FILENAME</code> token as illustrated by the subsequent examples.</p>
<p><strong>Note</strong>: Make sure options for the script are provided such that it will rewrite the input file <strong>in place</strong>. For example, when running autopep8, the <code>--in-place</code> option should be provided:</p>
<pre><code class="language-ini">[post_write_hooks]
hooks = autopep8
autopep8.type = console_scripts
autopep8.entrypoint = autopep8
autopep8.options = --in-place REVISION_SCRIPT_FILENAME
</code></pre>
</li>
<li>
<p><code>cwd</code> - optional working directory from which the console script is run.</p>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>entrypoint</code> - 用于定义控制台脚本的 <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#entry-points">setuptools entrypoint</a> 的名称。 在标准 Python 控制台脚本的范围内，此名称将匹配通常为代码格式化工具运行的 shell 命令的名称，在本例中为<code>“black”</code>。</p>
</li>
<li>
<p><code>options</code> - 将传递给代码格式化工具的命令行选项。 在这种情况下，我们要运行命令“black /path/to/revision.py -l 79”。 默认情况下，修订路径定位为第一个参数。 为了指定不同的位置，我们可以使用 <code>REVISION_SCRIPT_FILENAME</code> 标记，如后续示例所示。</p>
<p><strong>注意:</strong> 确保提供了脚本选项，以便它会在 <strong>原地</strong> 重写输入文件。 例如，在运行 <code>autopep8</code> 时，应提供 <code>--in-place</code> 选项：</p>
<pre><code class="language-ini">[post_write_hooks]
hooks = autopep8
autopep8.type = console_scripts
autopep8.entrypoint = autopep8
autopep8.options = --in-place REVISION_SCRIPT_FILENAME
</code></pre>
</li>
<li>
<p><code>cwd</code> - 运行控制台脚本的可选工作目录。</p>
</li>
</ul>
</blockquote>
<p>When running <code>alembic revision -m &quot;rev1&quot;</code>, we will now see the <code>black</code> tool’s output as well:</p>
<blockquote>
<p>当运行 <code>alembic revision -m &quot;rev1&quot;</code> 时，我们现在也会看到 <code>black</code> 工具的输出：</p>
</blockquote>
<pre><code class="language-bash">$ alembic revision -m &quot;rev1&quot;
  Generating /path/to/project/versions/481b13bc369a_rev1.py ... done
  Running post write hook &quot;black&quot; ...
reformatted /path/to/project/versions/481b13bc369a_rev1.py
All done! ✨ 🍰 ✨
1 file reformatted.
  done
</code></pre>
<p>Hooks may also be specified as a list of names, which correspond to hook runners that will run sequentially. As an example, we can also run the <a href="https://pypi.org/project/zimports/">zimports</a> import rewriting tool (written by Alembic’s author) subsequent to running the <code>black</code> tool, using a configuration as follows:</p>
<blockquote>
<p>钩子也可以指定为名称列表，这些名称对应于将按顺序运行的挂钩运行器。 例如，我们还可以在运行 <code>black</code> 工具之后运行 <a href="https://pypi.org/project/zimports/">zimports</a> 导入重写工具（由 Alembic 的作者编写），使用如下配置：</p>
</blockquote>
<pre><code class="language-ini">[post_write_hooks]

# format using &quot;black&quot;, then &quot;zimports&quot;
hooks=black, zimports

black.type = console_scripts
black.entrypoint = black
black.options = -l 79 REVISION_SCRIPT_FILENAME

zimports.type = console_scripts
zimports.entrypoint = zimports
zimports.options = --style google REVISION_SCRIPT_FILENAME
</code></pre>
<p>When using the above configuration, a newly generated revision file will be processed first by the “black” tool, then by the “zimports” tool.</p>
<blockquote>
<p>使用上述配置时，新生成的修订文件将首先由“black”工具处理，然后由“zimports”工具处理。</p>
</blockquote>
<p>Alternatively, one can run pre-commit itself as follows:</p>
<blockquote>
<p>或者，可以按如下方式运行预提交本身：</p>
</blockquote>
<pre><code class="language-ini">[post_write_hooks]

hooks = pre-commit

pre-commit.type = console_scripts
pre-commit.entrypoint = pre-commit
pre-commit.options = run --files REVISION_SCRIPT_FILENAME
pre-commit.cwd = %(here)s
</code></pre>
<p>(The last line helps to ensure that the <code>.pre-commit-config.yaml</code> file will always be found, regardless of from where the hook was called.)</p>
<blockquote>
<p>(最后一行有助于确保始终可以找到 <code>.pre-commit-config.yaml</code> 文件，无论从何处调用钩子。)</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="writing-custom-hooks-as-python-functions"><a class="header" href="#writing-custom-hooks-as-python-functions">Writing Custom Hooks as Python Functions</a></h1>
<p>The previous section illustrated how to run command-line code formatters, through the use of a post write hook provided by Alembic known as <code>console_scripts</code>. This hook is in fact a Python function that is registered under that name using a registration function that may be used to register other types of hooks as well.</p>
<blockquote>
<p>上一节说明了如何通过使用 Alembic 提供的称为<code>“console_scripts”</code>的写后挂钩来运行命令行代码格式化程序。 这个钩子实际上是一个 Python 函数，它使用一个注册函数以该名称注册，该注册函数也可用于注册其他类型的钩子。</p>
</blockquote>
<p>To illustrate, we will use the example of a short Python function that wants to rewrite the generated code to use tabs instead of four spaces. For simplicity, we will illustrate how this function can be present directly in the <code>env.py</code> file. The function is declared and registered using the <a href="http://localhost:3002/en/api/script.html#alembic.script.write_hooks.register">write_hooks.register()</a> decorator:</p>
<blockquote>
<p>为了说明，我们将使用一个简短的 Python 函数示例，该函数希望重写生成的代码以使用制表符而不是四个空格。 为简单起见，我们将说明如何将此函数直接存在于 <code>env.py</code> 文件中。 该函数使用 <a href="http://localhost:3002/en/api/script.html#alembic.script.write_hooks.register">write_hooks.register()</a> 装饰器声明和注册：</p>
</blockquote>
<pre><code class="language-python">from alembic.script import write_hooks
import re

@write_hooks.register(&quot;spaces_to_tabs&quot;)
def convert_spaces_to_tabs(filename, options):
    lines = []
    with open(filename) as file_:
        for line in file_:
            lines.append(
                re.sub(
                    r&quot;^(    )+&quot;,
                    lambda m: &quot;\t&quot; * (len(m.group(1)) // 4),
                    line
                )
            )
    with open(filename, &quot;w&quot;) as to_write:
        to_write.write(&quot;&quot;.join(lines))
</code></pre>
<p>Our new <code>&quot;spaces_to_tabs&quot;</code> hook can be configured in <code>alembic.ini</code> as follows:</p>
<blockquote>
<p>我们新的 <code>&quot;spaces_to_tabs&quot;</code> 钩子可以在 <code>alembic.ini</code> 中配置如下：</p>
</blockquote>
<pre><code class="language-ini">[alembic]

# ...

# ensure the revision command loads env.py
revision_environment = true

[post_write_hooks]

hooks = spaces_to_tabs

spaces_to_tabs.type = spaces_to_tabs
</code></pre>
<p>When <code>alembic revision</code> is run, the <code>env.py</code> file will be loaded in all cases, the custom <code>“spaces_to_tabs”</code> function will be registered and it will then be run against the newly generated file path:</p>
<blockquote>
<p>当 <code>alembic revision</code> 运行时，<code>env.py</code> 文件将在所有情况下被加载，自定义的 <code>“spaces_to_tabs”</code> 函数将被注册，然后它将针对新生成的文件路径运行：</p>
</blockquote>
<pre><code class="language-bash">$ alembic revision -m &quot;rev1&quot;
  Generating /path/to/project/versions/481b13bc369a_rev1.py ... done
  Running post write hook &quot;spaces_to_tabs&quot; ...
  done
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="generating-sql-scripts-aka-offline-mode"><a class="header" href="#generating-sql-scripts-aka-offline-mode">Generating SQL Scripts (a.k.a. “Offline Mode”)</a></h1>
<p><strong>生成SQL脚本(又称离线模式)</strong></p>
<p>A major capability of Alembic is to generate migrations as SQL scripts, instead of running them against the database - this is also referred to as offline mode. This is a critical feature when working in large organizations where access to DDL is restricted, and SQL scripts must be handed off to DBAs. Alembic makes this easy via the <code>--sql</code> option passed to any <code>upgrade</code> or <code>downgrade</code> command. We can, for example, generate a script that revises up to rev <code>ae1027a6acf</code>:</p>
<blockquote>
<p>Alembic 的一个主要功能是将迁移生成为 SQL 脚本，而不是针对数据库运行它们 - 这也称为离线模式。 在限制访问 DDL 且 SQL 脚本必须交给 DBA 的大型组织中工作时，这是一项关键功能。 Alembic 通过传递给任何<code>upgrade</code> 或 <code>downgrade</code>命令的 <code>--sql</code> 选项使这变得容易。 例如，我们可以生成一个脚本，修改为修订版 <code>ae1027a6acf</code>：</p>
</blockquote>
<pre><code class="language-sql">$ alembic upgrade ae1027a6acf --sql
INFO  [alembic.context] Context class PostgresqlContext.
INFO  [alembic.context] Will assume transactional DDL.
BEGIN;

CREATE TABLE alembic_version (
    version_num VARCHAR(32) NOT NULL
);

INFO  [alembic.context] Running upgrade None -&gt; 1975ea83b712
CREATE TABLE account (
    id SERIAL NOT NULL,
    name VARCHAR(50) NOT NULL,
    description VARCHAR(200),
    PRIMARY KEY (id)
);

INFO  [alembic.context] Running upgrade 1975ea83b712 -&gt; ae1027a6acf
ALTER TABLE account ADD COLUMN last_transaction_date TIMESTAMP WITHOUT TIME ZONE;

INSERT INTO alembic_version (version_num) VALUES ('ae1027a6acf');

COMMIT;
</code></pre>
<p>While the logging configuration dumped to standard error, the actual script was dumped to standard output - so in the absence of further configuration (described later in this section), we’d at first be using output redirection to generate a script:</p>
<blockquote>
<p>当日志配置转发到标准错误时，实际的脚本消息被转发到标准输出 - 所以在没有进一步配置的情况下（本节稍后描述），我们首先使用输出重定向来生成脚本：</p>
</blockquote>
<pre><code class="language-bash">alembic upgrade ae1027a6acf --sql &gt; migration.sql
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-the-start-version"><a class="header" href="#getting-the-start-version">Getting the Start Version</a></h1>
<p><strong>获取起始版本</strong></p>
<p>Notice that our migration script started at the base - this is the default when using offline mode, as no database connection is present and there’s no <code>alembic_version</code> table to read from.</p>
<p>One way to provide a starting version in offline mode is to provide a range to the command line. This is accomplished by providing the “version” in <code>start:end</code> syntax:</p>
<blockquote>
<p>请注意，我们的迁移脚本从base开始 - 这是使用离线模式时的默认设置，因为不存在数据库连接并且没有 <code>alembic_version</code> 表可供读取。</p>
<p>在离线模式下提供起始版本的一种方法是为命令行提供范围。 这是通过在 <code>start:end</code> 语法中提供 “version” (版本)来实现的：</p>
</blockquote>
<pre><code class="language-bash">alembic upgrade 1975ea83b712:ae1027a6acf --sql &gt; migration.sql
</code></pre>
<p>The <code>start:end</code> syntax is only allowed in offline mode; in “online” mode, the <code>alembic_version</code> table is always used to get at the current version.</p>
<p>It’s also possible to have the <code>env.py</code> script retrieve the “last” version from the local environment, such as from a local file. A scheme like this would basically treat a local file in the same way <code>alembic_version</code> works:</p>
<blockquote>
<p><code>start:end</code> 语法只允许在离线模式下使用； 在“online”(在线)模式下，总是使用 <code>alembic_version</code> 表来获取当前版本。</p>
<p>也可以让 <code>env.py</code> 脚本从本地环境（例如本地文件）中检索“last”(最后)版本。 像这样的方案基本上会以与 <code>alembic_version</code> 相同的方式处理本地文件：</p>
</blockquote>
<pre><code class="language-python">if context.is_offline_mode():
    version_file = os.path.join(os.path.dirname(config.config_file_name), &quot;version.txt&quot;)
    if os.path.exists(version_file):
        current_version = open(version_file).read()
    else:
        current_version = None
    context.configure(dialect_name=engine.name, starting_rev=current_version)
    context.run_migrations()
    end_version = context.get_revision_argument()
    if end_version and end_version != current_version:
        open(version_file, 'w').write(end_version)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="writing-migration-scripts-to-support-script-generation"><a class="header" href="#writing-migration-scripts-to-support-script-generation">Writing Migration Scripts to Support Script Generation</a></h1>
<p><strong>编写支持生成脚本的迁移脚本</strong></p>
<p>The challenge of SQL script generation is that the scripts we generate can’t rely upon any client/server database access. This means a migration script that pulls some rows into memory via a <code>SELECT</code> statement will not work in <code>--sql</code> mode. It’s also important that the Alembic directives, all of which are designed specifically to work in both “live execution” as well as “offline SQL generation” mode, are used.</p>
<blockquote>
<p>SQL 脚本生成的挑战在于我们生成的脚本不能依赖于任何客户端/服务器数据库访问。 这意味着通过 <code>SELECT</code> 语句将一些行拉入内存的迁移脚本将无法在 <code>--sql</code> 模式下工作。 同时 Alembic 指令也很重要，所有这些指令都是专门为在 “live execution”(实时执行)和 “offline SQL generation”(离线SQL生成) 模式下工作而设计的。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="customizing-the-environment"><a class="header" href="#customizing-the-environment">Customizing the Environment</a></h1>
<p>Users of the <code>--sql</code> option are encouraged to hack their env.py files to suit their needs. The env.py script as provided is broken into two sections: <code>run_migrations_online()</code> and <code>run_migrations_offline()</code>. Which function is run is determined at the bottom of the script by reading <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.is_offline_mode">EnvironmentContext.is_offline_mode()</a></strong>, which basically determines if the <code>--sql</code> flag was enabled.</p>
<p>For example, a multiple database configuration may want to run through each database and set the output of the migrations to different named files - the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> function accepts a parameter <code>output_buffer</code> for this purpose. Below we illustrate this within the <code>run_migrations_offline()</code> function:</p>
<blockquote>
<p>鼓励使用 <code>--sql</code> 选项的用户修改他们的 <code>env.py</code> 文件以满足他们的需要。 提供的 <code>env.py</code> 脚本分为两部分：<code>run_migrations_online()</code> 和 <code>run_migrations_offline()</code>。 运行哪个函数是在脚本底部通过读取 <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.is_offline_mode">EnvironmentContext.is_offline_mode()</a></strong> 确定的，它基本上确定是否启用了 <code>--sql</code> 标志。</p>
<p>例如，多数据库配置可能希望通过每个数据库运行并将迁移的输出设置为不同的命名文件 - 为此，<strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> 函数接受一个参数 <code>output_buffer</code>。 下面我们在 <code>run_migrations_offline()</code> 函数中说明这一点：</p>
</blockquote>
<pre><code class="language-python">from alembic import context
import myapp
import sys

db_1 = myapp.db_1
db_2 = myapp.db_2

def run_migrations_offline():
    &quot;&quot;&quot;Run migrations *without* a SQL connection.&quot;&quot;&quot;

    for name, engine, file_ in [
        (&quot;db1&quot;, db_1, &quot;db1.sql&quot;),
        (&quot;db2&quot;, db_2, &quot;db2.sql&quot;),
    ]:
        context.configure(
                    url=engine.url,
                    transactional_ddl=False,
                    output_buffer=open(file_, 'w'))
        context.execute(&quot;-- running migrations for '%s'&quot; % name)
        context.run_migrations(name=name)
        sys.stderr.write(&quot;Wrote file '%s'&quot; % file_)

def run_migrations_online():
    &quot;&quot;&quot;Run migrations *with* a SQL connection.&quot;&quot;&quot;

    for name, engine in [
        (&quot;db1&quot;, db_1),
        (&quot;db2&quot;, db_2),
    ]:
        connection = engine.connect()
        context.configure(connection=connection)
        try:
            context.run_migrations(name=name)
            session.commit()
        except:
            session.rollback()
            raise

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-importance-of-naming-constraints"><a class="header" href="#the-importance-of-naming-constraints">The Importance of Naming Constraints</a></h1>
<p><strong>命名约束的重要性</strong></p>
<p>An important topic worth mentioning is that of constraint naming conventions. As we’ve proceeded here, we’ve talked about adding tables and columns, and we’ve also hinted at lots of other operations listed in <a href="zh/../zh/06_operation_reference.html">Operation Reference</a> such as those which support adding or dropping constraints like foreign keys and unique constraints. The way these constraints are referred to in migration scripts is by name, however these names by default are in most cases generated by the relational database in use, when the constraint is created. For example, if you emitted two CREATE TABLE statements like this on Postgresql:</p>
<blockquote>
<p>值得一提的一个重要主题是约束命名约定。 正如我们在这里进行的那样，我们已经讨论了添加表和列，并且我们还暗示了 <a href="zh/../zh/06_operation_reference.html">操作参考</a> 中列出的许多其他操作，例如支持添加或删除外键和唯一约束等约束的操作。 在迁移脚本中引用这些约束的方式是按名称，但是在大多数情况下，这些名称默认情况下是由使用的关系数据库在创建约束时生成的。 例如，如果您在 Postgresql 上发出两个这样的 CREATE TABLE 语句：</p>
</blockquote>
<pre><code class="language-sql">test=&gt; CREATE TABLE user_account (id INTEGER PRIMARY KEY);
CREATE TABLE
test=&gt; CREATE TABLE user_order (
test(&gt;   id INTEGER PRIMARY KEY,
test(&gt;   user_account_id INTEGER REFERENCES user_account(id));
CREATE TABLE
</code></pre>
<p>Suppose we wanted to DROP the REFERENCES that we just applied to the <code>user_order.user_account_id</code> column, how do we do that? At the prompt, we’d use <code>ALTER TABLE &lt;tablename&gt; DROP CONSTRAINT &lt;constraint_name&gt;</code>, or if using Alembic we’d be using <strong><a href="zh/../zh/06_01_14_drop_constraint.html">Operations.drop_constraint()</a></strong>. But both of those functions need a name - what’s the name of this constraint?</p>
<blockquote>
<p>假设我们想要删除刚刚应用于 <code>user_order.user_account_id</code> 列的 <code>REFERENCES</code> ，我们该怎么做？ 在提示符下，我们将使用 <code>ALTER TABLE &lt;tablename&gt; DROP CONSTRAINT &lt;constraint_name&gt;</code>，或者如果使用 Alembic，我们将使用 <strong><a href="zh/../zh/06_01_14_drop_constraint.html">Operations.drop_constraint()</a></strong>。 但是这两个函数都需要一个名字——这个约束的名字是什么？</p>
</blockquote>
<p>It does have a name, which in this case we can figure out by looking at the Postgresql catalog tables:</p>
<blockquote>
<p>它确实有一个名称，在这种情况下，我们可以通过查看 Postgresql 目录表来确定：</p>
</blockquote>
<pre><code class="language-sql">test=&gt; SELECT r.conname FROM
test-&gt;  pg_catalog.pg_class c JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
test-&gt;  JOIN pg_catalog.pg_constraint r  ON c.oid = r.conrelid
test-&gt;  WHERE c.relname='user_order' AND r.contype = 'f'
test-&gt; ;
             conname
---------------------------------
 user_order_user_account_id_fkey
(1 row)
</code></pre>
<p>The name above is not something that Alembic or SQLAlchemy created; <code>user_order_user_account_id_fkey</code> is a naming scheme used internally by Postgresql to name constraints that are otherwise not named.</p>
<blockquote>
<p>上面的名字不是 Alembic 或 SQLAlchemy 创建的； <code>user_order_user_account_id_fkey</code> 是 Postgresql 内部使用的命名方案，用于命名未命名的约束。</p>
</blockquote>
<p>This scheme doesn’t seem so complicated, and we might want to just use our knowledge of it so that we know what name to use for our <strong><a href="zh/../zh/06_01_14_drop_constraint.html">Operations.drop_constraint()</a></strong> call. But is that a good idea? What if for example we needed our code to run on Oracle as well. OK, certainly Oracle uses this same scheme, right? Or if not, something similar. Let’s check:</p>
<blockquote>
<p>这个方案似乎并不复杂，我们可能只想使用我们对它的了解，以便我们知道为 <strong><a href="zh/../zh/06_01_14_drop_constraint.html">Operations.drop_constraint()</a></strong> 调用使用什么名称。 但这是个好主意吗？ 例如，如果我们也需要我们的代码在 Oracle 上运行怎么办。 好的，Oracle 肯定使用相同的方案，对吧？ 或者如果没有，类似的东西。 让我们检查：</p>
</blockquote>
<pre><code class="language-sql">Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; CREATE TABLE user_account (id INTEGER PRIMARY KEY);

Table created.

SQL&gt; CREATE TABLE user_order (
  2     id INTEGER PRIMARY KEY,
  3     user_account_id INTEGER REFERENCES user_account(id));

Table created.

SQL&gt; SELECT constraint_name FROM all_constraints WHERE
  2     table_name='USER_ORDER' AND constraint_type in ('R');

CONSTRAINT_NAME
-----------------------------------------------------
SYS_C0029334
</code></pre>
<p>Oh, we can see that is…..much worse. Oracle’s names are entirely unpredictable alphanumeric codes, and this will make being able to write migrations quite tedious, as we’d need to look up all these names.</p>
<blockquote>
<p>哦，我们可以看到那是……更糟。 Oracle 的名称是完全不可预测的字母数字代码，这将使编写迁移变得非常乏味，因为我们需要查找所有这些名称。</p>
</blockquote>
<p>The solution to having to look up names is to make your own names. This is an easy, though tedious thing to do manually. For example, to create our model in SQLAlchemy ensuring we use names for foreign key constraints would look like:</p>
<blockquote>
<p>必须查找名称的解决方案是自己命名。 手动完成这是一件容易但乏味的事情。 例如，要在 SQLAlchemy 中创建我们的模型，确保我们使用名称作为外键约束，如下所示：</p>
</blockquote>
<pre><code class="language-python">from sqlalchemy import MetaData, Table, Column, Integer, ForeignKey

meta = MetaData()

user_account = Table('user_account', meta,
                  Column('id', Integer, primary_key=True)
              )

user_order = Table('user_order', meta,
                  Column('id', Integer, primary_key=True),
                  Column('user_order_id', Integer,
                    ForeignKey('user_account.id', name='fk_user_order_id'))
              )
</code></pre>
<p>Simple enough, though this has some disadvantages. The first is that it’s tedious; we need to remember to use a name for every <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKey">ForeignKey</a></strong> object, not to mention every <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.UniqueConstraint">UniqueConstraint</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.CheckConstraint">CheckConstraint</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Index">Index</a></strong>, and maybe even <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint">PrimaryKeyConstraint</a></strong> as well if we wish to be able to alter those too, and beyond all that, all the names have to be globally unique. Even with all that effort, if we have a naming scheme in mind, it’s easy to get it wrong when doing it manually each time.</p>
<blockquote>
<p>很简单，尽管这有一些缺点。 首先是乏味； 我们需要记住为每个 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKey">ForeignKey</a></strong> 对象使用一个名称，更不用说每个 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.UniqueConstraint">UniqueConstraint</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.CheckConstraint">CheckConstraint</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Index">Index</a></strong>, 甚至 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint">PrimaryKeyConstraint</a></strong>，如果我们也希望能够更改它们，除此之外，所有名称都必须是全局唯一的。 即使付出了所有努力，如果我们有一个命名方案，每次手动执行时很容易出错。</p>
</blockquote>
<p>What’s worse is that manually naming constraints (and indexes) gets even more tedious in that we can no longer use convenience features such as the <code>.unique=True</code> or <code>.index=True</code> flag on <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong>:</p>
<blockquote>
<p>更糟糕的是，手动命名约束（和索引）变得更加乏味，因为我们不能再在列上使用 <code>.unique=True</code> 或 <code>.index=True</code> 标志等便利功能：</p>
</blockquote>
<pre><code class="language-python">user_account = Table('user_account', meta,
                  Column('id', Integer, primary_key=True),
                  Column('name', String(50), unique=True)
              )
</code></pre>
<p>Above, the <code>unique=True</code> flag creates a <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.UniqueConstraint">UniqueConstraint</a></strong>, but again, it’s not named. If we want to name it, manually we have to forego the usage of <code>unique=True</code> and type out the whole constraint:</p>
<blockquote>
<p>上面，<code>unique=True</code> 标志创建了一个 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.UniqueConstraint">UniqueConstraint</a></strong> ，但同样，它没有命名。 如果我们想命名它，我们必须手动放弃使用 <code>unique=True</code> 并输入整个约束：</p>
</blockquote>
<pre><code class="language-python">user_account = Table('user_account', meta,
                  Column('id', Integer, primary_key=True),
                  Column('name', String(50)),
                  UniqueConstraint('name', name='uq_user_account_name')
              )
</code></pre>
<p>There’s a solution to all this naming work, which is to use an <strong>automated naming convention</strong>. For some years, SQLAlchemy has encourgaged the use of DDL Events in order to create naming schemes. The <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.after_parent_attach">after_parent_attach()</a></strong> event in particular is the best place to intercept when <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Constraint">Constraint</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Index">Index</a></strong> objects are being associated with a parent <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object, and to assign a <code>.name</code> to the constraint while making use of the name of the table and associated columns.</p>
<blockquote>
<p>所有这些命名工作都有一个解决方案，那就是使用 <strong>自动命名约定</strong>。 多年来，SQLAlchemy 一直鼓励使用 DDL 事件来创建命名方案。 当 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Constraint">约束</a></strong> 和 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Index">索引</a></strong> 对象与父 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">表</a></strong> 对象关联时，<code>after_parent_attach()</code> 事件是拦截的最佳位置，并在使用表名和关联列的名称时为约束分配 <code>.name</code>。</p>
</blockquote>
<p>But there is also a better way to go, which is to make use of a feature new in SQLAlchemy 0.9.2 which makes use of the events behind the scenes known as <strong>naming_convention</strong>. Here, we can create a new <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object while passing a dictionary referring to a naming scheme:</p>
<blockquote>
<p>但是还有一个更好的方法，那就是利用 SQLAlchemy 0.9.2 版本中的一个新特性，它利用称为 <strong>naming_convention</strong> 的幕后事件。 在这里，我们可以创建一个新的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 对象，同时传递一个引用命名方案的字典：</p>
</blockquote>
<pre><code class="language-python">convention = {
  &quot;ix&quot;: &quot;ix_%(column_0_label)s&quot;,
  &quot;uq&quot;: &quot;uq_%(table_name)s_%(column_0_name)s&quot;,
  &quot;ck&quot;: &quot;ck_%(table_name)s_%(constraint_name)s&quot;,
  &quot;fk&quot;: &quot;fk_%(table_name)s_%(column_0_name)s_%(referred_table_name)s&quot;,
  &quot;pk&quot;: &quot;pk_%(table_name)s&quot;
}

metadata = MetaData(naming_convention=convention)
</code></pre>
<p>If we define our models using a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> as above, the given naming convention dictionary will be used to provide names for all constraints and indexes.</p>
<blockquote>
<p>如果我们使用上面的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> 定义我们的模型，那么给定的命名约定字典将用于为所有约束和索引提供名称。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="integration-of-naming-conventions-into-operations-autogenerate"><a class="header" href="#integration-of-naming-conventions-into-operations-autogenerate">Integration of Naming Conventions into Operations, Autogenerate</a></h1>
<p>As of Alembic 0.6.4, the naming convention feature is integrated into the <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> object, so that the convention takes effect for any constraint that is otherwise unnamed. The naming convention is passed to <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> using the <strong>MigrationsContext.configure.target_metadata</strong> parameter in <code>env.py</code>, which is normally configured when autogenerate is used:</p>
<blockquote>
<p>从 Alembic 0.6.4 开始，命名约定功能集成到 <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> 对象中，因此约定对任何未命名的约束生效。 命名约定使用 <code>env.py</code> 中的 <strong>MigrationsContext.configure.target_metadata</strong> 参数传递给 <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> ，通常在使用 autogenerate 时配置：</p>
</blockquote>
<pre><code class="language-python"># in your application's model:

meta = MetaData(naming_convention={
        &quot;ix&quot;: &quot;ix_%(column_0_label)s&quot;,
        &quot;uq&quot;: &quot;uq_%(table_name)s_%(column_0_name)s&quot;,
        &quot;ck&quot;: &quot;ck_%(table_name)s_%(constraint_name)s&quot;,
        &quot;fk&quot;: &quot;fk_%(table_name)s_%(column_0_name)s_%(referred_table_name)s&quot;,
        &quot;pk&quot;: &quot;pk_%(table_name)s&quot;
      })
Base = declarative_base(metadata=meta)

# .. in your Alembic env.py:

# add your model's MetaData object here
# for 'autogenerate' support
from myapp import mymodel
target_metadata = mymodel.Base.metadata

# ...

def run_migrations_online():

    # ...

    context.configure(
                connection=connection,
                target_metadata=target_metadata
                )
</code></pre>
<p>Above, when we render a directive like the following:</p>
<blockquote>
<p>以上，当我们渲染一个指令时：</p>
</blockquote>
<pre><code class="language-python">op.add_column('sometable', Column('q', Boolean(name='q_bool')))
</code></pre>
<p>The Boolean type will render a CHECK constraint with the name <code>&quot;ck_sometable_q_bool&quot;</code>, assuming the backend in use does not support native boolean types.</p>
<blockquote>
<p>假设使用的后端不支持原生布尔类型，布尔类型将呈现名为 <code>“ck_sometable_q_bool”</code> 的 CHECK 约束。</p>
</blockquote>
<p>We can also use op directives with constraints and not give them a name at all, if the naming convention doesn’t require one. The value of <code>None</code> will be converted into a name that follows the appropriate naming conventions:</p>
<blockquote>
<p>如果命名约定不需要，我们也可以使用带有约束的 <code>op</code> 指令而不给它们命名。 <code>None</code> 的值将转换为遵循适当命名约定的名称：</p>
</blockquote>
<pre><code class="language-python">def upgrade():
    op.create_unique_constraint(None, 'some_table', 'x')
</code></pre>
<p>When autogenerate renders constraints in a migration script, it renders them typically with their completed name. If using at least Alembic 0.6.4 as well as SQLAlchemy 0.9.4, these will be rendered with a special directive <strong><a href="zh/../zh/06_01_19_f.html">Operations.f()</a></strong> which denotes that the string has already been tokenized:</p>
<blockquote>
<p>当自动生成在迁移脚本中呈现约束时，它通常使用完整的名称呈现它们。 如果至少使用 Alembic 0.6.4 和 SQLAlchemy 0.9.4，这些将使用特殊指令 <strong><a href="zh/../zh/06_01_19_f.html">Operations.f()</a></strong> 呈现，表示字符串已经被标记：</p>
</blockquote>
<pre><code class="language-python">def upgrade():
    op.create_unique_constraint(op.f('uq_const_x'), 'some_table', 'x')
</code></pre>
<p>For more detail on the naming convention feature, see <a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#constraint-naming-conventions">Configuring Constraint Naming Conventions</a>.</p>
<blockquote>
<p>有关命名约定功能的更多详细信息，请参阅<a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#constraint-naming-conventions">配置约束命名约定</a>。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-batch-migrations-for-sqlite-and-other-databases"><a class="header" href="#running-batch-migrations-for-sqlite-and-other-databases">Running “Batch” Migrations for SQLite and Other Databases</a></h1>
<p><strong>在SQLite和其他数据中运行&quot;批处理&quot;迁移脚本</strong></p>
<p>The SQLite database presents a challenge to migration tools in that it has almost no support for the ALTER statement which relational schema migrations rely upon. The rationale for this stems from philosophical and architectural concerns within SQLite, and they are unlikely to be changed.</p>
<blockquote>
<p>SQLite 数据库对迁移工具提出了挑战，因为它几乎不支持关系模式迁移所依赖的 ALTER 语句。 这样做的理由源于 SQLite 中的哲学和架构问题，它们不太可能被改变。</p>
</blockquote>
<p>Migration tools are instead expected to produce copies of SQLite tables that correspond to the new structure, transfer the data from the existing table to the new one, then drop the old table. For our purposes here we’ll call this <strong>“move and copy”</strong> workflow, and in order to accommodate it in a way that is reasonably predictable, while also remaining compatible with other databases, Alembic provides the <strong>batch</strong> operations context.</p>
<blockquote>
<p>相反，迁移工具应该生成与新结构相对应的 SQLite 表副本，将数据从现有表传输到新表，然后删除旧表。 出于我们的目的，我们将这里称为 <strong>“移动和复制”</strong> 工作流，并且为了以合理可预测的方式适应它，同时保持与其他数据库的兼容性，Alembic 提供了 <strong>批处理</strong> 操作上下文。</p>
</blockquote>
<p>Within this context, a relational table is named, and then a series of mutation operations to that table alone are specified within the block. When the context is complete, a process begins whereby the <strong>“move and copy”</strong> procedure begins; the existing table structure is reflected from the database, a new version of this table is created with the given changes, data is copied from the old table to the new table using “INSERT from SELECT”, and finally the old table is dropped and the new one renamed to the original name.</p>
<blockquote>
<p>在此上下文中，一个关系表被命名，然后在块中指定对该表的一系列变异操作。 当上下文完成时，一个过程开始，<strong>“移动和复制”</strong> 过程开始； 现有的表结构反映在数据库中，使用给定的更改创建该表的新版本，使用 “INSERT from SELECT” 将数据从旧表复制到新表，最后旧表被删除，新表重命名为原始名称。</p>
</blockquote>
<p>The <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> method provides the gateway to this process:</p>
<blockquote>
<p><strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> 方法提供了此过程的上下文：</p>
</blockquote>
<pre><code class="language-python">with op.batch_alter_table(&quot;some_table&quot;) as batch_op:
    batch_op.add_column(Column('foo', Integer))
    batch_op.drop_column('bar')
</code></pre>
<p>When the above directives are invoked within a migration script, on a SQLite backend we would see SQL like:</p>
<blockquote>
<p>当在迁移脚本中调用上述指令时，在 SQLite 后端我们会看到如下 SQL：</p>
</blockquote>
<pre><code class="language-sql">CREATE TABLE _alembic_batch_temp (
  id INTEGER NOT NULL,
  foo INTEGER,
  PRIMARY KEY (id)
);
INSERT INTO _alembic_batch_temp (id) SELECT some_table.id FROM some_table;
DROP TABLE some_table;
ALTER TABLE _alembic_batch_temp RENAME TO some_table;
</code></pre>
<p>On other backends, we’d see the usual ALTER statements done as though there were no batch directive - the batch context by default only does the “move and copy” process if SQLite is in use, and if there are migration directives other than <strong><a href="zh/../zh/06_01_01_add_column.html">Operations.add_column()</a></strong> present, which is the one kind of column-level ALTER statement that SQLite supports. <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> can be configured to run “move and copy” unconditionally in all cases, including on databases other than SQLite; more on this is below.</p>
<blockquote>
<p>在其他后端，我们会看到执行通常的 ALTER 语句，就好像没有批处理指令一样 - 默认情况下，批处理上下文仅在使用 SQLite 并且存在除 <strong><a href="zh/../zh/06_01_01_add_column.html">Operations.add_column()</a></strong> 之外的迁移指令（这是 SQLite 支持的一种列级 ALTER 语句）时才执行 <strong>“移动和复制”</strong> 过程。 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> 可以配置为在所有情况下无条件地运行 <strong>“移动和复制”</strong>，包括在 SQLite 以外的数据库上； 更多内容如下。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="controlling-table-reflection"><a class="header" href="#controlling-table-reflection">Controlling Table Reflection</a></h1>
<p><strong>控制表反射</strong></p>
<p>The <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object that is reflected when “move and copy” proceeds is performed using the standard <code>autoload=True</code> approach. This call can be affected using the <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#reflect_args">reflect_args</a></strong> and <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#reflect_kwargs">reflect_kwargs</a></strong> arguments. For example, to override a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> within the reflection process such that a <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> object is reflected with the <code>create_constraint</code> flag set to <code>False</code>:</p>
<blockquote>
<p>使用标准 <code>autoload=True</code> 方法执行 <strong>“移动和复制”</strong> 时反射的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> 对象。 使用 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#reflect_args">reflect_args</a></strong> 和 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#reflect_kwargs">reflect_kwargs</a></strong> 参数可以影响此调用。 例如，要在反射过程中覆盖 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong>，以便在将 <code>create_constraint</code> 标志设置为 <code>False</code> 的情况下反射布尔对象：</p>
</blockquote>
<pre><code class="language-python">with self.op.batch_alter_table(
    &quot;bar&quot;,
    reflect_args=[Column('flag', Boolean(create_constraint=False))]
) as batch_op:
    batch_op.alter_column(
        'flag', new_column_name='bflag', existing_type=Boolean)
</code></pre>
<p>Another use case, add a listener to the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> as it is reflected so that special logic can be applied to columns or types, using the <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.column_reflect">column_reflect()</a></strong> event:</p>
<blockquote>
<p>另一个用例，使用 <strong><a href="https://docs.sqlalchemy.org/en/14/core/events.html#sqlalchemy.events.DDLEvents.column_reflect">column_reflect()</a></strong> 事件在 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">表</a></strong> 反射时向 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">表</a></strong> 添加一个侦听器，以便可以将特殊逻辑应用于列或类型：</p>
</blockquote>
<pre><code class="language-python">def listen_for_reflect(inspector, table, column_info):
    &quot;correct an ENUM type&quot;
    if column_info['name'] == 'my_enum':
        column_info['type'] = Enum('a', 'b', 'c')

with self.op.batch_alter_table(
    &quot;bar&quot;,
    reflect_kwargs=dict(
        listeners=[
            ('column_reflect', listen_for_reflect)
        ]
    )
) as batch_op:
    batch_op.alter_column(
        'flag', new_column_name='bflag', existing_type=Boolean)
</code></pre>
<p>The reflection process may also be bypassed entirely by sending a pre-fabricated <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object; see <strong><a href="zh/../zh/04_03_working_in_offline_mode.html">Working in Offline Mode</a></strong> for an example.</p>
<blockquote>
<p>反射过程也可以通过发送一个预制的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> 对象来完全绕过； 有关示例，请参阅<a href="zh/../zh/04_03_working_in_offline_mode.html">在脱机模式下工作</a>。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dealing-with-constraints"><a class="header" href="#dealing-with-constraints">Dealing with Constraints</a></h1>
<p><strong>处理约束</strong></p>
<p>There are a variety of issues when using “batch” mode with constraints, such as FOREIGN KEY, CHECK and UNIQUE constraints. This section will attempt to detail many of these scenarios.</p>
<blockquote>
<p>使用带有约束的“批处理”模式时会出现各种问题，例如 FOREIGN KEY、CHECK 和 UNIQUE 约束。 本节将尝试详细介绍其中的许多场景。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dropping-unnamed-or-named-foreign-key-constraints"><a class="header" href="#dropping-unnamed-or-named-foreign-key-constraints">Dropping Unnamed or Named Foreign Key Constraints</a></h1>
<p><strong>删除未命名或命名的外键约束</strong></p>
<p>SQLite, unlike any other database, allows constraints to exist in the database that have no identifying name. On all other backends, the target database will always generate some kind of name, if one is not given.</p>
<blockquote>
<p>与任何其他数据库不同，SQLite 允许数据库中存在没有标识名称的约束。 在所有其他后端，如果没有给出，目标数据库将始终生成某种名称。</p>
</blockquote>
<p>The first challenge this represents is that an unnamed constraint can’t by itself be targeted by the <strong><a href="zh/../en/ops.html#alembic.operations.BatchOperations.drop_constraint">BatchOperations.drop_constraint()</a></strong> method. An unnamed FOREIGN KEY constraint is implicit whenever the <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKey">ForeignKey</a></strong> or <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint">ForeignKeyConstraint</a></strong> objects are used without passing them a name. Only on SQLite will these constraints remain entirely unnamed when they are created on the target database; an automatically generated name will be assigned in the case of all other database backends.</p>
<blockquote>
<p>这代表的第一个挑战是未命名的约束本身不能被 <strong><a href="zh/../en/ops.html#alembic.operations.BatchOperations.drop_constraint">BatchOperations.drop_constraint()</a></strong> 方法定位。 每当使用 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKey">ForeignKey</a></strong> 或 <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint">ForeignKeyConstraint</a></strong> 对象而不传递名称时，未命名的 FOREIGN KEY 约束是隐式的。 只有在 SQLite 上，这些约束在目标数据库上创建时才会完全保持未命名； 对于所有其他数据库后端，将分配一个自动生成的名称。</p>
</blockquote>
<p>A second issue is that SQLAlchemy itself has inconsistent behavior in dealing with SQLite constraints as far as names. Prior to version 1.0, SQLAlchemy omits the name of foreign key constraints when reflecting them against the SQLite backend. So even if the target application has gone through the steps to apply names to the constraints as stated in the database, they still aren’t targetable within the batch reflection process prior to SQLAlchemy 1.0.</p>
<blockquote>
<p>第二个问题是 SQLAlchemy 本身在处理 SQLite 约束时的行为不一致，就名称而言。 在 1.0 版之前，SQLAlchemy 在将外键约束反映到 SQLite 后端时省略了它们的名称。 因此，即使目标应用程序已经完成了将名称应用于数据库中所述的约束的步骤，它们仍然不能在 SQLAlchemy 1.0 之前的批处理反射过程中成为目标。</p>
</blockquote>
<p>Within the scope of batch mode, this presents the issue that the <strong><a href="zh/../en/ops.html#alembic.operations.BatchOperations.drop_constraint">BatchOperations.drop_constraint()</a></strong> method requires a constraint name in order to target the correct constraint.</p>
<blockquote>
<p>在批处理模式的范围内，这提出了 <strong><a href="zh/../en/ops.html#alembic.operations.BatchOperations.drop_constraint">BatchOperations.drop_constraint()</a></strong> 方法需要一个约束名称才能定位正确的约束的问题。</p>
</blockquote>
<p>In order to overcome this, the <strong><a href="zh/../en/ops.html#alembic.operations.Operations.batch_alter_table">Operations.batch_alter_table()</a></strong> method supports a <strong><a href="zh/../en/ops.html#alembic.operations.Operations.batch_alter_table.params.naming_convention">naming_convention</a></strong> argument, so that all reflected constraints, including foreign keys that are unnamed, or were named but SQLAlchemy isn’t loading this name, may be given a name, as described in Integration of Naming Conventions into Operations, Autogenerate. Usage is as follows:</p>
<blockquote>
<p>为了克服这个问题，<strong><a href="zh/../en/ops.html#alembic.operations.Operations.batch_alter_table">Operations.batch_alter_table()</a></strong> 方法支持一个命名约定参数，以便所有反映的约束，包括未命名的外键，或已命名但 SQLAlchemy 未加载此名称的外键，都可以指定一个名称，如 将命名约定集成到操作中，自动生成中进行了描述。 用法如下：</p>
</blockquote>
<pre><code class="language-python">naming_convention = {
    &quot;fk&quot;:
    &quot;fk_%(table_name)s_%(column_0_name)s_%(referred_table_name)s&quot;,
}
with self.op.batch_alter_table(
        &quot;bar&quot;, naming_convention=naming_convention) as batch_op:
    batch_op.drop_constraint(
        &quot;fk_bar_foo_id_foo&quot;, type_=&quot;foreignkey&quot;)
</code></pre>
<p>Note that the naming convention feature requires at least <strong>SQLAlchemy 0.9.4</strong> for support.</p>
<blockquote>
<p>请注意，命名约定功能至少需要 <strong>SQLAlchemy 0.9.4</strong> 的支持。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="including-unnamed-unique-constraints"><a class="header" href="#including-unnamed-unique-constraints">Including unnamed UNIQUE constraints</a></h1>
<p><strong>包含未命名的 UNIQUE 约束</strong></p>
<p>A similar, but frustratingly slightly different, issue is that in the case of UNIQUE constraints, we again have the issue that SQLite allows unnamed UNIQUE constraints to exist on the database, however in this case, SQLAlchemy prior to version 1.0 doesn’t reflect these constraints at all. It does properly reflect named unique constraints with their names, however.</p>
<blockquote>
<p>一个类似但令人沮丧的稍微不同的问题是，在 UNIQUE 约束的情况下，我们再次遇到 SQLite 允许数据库上存在未命名的 UNIQUE 约束的问题，但是在这种情况下，1.0 版之前的 SQLAlchemy 没有反映这些 根本没有约束。 但是，它确实正确地反映了命名的唯一约束及其名称。</p>
</blockquote>
<p>So in this case, the workaround for foreign key names is still not sufficient prior to SQLAlchemy 1.0. If our table includes unnamed unique constraints, and we’d like them to be re-created along with the table, we need to include them directly, which can be via the <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#table_args">table_args</a></strong> argument:</p>
<blockquote>
<p>所以在这种情况下，外键名称的解决方法在 SQLAlchemy 1.0 之前仍然不够。 如果我们的表包含未命名的唯一约束，并且我们希望它们与表一起重新创建，我们需要直接包含它们，这可以通过 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#table_args">table_args</a></strong> 参数：</p>
</blockquote>
<pre><code class="language-python">with self.op.batch_alter_table(
        &quot;bar&quot;, table_args=(UniqueConstraint('username'),)
    ):
    batch_op.add_column(Column('foo', Integer))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changing-the-type-of-boolean-enum-and-other-implicit-check-datatypes"><a class="header" href="#changing-the-type-of-boolean-enum-and-other-implicit-check-datatypes">Changing the Type of Boolean, Enum and other implicit CHECK datatypes</a></h1>
<p><strong>更改布尔、枚举和其他隐式 CHECK 数据类型的类型</strong></p>
<p>The SQLAlchemy types <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> are part of a category of types known as “schema” types; this style of type creates other structures along with the type itself, most commonly (but not always) a CHECK constraint.</p>
<blockquote>
<p>SQLAlchemy 类型 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> 和 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> 是称为 “schema” 类型的类型类别的一部分； 这种类型的类型会与类型本身一起创建其他结构，最常见的（但不总是）是 CHECK 约束。</p>
</blockquote>
<p>Alembic handles dropping and creating the CHECK constraints here automatically, including in the case of batch mode. When changing the type of an existing column, what’s necessary is that the existing type be specified fully:</p>
<blockquote>
<p>Alembic 在此处自动处理删除和创建 CHECK 约束，包括在批处理模式的情况下。 更改现有列的类型时，需要完全指定现有类型：</p>
</blockquote>
<pre><code class="language-python">with self.op.batch_alter_table(&quot;some_table&quot;) as batch_op:
    batch_op.alter_column(
        'q', type_=Integer,
        existing_type=Boolean(create_constraint=True, constraint_name=&quot;ck1&quot;))
</code></pre>
<p>When dropping a column that includes a named CHECK constraint, as of Alembic 1.7 this named constraint must also be provided using a similar form, as there is no ability for Alembic to otherwise link this reflected CHECK constraint as belonging to a particular column:</p>
<blockquote>
<p>当删除包含命名 CHECK 约束的列时，从 Alembic 1.7 开始，此命名约束也必须使用类似的形式提供，因为 Alembic 无法以其他方式将此反映的 CHECK 约束链接为属于特定列：</p>
</blockquote>
<pre><code class="language-python">with self.op.batch_alter_table(&quot;some_table&quot;) as batch_op:
    batch_op.drop_column(
        'q',
        existing_type=Boolean(create_constraint=True, constraint_name=&quot;ck1&quot;))
    )
</code></pre>
<blockquote>
<p><em>Changed in version 1.7</em>: The <strong><a href="zh/../zh/06_02_10_drop_column.html">BatchOperations.drop_column()</a></strong> operation can accept an <code>existing_type</code> directive where a “schema type” such as <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> may be specified such that an associated named constraint can be removed.</p>
</blockquote>
<blockquote>
<p>版本1.7更新：<strong><a href="zh/../zh/06_02_10_drop_column.html">BatchOperations.drop_column()</a></strong> 操作可以接受 <code>existing_type</code> 指令，其中可以指定诸如布尔和枚举之类的“模式类型”，以便可以删除关联的命名约束。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="including-check-constraints"><a class="header" href="#including-check-constraints">Including CHECK constraints</a></h1>
<p><strong>包括 CHECK 约束</strong></p>
<p>As of Alembic 1.7, <strong>named</strong> CHECK constraints are automatically included in batch mode, as modern SQLAlchemy versions are capable of reflecting these constraints like any other constraint.</p>
<blockquote>
<p>从 Alembic 1.7 开始，<strong>已命名</strong> 的 CHECK 约束自动包含在批处理模式中，因为现代 SQLAlchemy 版本能够像任何其他约束一样反映这些约束。</p>
</blockquote>
<p>Note that when dropping or renaming a column that is mentioned in a named CHECK constraint, this CHECK constraint must be explicitly dropped first, as Alembic has no means of linking a reflected CHECK constraint to that column. Supposing column <code>q</code> of <code>some_table</code> were mentioned in a CHECK constraint named ck1. In order to drop this column, we have to drop the check constraint also:</p>
<blockquote>
<p>请注意，当删除或重命名命名 CHECK 约束中提到的列时，必须首先显式删除此 CHECK 约束，因为 Alembic 无法将反射的 CHECK 约束链接到该列。 假设 <code>some_table</code> 的列 <code>q</code> 在名为 <code>ck1</code> 的 CHECK 约束中被提及。 为了删除此列，我们还必须删除检查约束：</p>
</blockquote>
<pre><code class="language-python">with self.op.batch_alter_table(&quot;some_table&quot;) as batch_op:
    batch_op.drop_constraint(&quot;ck1&quot;, &quot;check&quot;)
    batch_op.drop_column('q')
</code></pre>
<blockquote>
<p><em>Changed in version 1.7</em>: Named CHECK constraints participate in batch mode in the same way as any other kind of constraint. This requires that column drops or renames now include explicit directives to drop an existing named constraint which refers to this column, as it will otherwise not be automatically detected as being associated with that particular column.</p>
<p>Unnamed CHECK constraints continue to be silently omitted from the table recreate operation.</p>
</blockquote>
<blockquote>
<p>版本1.7更新: 命名 CHECK 约束以与任何其他类型的约束相同的方式参与批处理模式。 这要求列的删除或重命名现在包含显式指令, 以删除引用此列的现有命名约束，否则将不会自动检测到它与该特定列的关联关系。</p>
<p>未命名的 CHECK 约束将继续在表重新创建操作中被忽略。</p>
</blockquote>
<p>For <strong>unnamed</strong> CHECK constraints, these are still not automatically included as part of the batch process. Note that this limitation <strong>includes</strong> the CHECK constraints generated by the <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> or <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> datatypes, which up through SQLAlchemy 1.3 would generate CHECK constraints automatically and cannot be tracked to the reflected table, assuming they are generated in an <strong>unnamed</strong> way.</p>
<blockquote>
<p>对于 <strong>未命名</strong> 的 CHECK 约束，它们仍然不会自动包含在批处理过程中。 请注意，此限制包括由 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> 或 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> 数据类型生成的 CHECK 约束，通过 SQLAlchemy 1.3 将自动生成 CHECK 约束并且不能跟踪到反射表，假设它们以未命名的方式生成。</p>
</blockquote>
<p>Unnamed constraints can be stated explicitly if they are to be included in the recreated table:</p>
<blockquote>
<p>如果要在重新创建的表中包含未命名的约束，则可以显式声明它们：</p>
</blockquote>
<pre><code class="language-python">with op.batch_alter_table(&quot;some_table&quot;, table_args=[
      CheckConstraint('x &gt; 5')
  ]) as batch_op:
    batch_op.add_column(Column('foo', Integer))
    batch_op.drop_column('bar')
</code></pre>
<p>The above step needs only be taken for CHECK constraints that are explicitly stated as part of the table definition.</p>
<blockquote>
<p>上述步骤只需要对明确声明为表定义的一部分的 CHECK 约束进行。</p>
</blockquote>
<p>For CHECK constraints that are generated by datatypes such as <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> or Enum, the type objects themselves <strong>must be named</strong> in order for their CHECK constraints to be included in the batch process. <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> datatypes that do <strong>not</strong> have the <code>.name</code> attribute set will <strong>not</strong> have CHECK constraints regenerated. This name can be set by specifying the <code>.name</code> parameter or by using a named Python <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> object as the source of enumeration.</p>
<blockquote>
<p>对于由 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> 或 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> 等数据类型生成的 CHECK 约束，<strong>必须为类型对象本身命名</strong>，以便将它们的 CHECK 约束包含在批处理过程中。 没有设置 <code>.name</code> 属性的 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> 和 <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> 数据类型将不会重新生成 CHECK 约束。 可以通过指定 <code>.name</code> 参数或使用命名的 Python <code>Enum</code> 对象作为枚举源来设置此名称。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dealing-with-referencing-foreign-keys"><a class="header" href="#dealing-with-referencing-foreign-keys">Dealing with Referencing Foreign Keys</a></h1>
<p><strong>处理引用外键</strong></p>
<p>It is important to note that batch table operations <strong>do not work</strong> with foreign keys that enforce referential integrity. This because the target table is dropped; if foreign keys refer to it, this will raise an error. On SQLite, whether or not foreign keys actually enforce is controlled by the <code>PRAGMA FOREIGN KEYS</code> pragma; this pragma, if in use, must be disabled when the workflow mode proceeds. When the operation is complete, the batch-migrated table will have the same name that it started with, so those referring foreign keys will again refer to this table.</p>
<blockquote>
<p>需要注意的是，批处理表操作 <strong>不适用于</strong> 强制参照完整性的外键。 这是因为目标表被删除了； 如果外键引用它，这将引发错误。 在 SQLite 上，是否实际执行外键由 <code>PRAGMA FOREIGN KEYS</code> 语法控制； 如果正在使用此编译指示，则必须在工作流模式继续时禁用。 操作完成后，批量迁移的表将与开始时的名称相同，因此引用外键的人将再次引用该表。</p>
</blockquote>
<p>A special case is dealing with self-referring foreign keys. Here, Alembic takes a special step of recreating the self-referring foreign key as referring to the original table name, rather than at the “temp” table, so that like in the case of other foreign key constraints, when the table is renamed to its original name, the foreign key again references the correct table. This operation only works when referential integrity is disabled, consistent with the same requirement for referring foreign keys from other tables.</p>
<blockquote>
<p>一种特殊情况是处理自引用外键。 在这里，Alembic 采取了一个特殊的步骤，将自引用外键重新创建为引用原始表名，而不是在“临时”表中，这样就像在其他外键约束的情况下一样，当表被重命名为它的原始名称，外键再次引用正确的表。 此操作仅在禁用引用完整性时有效，与从其他表引用外键的相同要求一致。</p>
</blockquote>
<p>When SQLite’s <code>PRAGMA FOREIGN KEYS</code> mode is turned on, it does provide the service that foreign key constraints, including self-referential, will automatically be modified to point to their table across table renames, however this mode prevents the target table from being dropped as is required by a batch migration. Therefore it may be necessary to manipulate the <code>PRAGMA FOREIGN KEYS</code> setting if a migration seeks to rename a table vs. batch migrate it.</p>
<blockquote>
<p>当 SQLite 的 <code>PRAGMA FOREIGN KEYS</code> 模式开启时，它确实提供了外键约束的服务，包括自引用, 将自动修改为跨表重命名指向其表，但是此模式可防止目标表按照批量迁移的要求被删除。 因此，如果迁移试图重命名表而不是批量迁移，则可能需要操作 <code>PRAGMA FOREIGN KEYS</code> 设置。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-in-offline-mode"><a class="header" href="#working-in-offline-mode">Working in Offline Mode</a></h1>
<p><strong>在离线模式下工作</strong></p>
<p>In the preceding sections, we’ve seen how much of an emphasis the “move and copy” process has on using reflection in order to know the structure of the table that is to be copied. This means that in the typical case, “online” mode, where a live database connection is present so that <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> can reflect the table from the database, is required; the <code>--sql</code> flag <strong>cannot</strong> be used without extra steps.</p>
<blockquote>
<p>在前面的部分中，我们已经看到 “移动和复制” 过程对于使用反射来了解要复制的表的结构有多么重要。 这意味着在典型情况下，需要“在线”模式，其中存在实时数据库连接，以便 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> 可以反映数据库中的表； 如果没有额外的步骤，就不能使用 <code>--sql</code> 标志。</p>
</blockquote>
<p>To support offline mode, the system must work without table reflection present, which means the full table as it intends to be created must be passed to <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> using <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#copy_from">copy_from</a></strong>:</p>
<blockquote>
<p>为了支持离线模式，系统必须在没有表反射的情况下工作，这意味着必须使用 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#copy_from">copy_from</a></strong> 将要创建的完整表传递给 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong>：</p>
</blockquote>
<pre><code class="language-python">meta = MetaData()
some_table = Table(
    'some_table', meta,
    Column('id', Integer, primary_key=True),
    Column('bar', String(50))
)

with op.batch_alter_table(&quot;some_table&quot;, copy_from=some_table) as batch_op:
    batch_op.add_column(Column('foo', Integer))
    batch_op.drop_column('bar')
</code></pre>
<p>The above use pattern is pretty tedious and quite far off from Alembic’s preferred style of working; however, if one needs to do SQLite-compatible “move and copy” migrations and need them to generate flat SQL files in “offline” mode, there’s not much alternative.</p>
<blockquote>
<p>上述使用模式相当乏味，与 Alembic 喜欢的工作方式相去甚远； 但是，如果需要进行与 SQLite 兼容的“移动和复制”迁移，并需要它们在“离线”模式下生成平面 SQL 文件，则别无选择。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="batch-mode-with-autogenerate"><a class="header" href="#batch-mode-with-autogenerate">Batch mode with Autogenerate</a></h1>
<p><strong>自动生成和批处理模式</strong></p>
<p>The syntax of batch mode is essentially that <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> is used to enter a batch block, and the returned <strong><a href="zh/../zh/06_02_batch_operations.html">BatchOperations</a></strong> context works just like the regular <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> context, except that the “table name” and “schema name” arguments are omitted.</p>
<blockquote>
<p>批处理模式的语法本质上是 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> 用于进入批处理块，返回的 <strong><a href="zh/../zh/06_02_batch_operations.html">BatchOperations</a></strong> 上下文与常规操作上下文一样工作，只是省略了 “table name” 和 “schema name” 参数。</p>
</blockquote>
<p>To support rendering of migration commands in batch mode for autogenerate, configure the <strong><a href="zh/../zh/08_02_01_02_configure.html#render_as_batch">EnvironmentContext.configure.render_as_batch</a></strong> flag in env.py:</p>
<blockquote>
<p>要支持以批处理模式渲染迁移命令以进行自动生成，请在 <code>env.py</code> 中配置 <strong><a href="zh/../zh/08_02_01_02_configure.html#render_as_batch">EnvironmentContext.configure.render_as_batch</a></strong> 标志：</p>
</blockquote>
<pre><code class="language-python">context.configure(
    connection=connection,
    target_metadata=target_metadata,
    render_as_batch=True
)
</code></pre>
<p>Autogenerate will now generate along the lines of:</p>
<blockquote>
<p>Autogenerate 现在将按照以下方式生成：</p>
</blockquote>
<pre><code class="language-python">def upgrade():
    ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('address', schema=None) as batch_op:
        batch_op.add_column(sa.Column('street', sa.String(length=50), nullable=True))
</code></pre>
<p>This mode is safe to use in all cases, as the <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> directive by default only takes place for SQLite; other backends will behave just as they normally do in the absence of the batch directives.</p>
<blockquote>
<p>此模式在所有情况下都可以安全使用，因为默认情况下 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong> 指令仅适用于 SQLite； 在没有批处理指令的情况下，其他后端的行为将与它们通常的行为一样。</p>
</blockquote>
<p>Note that autogenerate support does not include “offline” mode, where the <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#copy_from">Operations.batch_alter_table.copy_from</a></strong> parameter is used. The table definition here would need to be entered into migration files manually if this is needed.</p>
<blockquote>
<p>请注意，自动生成支持不包括使用 <strong><a href="zh/../zh/06_01_03_batch_alter_table.html#copy_from">Operations.batch_alter_table.copy_from</a></strong> 参数的“离线”模式。 如果需要，此处的表定义需要手动输入到迁移文件中。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="batch-mode-with-databases-other-than-sqlite"><a class="header" href="#batch-mode-with-databases-other-than-sqlite">Batch mode with databases other than SQLite</a></h1>
<p><strong>SQLite 以外的数据库的批处理模式</strong></p>
<p>There’s an odd use case some shops have, where the “move and copy” style of migration is useful in some cases for databases that do already support ALTER. There’s some cases where an ALTER operation may block access to the table for a long time, which might not be acceptable. “move and copy” can be made to work on other backends, though with a few extra caveats.</p>
<blockquote>
<p>一些商店有一个奇怪的用例，其中“移动和复制”风格的迁移在某些情况下对于已经支持 ALTER 的数据库很有用。 在某些情况下，ALTER 操作可能会长时间阻止对表的访问，这可能是不可接受的。 “移动和复制” 可以在其他后端工作，尽管有一些额外的警告。</p>
</blockquote>
<p>The batch mode directive will run the “recreate” system regardless of backend if the flag <code>recreate='always'</code> is passed:</p>
<blockquote>
<p>如果传递了标志 <code>recreate='always'</code>，批处理模式指令将运行 “recreate” 系统，而不管后端如何：</p>
</blockquote>
<pre><code class="language-python">with op.batch_alter_table(&quot;some_table&quot;, recreate='always') as batch_op:
    batch_op.add_column(Column('foo', Integer))
</code></pre>
<p>The issues that arise in this mode are mostly to do with constraints. Databases such as Postgresql and MySQL with InnoDB will enforce referential integrity (e.g. via foreign keys) in all cases. Unlike SQLite, it’s not as simple to turn off referential integrity across the board (nor would it be desirable). Since a new table is replacing the old one, existing foreign key constraints which refer to the target table will need to be unconditionally dropped before the batch operation, and re-created to refer to the new table afterwards. Batch mode currently does not provide any automation for this.</p>
<blockquote>
<p>这种模式下出现的问题主要与约束有关。 在所有情况下，带有 InnoDB 的 Postgresql 和 MySQL 等数据库都将强制执行引用完整性（例如通过外键）。 与 SQLite 不同，全面关闭参照完整性并不那么简单（也不是可取的）。 由于新表正在替换旧表，因此需要在批处理操作之前无条件地删除引用目标表的现有外键约束，然后重新创建以引用新表。 批处理模式目前不为此提供任何自动化。</p>
</blockquote>
<p>The Postgresql database and possibly others also have the behavior such that when the new table is created, a naming conflict occurs with the named constraints of the new table, in that they match those of the old table, and on Postgresql, these names need to be unique across all tables. The Postgresql dialect will therefore emit a “DROP CONSTRAINT” directive for all constraints on the old table before the new one is created; this is “safe” in case of a failed operation because Postgresql also supports transactional DDL.</p>
<blockquote>
<p>Postgresql 数据库和可能的其他数据库也有这样的行为，即在创建新表时，与新表的命名约束发生命名冲突，因为它们与旧表的约束匹配，并且在 Postgresql 上，这些名称需要 在所有表中都是唯一的。 因此，在创建新表之前，Postgresql 方言将为旧表上的所有约束发出“DROP CONSTRAINT”指令； 这在操作失败的情况下是“安全的”，因为 Postgresql 还支持事务 DDL。</p>
</blockquote>
<p>Note that also as is the case with SQLite, CHECK constraints need to be moved over between old and new table manually using the <strong><a href="zh/../en/ops.html#alembic.operations.Operations.batch_alter_table.params.table_args">Operations.batch_alter_table.table_args</a></strong> parameter.</p>
<blockquote>
<p>请注意，与 SQLite 的情况一样，需要使用  <strong><a href="zh/../en/ops.html#alembic.operations.Operations.batch_alter_table.params.table_args">Operations.batch_alter_table.table_args</a></strong> 参数在新旧表之间手动移动 CHECK 约束。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-branches"><a class="header" href="#working-with-branches">Working with Branches</a></h1>
<p><strong>工作分支</strong></p>
<p>A <strong>branch</strong> describes a point in a migration stream when two or more versions refer to the same parent migration as their anscestor. Branches occur naturally when two divergent source trees, both containing Alembic revision files created independently within those source trees, are merged together into one. When this occurs, the challenge of a branch is to <strong>merge</strong> the branches into a single series of changes, so that databases established from either source tree individually can be upgraded to reference the merged result equally. Another scenario where branches are present are when we create them directly; either at some point in the migration stream we’d like different series of migrations to be managed independently (e.g. we create a tree), or we’d like separate migration streams for different features starting at the root (e.g. a forest). We’ll illustrate all of these cases, starting with the most common which is a source-merge-originated branch that we’ll merge.</p>
<p>Starting with the “account table” example we began in <strong><a href="zh/../en/tutorial.html#create-migration">Create a Migration Script</a></strong>, assume we have our basemost version <code>1975ea83b712</code>, which leads into the second revision <code>ae1027a6acf</code>, and the migration files for these two revisions are checked into our source repository. Consider if we merged into our source repository another code branch which contained a revision for another table called <code>shopping_cart</code>. This revision was made against our first Alembic revision, the one that generated <code>account</code>. After loading the second source tree in, a new file <code>27c6a30d7c24_add_shopping_cart_table.py</code> exists within our <code>versions</code> directory. Both it, as well as <code>ae1027a6acf_add_a_column.py</code>, reference <code>1975ea83b712_add_account_table.py</code> as the “downgrade” revision. To illustrate:</p>
<pre><code class="language-bash"># main source tree:
1975ea83b712 (create account table) -&gt; ae1027a6acf (add a column)

# branched source tree
1975ea83b712 (create account table) -&gt; 27c6a30d7c24 (add shopping cart table)
</code></pre>
<p>Above, we can see <code>1975ea83b712</code> is our <strong>branch point</strong>; two distinct versions both refer to it as its parent. The Alembic command <code>branches</code> illustrates this fact:</p>
<pre><code class="language-bash">$ alembic branches --verbose
Rev: 1975ea83b712 (branchpoint)
Parent: &lt;base&gt;
Branches into: 27c6a30d7c24, ae1027a6acf
Path: foo/versions/1975ea83b712_add_account_table.py

    create account table

    Revision ID: 1975ea83b712
    Revises:
    Create Date: 2014-11-20 13:02:46.257104

             -&gt; 27c6a30d7c24 (head), add shopping cart table
             -&gt; ae1027a6acf (head), add a column
</code></pre>
<p>History shows it too, illustrating two <code>head</code> entries as well as a <code>branchpoint</code>:</p>
<pre><code class="language-bash">$ alembic history
1975ea83b712 -&gt; 27c6a30d7c24 (head), add shopping cart table
1975ea83b712 -&gt; ae1027a6acf (head), add a column
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>We can get a view of just the current heads using <code>alembic heads</code>:</p>
<pre><code class="language-bash">$ alembic heads --verbose
Rev: 27c6a30d7c24 (head)
Parent: 1975ea83b712
Path: foo/versions/27c6a30d7c24_add_shopping_cart_table.py

    add shopping cart table

    Revision ID: 27c6a30d7c24
    Revises: 1975ea83b712
    Create Date: 2014-11-20 13:03:11.436407

Rev: ae1027a6acf (head)
Parent: 1975ea83b712
Path: foo/versions/ae1027a6acf_add_a_column.py

    add a column

    Revision ID: ae1027a6acf
    Revises: 1975ea83b712
    Create Date: 2014-11-20 13:02:54.849677
</code></pre>
<p>If we try to run an <code>upgrade</code> to the usual end target of <code>head</code>, Alembic no longer considers this to be an unambiguous command. As we have more than one <code>head</code>, the <code>upgrade</code> command wants us to provide more information:</p>
<pre><code class="language-bash">$ alembic upgrade head
  FAILED: Multiple head revisions are present for given argument 'head'; please specify a specific
  target revision, '&lt;branchname&gt;@head' to narrow to a specific head, or 'heads' for all heads
</code></pre>
<p>The <code>upgrade</code> command gives us quite a few options in which we can proceed with our <code>upgrade</code>, either giving it information on which head we’d like to <code>upgrade</code> towards, or alternatively stating that we’d like all heads to be upgraded towards at once. However, in the typical case of two source trees being merged, we will want to pursue a third option, which is that we can <strong>merge</strong> these branches.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="merging-branches"><a class="header" href="#merging-branches">Merging Branches</a></h1>
<p><strong>合并分支</strong></p>
<p>An Alembic merge is a migration file that joins two or more “head” files together. If the two branches we have right now can be said to be a “tree” structure, introducing this merge file will turn it into a “diamond” structure:</p>
<pre><code class="language-text">                            -- ae1027a6acf --&gt;
                           /                   \
&lt;base&gt; --&gt; 1975ea83b712 --&gt;                      --&gt; mergepoint
                           \                   /
                            -- 27c6a30d7c24 --&gt;
</code></pre>
<p>We create the merge file using alembic merge; with this command, we can pass to it an argument such as <code>heads</code>, meaning we’d like to merge all <code>heads</code>. Or, we can pass it individual revision numbers sequentally:</p>
<pre><code class="language-bash">$ alembic merge -m &quot;merge ae1 and 27c&quot; ae1027 27c6a
  Generating /path/to/foo/versions/53fffde5ad5_merge_ae1_and_27c.py ... done
</code></pre>
<p>Looking inside the new file, we see it as a regular migration file, with the only new twist is that <code>down_revision</code> points to both revisions:</p>
<pre><code class="language-python">&quot;&quot;&quot;merge ae1 and 27c

Revision ID: 53fffde5ad5
Revises: ae1027a6acf, 27c6a30d7c24
Create Date: 2014-11-20 13:31:50.811663

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '53fffde5ad5'
down_revision = ('ae1027a6acf', '27c6a30d7c24')
branch_labels = None

from alembic import op
import sqlalchemy as sa


def upgrade():
    pass


def downgrade():
    pass
</code></pre>
<p>This file is a regular migration file, and if we wish to, we may place <strong><a href="zh/../en/ops.html#alembic.operations.Operations">Operations</a></strong> directives into the <code>upgrade()</code> and <code>downgrade()</code> functions like any other migration file. Though it is probably best to limit the instructions placed here only to those that deal with any kind of reconciliation that is needed between the two merged branches, if any.</p>
<p>The <code>heads</code> command now illustrates that the multiple <code>heads</code> in our <code>versions/</code> directory have been resolved into our new head:</p>
<pre><code class="language-bash">$ alembic heads --verbose
Rev: 53fffde5ad5 (head) (mergepoint)
Merges: ae1027a6acf, 27c6a30d7c24
Path: foo/versions/53fffde5ad5_merge_ae1_and_27c.py

    merge ae1 and 27c

    Revision ID: 53fffde5ad5
    Revises: ae1027a6acf, 27c6a30d7c24
    Create Date: 2014-11-20 13:31:50.811663
</code></pre>
<p>History shows a similar result, as the mergepoint becomes our head:</p>
<pre><code class="language-bash">$ alembic history
ae1027a6acf, 27c6a30d7c24 -&gt; 53fffde5ad5 (head) (mergepoint), merge ae1 and 27c
1975ea83b712 -&gt; ae1027a6acf, add a column
1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>With a single <code>head</code> target, a generic <code>upgrade</code> can proceed:</p>
<pre><code class="language-bash">$ alembic upgrade head
INFO  [alembic.migration] Context impl PostgresqlImpl.
INFO  [alembic.migration] Will assume transactional DDL.
INFO  [alembic.migration] Running upgrade  -&gt; 1975ea83b712, create account table
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; ae1027a6acf, add a column
INFO  [alembic.migration] Running upgrade ae1027a6acf, 27c6a30d7c24 -&gt; 53fffde5ad5, merge ae1 and 27c
</code></pre>
<p><strong>merge mechanics</strong></p>
<p>The upgrade process traverses through all of our migration files using a <strong>topological sorting</strong> algorithm, treating the list of migration files not as a linked list, but as a directed acyclic graph. The starting points of this traversal are the <strong>current heads</strong> within our database, and the end point is the “head” revision or revisions specified.</p>
<p>When a migration proceeds across a point at which there are multiple heads, the <code>alembic_version</code> table will at that point store multiple rows, one for each head. Our migration process above will emit SQL against <code>alembic_version</code> along these lines:</p>
<pre><code class="language-bash">-- Running upgrade  -&gt; 1975ea83b712, create account table
INSERT INTO alembic_version (version_num) VALUES ('1975ea83b712')

-- Running upgrade 1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
UPDATE alembic_version SET version_num='27c6a30d7c24' WHERE alembic_version.version_num = '1975ea83b712'

-- Running upgrade 1975ea83b712 -&gt; ae1027a6acf, add a column
INSERT INTO alembic_version (version_num) VALUES ('ae1027a6acf')

-- Running upgrade ae1027a6acf, 27c6a30d7c24 -&gt; 53fffde5ad5, merge ae1 and 27c
DELETE FROM alembic_version WHERE alembic_version.version_num = 'ae1027a6acf'
UPDATE alembic_version SET version_num='53fffde5ad5' WHERE alembic_version.version_num = '27c6a30d7c24'
</code></pre>
<p>At the point at which both <code>27c6a30d7c24</code> and <code>ae1027a6acf</code> exist within our database, both values are present in <code>alembic_version</code>, which now has two rows. If we upgrade to these two versions alone, then stop and run <code>alembic current</code>, we will see this:</p>
<pre><code class="language-bash">$ alembic current --verbose
Current revision(s) for postgresql://scott:XXXXX@localhost/test:
Rev: ae1027a6acf
Parent: 1975ea83b712
Path: foo/versions/ae1027a6acf_add_a_column.py

    add a column

    Revision ID: ae1027a6acf
    Revises: 1975ea83b712
    Create Date: 2014-11-20 13:02:54.849677

Rev: 27c6a30d7c24
Parent: 1975ea83b712
Path: foo/versions/27c6a30d7c24_add_shopping_cart_table.py

    add shopping cart table

    Revision ID: 27c6a30d7c24
    Revises: 1975ea83b712
    Create Date: 2014-11-20 13:03:11.436407
</code></pre>
<p>A key advantage to the <code>merge</code> process is that it will run equally well on databases that were present on version <code>ae1027a6acf</code> alone, versus databases that were present on version <code>27c6a30d7c24</code> alone; whichever version was not yet applied, will be applied before the <code>merge</code> point can be crossed. This brings forth a way of thinking about a <code>merge</code> file, as well as about any Alembic revision file. As they are considered to be “nodes” within a set that is subject to topological sorting, each “node” is a point that cannot be crossed until all of its dependencies are satisfied.</p>
<p>Prior to Alembic’s support of merge points, the use case of databases sitting on different heads was basically impossible to reconcile; having to manually splice the head files together invariably meant that one migration would occur before the other, thus being incompatible with databases that were present on the other migration.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-explicit-branches"><a class="header" href="#working-with-explicit-branches">Working with Explicit Branches</a></h1>
<p><strong>使用显式分支</strong></p>
<p>The <code>alembic upgrade</code> command hinted at other options besides merging when dealing with multiple heads. Let’s back up and assume we’re back where we have as our heads just <code>ae1027a6acf</code> and <code>27c6a30d7c24</code>:</p>
<pre><code class="language-bash">$ alembic heads
27c6a30d7c24
ae1027a6acf
</code></pre>
<p>Earlier, when we did <code>alembic upgrade head</code>, it gave us an error which suggested <code>please specify a specific target revision, '&lt;branchname&gt;@head' to narrow to a specific head, or 'heads' for all heads</code> in order to proceed without merging. Let’s cover those cases.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="referring-to-all-heads-at-once"><a class="header" href="#referring-to-all-heads-at-once">Referring to all heads at once</a></h1>
<p><strong>一次引用到所有的head</strong></p>
<p>The <code>heads</code> identifier is a lot like <code>head</code>, except it explicitly refers to all <code>heads</code> at once. That is, it’s like telling Alembic to do the operation for both <code>ae1027a6acf</code> and <code>27c6a30d7c24</code> simultaneously. If we started from a fresh database and ran upgrade <code>heads</code> we’d see:</p>
<pre><code class="language-bash">$ alembic upgrade heads
INFO  [alembic.migration] Context impl PostgresqlImpl.
INFO  [alembic.migration] Will assume transactional DDL.
INFO  [alembic.migration] Running upgrade  -&gt; 1975ea83b712, create account table
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; ae1027a6acf, add a column
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
</code></pre>
<p>Since we’ve upgraded to <code>heads</code>, and we do in fact have more than one head, that means these two distinct <code>heads</code> are now in our <code>alembic_version</code> table. We can see this if we run <code>alembic current</code>:</p>
<pre><code class="language-bash">$ alembic current
ae1027a6acf (head)
27c6a30d7c24 (head)
</code></pre>
<p>That means there’s two rows in <code>alembic_version</code> right now. If we downgrade one step at a time, Alembic will <strong>delete</strong> from the <code>alembic_version</code> table each branch that’s closed out, until only one branch remains; then it will continue updating the single value down to the previous versions:</p>
<pre><code class="language-bash">$ alembic downgrade -1
INFO  [alembic.migration] Running downgrade ae1027a6acf -&gt; 1975ea83b712, add a column

$ alembic current
27c6a30d7c24 (head)

$ alembic downgrade -1
INFO  [alembic.migration] Running downgrade 27c6a30d7c24 -&gt; 1975ea83b712, add shopping cart table

$ alembic current
1975ea83b712 (branchpoint)

$ alembic downgrade -1
INFO  [alembic.migration] Running downgrade 1975ea83b712 -&gt; , create account table

$ alembic current
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="referring-to-a-specific-version"><a class="header" href="#referring-to-a-specific-version">Referring to a Specific Version</a></h1>
<p><strong>引用特定版本</strong></p>
<p>We can pass a specific version number to <code>upgrade</code>. Alembic will ensure that all revisions upon which this version depends are invoked, and nothing more. So if we <code>upgrade</code> either to <code>27c6a30d7c24</code> or <code>ae1027a6acf</code> specifically, it guarantees that <code>1975ea83b712</code> will have been applied, but not that any “sibling” versions are applied:</p>
<pre><code class="language-bash">$ alembic upgrade 27c6a
INFO  [alembic.migration] Running upgrade  -&gt; 1975ea83b712, create account table
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
</code></pre>
<p>With <code>1975ea83b712</code> and <code>27c6a30d7c24</code> applied, <code>ae1027a6acf</code> is just a single additional step:</p>
<pre><code class="language-bash">$ alembic upgrade ae102
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; ae1027a6acf, add a column
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-branch-labels"><a class="header" href="#working-with-branch-labels">Working with Branch Labels</a></h1>
<p><strong>使用分支标注</strong></p>
<p>To satisfy the use case where an environment has long-lived branches, especially independent branches as will be discussed in the next section, Alembic supports the concept of branch labels. These are string values that are present within the migration file, using the new identifier <code>branch_labels</code>. For example, if we want to refer to the “shopping cart” branch using the name “shoppingcart”, we can add that name to our file <code>27c6a30d7c24_add_shopping_cart_table.py</code>:</p>
<pre><code class="language-python">&quot;&quot;&quot;add shopping cart table

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '27c6a30d7c24'
down_revision = '1975ea83b712'
branch_labels = ('shoppingcart',)

# ...
</code></pre>
<p>The <code>branch_labels</code> attribute refers to a string name, or a tuple of names, which will now apply to this revision, all descendants of this revision, as well as all ancestors of this revision up until the preceding branch point, in this case <code>1975ea83b712</code>. We can see the <code>shoppingcart</code> label applied to this revision:</p>
<pre><code class="language-bash">$ alembic history
1975ea83b712 -&gt; 27c6a30d7c24 (shoppingcart) (head), add shopping cart table
1975ea83b712 -&gt; ae1027a6acf (head), add a column
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>With the label applied, the name <code>shoppingcart</code> now serves as an alias for the <code>27c6a30d7c24</code> revision specifically. We can illustrate this by showing it with <code>alembic show</code>:</p>
<pre><code class="language-bash">$ alembic show shoppingcart
Rev: 27c6a30d7c24 (head)
Parent: 1975ea83b712
Branch names: shoppingcart
Path: foo/versions/27c6a30d7c24_add_shopping_cart_table.py

    add shopping cart table

    Revision ID: 27c6a30d7c24
    Revises: 1975ea83b712
    Create Date: 2014-11-20 13:03:11.436407
</code></pre>
<p>However, when using branch labels, we usually want to use them using a syntax known as “branch at” syntax; this syntax allows us to state that we want to use a specific revision, let’s say a “head” revision, in terms of a specific branch. While normally, we can’t refer to <code>alembic upgrade head</code> when there’s multiple heads, we can refer to this head specifcally using <code>shoppingcart@head</code> syntax:</p>
<pre><code class="language-bash">$ alembic upgrade shoppingcart@head
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
</code></pre>
<p>The <code>shoppingcart@head</code> syntax becomes important to us if we wish to add new migration files to our versions directory while maintaining multiple branches. Just like the <code>upgrade</code> command, if we attempted to add a new revision file to our multiple-heads layout without a specific parent revision, we’d get a familiar error:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add a shopping cart column&quot;
  FAILED: Multiple heads are present; please specify the head revision on
  which the new revision should be based, or perform a merge.
</code></pre>
<p>The <code>alembic revision</code> command is pretty clear in what we need to do; to add our new revision specifically to the <code>shoppingcart</code> branch, we use the <code>--head</code> argument, either with the specific revision identifier <code>27c6a30d7c24</code>, or more generically using our branchname <code>shoppingcart@head</code>:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add a shopping cart column&quot;  --head shoppingcart@head
  Generating /path/to/foo/versions/d747a8a8879_add_a_shopping_cart_column.py ... done
</code></pre>
<p>alembic history shows both files now part of the <code>shoppingcart</code> branch:</p>
<pre><code class="language-bash">$ alembic history
1975ea83b712 -&gt; ae1027a6acf (head), add a column
27c6a30d7c24 -&gt; d747a8a8879 (shoppingcart) (head), add a shopping cart column
1975ea83b712 -&gt; 27c6a30d7c24 (shoppingcart), add shopping cart table
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>We can limit our history operation just to this branch as well:</p>
<pre><code class="language-bash">$ alembic history -r shoppingcart:
27c6a30d7c24 -&gt; d747a8a8879 (shoppingcart) (head), add a shopping cart column
1975ea83b712 -&gt; 27c6a30d7c24 (shoppingcart), add shopping cart table
</code></pre>
<p>If we want to illustrate the path of <code>shoppingcart</code> all the way from the base, we can do that as follows:</p>
<pre><code class="language-bash">$ alembic history -r :shoppingcart@head
27c6a30d7c24 -&gt; d747a8a8879 (shoppingcart) (head), add a shopping cart column
1975ea83b712 -&gt; 27c6a30d7c24 (shoppingcart), add shopping cart table
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>We can run this operation from the “base” side as well, but we get a different result:</p>
<pre><code class="language-bash$ alembic history -r shoppingcart@base:">1975ea83b712 -&gt; ae1027a6acf (head), add a column
27c6a30d7c24 -&gt; d747a8a8879 (shoppingcart) (head), add a shopping cart column
1975ea83b712 -&gt; 27c6a30d7c24 (shoppingcart), add shopping cart table
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>When we list from <code>shoppingcart@base</code> without an endpoint, it’s really shorthand for -r <code>shoppingcart@base</code>:heads, e.g. all heads, and since <code>shoppingcart@base</code> is the same “base” shared by the <code>ae1027a6acf</code> revision, we get that revision in our listing as well. The <code>&lt;branchname&gt;@base</code> syntax can be useful when we are dealing with individual bases, as we’ll see in the next section.</p>
<p>The <code>&lt;branchname&gt;@head</code> format can also be used with revision numbers instead of branch names, though this is less convenient. If we wanted to add a new revision to our branch that includes the un-labeled <code>ae1027a6acf</code>, if this weren’t a head already, we could ask for the “head of the branch that includes ae1027a6acf” as follows:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add another account column&quot; --head ae10@head
  Generating /path/to/foo/versions/55af2cb1c267_add_another_account_column.py ... done
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="more-label-syntaxes"><a class="header" href="#more-label-syntaxes">More Label Syntaxes</a></h1>
<p><strong>更多标注语法</strong></p>
<p>The <code>heads</code> symbol can be combined with a branch label, in the case that your labeled branch itself breaks off into multiple branches:</p>
<pre><code class="language-bash">alembic upgrade shoppingcart@heads
</code></pre>
<p>Relative identifiers, as introduced in <strong><a href="zh/../en/tutorial.html#relative-migrations">Relative Migration Identifiers</a></strong>, work with labels too. For example, upgrading to <code>shoppingcart@+2</code> means to upgrade from current heads on “shoppingcart” upwards two revisions:</p>
<pre><code class="language-bash">alembic upgrade shoppingcart@+2
</code></pre>
<p>This kind of thing works from history as well:</p>
<pre><code class="language-bash">alembic history -r current:shoppingcart@+2
</code></pre>
<p>The newer <code>relnum+delta</code> format can be combined as well, for example if we wanted to list along <code>shoppingcart</code> up until two revisions before the head:</p>
<pre><code class="language-bash">alembic history -r :shoppingcart@head-2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-multiple-bases"><a class="header" href="#working-with-multiple-bases">Working with Multiple Bases</a></h1>
<p><strong>基于多个base工作</strong></p>
<blockquote>
<p><strong>Note</strong>: The multiple base feature is intended to allow for multiple Alembic versioning lineages which share the same alembic_version table. This is so that individual revisions within the lineages can have cross-dependencies on each other. For the simpler case where one project has multiple, <strong>completely independent</strong> revision lineages that refer to <strong>separate</strong> alembic_version tables, see the example in <strong><a href="zh/../en/cookbook.html#multiple-environments">Run Multiple Alembic Environments from one .ini file</a></strong>.</p>
</blockquote>
<p>We’ve seen in the previous section that <code>alembic upgrade</code> is fine if we have multiple heads, <code>alembic revision</code> allows us to tell it which “head” we’d like to associate our new revision file with, and branch labels allow us to assign names to branches that we can use in subsequent commands. Let’s put all these together and refer to a new “base”, that is, a whole new tree of revision files that will be semi-independent of the account/shopping cart revisions we’ve been working with. This new tree will deal with database tables involving “networking”.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up-multiple-version-directories"><a class="header" href="#setting-up-multiple-version-directories">Setting up Multiple Version Directories</a></h1>
<p><strong>设置多版本目录</strong></p>
<p>While optional, it is often the case that when working with multiple bases, we’d like different sets of version files to exist within their own directories; typically, if an application is organized into several sub-modules, each one would have a version directory containing migrations pertinent to that module. So to start out, we can edit <code>alembic.ini</code> to refer to multiple directories; we’ll also state the current <code>versions</code> directory as one of them:</p>
<pre><code class="language-python"># A separator for the location paths must be defined first.
version_path_separator = os  # Use os.pathsep.
# version location specification; this defaults
# to foo/versions.  When using multiple version
# directories, initial revisions must be specified with --version-path
version_locations = %(here)s/model/networking:%(here)s/alembic/versions
</code></pre>
<p>The new directory <code>%(here)s/model/networking</code> is in terms of where the <code>alembic.ini</code> file is, as we are using the symbol <code>%(here)s</code> which resolves to this location. When we create our first new revision targeted at this directory, <code>model/networking</code> will be created automatically if it does not exist yet. Once we’ve created a revision here, the path is used automatically when generating subsequent revision files that refer to this revision tree.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-labeled-base-revision"><a class="header" href="#creating-a-labeled-base-revision">Creating a Labeled Base Revision</a></h1>
<p><strong>创建带标注的基本修订</strong></p>
<p>We also want our new branch to have its own name, and for that we want to apply a branch label to the base. In order to achieve this using the <code>alembic revision</code> command without editing, we need to ensure our <code>script.py.mako</code> file, used for generating new revision files, has the appropriate substitutions present. If Alembic version 0.7.0 or greater was used to generate the original migration environment, this is already done. However when working with an older environment, <code>script.py.mako</code> needs to have this directive added, typically underneath the <code>down_revision</code> directive:</p>
<pre><code class="language-bash"># revision identifiers, used by Alembic.
revision = ${repr(up_revision)}
down_revision = ${repr(down_revision)}

# add this here in order to use revision with branch_label
branch_labels = ${repr(branch_labels)}
</code></pre>
<p>With this in place, we can create a new revision file, starting up a branch that will deal with database tables involving networking; we specify the <code>--head</code> version of <code>base</code>, a <code>--branch-label</code> of <code>networking</code>, and the directory we want this first revision file to be placed in with <code>--version-path</code>:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;create networking branch&quot; --head=base --branch-label=networking --version-path=model/networking
  Creating directory /path/to/foo/model/networking ... done
  Generating /path/to/foo/model/networking/3cac04ae8714_create_networking_branch.py ... done
</code></pre>
<p>If we ran the above command and we didn’t have the newer <code>script.py.mako</code> directive, we’d get this error:</p>
<pre><code class="language-bash">FAILED: Version 3cac04ae8714 specified branch_labels networking, however
the migration file foo/model/networking/3cac04ae8714_create_networking_branch.py
does not have them; have you upgraded your script.py.mako to include the 'branch_labels'
section?
</code></pre>
<p>When we receive the above error, and we would like to try again, we need to either <strong>delete</strong> the incorrectly generated file in order to run <code>revision</code> again, or we can edit the <code>3cac04ae8714_create_networking_branch.py</code> directly to add the <code>branch_labels</code> in of our choosing.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-with-multiple-bases"><a class="header" href="#running-with-multiple-bases">Running with Multiple Bases</a></h1>
<p><strong>基于多个base运行</strong></p>
<p>Once we have a new, permanent (for as long as we desire it to be) base in our system, we’ll always have multiple heads present:</p>
<pre><code class="language-bash">$ alembic heads
3cac04ae8714 (networking) (head)
27c6a30d7c24 (shoppingcart) (head)
ae1027a6acf (head)

</code></pre>
<p>When we want to add a new revision file to <code>networking</code>, we specify <code>networking@head</code> as the <code>--head</code>. The appropriate version directory is now selected automatically based on the head we choose:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add ip number table&quot; --head=networking@head
  Generating /path/to/foo/model/networking/109ec7d132bf_add_ip_number_table.py ... done
</code></pre>
<p>It’s important that we refer to the head using networking@head; if we only refer to <code>networking</code>, that refers to only <code>3cac04ae8714</code> specifically; if we specify this and it’s not a head, <code>alembic revision</code> will make sure we didn’t mean to specify the head:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add DNS table&quot; --head=networking
  FAILED: Revision 3cac04ae8714 is not a head revision; please
  specify --splice to create a new branch from this revision
</code></pre>
<p>As mentioned earlier, as this base is independent, we can view its history from the base using <code>history -r networking@base:</code>:</p>
<pre><code class="language-bash">$ alembic history -r networking@base:
109ec7d132bf -&gt; 29f859a13ea (networking) (head), add DNS table
3cac04ae8714 -&gt; 109ec7d132bf (networking), add ip number table
&lt;base&gt; -&gt; 3cac04ae8714 (networking), create networking branch
</code></pre>
<p>At the moment, this is the same output we’d get at this point if we used <code>-r :networking@head</code>. However, that will change later on as we use additional directives.</p>
<p>We may now run upgrades or downgrades freely, among individual branches (let’s assume a clean database again):</p>
<pre><code class="language-bash">$ alembic upgrade networking@head
INFO  [alembic.migration] Running upgrade  -&gt; 3cac04ae8714, create networking branch
INFO  [alembic.migration] Running upgrade 3cac04ae8714 -&gt; 109ec7d132bf, add ip number table
INFO  [alembic.migration] Running upgrade 109ec7d132bf -&gt; 29f859a13ea, add DNS table
</code></pre>
<p>or against the whole thing using <code>heads</code>:</p>
<pre><code class="language-bash">$ alembic upgrade heads
INFO  [alembic.migration] Running upgrade  -&gt; 1975ea83b712, create account table
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; 27c6a30d7c24, add shopping cart table
INFO  [alembic.migration] Running upgrade 27c6a30d7c24 -&gt; d747a8a8879, add a shopping cart column
INFO  [alembic.migration] Running upgrade 1975ea83b712 -&gt; ae1027a6acf, add a column
INFO  [alembic.migration] Running upgrade ae1027a6acf -&gt; 55af2cb1c267, add another account column
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="branch-dependencies"><a class="header" href="#branch-dependencies">Branch Dependencies</a></h1>
<p>When working with multiple roots, it is expected that these different revision streams will need to refer to one another. For example, a new revision in <code>networking</code> which needs to refer to the <code>account</code> table will want to establish 55af2cb1c267, add another <code>account</code> column, the last revision that works with the <code>account</code> table, as a dependency. From a graph perspective, this means nothing more that the new file will feature both 55af2cb1c267, add another <code>account</code> column and <code>29f859a13ea, add DNS table</code> as “down” revisions, and looks just as though we had merged these two branches together. However, we don’t want to consider these as “merged”; we want the two revision streams to remain independent, even though a version in <code>networking</code> is going to reach over into the other stream. To support this use case, Alembic provides a directive known as <code>depends_on</code>, which allows a revision file to refer to another as a “dependency”, very similar to an entry in <code>down_revision</code> from a graph perspective, but different from a semantic perspective.</p>
<p>To use <code>depends_on</code>, we can specify it as part of our <code>alembic revision</code> command:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add ip account table&quot; --head=networking@head  --depends-on=55af2cb1c267
  Generating /path/to/foo/model/networking/2a95102259be_add_ip_account_table.py ... done
</code></pre>
<p>Within our migration file, we’ll see this new directive present:</p>
<pre><code class="language-python"># revision identifiers, used by Alembic.
revision = '2a95102259be'
down_revision = '29f859a13ea'
branch_labels = None
depends_on='55af2cb1c267'
</code></pre>
<p><code>depends_on</code> may be either a real revision number or a branch name. When specified at the command line, a resolution from a partial revision number will work as well. It can refer to any number of dependent revisions as well; for example, if we were to run the command:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;add ip account table&quot; \\
    --head=networking@head  \\
    --depends-on=55af2cb1c267 --depends-on=d747a --depends-on=fa445
  Generating /path/to/foo/model/networking/2a95102259be_add_ip_account_table.py ... done
</code></pre>
<p>We’d see inside the file:</p>
<pre><code class="language-python"># revision identifiers, used by Alembic.
revision = '2a95102259be'
down_revision = '29f859a13ea'
branch_labels = None
depends_on = ('55af2cb1c267', 'd747a8a8879', 'fa4456a9201')
</code></pre>
<p>We also can of course add or alter this value within the file manually after it is generated, rather than using the <code>--depends-on</code> argument.</p>
<p>We can see the effect this directive has when we view the history of the <code>networking</code> branch in terms of “heads”, e.g., all the revisions that are descendants:</p>
<pre><code class="language-bash">$ alembic history -r :networking@head
29f859a13ea (55af2cb1c267) -&gt; 2a95102259be (networking) (head), add ip account table
109ec7d132bf -&gt; 29f859a13ea (networking), add DNS table
3cac04ae8714 -&gt; 109ec7d132bf (networking), add ip number table
&lt;base&gt; -&gt; 3cac04ae8714 (networking), create networking branch
ae1027a6acf -&gt; 55af2cb1c267 (effective head), add another account column
1975ea83b712 -&gt; ae1027a6acf, Add a column
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table
</code></pre>
<p>What we see is that the full history of the <code>networking</code> branch, in terms of an “upgrade” to the “head”, will include that the tree building up <code>55af2cb1c267, add another account column</code> will be pulled in first. Interstingly, we don’t see this displayed when we display history in the other direction, e.g. from <code>networking@base</code>:</p>
<pre><code class="language-bash">$ alembic history -r networking@base:
29f859a13ea (55af2cb1c267) -&gt; 2a95102259be (networking) (head), add ip account table
109ec7d132bf -&gt; 29f859a13ea (networking), add DNS table
3cac04ae8714 -&gt; 109ec7d132bf (networking), add ip number table
&lt;base&gt; -&gt; 3cac04ae8714 (networking), create networking branch
</code></pre>
<p>The reason for the discrepancy is that displaying history from the base shows us what would occur if we ran a downgrade operation, instead of an upgrade. If we downgraded all the files in <code>networking</code> using <code>networking@base</code>, the dependencies aren’t affected, they’re left in place.</p>
<p>We also see something odd if we view <code>heads</code> at the moment:</p>
<pre><code class="language-bash">$ alembic heads
2a95102259be (networking) (head)
27c6a30d7c24 (shoppingcart) (head)
55af2cb1c267 (effective head)
</code></pre>
<p>The head file that we used as a “dependency”, <code>55af2cb1c267</code>, is displayed as an “effective” head, which we can see also in the history display earlier. What this means is that at the moment, if we were to upgrade all versions to the top, the <code>55af2cb1c267</code> revision number would not actually be present in the <code>alembic_version</code> table; this is because it does not have a branch of its own subsequent to the <code>2a95102259be</code> revision which depends on it:</p>
<pre><code class="language-bash">$ alembic upgrade heads
INFO  [alembic.migration] Running upgrade 29f859a13ea, 55af2cb1c267 -&gt; 2a95102259be, add ip account table

$ alembic current
2a95102259be (head)
27c6a30d7c24 (head)
</code></pre>
<p>The entry is still displayed in <code>alembic heads</code> because Alembic knows that even though this revision isn’t a “real” head, it’s still something that we developers consider semantically to be a head, so it’s displayed, noting its special status so that we don’t get quite as confused when we don’t see it within <code>alembic current</code>.</p>
<p>If we add a new revision onto <code>55af2cb1c267</code>, the branch again becomes a “real” branch which can have its own entry in the database:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;more account changes&quot; --head=55af2cb@head
  Generating /path/to/foo/versions/34e094ad6ef1_more_account_changes.py ... done

$ alembic upgrade heads
INFO  [alembic.migration] Running upgrade 55af2cb1c267 -&gt; 34e094ad6ef1, more account changes

$ alembic current
2a95102259be (head)
27c6a30d7c24 (head)
34e094ad6ef1 (head)
</code></pre>
<p>For posterity, the revision tree now looks like:</p>
<pre><code class="language-bash">$ alembic history
29f859a13ea (55af2cb1c267) -&gt; 2a95102259be (networking) (head), add ip account table
109ec7d132bf -&gt; 29f859a13ea (networking), add DNS table
3cac04ae8714 -&gt; 109ec7d132bf (networking), add ip number table
&lt;base&gt; -&gt; 3cac04ae8714 (networking), create networking branch
1975ea83b712 -&gt; 27c6a30d7c24 (shoppingcart) (head), add shopping cart table
55af2cb1c267 -&gt; 34e094ad6ef1 (head), more account changes
ae1027a6acf -&gt; 55af2cb1c267, add another account column
1975ea83b712 -&gt; ae1027a6acf, Add a column
&lt;base&gt; -&gt; 1975ea83b712 (branchpoint), create account table


                    --- 27c6 --&gt; d747 --&gt; &lt;head&gt;
                   /   (shoppingcart)
&lt;base&gt; --&gt; 1975 --&gt;
                   \
                     --- ae10 --&gt; 55af --&gt; &lt;head&gt;
                                    ^
                                    +--------+ (dependency)
                                             |
                                             |
&lt;base&gt; --&gt; 3782 -----&gt; 109e ----&gt; 29f8 ---&gt; 2a95 --&gt; &lt;head&gt;
         (networking)
</code></pre>
<p>If there’s any point to be made here, it’s if you are too freely branching, merging and labeling, things can get pretty crazy! Hence the branching system should be used carefully and thoughtfully for best results.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operation-reference"><a class="header" href="#operation-reference">Operation Reference</a></h1>
<p><strong>操作参考</strong></p>
<p>This file provides documentation on Alembic migration directives.</p>
<p>The directives here are used within user-defined migration files, within the <code>upgrade()</code> and <code>downgrade()</code> functions, as well as any functions further invoked by those.</p>
<p>All directives exist as methods on a class called <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong>. When migration scripts are run, this object is made available to the script via the <code>alembic.op</code> datamember, which is a proxy to an actual instance of <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong>. Currently, <code>alembic.op</code> is a real Python module, populated with individual proxies for each method on <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong>, so symbols can be imported safely from the <code>alembic.op</code> namespace.</p>
<p>The <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> system is also fully extensible. See <strong><a href="zh/../en/api/operations.html#operation-plugins">Operation Plugins</a></strong> for details on this.</p>
<p>A key design philosophy to the <strong><a href="zh/../en/api/operations.html#alembic-operations-toplevel">Operation Directives</a></strong> methods is that to the greatest degree possible, they internally generate the appropriate SQLAlchemy metadata, typically involving <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Constraint">Constraint</a></strong> objects. This so that migration instructions can be given in terms of just the string names and/or flags involved. The exceptions to this rule include the <strong><a href="zh/06_operation_reference.html#alembic.operations.Operations.add_column">add_column()</a></strong> and <strong><a href="zh/06_operation_reference.html#alembic.operations.Operations.create_table">create_table()</a></strong> directives, which require full <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> objects, though the table metadata is still generated here.</p>
<p>The functions here all require that a <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured within the <code>env.py</code> script first, which is typically via <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong>. Under normal circumstances they are called from an actual migration script, which itself would be invoked by the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.run_migrations">EnvironmentContext.run_migrations()</a></strong> method.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alembicoperationsoperations"><a class="header" href="#alembicoperationsoperations">alembic.operations.Operations</a></h1>
<p><em>class</em> alembic.operations.<strong>Operations</strong>(<em>migration_context</em>: MigrationContext, <em>impl</em>: Optional[BatchOperationsImpl] = None)</p>
<p>Define high level migration operations.</p>
<p>Each operation corresponds to some schema migration operation, executed against a particular <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> which in turn represents connectivity to a database, or a file output stream.</p>
<p>While <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> is normally configured as part of the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.run_migrations">EnvironmentContext.run_migrations()</a></strong> method called from an <code>env.py</code> script, a standalone <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> instance can be made for use cases external to regular Alembic migrations by passing in a MigrationContext:</p>
<pre><code class="language-python">from alembic.migration import MigrationContext
from alembic.operations import Operations

conn = myengine.connect()
ctx = MigrationContext.configure(conn)
op = Operations(ctx)

op.alter_column(&quot;t&quot;, &quot;c&quot;, nullable=True)
</code></pre>
<blockquote>
<p><strong>Note</strong> that as of 0.8, most of the methods on this class are produced dynamically using the <strong><a href="zh/../zh/06_01_25_register_operation.html">Operations.register_operation()</a></strong> method.</p>
</blockquote>
<p>Construct a new Operations</p>
<p><em>migration_context</em> – a <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="add_column"><a class="header" href="#add_column">add_column</a></h1>
<p><strong>add_column</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column</em>:  Column, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Issue an “add column” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op
from sqlalchemy import Column, String

op.add_column('organization',
    Column('name', String())
)
</code></pre>
<p>The provided <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> object can also specify a <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKey">ForeignKey</a></strong>, referencing a remote table name. Alembic will automatically generate a stub “referenced” table and emit a second ALTER statement in order to add the constraint separately:</p>
<pre><code class="language-python">from alembic import op
from sqlalchemy import Column, INTEGER, ForeignKey

op.add_column('organization',
    Column('account_id', INTEGER, ForeignKey('accounts.id'))
)
</code></pre>
<blockquote>
<p><strong>Note</strong> that this statement uses the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> construct as is from the SQLAlchemy library. In particular, <code>default</code> values to be created on the database side are specified using the <code>server_default</code> parameter, and not <code>default</code> which only specifies Python-side defaults:</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – String name of the parent table.</li>
<li><em><strong>column</strong></em> – a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">sqlalchemy.schema.Column</a></strong> object representing the new column.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alter_column"><a class="header" href="#alter_column">alter_column</a></h1>
<p><strong>alter_column</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>comment</em>:  Optional[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>]] = False, <em>server_default</em>:  Any = False, <em>new_column_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>type_</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_type</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_server_default</em>:  Optional[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>, Identity, Computed]] = False, <em>existing_nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Optional[Table]</p>
<p>Issue an “alter column” instruction using the current migration context.</p>
<p>Generally, only that aspect of the column which is being changed, i.e. name, type, nullability, default, needs to be specified. Multiple changes can also be specified at once and the backend should “do the right thing”, emitting each change either separately or together as the backend allows.</p>
<p>MySQL has special requirements here, since MySQL cannot ALTER a column without a full specification. When producing MySQL-compatible migration files, it is recommended that the <code>existing_type</code>, <code>existing_server_default</code>, and <code>existing_nullable</code> parameters be present, if not being altered.</p>
<p>Type changes which are against the SQLAlchemy “schema” types <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Enum">Enum</a></strong> may also add or drop constraints which accompany those types on backends that don’t support them natively. The <code>existing_type</code> argument is used in this case to identify and remove a previous constraint that was bound to the type object.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – string name of the target table.</li>
<li><em><strong>column_name</strong></em> – string name of the target column, as it exists before the operation begins.</li>
<li><em><strong>nullable</strong></em> – Optional; specify <code>True</code> or <code>False</code> to alter the column’s nullability.</li>
<li><em><strong>server_default</strong></em> – Optional; specify a string SQL expression, <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text">text()</a></strong>, or <strong><a href="https://docs.sqlalchemy.org/en/14/core/defaults.html#sqlalchemy.schema.DefaultClause">DefaultClause</a></strong> to indicate an alteration to the column’s default value. Set to <code>None</code> to have the default removed.</li>
<li><em><strong>comment</strong></em><a name="params.comment"></a> – optional string text of a new comment to add to the column.
<ul>
<li><em>New in version 1.0.6.</em></li>
</ul>
</li>
<li><em><strong>new_column_name</strong></em> – Optional; specify a string name here to indicate the new name within a column rename operation.</li>
<li><em><strong>type_</strong></em> – Optional; a <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_api.html#sqlalchemy.types.TypeEngine">TypeEngine</a></strong> type object to specify a change to the column’s type. For SQLAlchemy types that also indicate a constraint (i.e. <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong>, Enum), the constraint is also generated.</li>
<li><em><strong>autoincrement</strong></em> – set the <code>AUTO_INCREMENT</code> flag of the column; currently understood by the MySQL dialect.</li>
<li><em><strong>existing_type</strong></em> – Optional; a <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_api.html#sqlalchemy.types.TypeEngine">TypeEngine</a></strong> type object to specify the previous type. This is required for all MySQL column alter operations that don’t otherwise specify a new type, as well as for when nullability is being changed on a SQL Server column. It is also used if the type is a so-called SQLlchemy “schema” type which may define a constraint (i.e. <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html#sqlalchemy.types.Boolean">Boolean</a></strong>, Enum), so that the constraint can be dropped.</li>
<li><em><strong>existing_server_default</strong></em> – Optional; The existing default value of the column. Required on MySQL if an existing default is not being changed; else MySQL removes the default.</li>
<li><em><strong>existing_nullable</strong></em> – Optional; the existing nullability of the column. Required on MySQL if the existing nullability is not being changed; else MySQL sets this to NULL.</li>
<li><em><strong>existing_autoincrement</strong></em> – Optional; the existing autoincrement of the column. Used for MySQL’s system of altering a column that specifies <code>AUTO_INCREMENT</code>.</li>
<li><em><strong>existing_comment</strong></em> – string text of the existing comment on the column to be maintained. Required on MySQL if the existing comment on the column is not being changed.
<ul>
<li><em>New in version 1.0.6.</em></li>
</ul>
</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
<li><em><strong>postgresql_using</strong></em> – String argument which will indicate a SQL expression to render within the Postgresql-specific USING clause within ALTER COLUMN. This string is taken directly as raw SQL which must explicitly include any necessary quoting or escaping of tokens within the expression.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="batch_alter_table"><a class="header" href="#batch_alter_table">batch_alter_table</a></h1>
<p><strong>batch_alter_table</strong>(table_name, schema=None, recreate='auto', partial_reordering=None, copy_from=None, table_args=(), table_kwargs={}, reflect_args=(), reflect_kwargs={}, naming_convention=None)</p>
<p>Invoke a series of per-table migrations in batch.</p>
<p>Batch mode allows a series of operations specific to a table to be syntactically grouped together, and allows for alternate modes of table migration, in particular the “recreate” style of migration required by SQLite.</p>
<p>“recreate” style is as follows:</p>
<ol>
<li>A new table is created with the new specification, based on the migration directives within the batch, using a temporary name.</li>
<li>the data copied from the existing table to the new table.</li>
<li>the existing table is dropped.</li>
<li>the new table is renamed to the existing table name.</li>
</ol>
<p>The directive by default will only use “recreate” style on the SQLite backend, and only if directives are present which require this form, e.g. anything other than <code>add_column()</code>. The batch operation on other backends will proceed using standard ALTER TABLE operations.</p>
<p>The method is used as a context manager, which returns an instance of BatchOperations; this object is the same as <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> except that table names and schema names are omitted. E.g.:</p>
<pre><code class="language-python">with op.batch_alter_table(&quot;some_table&quot;) as batch_op:
    batch_op.add_column(Column('foo', Integer))
    batch_op.drop_column('bar')
</code></pre>
<p>The operations within the context manager are invoked at once when the context is ended. When run against SQLite, if the migrations include operations not supported by SQLite’s ALTER TABLE, the entire table will be copied to a new one with the new specification, moving all data across as well.</p>
<p>The copy operation by default uses reflection to retrieve the current structure of the table, and therefore <strong><a href="zh/../zh/06_01_03_batch_alter_table.html">batch_alter_table()</a></strong> in this mode requires that the migration is run in “online” mode. The <code>copy_from</code> parameter may be passed which refers to an existing <code>Table</code> object, which will bypass this reflection step.</p>
<blockquote>
<p><strong>Note</strong> The table copy operation will currently not copy CHECK constraints, and may not copy UNIQUE constraints that are unnamed, as is possible on SQLite. See the section <strong><a href="zh/../en/batch.html#sqlite-batch-constraints">Dealing with Constraints</a></strong> for workarounds.</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><em><strong>table_name</strong></em> – name of table</p>
</li>
<li>
<p><em><strong>schema</strong></em> – optional <strong>schema</strong> name.</p>
</li>
<li>
<p><em><strong>recreate</strong></em> – under what circumstances the table should be recreated. At its default of <code>&quot;auto&quot;</code>, the SQLite dialect will <strong>recreate</strong> the table if any operations other than <code>add_column()</code>, <code>create_index()</code>, or <code>drop_index()</code> are present. Other options include <code>&quot;always&quot;</code> and <code>&quot;never&quot;</code>.</p>
</li>
<li>
<p><em>copy_from</em> <a name="copy_from"></a> – optional <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object that will act as the structure of the table being copied. If omitted, table reflection is used to retrieve the structure of the table.</p>
<p><strong>See also</strong> <em><a href="zh/../zh/04_03_working_in_offline_mode.html">Working in Offline Mode</a></em></p>
<p><em><strong>reflect_args</strong></em></p>
<p><em><strong>reflect_kwargs</strong></em></p>
</li>
<li>
<p><em><strong>reflect_args</strong></em> <a name="reflect_args"></a> – a sequence of additional positional arguments that will be applied to the table structure being reflected / copied; this may be used to pass column and constraint overrides to the table that will be reflected, in lieu of passing the whole <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> using <strong><a href="zh/06_01_03_batch_alter_table.html#alembic.operations.Operations.batch_alter_table.params.copy_from">copy_from</a></strong>.</p>
</li>
<li>
<p><em><strong>reflect_kwargs</strong></em> <a name="reflect_kwargs"></a> – a dictionary of additional keyword arguments that will be applied to the table structure being copied; this may be used to pass additional table and reflection options to the table that will be reflected, in lieu of passing the whole <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> using <strong><a href="zh/06_01_03_batch_alter_table.html#alembic.operations.Operations.batch_alter_table.params.copy_from">copy_from</a></strong>.</p>
</li>
<li>
<p><em><strong>table_args</strong></em> – <a name="table_args"></a> a sequence of additional positional arguments that will be applied to the new <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> when created, in addition to those copied from the source table. This may be used to provide additional constraints such as CHECK constraints that may not be reflected.</p>
</li>
<li>
<p><em><strong>table_args</strong></em> – a sequence of additional positional arguments that will be applied to the new <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> when created, in addition to those copied from the source table. This may be used to provide additional constraints such as CHECK constraints that may not be reflected.</p>
</li>
<li>
<p><em><strong>table_kwargs</strong></em> – a dictionary of additional keyword arguments that will be applied to the new <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> when created, in addition to those copied from the source table. This may be used to provide for additional table options that may not be reflected.</p>
</li>
<li>
<p><em><strong>naming_convention</strong></em> – a naming convention dictionary of the form described at <strong><a href="zh/../en/naming.html#autogen-naming-conventions">Integration of Naming Conventions into Operations, Autogenerate</a></strong> which will be applied to the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> during the reflection process. This is typically required if one wants to drop SQLite constraints, as these constraints will not have names when reflected on this backend. Requires SQLAlchemy <strong>0.9.4</strong> or greater.</p>
<blockquote>
<p>See also</p>
<p><a href="zh/../en/batch.html#dropping-sqlite-foreign-keys">Dropping Unnamed or Named Foreign Key Constraints</a></p>
</blockquote>
</li>
<li>
<p><em><strong>partial_reordering</strong></em> – a list of tuples, each suggesting a desired ordering of two or more columns in the newly created table. Requires that <strong><a href="zh/06_01_03_batch_alter_table.html#alembic.operations.Operations.batch_alter_table.params.recreate">batch_alter_table.recreate</a></strong> is set to <code>&quot;always&quot;</code>. Examples, given a table with columns “a”, “b”, “c”, and “d”:</p>
<p>Specify the order of all columns:</p>
<pre><code class="language-python">with op.batch_alter_table(
        &quot;some_table&quot;, recreate=&quot;always&quot;,
        partial_reordering=[(&quot;c&quot;, &quot;d&quot;, &quot;a&quot;, &quot;b&quot;)]
) as batch_op:
    pass
</code></pre>
<p>Ensure “d” appears before “c”, and “b”, appears before “a”:</p>
<pre><code class="language-python">with op.batch_alter_table(
        &quot;some_table&quot;, recreate=&quot;always&quot;,
        partial_reordering=[(&quot;d&quot;, &quot;c&quot;), (&quot;b&quot;, &quot;a&quot;)]
) as batch_op:
    pass
</code></pre>
<p>The ordering of columns not included in the partial_reordering set is undefined. Therefore it is best to specify the complete ordering of all columns for best results.</p>
<p><em>New in version 1.4.0.</em></p>
</li>
</ul>
<blockquote>
<p><strong>Note:</strong> batch mode requires SQLAlchemy 0.8 or above.</p>
</blockquote>
<blockquote>
<p><strong>See also</strong> <a href="zh/../en/batch.html#batch-migrations">Running “Batch” Migrations for SQLite and Other Databases</a></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bulk_insert"><a class="header" href="#bulk_insert">bulk_insert</a></h1>
<p><strong>bulk_insert</strong>(<em>table</em>:  Union[Table, TableClause], <em>rows</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>], <em>multiinsert</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = True) → None</p>
<p>Issue a “bulk insert” operation using the current migration context.</p>
<p>This provides a means of representing an INSERT of multiple rows which works equally well in the context of executing on a live connection as well as that of generating a SQL script. In the case of a SQL script, the values are rendered inline into the statement.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op
from datetime import date
from sqlalchemy.sql import table, column
from sqlalchemy import String, Integer, Date

# Create an ad-hoc table to use for the insert statement.
accounts_table = table('account',
    column('id', Integer),
    column('name', String),
    column('create_date', Date)
)

op.bulk_insert(accounts_table,
    [
        {'id':1, 'name':'John Smith',
                'create_date':date(2010, 10, 5)},
        {'id':2, 'name':'Ed Williams',
                'create_date':date(2007, 5, 27)},
        {'id':3, 'name':'Wendy Jones',
                'create_date':date(2008, 8, 15)},
    ]
)
</code></pre>
<p>When using –sql mode, some datatypes may not render inline automatically, such as dates and other special types. When this issue is present, <strong><a href="zh/../zh/06_01_23_inline_literal.html">Operations.inline_literal()</a></strong> may be used:</p>
<pre><code class="language-python">op.bulk_insert(accounts_table,
    [
        {'id':1, 'name':'John Smith',
                'create_date':op.inline_literal(&quot;2010-10-05&quot;)},
        {'id':2, 'name':'Ed Williams',
                'create_date':op.inline_literal(&quot;2007-05-27&quot;)},
        {'id':3, 'name':'Wendy Jones',
                'create_date':op.inline_literal(&quot;2008-08-15&quot;)},
    ],
    multiinsert=False
)
</code></pre>
<p>When using <strong><a href="zh/../zh/06_01_23_inline_literal.html">Operations.inline_literal()</a></strong> in conjunction with <strong><a href="zh/../zh/06_01_04_bulk_insert.html">Operations.bulk_insert()</a></strong>, in order for the statement to work in “online” (e.g. non –sql) mode, the <strong><a href="zh/../zh/06_01_04_bulk_insert.html#params.multiinsert">multiinsert</a></strong> flag should be set to <code>False</code>, which will have the effect of individual INSERT statements being emitted to the database, each with a distinct VALUES clause, so that the “inline” values can still be rendered, rather than attempting to pass the values as bound parameters.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table</strong></em> – a <strong>table</strong> object which represents the target of the INSERT.</li>
<li><em><strong>rows</strong></em> – a list of dictionaries indicating rows.</li>
<li><em><strong>multiinsert</strong></em> – when at its default of True and –sql mode is not enabled, the INSERT statement will be executed using “executemany()” style, where all elements in the list of dictionaries are passed as bound parameters in a single list. Setting this to False results in individual INSERT statements being emitted per parameter set, and is needed in those cases where non-literal values are present in the parameter sets.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_check_constraint"><a class="header" href="#create_check_constraint">create_check_constraint</a></h1>
<p><strong>create_check_constraint</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>condition</em>:  Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, BinaryExpression], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Optional[Table]</p>
<p>Issue a “create check constraint” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op
from sqlalchemy.sql import column, func

op.create_check_constraint(
    &quot;ck_user_name_len&quot;,
    &quot;user&quot;,
    func.len(column('name')) &gt; 5
)
</code></pre>
<p>CHECK constraints are usually against a SQL expression, so ad-hoc table metadata is usually needed. The function will convert the given arguments into a <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.CheckConstraint">sqlalchemy.schema.CheckConstraint</a></strong> bound to an anonymous table in order to emit the CREATE statement.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>name</strong></em> – Name of the check constraint. The <code>name</code> is necessary so that an ALTER statement can be emitted. For setups that use an automated naming scheme such as that described at <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#constraint-naming-conventions">Configuring Constraint Naming Conventions</a></strong>, <code>name</code> here can be <code>None</code>, as the event listener will apply the <code>name</code> to the constraint object when it is associated with the table.</li>
<li><em><strong>table_name</strong></em> – String name of the source table.</li>
<li><em><strong>condition</strong></em> – SQL expression that’s the <strong>condition</strong> of the constraint. Can be a string or SQLAlchemy expression language structure.</li>
<li><em><strong>deferrable</strong></em> – optional bool. If set, emit DEFERRABLE or NOT DEFERRABLE when issuing DDL for this constraint.</li>
<li><em><strong>initially</strong></em> – optional string. If set, emit INITIALLY <value> when issuing DDL for this constraint.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_exclude_constraint"><a class="header" href="#create_exclude_constraint">create_exclude_constraint</a></h1>
<p><strong>create_exclude_constraint</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, *elements: Any, **kw: Any) → Optional[Table]</p>
<p>Issue an alter to create an EXCLUDE constraint using the current migration context.</p>
<blockquote>
<p><strong>Note:</strong> This method is Postgresql specific, and additionally requires at least SQLAlchemy 1.0.</p>
</blockquote>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op

op.create_exclude_constraint(
    &quot;user_excl&quot;,
    &quot;user&quot;,

    (&quot;period&quot;, '&amp;&amp;'),
    (&quot;group&quot;, '='),
    where=(&quot;group != 'some group'&quot;)

)
</code></pre>
<blockquote>
<p><strong>Note</strong> that the expressions work the same way as that of the <code>ExcludeConstraint</code> object itself; if plain strings are passed, quoting rules must be applied manually.</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>name</strong></em> – Name of the constraint.</li>
<li><em><strong>table_name</strong></em> – String name of the source table.</li>
<li><em><strong>elements</strong></em> – exclude conditions.</li>
<li><em><strong>where</strong></em> – SQL expression or SQL string with optional WHERE clause.</li>
<li><em><strong>deferrable</strong></em> – optional bool. If set, emit DEFERRABLE or NOT DEFERRABLE when issuing DDL for this constraint.</li>
<li><em><strong>initially</strong></em> – optional string. If set, emit INITIALLY <value> when issuing DDL for this constraint.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_foreign_key"><a class="header" href="#create_foreign_key">create_foreign_key</a></h1>
<p><strong>create_foreign_key</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>source_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>referent_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>local_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>remote_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>onupdate</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>ondelete</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>deferrable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>initially</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>match</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>source_schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>referent_schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **dialect_kw) → Optional[Table]</p>
<p>Issue a “create foreign key” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op
op.create_foreign_key(
            &quot;fk_user_address&quot;, &quot;address&quot;,
            &quot;user&quot;, [&quot;user_id&quot;], [&quot;id&quot;])
</code></pre>
<p>This internally generates a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object containing the necessary columns, then generates a new <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint">ForeignKeyConstraint</a></strong> object which it then associates with the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong>. Any event listeners associated with this action will be fired off normally. The <strong><a href="https://docs.sqlalchemy.org/en/14/core/ddl.html#sqlalchemy.schema.AddConstraint">AddConstraint</a></strong> construct is ultimately used to generate the ALTER statement.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>constraint_name</strong></em> – Name of the foreign key constraint. The <code>name</code> is necessary so that an ALTER statement can be emitted. For setups that use an automated naming scheme such as that described at <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#constraint-naming-conventions">Configuring Constraint Naming Conventions</a></strong>, <code>name</code> here can be <code>None</code>, as the event listener will apply the <code>name</code> to the constraint object when it is associated with the table.</li>
<li><em><strong>source_table</strong></em> – String name of the source table.</li>
<li><em><strong>referent_table</strong></em> – String name of the destination table.</li>
<li><em><strong>local_cols</strong></em> – a list of string column names in the source table.</li>
<li><em><strong>remote_cols</strong></em> – a list of string column names in the remote table.</li>
<li><em><strong>onupdate</strong></em> – Optional string. If set, emit ON UPDATE <code>&lt;value&gt;</code> when issuing DDL for this constraint. Typical values include CASCADE, DELETE and RESTRICT.</li>
<li><em><strong>ondelete</strong></em> – Optional string. If set, emit ON DELETE <code>&lt;value&gt;</code> when issuing DDL for this constraint. Typical values include CASCADE, DELETE and RESTRICT.</li>
<li><em><strong>deferrable</strong></em> – optional bool. If set, emit DEFERRABLE or NOT DEFERRABLE when issuing DDL for this constraint.</li>
<li><em><strong>source_schema</strong></em> – Optional schema name of the source table.</li>
<li><em><strong>referent_schema</strong></em> – Optional schema name of the destination table.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_index"><a class="header" href="#create_index">create_index</a></h1>
<p><strong>create_index</strong>(<em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, TextClause, Function]], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>unique</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, **kw) → Optional[Table]</p>
<p>Issue a “create index” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op

op.create_index('ik_test', 't1', ['foo', 'bar'])
</code></pre>
<p>Functional indexes can be produced by using the <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text">sqlalchemy.sql.expression.text()</a></strong> construct:</p>
<pre><code class="language-python">from alembic import op
from sqlalchemy import text

op.create_index('ik_test', 't1', [text('lower(foo)')])
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>index_name</strong></em> – name of the index.</li>
<li><em><strong>table_name</strong></em> – name of the owning table.</li>
<li><em><strong>columns</strong></em> – a list consisting of string column names and/or <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text">text()</a></strong> constructs.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
<li><em><strong>unique</strong></em> – If True, create a <strong>unique</strong> index.</li>
<li><em><strong>quote</strong></em> – Force quoting of this column’s name on or off, corresponding to <code>True</code> or <code>False</code>. When left at its default of <code>None</code>, the column identifier will be quoted according to whether the name is case sensitive (identifiers with at least one upper case character are treated as case sensitive), or if it’s a reserved word. This flag is only needed to force quoting of a reserved word which is not known by the SQLAlchemy dialect.</li>
<li><em><strong>**kw</strong></em> – Additional keyword arguments not mentioned above are dialect specific, and passed in the form <code>&lt;dialectname&gt;_&lt;argname&gt;</code>. See the documentation regarding an individual dialect at <strong><a href="https://docs.sqlalchemy.org/en/14/dialects/index.html#dialect-toplevel">Dialects</a></strong> for detail on documented arguments.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_primary_key"><a class="header" href="#create_primary_key">create_primary_key</a></h1>
<p><strong>create_primary_key</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Issue a “create primary key” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op

op.create_primary_key(
            &quot;pk_my_table&quot;, &quot;my_table&quot;,
            [&quot;id&quot;, &quot;version&quot;]
        )
</code></pre>
<p>This internally generates a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object containing the necessary columns, then generates a new <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint">PrimaryKeyConstraint</a></strong> object which it then associates with the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong>. Any event listeners associated with this action will be fired off normally. The <strong><a href="https://docs.sqlalchemy.org/en/14/core/ddl.html#sqlalchemy.schema.AddConstraint">AddConstraint</a></strong> construct is ultimately used to generate the ALTER statement.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>constraint_name</strong></em> – Name of the primary key constraint. The <code>name</code> is necessary so that an ALTER statement can be emitted. For setups that use an automated naming scheme such as that described at <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#constraint-naming-conventions">Configuring Constraint Naming Conventions</a></strong> <code>name</code> here can be <code>None</code>, as the event listener will apply the <code>name</code> to the constraint object when it is associated with the table.</li>
<li><em><strong>table_name</strong></em> – String name of the target table.</li>
<li><em><strong>columns</strong></em> – a list of string column names to be applied to the primary key constraint.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_table"><a class="header" href="#create_table">create_table</a></h1>
<p><strong>create_table</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, *columns, **kw) → Optional[Table]</p>
<p>Issue a “create table” instruction using the current migration context.</p>
<p>This directive receives an argument list similar to that of the traditional <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">sqlalchemy.schema.Table</a></strong> construct, but without the metadata:</p>
<pre><code class="language-python">from sqlalchemy import INTEGER, VARCHAR, NVARCHAR, Column
from alembic import op

op.create_table(
    'account',
    Column('id', INTEGER, primary_key=True),
    Column('name', VARCHAR(50), nullable=False),
    Column('description', NVARCHAR(200)),
    Column('timestamp', TIMESTAMP, server_default=func.now())
)
</code></pre>
<blockquote>
<p><strong>Note:</strong> that <strong><a href="zh/../zh/06_01_10_create_table.html">create_table()</a></strong> accepts <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> constructs directly from the SQLAlchemy library. In particular, <code>default</code> values to be created on the database side are specified using the <code>server_default</code> parameter, and not <code>default</code> which only specifies Python-side defaults:</p>
</blockquote>
<pre><code class="language-python">from alembic import op
from sqlalchemy import Column, TIMESTAMP, func

# specify &quot;DEFAULT NOW&quot; along with the &quot;timestamp&quot; column
op.create_table('account',
    Column('id', INTEGER, primary_key=True),
    Column('timestamp', TIMESTAMP, server_default=func.now())
)
</code></pre>
<p>The function also returns a newly created <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object, corresponding to the table specification given, which is suitable for immediate SQL operations, in particular <strong><a href="zh/../zh/06_01_04_bulk_insert.html">Operations.bulk_insert()</a></strong>:</p>
<pre><code class="language-python">from sqlalchemy import INTEGER, VARCHAR, NVARCHAR, Column
from alembic import op

account_table = op.create_table(
    'account',
    Column('id', INTEGER, primary_key=True),
    Column('name', VARCHAR(50), nullable=False),
    Column('description', NVARCHAR(200)),
    Column('timestamp', TIMESTAMP, server_default=func.now())
)

op.bulk_insert(
    account_table,
    [
        {&quot;name&quot;: &quot;A1&quot;, &quot;description&quot;: &quot;account 1&quot;},
        {&quot;name&quot;: &quot;A2&quot;, &quot;description&quot;: &quot;account 2&quot;},
    ]
)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – Name of the table</li>
<li>*<em><strong>columns</strong></em> – collection of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> objects within the table, as well as optional <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Constraint">Constraint</a></strong> objects and <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Index">Index</a></strong> objects.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
<li>**<em><strong>kw</strong></em> – Other keyword arguments are passed to the underlying <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">sqlalchemy.schema.Table</a></strong> object created for the command.</li>
</ul>
<p><strong>Returns:</strong> the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object corresponding to the parameters given.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_table_comment"><a class="header" href="#create_table_comment">create_table_comment</a></h1>
<p><strong>create_table_comment</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>existing_comment</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Emit a COMMENT ON operation to set the comment for a table.</p>
<p><em>New in version 1.0.6.</em></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – string name of the target table.</li>
<li><em><strong>comment</strong></em> – string value of the <strong>comment</strong> being registered against the specified table.</li>
<li><em><strong>existing_comment</strong></em> – String value of a comment already registered on the specified table, used within autogenerate so that the operation is reversible, but not required for direct use.</li>
</ul>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_17_drop_table_comment.html">Operations.drop_table_comment()</a></strong></li>
<li><strong><a href="zh/../zh/06_01_02_alter_column.html#params.comment">Operations.alter_column.comment</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_unique_constraint"><a class="header" href="#create_unique_constraint">create_unique_constraint</a></h1>
<p><strong>create_unique_constraint</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Any</p>
<p>Issue a “create unique constraint” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">from alembic import op

op.create_unique_constraint(&quot;uq_user_name&quot;, &quot;user&quot;, [&quot;name&quot;])
</code></pre>
<p>This internally generates a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object containing the necessary columns, then generates a new <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.UniqueConstraint">UniqueConstraint</a></strong> object which it then associates with the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong>. Any event listeners associated with this action will be fired off normally. The <strong><a href="https://docs.sqlalchemy.org/en/14/core/ddl.html#sqlalchemy.schema.AddConstraint">AddConstraint</a></strong> construct is ultimately used to generate the ALTER statement.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>name</strong></em> – Name of the unique constraint. The <code>name</code> is necessary so that an ALTER statement can be emitted. For setups that use an automated naming scheme such as that described at <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#constraint-naming-conventions">Configuring Constraint Naming Conventions</a></strong>, <code>name</code> here can be <code>None</code>, as the event listener will apply the <code>name</code> to the constraint object when it is associated with the table.</li>
<li><em><strong>table_name</strong></em> – String name of the source table.</li>
<li><em><strong>columns</strong></em> – a list of string column names in the source table.</li>
<li><em><strong>deferrable</strong></em> – optional bool. If set, emit DEFERRABLE or NOT DEFERRABLE when issuing DDL for this constraint.</li>
<li><em><strong>initially</strong></em> – optional string. If set, emit INITIALLY <value> when issuing DDL for this constraint.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_column"><a class="header" href="#drop_column">drop_column</a></h1>
<p><strong>drop_column</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Optional[Table]</p>
<p>Issue a “drop column” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">drop_column('organization', 'account_id')
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – name of table</li>
<li><em><strong>column_name</strong></em> – name of column</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
<li><em><strong>mssql_drop_check</strong></em> – Optional boolean. When <code>True</code>, on Microsoft SQL Server only, first drop the CHECK constraint on the column using a SQL-script-compatible block that selects into a @variable from sys.check_constraints, then exec’s a separate DROP CONSTRAINT for that constraint.</li>
<li><em><strong>mssql_drop_default</strong></em> – Optional boolean. When <code>True</code>, on Microsoft SQL Server only, first drop the DEFAULT constraint on the column using a SQL-script-compatible block that selects into a @variable from sys.default_constraints, then exec’s a separate DROP CONSTRAINT for that default.</li>
<li><em><strong>mssql_drop_foreign_key</strong></em> – Optional boolean. When <code>True</code>, on Microsoft SQL Server only, first drop a single FOREIGN KEY constraint on the column using a SQL-script-compatible block that selects into a @variable from sys.foreign_keys/sys.foreign_key_columns, then exec’s a separate DROP CONSTRAINT for that default. Only works if the column has exactly one FK constraint which refers to it, at the moment.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_constraint"><a class="header" href="#drop_constraint">drop_constraint</a></h1>
<p><strong>drop_constraint</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>type_</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Drop a constraint of the given name, typically via DROP CONSTRAINT.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>constraint_name</strong></em> – name of the constraint.</li>
<li><em><strong>table_name</strong></em> – table name.</li>
<li><em><strong>type_</strong></em> – optional, required on MySQL. can be ‘foreignkey’, ‘primary’, ‘unique’, or ‘check’.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_index"><a class="header" href="#drop_index">drop_index</a></h1>
<p><strong>drop_index</strong>(<em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Optional[Table]</p>
<p>Issue a “drop index” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">drop_index(&quot;accounts&quot;)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>index_name</strong></em> – name of the index.</li>
<li><em><strong>table_name</strong></em> – name of the owning table. Some backends such as Microsoft SQL Server require this.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
<li><em><strong>**kw</strong></em> – Additional keyword arguments not mentioned above are dialect specific, and passed in the form <code>&lt;dialectname&gt;_&lt;argname&gt;</code>. See the documentation regarding an individual dialect at <strong><a href="https://docs.sqlalchemy.org/en/14/dialects/index.html#dialect-toplevel">Dialects</a></strong> for detail on documented arguments.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_table"><a class="header" href="#drop_table">drop_table</a></h1>
<p><strong>drop_table</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw: Any) → None</p>
<p>Issue a “drop table” instruction using the current migration context.</p>
<p>e.g.:</p>
<pre><code class="language-python">drop_table(&quot;accounts&quot;)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – Name of the table</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
<li><em><strong>**kw</strong></em> – Other keyword arguments are passed to the underlying <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">sqlalchemy.schema.Table</a></strong> object created for the command.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_table_comment"><a class="header" href="#drop_table_comment">drop_table_comment</a></h1>
<p><strong>drop_table_comment</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Issue a “drop table comment” operation to remove an existing comment set on a table.</p>
<p><em>New in version 1.0.6.</em></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>table_name</strong></em> – string name of the target table.</li>
<li><em><strong>existing_comment</strong></em> – An optional string value of a comment already registered on the specified table.</li>
</ul>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_11_create_table_comment.html">Operations.create_table_comment()</a></strong></li>
<li><strong><a href="zh/../zh/06_01_02_alter_column.html#params.comment">Operations.alter_column.comment</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execute"><a class="header" href="#execute">execute</a></h1>
<p><strong>execute</strong>(<em>sqltext</em>:  Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, TextClause, Update], <em>execution_options</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>) → Optional[Table]</p>
<p>Execute the given SQL using the current migration context.</p>
<p>The given SQL can be a plain string, e.g.:</p>
<pre><code class="language-python">op.execute(&quot;INSERT INTO table (foo) VALUES ('some value')&quot;)
</code></pre>
<p>Or it can be any kind of Core SQL Expression construct, such as below where we use an update construct:</p>
<pre><code class="language-python">from sqlalchemy.sql import table, column
from sqlalchemy import String
from alembic import op

account = table('account',
    column('name', String)
)
op.execute(
    account.update().\\
        where(account.c.name==op.inline_literal('account 1')).\\
        values({'name':op.inline_literal('account 2')})
        )
</code></pre>
<p>Above, we made use of the SQLAlchemy <strong><a href="https://docs.sqlalchemy.org/en/14/core/selectable.html#sqlalchemy.sql.expression.table">sqlalchemy.sql.expression.table()</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.column">sqlalchemy.sql.expression.column()</a></strong> constructs to make a brief, ad-hoc table construct just for our UPDATE statement. A full <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> construct of course works perfectly fine as well, though note it’s a recommended practice to at least ensure the definition of a table is self-contained within the migration script, rather than imported from a module that may break compatibility with older migrations.</p>
<p>In a SQL script context, the statement is emitted directly to the output stream. There is no return result, however, as this function is oriented towards generating a change script that can run in “offline” mode. Additionally, parameterized statements are discouraged here, as they will not work in offline mode. Above, we use <strong><a href="zh/../zh/06_01_23_inline_literal.html">inline_literal()</a></strong> where parameters are to be used.</p>
<p>For full interaction with a connected database where parameters can also be used normally, use the “bind” available from the context:</p>
<pre><code class="language-python">from alembic import op
connection = op.get_bind()

connection.execute(
    account.update().where(account.c.name=='account 1').
    values({&quot;name&quot;: &quot;account 2&quot;})
)
</code></pre>
<p>Additionally, when passing the statement as a plain string, it is first coerceed into a <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text">sqlalchemy.sql.expression.text()</a></strong> construct before being passed along. In the less likely case that the literal SQL string contains a colon, it must be escaped with a backslash, as:</p>
<pre><code class="language-python">op.execute(&quot;INSERT INTO table (foo) VALUES ('\:colon_value')&quot;)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>sqltext</strong></em> – Any legal SQLAlchemy expression, including:
<ul>
<li>a string</li>
<li>a <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text">sqlalchemy.sql.expression.text()</a></strong> construct.</li>
<li>a <strong><a href="https://docs.sqlalchemy.org/en/14/core/dml.html#sqlalchemy.sql.expression.insert">sqlalchemy.sql.expression.insert()</a></strong> construct.</li>
<li>a <strong><a href="https://docs.sqlalchemy.org/en/14/core/dml.html#sqlalchemy.sql.expression.update">sqlalchemy.sql.expression.update()</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/dml.html#sqlalchemy.sql.expression.insert">sqlalchemy.sql.expression.insert()</a></strong>, or <strong><a href="https://docs.sqlalchemy.org/en/14/core/dml.html#sqlalchemy.sql.expression.delete">sqlalchemy.sql.expression.delete()</a></strong> construct.</li>
<li>Pretty much anything that’s “executable” as described in <strong><a href="https://docs.sqlalchemy.org/en/14/core/tutorial.html#sqlexpression-toplevel">SQL Expression Language Tutorial (1.x API)</a></strong>.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> when passing a plain string, the statement is coerced into a <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text">sqlalchemy.sql.expression.text()</a></strong> construct. This construct considers symbols with colons, e.g. <code>:foo</code> to be bound parameters. To avoid this, ensure that colon symbols are escaped, e.g. <code>\:foo</code>.</p>
</blockquote>
</li>
<li><em><strong>execution_options</strong></em> – Optional dictionary of execution options, will be passed to <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection.execution_options">sqlalchemy.engine.Connection.execution_options()</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="f"><a class="header" href="#f">f</a></h1>
<p><strong>f</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>) → sqlalchemy.sql.elements.conv</p>
<p>Indicate a string name that has already had a naming convention applied to it.</p>
<p>This feature combines with the SQLAlchemy <code>naming_convention</code> feature to disambiguate constraint names that have already had naming conventions applied to them, versus those that have not. This is necessary in the case that the <code>&quot;%(constraint_name)s&quot;</code> token is used within a naming convention, so that it can be identified that this particular name should remain fixed.</p>
<p>If the <strong><a href="zh/../zh/06_01_19_f.html">Operations.f()</a></strong> is used on a constraint, the naming convention will not take effect:</p>
<pre><code class="language-python">op.add_column('t', 'x', Boolean(name=op.f('ck_bool_t_x')))
</code></pre>
<p>Above, the CHECK constraint generated will have the name <code>ck_bool_t_x</code> regardless of whether or not a naming convention is in use.</p>
<p>Alternatively, if a naming convention is in use, and ‘f’ is not used, names will be converted along conventions. If the <code>target_metadata</code> contains the naming convention <code>{&quot;ck&quot;: &quot;ck_bool_%(table_name)s_%(constraint_name)s&quot;}</code>, then the output of the following:</p>
<pre><code class="language-text">op.add_column(‘t’, ‘x’, Boolean(name=’x’))
</code></pre>
<p>will be:</p>
<pre><code class="language-python">CONSTRAINT ck_bool_t_x CHECK (x in (1, 0)))
</code></pre>
<p>The function is rendered in the output of autogenerate when a particular constraint name is already converted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_bind"><a class="header" href="#get_bind">get_bind</a></h1>
<p><strong>get_bind</strong>() → Connection</p>
<p>Return the current ‘bind’.</p>
<p>Under normal circumstances, this is the <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> currently being used to emit SQL to the database.</p>
<p>In a SQL script context, this value is <code>None</code>. [TODO: verify this]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_context"><a class="header" href="#get_context">get_context</a></h1>
<p><strong>get_context</strong>()</p>
<p>Return the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> object that’s currently in use.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="implementation_for"><a class="header" href="#implementation_for">implementation_for</a></h1>
<p><em>classmethod</em> <strong>implementation_for</strong>(<em>op_cls</em>:  Any) → Callable</p>
<p>Register an implementation for a given <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong>.</p>
<p>This is part of the operation extensibility API.</p>
<p><strong>See also:</strong></p>
<p><a href="zh/../en/api/operations.html#operation-plugins">Operation Plugins</a> - example of use</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inline_literal"><a class="header" href="#inline_literal">inline_literal</a></h1>
<p><strong>inline_literal</strong>(<em>value</em>:  Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/functions.html#int">int</a>], <em>type_</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>) → _literal_bindparam</p>
<p>Produce an ‘inline literal’ expression, suitable for using in an INSERT, UPDATE, or DELETE statement.</p>
<p>When using Alembic in “offline” mode, CRUD operations aren’t compatible with SQLAlchemy’s default behavior surrounding literal values, which is that they are converted into bound values and passed separately into the <code>execute()</code> method of the DBAPI cursor. An offline SQL script needs to have these rendered inline. While it should always be noted that inline literal values are an <strong>enormous</strong> security hole in an application that handles untrusted input, a schema migration is not run in this context, so literals are safe to render inline, with the caveat that advanced types like dates may not be supported directly by SQLAlchemy.</p>
<p>See <strong><a href="zh/../zh/06_01_18_execute.html">execute()</a></strong> for an example usage of <strong><a href="zh/../zh/06_01_23_inline_literal.html">inline_literal()</a></strong>.</p>
<p>The environment can also be configured to attempt to render “literal” values inline automatically, for those simple types that are supported by the dialect; see <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.literal_binds">EnvironmentContext.configure.literal_binds</a></strong> for this more recently added feature.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><em><strong>value</strong></em> – The <strong>value</strong> to render. Strings, integers, and simple numerics should be supported. Other types like boolean, dates, etc. may or may not be supported yet by various backends.</p>
</li>
<li>
<p><em><strong>type_</strong></em> – optional - a <strong><a href="https://docs.sqlalchemy.org/en/14/core/type_api.html#sqlalchemy.types.TypeEngine">sqlalchemy.types.TypeEngine</a></strong> subclass stating the type of this value. In SQLAlchemy expressions, this is usually derived automatically from the Python type of the value itself, as well as based on the context in which the value is used.</p>
</li>
</ul>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.literal_binds">EnvironmentContext.configure.literal_binds</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="invoke"><a class="header" href="#invoke">invoke</a></h1>
<p><strong>invoke</strong>(<em>operation</em>:  MigrateOperation) → Any</p>
<p>Given a <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong>, invoke it in terms of this <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="register_operation"><a class="header" href="#register_operation">register_operation</a></h1>
<p><em>classmethod</em> <strong>register_operation</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>sourcename</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Callable</p>
<p>Register a new operation for this class.</p>
<p>This method is normally used to add new operations to the <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> class, and possibly the <strong><a href="zh/../zh/06_02_batch_operations.html">BatchOperations</a></strong> class as well. All Alembic migration operations are implemented via this system, however the system is also available as a public API to facilitate adding custom operations.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../en/api/operations.html#operation-plugins">Operation Plugins</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rename_table"><a class="header" href="#rename_table">rename_table</a></h1>
<p><strong>rename_table</strong>(<em>old_table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>new_table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Emit an ALTER TABLE to rename a table.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>old_table_name</strong></em> – old name.</li>
<li><em><strong>new_table_name</strong></em> – new name.</li>
<li><em><strong>schema</strong></em> – Optional <strong>schema</strong> name to operate within. To control quoting of the <strong>schema</strong> outside of the default behavior, use the SQLAlchemy construct <strong><a href="https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.quoted_name">quoted_name</a></strong>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alembicoperationsbatchoperations"><a class="header" href="#alembicoperationsbatchoperations">alembic.operations.BatchOperations</a></h1>
<p><em>class</em> alembic.operations.<strong>BatchOperations</strong>(<em>migration_context</em>:  MigrationContext, <em>impl</em>:  Optional[BatchOperationsImpl] = None)</p>
<p>Modifies the interface <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> for batch mode.</p>
<p>This basically omits the <code>table_name</code> and <code>schema</code> parameters from associated methods, as these are a given when running under batch mode.</p>
<p><strong>See also: <a href="zh/../zh/06_01_03_batch_alter_table.html">Operations.batch_alter_table()</a></strong></p>
<blockquote>
<p><strong>Note:</strong> that as of 0.8, most of the methods on this class are produced dynamically using the <strong><a href="zh/../zh/06_01_25_register_operation.html">Operations.register_operation()</a></strong> method.</p>
</blockquote>
<p>Construct a new <a href="zh/../zh/06_01_operations.html">Operations</a></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>migration_context</strong></em> – a <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> instance.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="add_column-1"><a class="header" href="#add_column-1">add_column</a></h1>
<p><strong>add_column</strong>(<em>column</em>:  Column, <em>insert_before</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>insert_after</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>Issue an “add column” instruction using the current batch migration context.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_01_add_column.html">Operations.add_column()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alter_column-1"><a class="header" href="#alter_column-1">alter_column</a></h1>
<p><strong>alter_column</strong>(<em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>comment</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>server_default</em>:  Union[Function, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = False, <em>new_column_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>type_</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_type</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_server_default</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>existing_nullable</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>existing_comment</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>insert_before</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>insert_after</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, **kw) → Optional[Table]</p>
<p>Issue an “alter column” instruction using the current batch migration context.</p>
<p>Parameters are the same as that of <strong><a href="zh/../zh/06_01_02_alter_column.html">Operations.alter_column()</a></strong>, as well as the following option(s):</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>insert_before</strong></em> – String name of an existing column which this column should be placed before, when creating the new table.
<blockquote>
<p><em>New in version 1.4.0.</em></p>
</blockquote>
</li>
<li><em><strong>insert_after</strong></em> – String name of an existing column which this column should be placed after, when creating the new table. If both <strong><a href="zh/06_02_02_alter_column.html#alembic.operations.BatchOperations.alter_column.params.insert_before">BatchOperations.alter_column.insert_before</a></strong> and <strong><a href="zh/06_02_02_alter_column.html#alembic.operations.BatchOperations.alter_column.params.insert_after">BatchOperations.alter_column.insert_after</a></strong> are omitted, the column is inserted after the last existing column in the table.
<blockquote>
<p><em>New in version 1.4.0.</em></p>
</blockquote>
</li>
</ul>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_02_alter_column.html">Operations.alter_column()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_check_constraint-1"><a class="header" href="#create_check_constraint-1">create_check_constraint</a></h1>
<p><strong>create_check_constraint</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>condition</em>:  TextClause, **kw) → Optional[Table]</p>
<p>Issue a “create check constraint” instruction using the current batch migration context.</p>
<p>The batch form of this call omits the <code>source</code> and <code>schema</code> arguments from the call.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_05_create_check_constraint.html">Operations.create_check_constraint()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_exclude_constraint-1"><a class="header" href="#create_exclude_constraint-1">create_exclude_constraint</a></h1>
<p><strong>create_exclude_constraint</strong>(constraint_name, *elements, **kw)</p>
<p>Issue a “create exclude constraint” instruction using the current batch migration context.</p>
<blockquote>
<p><strong>Note:</strong> This method is Postgresql specific, and additionally requires at least SQLAlchemy 1.0.</p>
</blockquote>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_06_create_exclude_constraint.html">Operations.create_exclude_constraint()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_foreign_key-1"><a class="header" href="#create_foreign_key-1">create_foreign_key</a></h1>
<p><strong>create_foreign_key</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>referent_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>local_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>remote_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>referent_schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>onupdate</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>ondelete</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>deferrable</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>initially</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>match</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, **dialect_kw) → None</p>
<p>Issue a “create foreign key” instruction using the current batch migration context.</p>
<p>The batch form of this call omits the <code>source</code> and <code>source_schema</code> arguments from the call.</p>
<p>e.g.:</p>
<pre><code class="language-python">with batch_alter_table(&quot;address&quot;) as batch_op:
    batch_op.create_foreign_key(
                &quot;fk_user_address&quot;,
                &quot;user&quot;, [&quot;user_id&quot;], [&quot;id&quot;])
</code></pre>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_07_create_foreign_key.html">Operations.create_foreign_key()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_index-1"><a class="header" href="#create_index-1">create_index</a></h1>
<p><strong>create_index</strong>(<em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], **kw) → Optional[Table]</p>
<p>Issue a “create index” instruction using the current batch migration context.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_08_create_index.html">Operations.create_index()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_primary_key-1"><a class="header" href="#create_primary_key-1">create_primary_key</a></h1>
<p><strong>create_primary_key</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]) → None</p>
<p>Issue a “create primary key” instruction using the current batch migration context.</p>
<p>The batch form of this call omits the <code>table_name</code> and <code>schema</code> arguments from the call.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_09_create_primary_key.html">Operations.create_primary_key()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_table_comment-1"><a class="header" href="#create_table_comment-1">create_table_comment</a></h1>
<p><strong>create_table_comment</strong>(comment, existing_comment=None)</p>
<p>Emit a COMMENT ON operation to set the comment for a table using the current batch migration context.</p>
<blockquote>
<p><em>New in version 1.6.0.</em></p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>comment</strong></em> – string value of the <strong>comment</strong> being registered against the specified table.</li>
<li><em><strong>existing_comment</strong></em> – String value of a comment already registered on the specified table, used within autogenerate so that the operation is reversible, but not required for direct use.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create_unique_constraint-1"><a class="header" href="#create_unique_constraint-1">create_unique_constraint</a></h1>
<p><strong>create_unique_constraint</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], **kw) → Any</p>
<p>Issue a “create unique constraint” instruction using the current batch migration context.</p>
<p>The batch form of this call omits the <code>source</code> and <code>schema</code> arguments from the call.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_12_create_unique_constraint.html">Operations.create_unique_constraint()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_column-1"><a class="header" href="#drop_column-1">drop_column</a></h1>
<p><strong>drop_column</strong>(<em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, **kw) → Optional[Table]</p>
<p>Issue a “drop column” instruction using the current batch migration context.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_13_drop_column.html">Operations.drop_column()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_constraint-1"><a class="header" href="#drop_constraint-1">drop_constraint</a></h1>
<p><strong>drop_constraint</strong>(<em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>type_</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → None</p>
<p>Issue a “drop constraint” instruction using the current batch migration context.</p>
<p>The batch form of this call omits the <code>table_name</code> and <code>schema</code> arguments from the call.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_14_drop_constraint.html">Operations.drop_constraint()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_index-1"><a class="header" href="#drop_index-1">drop_index</a></h1>
<p><strong>drop_index</strong>(<em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, **kw) → Optional[Table]</p>
<p>Issue a “drop index” instruction using the current batch migration context.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../zh/06_01_15_drop_index.html">Operations.drop_index()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drop_table_comment-1"><a class="header" href="#drop_table_comment-1">drop_table_comment</a></h1>
<p><strong>drop_table_comment</strong>(existing_comment=None)</p>
<p>Issue a “drop table comment” operation to remove an existing comment set on a table using the current batch operations context.</p>
<blockquote>
<p><em>New in version 1.6.0.</em></p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>existing_comment</strong></em> – An optional string value of a comment already registered on the specified table.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cookbook"><a class="header" href="#cookbook">cookbook</a></h1>
<p>A collection of “How-Tos” highlighting popular ways to extend Alembic.</p>
<blockquote>
<p><em><strong>Note:</strong></em> This is a new section where we catalogue various “how-tos” based on user requests. It is often the case that users will request a feature only to learn it can be provided with a simple customization.</p>
</blockquote>
<p>一系列“操作方法”，重点介绍了扩展 Alembic 的流行方法。</p>
<blockquote>
<p><em><strong>备注:</strong></em> 这是一个新的部分，我们根据用户请求对各种“操作方法”进行分类。 通常情况下，用户会请求一个功能只是为了学习它， 并且可以通过简单的定制来提供。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-an-up-to-date-database-from-scratch"><a class="header" href="#building-an-up-to-date-database-from-scratch">Building an Up to Date Database from Scratch</a></h1>
<p><strong>从头开始构建最新的数据库</strong></p>
<p>There’s a theory of database migrations that says that the revisions in existence for a database should be able to go from an entirely blank schema to the finished product, and back again. Alembic can roll this way. Though we think it’s kind of overkill, considering that SQLAlchemy itself can emit the full CREATE statements for any given model using <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData.create_all">create_all()</a></strong>. If you check out a copy of an application, running this will give you the entire database in one shot, without the need to run through all those migration files, which are instead tailored towards applying incremental changes to an existing database.</p>
<p>Alembic can integrate with a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData.create_all">create_all()</a></strong> script quite easily. After running the create operation, tell Alembic to create a new version table, and to stamp it with the most recent revision (i.e. <code>head</code>):</p>
<pre><code class="language-python"># inside of a &quot;create the database&quot; script, first create
# tables:
my_metadata.create_all(engine)

# then, load the Alembic configuration and generate the
# version table, &quot;stamping&quot; it with the most recent rev:
from alembic.config import Config
from alembic import command
alembic_cfg = Config(&quot;/path/to/yourapp/alembic.ini&quot;)
command.stamp(alembic_cfg, &quot;head&quot;)
</code></pre>
<p>When this approach is used, the application can generate the database using normal SQLAlchemy techniques instead of iterating through hundreds of migration scripts. Now, the purpose of the migration scripts is relegated just to movement between versions on out-of-date databases, not new databases. You can now remove old migration files that are no longer represented on any existing environments.</p>
<p>To prune old migration files, simply delete the files. Then, in the earliest, still-remaining migration file, set <code>down_revision</code> to <code>None</code>:</p>
<pre><code class="language-python"># replace this:
#down_revision = '290696571ad2'

# with this:
down_revision = None
</code></pre>
<p>That file now becomes the “base” of the migration series.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditional-migration-elements"><a class="header" href="#conditional-migration-elements">Conditional Migration Elements</a></h1>
<p><strong>条件迁移元素</strong></p>
<p>This example features the basic idea of a common need, that of affecting how a migration runs based on command line switches.</p>
<p>The technique to use here is simple; within a migration script, inspect the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_x_argument">EnvironmentContext.get_x_argument()</a></strong> collection for any additional, user-defined parameters. Then take action based on the presence of those arguments.</p>
<p>To make it such that the logic to inspect these flags is easy to use and modify, we modify our <code>script.py.mako</code> template to make this feature available in all new revision files:</p>
<pre><code class="language-python">&quot;&quot;&quot;${message}

Revision ID: ${up_revision}
Revises: ${down_revision}
Create Date: ${create_date}

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = ${repr(up_revision)}
down_revision = ${repr(down_revision)}

from alembic import op
import sqlalchemy as sa
${imports if imports else &quot;&quot;}

from alembic import context


def upgrade():
    schema_upgrades()
    if context.get_x_argument(as_dictionary=True).get('data', None):
        data_upgrades()

def downgrade():
    if context.get_x_argument(as_dictionary=True).get('data', None):
        data_downgrades()
    schema_downgrades()

def schema_upgrades():
    &quot;&quot;&quot;schema upgrade migrations go here.&quot;&quot;&quot;
    ${upgrades if upgrades else &quot;pass&quot;}

def schema_downgrades():
    &quot;&quot;&quot;schema downgrade migrations go here.&quot;&quot;&quot;
    ${downgrades if downgrades else &quot;pass&quot;}

def data_upgrades():
    &quot;&quot;&quot;Add any optional data upgrade migrations here!&quot;&quot;&quot;
    pass

def data_downgrades():
    &quot;&quot;&quot;Add any optional data downgrade migrations here!&quot;&quot;&quot;
    pass
</code></pre>
<p>Now, when we create a new migration file, the <code>data_upgrades()</code> and <code>data_downgrades()</code> placeholders will be available, where we can add optional data migrations:</p>
<pre><code class="language-python">&quot;&quot;&quot;rev one

Revision ID: 3ba2b522d10d
Revises: None
Create Date: 2014-03-04 18:05:36.992867

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '3ba2b522d10d'
down_revision = None

from alembic import op
import sqlalchemy as sa
from sqlalchemy import String, Column
from sqlalchemy.sql import table, column

from alembic import context

def upgrade():
    schema_upgrades()
    if context.get_x_argument(as_dictionary=True).get('data', None):
        data_upgrades()

def downgrade():
    if context.get_x_argument(as_dictionary=True).get('data', None):
        data_downgrades()
    schema_downgrades()

def schema_upgrades():
    &quot;&quot;&quot;schema upgrade migrations go here.&quot;&quot;&quot;
    op.create_table(&quot;my_table&quot;, Column('data', String))

def schema_downgrades():
    &quot;&quot;&quot;schema downgrade migrations go here.&quot;&quot;&quot;
    op.drop_table(&quot;my_table&quot;)

def data_upgrades():
    &quot;&quot;&quot;Add any optional data upgrade migrations here!&quot;&quot;&quot;

    my_table = table('my_table',
        column('data', String),
    )

    op.bulk_insert(my_table,
        [
            {'data': 'data 1'},
            {'data': 'data 2'},
            {'data': 'data 3'},
        ]
    )

def data_downgrades():
    &quot;&quot;&quot;Add any optional data downgrade migrations here!&quot;&quot;&quot;

    op.execute(&quot;delete from my_table&quot;)
</code></pre>
<p>To invoke our migrations with data included, we use the <code>-x</code> flag:</p>
<pre><code class="language-bash">alembic -x data=true upgrade head
</code></pre>
<p>The <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_x_argument">EnvironmentContext.get_x_argument()</a></strong> is an easy way to support new commandline options within environment and migration scripts.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sharing-a-connection-with-a-series-of-migration-commands-and-environments"><a class="header" href="#sharing-a-connection-with-a-series-of-migration-commands-and-environments">Sharing a Connection with a Series of Migration Commands and Environments</a></h1>
<p><strong>与一系列迁移命令和环境共享连接</strong></p>
<p>It is often the case that an application will need to call upon a series of commands within <strong><a href="zh/../en/api/commands.html#alembic-command-toplevel">Commands</a></strong>, where it would be advantageous for all operations to proceed along a single transaction. The connectivity for a migration is typically solely determined within the <code>env.py</code> script of a migration environment, which is called within the scope of a command.</p>
<p>The steps to take here are:</p>
<ol>
<li>Produce the <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> object to use.</li>
<li>Place it somewhere that <code>env.py</code> will be able to access it. This can be either a. a module-level global somewhere, or b. an attribute which we place into the <strong><a href="zh/../en/api/config.html#alembic.config.Config.attributes">Config.attributes</a></strong> dictionary (if we are on an older Alembic version, we may also attach an attribute directly to the <strong><a href="zh/../en/api/config.html#alembic.config.Config">Config</a></strong> object).</li>
<li>The <code>env.py</code> script is modified such that it looks for this <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> and makes use of it, in lieu of building up its own <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Engine">Engine</a></strong> instance.</li>
</ol>
<p>We illustrate using <strong><a href="zh/../en/api/config.html#alembic.config.Config.attributes">Config.attributes</a></strong>:</p>
<pre><code class="language-python">from alembic import command, config

cfg = config.Config(&quot;/path/to/yourapp/alembic.ini&quot;)
with engine.begin() as connection:
    cfg.attributes['connection'] = connection
    command.upgrade(cfg, &quot;head&quot;)
</code></pre>
<p>Then in <code>env.py</code>:</p>
<pre><code class="language-python">def run_migrations_online():
    connectable = config.attributes.get('connection', None)

    if connectable is None:
        # only create Engine if we don't have a Connection
        # from the outside
        connectable = engine_from_config(
            config.get_section(config.config_ini_section),
            prefix='sqlalchemy.',
            poolclass=pool.NullPool)

    context.configure(
        connection=connectable,
        target_metadata=target_metadata
    )

    with context.begin_transaction():
        context.run_migrations()
</code></pre>
<blockquote>
<p><em>Changed in version 1.4</em>: Prior to this version, we used a “branched connection”, by calling <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection.connect">connect()</a></strong>. This is now deprecated and unnecessary, since we no longer have to guess if the given “connection” is an <code>Engine</code> or <code>Connection</code>, it is always a <code>Connection</code>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="replaceable-objects"><a class="header" href="#replaceable-objects">Replaceable Objects</a></h1>
<p><strong>可替换对象</strong></p>
<p>This recipe proposes a hypothetical way of dealing with what we might call a replaceable schema object. A replaceable object is a schema object that needs to be created and dropped all at once. Examples of such objects include views, stored procedures, and triggers.</p>
<blockquote>
<p><strong>See also:</strong> The Replaceable Object concept has been integrated by the <strong><a href="https://github.com/olirice/alembic_utils">Alembic Utils</a></strong> project, which provides autogenerate and migration support for PostgreSQL functions and views. See <strong><a href="https://github.com/olirice/alembic_utils">Alembic Utils</a></strong> at <strong><a href="https://github.com/olirice/alembic_utils">https://github.com/olirice/alembic_utils</a></strong> .</p>
</blockquote>
<p>Replaceable objects present a problem in that in order to make incremental changes to them, we have to refer to the whole definition at once. If we need to add a new column to a view, for example, we have to drop it entirely and recreate it fresh with the extra column added, referring to the whole structure; but to make it even tougher, if we wish to support downgrade operarations in our migration scripts, we need to refer to the previous version of that construct fully, and we’d much rather not have to type out the whole definition in multiple places.</p>
<p>This recipe proposes that we may refer to the older version of a replaceable construct by directly naming the migration version in which it was created, and having a migration refer to that previous file as migrations run. We will also demonstrate how to integrate this logic within the <strong><a href="zh/../en/api/operations.html#operation-plugins">Operation Plugins</a></strong> feature introduced in Alembic 0.8. It may be very helpful to review this section first to get an overview of this API.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-replaceable-object-structure"><a class="header" href="#the-replaceable-object-structure">The Replaceable Object Structure</a></h1>
<p><strong>可替换对象结构</strong></p>
<p>We first need to devise a simple format that represents the “CREATE XYZ” / “DROP XYZ” aspect of what it is we’re building. We will work with an object that represents a textual definition; while a SQL view is an object that we can define using a <strong><a href="https://github.com/sqlalchemy/sqlalchemy/wiki/UsageRecipes/Views">table-metadata-like system</a></strong>, this is not so much the case for things like stored procedures, where we pretty much need to have a full string definition written down somewhere. We’ll use a simple value object called <code>ReplaceableObject</code> that can represent any named set of SQL text to send to a “CREATE” statement of some kind:</p>
<pre><code class="language-python">class ReplaceableObject:
    def __init__(self, name, sqltext):
        self.name = name
        self.sqltext = sqltext
</code></pre>
<p>Using this object in a migration script, assuming a Postgresql-style syntax, looks like:</p>
<pre><code class="language-python">customer_view = ReplaceableObject(
    &quot;customer_view&quot;,
    &quot;SELECT name, order_count FROM customer WHERE order_count &gt; 0&quot;
)

add_customer_sp = ReplaceableObject(
    &quot;add_customer_sp(name varchar, order_count integer)&quot;,
    &quot;&quot;&quot;
    RETURNS integer AS $$
    BEGIN
        insert into customer (name, order_count)
        VALUES (in_name, in_order_count);
    END;
    $$ LANGUAGE plpgsql;
    &quot;&quot;&quot;
)
</code></pre>
<p>The <code>ReplaceableObject</code> class is only one very simplistic way to do this. The structure of how we represent our schema objects is not too important for the purposes of this example; we can just as well put strings inside of tuples or dictionaries, as well as that we could define any kind of series of fields and class structures we want. The only important part is that below we will illustrate how organize the code that can consume the structure we create here.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-operations-for-the-target-objects"><a class="header" href="#create-operations-for-the-target-objects">Create Operations for the Target Objects</a></h1>
<p><strong>为目标对象创建操作</strong></p>
<p>We’ll use the <strong><a href="zh/../zh/06_01_operations.html">Operations</a></strong> extension API to make new operations for create, drop, and replace of views and stored procedures. Using this API is also optional; we can just as well make any kind of Python function that we would invoke from our migration scripts. However, using this API gives us operations built directly into the Alembic <code>op.*</code> namespace very nicely.</p>
<p>The most intricate class is below. This is the base of our “replaceable” operation, which includes not just a base operation for emitting CREATE and DROP instructions on a <code>ReplaceableObject</code>, it also assumes a certain model of “reversibility” which makes use of references to other migration files in order to refer to the “previous” version of an object:</p>
<pre><code class="language-python">from alembic.operations import Operations, MigrateOperation

class ReversibleOp(MigrateOperation):
    def __init__(self, target):
        self.target = target

    @classmethod
    def invoke_for_target(cls, operations, target):
        op = cls(target)
        return operations.invoke(op)

    def reverse(self):
        raise NotImplementedError()

    @classmethod
    def _get_object_from_version(cls, operations, ident):
        version, objname = ident.split(&quot;.&quot;)

        module = operations.get_context().script.get_revision(version).module
        obj = getattr(module, objname)
        return obj

    @classmethod
    def replace(cls, operations, target, replaces=None, replace_with=None):

        if replaces:
            old_obj = cls._get_object_from_version(operations, replaces)
            drop_old = cls(old_obj).reverse()
            create_new = cls(target)
        elif replace_with:
            old_obj = cls._get_object_from_version(operations, replace_with)
            drop_old = cls(target).reverse()
            create_new = cls(old_obj)
        else:
            raise TypeError(&quot;replaces or replace_with is required&quot;)

        operations.invoke(drop_old)
        operations.invoke(create_new)
</code></pre>
<p>The workings of this class should become clear as we walk through the example. To create usable operations from this base, we will build a series of stub classes and use <strong><a href="zh/../zh/06_01_25_register_operation.html">Operations.register_operation()</a></strong> to make them part of the <code>op.*</code> namespace:</p>
<pre><code class="language-python">@Operations.register_operation(&quot;create_view&quot;, &quot;invoke_for_target&quot;)
@Operations.register_operation(&quot;replace_view&quot;, &quot;replace&quot;)
class CreateViewOp(ReversibleOp):
    def reverse(self):
        return DropViewOp(self.target)


@Operations.register_operation(&quot;drop_view&quot;, &quot;invoke_for_target&quot;)
class DropViewOp(ReversibleOp):
    def reverse(self):
        return CreateViewOp(self.target)


@Operations.register_operation(&quot;create_sp&quot;, &quot;invoke_for_target&quot;)
@Operations.register_operation(&quot;replace_sp&quot;, &quot;replace&quot;)
class CreateSPOp(ReversibleOp):
    def reverse(self):
        return DropSPOp(self.target)


@Operations.register_operation(&quot;drop_sp&quot;, &quot;invoke_for_target&quot;)
class DropSPOp(ReversibleOp):
    def reverse(self):
        return CreateSPOp(self.target)
</code></pre>
<p>To actually run the SQL like “CREATE VIEW” and “DROP SEQUENCE”, we’ll provide implementations using <strong><a href="zh/../zh/06_01_22_implementation_for.html">Operations.implementation_for()</a></strong> that run straight into <strong><a href="zh/../zh/06_01_18_execute.html">Operations.execute()</a></strong>:</p>
<pre><code class="language-python">@Operations.implementation_for(CreateViewOp)
def create_view(operations, operation):
    operations.execute(&quot;CREATE VIEW %s AS %s&quot; % (
        operation.target.name,
        operation.target.sqltext
    ))


@Operations.implementation_for(DropViewOp)
def drop_view(operations, operation):
    operations.execute(&quot;DROP VIEW %s&quot; % operation.target.name)


@Operations.implementation_for(CreateSPOp)
def create_sp(operations, operation):
    operations.execute(
        &quot;CREATE FUNCTION %s %s&quot; % (
            operation.target.name, operation.target.sqltext
        )
    )


@Operations.implementation_for(DropSPOp)
def drop_sp(operations, operation):
    operations.execute(&quot;DROP FUNCTION %s&quot; % operation.target.name)
</code></pre>
<p>All of the above code can be present anywhere within an application’s source tree; the only requirement is that when the <code>env.py</code> script is invoked, it includes imports that ultimately call upon these classes as well as the <strong><a href="zh/../zh/06_01_25_register_operation.html">Operations.register_operation()</a></strong> and <strong><a href="zh/../zh/06_01_22_implementation_for.html">Operations.implementation_for()</a></strong> sequences.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-initial-migrations"><a class="header" href="#create-initial-migrations">Create Initial Migrations</a></h1>
<p><strong>创建初始迁移</strong></p>
<p>We can now illustrate how these objects look during use. For the first step, we’ll create a new migration to create a “customer” table:</p>
<pre><code class="language-bash">alembic revision -m &quot;create table&quot;
</code></pre>
<p>We build the first revision as follows:</p>
<pre><code class="language-python">&quot;&quot;&quot;create table

Revision ID: 3ab8b2dfb055
Revises:
Create Date: 2015-07-27 16:22:44.918507

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '3ab8b2dfb055'
down_revision = None
branch_labels = None
depends_on = None

from alembic import op
import sqlalchemy as sa


def upgrade():
    op.create_table(
        &quot;customer&quot;,
        sa.Column('id', sa.Integer, primary_key=True),
        sa.Column('name', sa.String),
        sa.Column('order_count', sa.Integer),
    )


def downgrade():
    op.drop_table('customer')
</code></pre>
<p>For the second migration, we will create a view and a stored procedure which act upon this table:</p>
<pre><code class="language-bash">alembic revision -m &quot;create views/sp&quot;
</code></pre>
<p>This migration will use the new directives:</p>
<pre><code class="language-python">&quot;&quot;&quot;create views/sp

Revision ID: 28af9800143f
Revises: 3ab8b2dfb055
Create Date: 2015-07-27 16:24:03.589867

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '28af9800143f'
down_revision = '3ab8b2dfb055'
branch_labels = None
depends_on = None

from alembic import op
import sqlalchemy as sa

from foo import ReplaceableObject

customer_view = ReplaceableObject(
    &quot;customer_view&quot;,
    &quot;SELECT name, order_count FROM customer WHERE order_count &gt; 0&quot;
)

add_customer_sp = ReplaceableObject(
    &quot;add_customer_sp(name varchar, order_count integer)&quot;,
    &quot;&quot;&quot;
    RETURNS integer AS $$
    BEGIN
        insert into customer (name, order_count)
        VALUES (in_name, in_order_count);
    END;
    $$ LANGUAGE plpgsql;
    &quot;&quot;&quot;
)


def upgrade():
    op.create_view(customer_view)
    op.create_sp(add_customer_sp)


def downgrade():
    op.drop_view(customer_view)
    op.drop_sp(add_customer_sp)
</code></pre>
<p>We see the use of our new <code>create_view()</code>, <code>create_sp()</code>, <code>drop_view()</code>, and <code>drop_sp()</code> directives. Running these to “head” we get the following (this includes an edited view of SQL emitted):</p>
<pre><code class="language-bash">$ alembic upgrade 28af9800143
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [sqlalchemy.engine.base.Engine] BEGIN (implicit)
INFO  [sqlalchemy.engine.base.Engine] select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s
INFO  [sqlalchemy.engine.base.Engine] {'name': u'alembic_version'}
INFO  [sqlalchemy.engine.base.Engine] SELECT alembic_version.version_num
FROM alembic_version
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s
INFO  [sqlalchemy.engine.base.Engine] {'name': u'alembic_version'}
INFO  [alembic.runtime.migration] Running upgrade  -&gt; 3ab8b2dfb055, create table
INFO  [sqlalchemy.engine.base.Engine]
CREATE TABLE customer (
    id SERIAL NOT NULL,
    name VARCHAR,
    order_count INTEGER,
    PRIMARY KEY (id)
)


INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] INSERT INTO alembic_version (version_num) VALUES ('3ab8b2dfb055')
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [alembic.runtime.migration] Running upgrade 3ab8b2dfb055 -&gt; 28af9800143f, create views/sp
INFO  [sqlalchemy.engine.base.Engine] CREATE VIEW customer_view AS SELECT name, order_count FROM customer WHERE order_count &gt; 0
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] CREATE FUNCTION add_customer_sp(name varchar, order_count integer)
    RETURNS integer AS $$
    BEGIN
        insert into customer (name, order_count)
        VALUES (in_name, in_order_count);
    END;
    $$ LANGUAGE plpgsql;

INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] UPDATE alembic_version SET version_num='28af9800143f' WHERE alembic_version.version_num = '3ab8b2dfb055'
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] COMMIT
</code></pre>
<p>We see that our CREATE TABLE proceeded as well as the CREATE VIEW and CREATE FUNCTION operations produced by our new directives.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-revision-migrations"><a class="header" href="#create-revision-migrations">Create Revision Migrations</a></h1>
<p><strong>创建修订迁移</strong></p>
<p>Finally, we can illustrate how we would “revise” these objects. Let’s consider we added a new column <code>email</code> to our <code>customer</code> table:</p>
<pre><code class="language-bash">alembic revision -m &quot;add email col&quot;
</code></pre>
<p>The migration is:</p>
<pre><code class="language-python">&quot;&quot;&quot;add email col

Revision ID: 191a2d20b025
Revises: 28af9800143f
Create Date: 2015-07-27 16:25:59.277326

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '191a2d20b025'
down_revision = '28af9800143f'
branch_labels = None
depends_on = None

from alembic import op
import sqlalchemy as sa


def upgrade():
    op.add_column(&quot;customer&quot;, sa.Column(&quot;email&quot;, sa.String()))


def downgrade():
    op.drop_column(&quot;customer&quot;, &quot;email&quot;)
</code></pre>
<p>We now need to recreate the <code>customer_view</code> view and the <code>add_customer_sp</code> function. To include downgrade capability, we will need to refer to the <strong>previous</strong> version of the construct; the <code>replace_view()</code> and <code>replace_sp()</code> operations we’ve created make this possible, by allowing us to refer to a specific, <strong>previous</strong> revision. the <code>replaces</code> and <code>replace_with</code> arguments accept a dot-separated string, which refers to a revision number and an object name, such as <code>&quot;28af9800143f.customer_view&quot;</code>. The <code>ReversibleOp</code> class makes use of the <strong><a href="zh/../en/ops.html#alembic.operations.Operations.get_context">Operations.get_context()</a></strong> method to locate the version file we refer to:</p>
<pre><code class="language-bash">alembic revision -m &quot;update views/sp&quot;
</code></pre>
<p>The migration:</p>
<pre><code class="language-python">&quot;&quot;&quot;update views/sp

Revision ID: 199028bf9856
Revises: 191a2d20b025
Create Date: 2015-07-27 16:26:31.344504

&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = '199028bf9856'
down_revision = '191a2d20b025'
branch_labels = None
depends_on = None

from alembic import op
import sqlalchemy as sa

from foo import ReplaceableObject

customer_view = ReplaceableObject(
    &quot;customer_view&quot;,
    &quot;SELECT name, order_count, email &quot;
    &quot;FROM customer WHERE order_count &gt; 0&quot;
)

add_customer_sp = ReplaceableObject(
    &quot;add_customer_sp(name varchar, order_count integer, email varchar)&quot;,
    &quot;&quot;&quot;
    RETURNS integer AS $$
    BEGIN
        insert into customer (name, order_count, email)
        VALUES (in_name, in_order_count, email);
    END;
    $$ LANGUAGE plpgsql;
    &quot;&quot;&quot;
)


def upgrade():
    op.replace_view(customer_view, replaces=&quot;28af9800143f.customer_view&quot;)
    op.replace_sp(add_customer_sp, replaces=&quot;28af9800143f.add_customer_sp&quot;)


def downgrade():
    op.replace_view(customer_view, replace_with=&quot;28af9800143f.customer_view&quot;)
    op.replace_sp(add_customer_sp, replace_with=&quot;28af9800143f.add_customer_sp&quot;)
</code></pre>
<p>Above, instead of using <code>create_view()</code>, <code>create_sp()</code>, <code>drop_view()</code>, and <code>drop_sp()</code> methods, we now use <code>replace_view()</code> and <code>replace_sp()</code>. The replace operation we’ve built always runs a DROP and a CREATE. Running an upgrade to head we see:</p>
<pre><code class="language-bash">$ alembic upgrade head
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [sqlalchemy.engine.base.Engine] BEGIN (implicit)
INFO  [sqlalchemy.engine.base.Engine] select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s
INFO  [sqlalchemy.engine.base.Engine] {'name': u'alembic_version'}
INFO  [sqlalchemy.engine.base.Engine] SELECT alembic_version.version_num
FROM alembic_version
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [alembic.runtime.migration] Running upgrade 28af9800143f -&gt; 191a2d20b025, add email col
INFO  [sqlalchemy.engine.base.Engine] ALTER TABLE customer ADD COLUMN email VARCHAR
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] UPDATE alembic_version SET version_num='191a2d20b025' WHERE alembic_version.version_num = '28af9800143f'
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [alembic.runtime.migration] Running upgrade 191a2d20b025 -&gt; 199028bf9856, update views/sp
INFO  [sqlalchemy.engine.base.Engine] DROP VIEW customer_view
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] CREATE VIEW customer_view AS SELECT name, order_count, email FROM customer WHERE order_count &gt; 0
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] DROP FUNCTION add_customer_sp(name varchar, order_count integer)
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] CREATE FUNCTION add_customer_sp(name varchar, order_count integer, email varchar)
    RETURNS integer AS $$
    BEGIN
        insert into customer (name, order_count, email)
        VALUES (in_name, in_order_count, email);
    END;
    $$ LANGUAGE plpgsql;

INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] UPDATE alembic_version SET version_num='199028bf9856' WHERE alembic_version.version_num = '191a2d20b025'
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] COMMIT
</code></pre>
<p>After adding our new <code>email</code> column, we see that both <code>customer_view</code> and <code>add_customer_sp()</code> are dropped before the new version is created. If we downgrade back to the old version, we see the old version of these recreated again within the downgrade for this migration:</p>
<pre><code class="language-bash">$ alembic downgrade 28af9800143
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [sqlalchemy.engine.base.Engine] BEGIN (implicit)
INFO  [sqlalchemy.engine.base.Engine] select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s
INFO  [sqlalchemy.engine.base.Engine] {'name': u'alembic_version'}
INFO  [sqlalchemy.engine.base.Engine] SELECT alembic_version.version_num
FROM alembic_version
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [alembic.runtime.migration] Running downgrade 199028bf9856 -&gt; 191a2d20b025, update views/sp
INFO  [sqlalchemy.engine.base.Engine] DROP VIEW customer_view
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] CREATE VIEW customer_view AS SELECT name, order_count FROM customer WHERE order_count &gt; 0
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] DROP FUNCTION add_customer_sp(name varchar, order_count integer, email varchar)
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] CREATE FUNCTION add_customer_sp(name varchar, order_count integer)
    RETURNS integer AS $$
    BEGIN
        insert into customer (name, order_count)
        VALUES (in_name, in_order_count);
    END;
    $$ LANGUAGE plpgsql;

INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] UPDATE alembic_version SET version_num='191a2d20b025' WHERE alembic_version.version_num = '199028bf9856'
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [alembic.runtime.migration] Running downgrade 191a2d20b025 -&gt; 28af9800143f, add email col
INFO  [sqlalchemy.engine.base.Engine] ALTER TABLE customer DROP COLUMN email
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] UPDATE alembic_version SET version_num='28af9800143f' WHERE alembic_version.version_num = '191a2d20b025'
INFO  [sqlalchemy.engine.base.Engine] {}
INFO  [sqlalchemy.engine.base.Engine] COMMIT
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rudimental-schema-level-multi-tenancy-for-postgresql-databases"><a class="header" href="#rudimental-schema-level-multi-tenancy-for-postgresql-databases">Rudimental Schema-Level Multi Tenancy for PostgreSQL Databases</a></h1>
<p>PostgreSQL 数据库的基础架构级多租户</p>
<p>Multi tenancy refers to an application that accommodates for many clients simultaneously. Within the scope of a database migrations tool, multi-tenancy typically refers to the practice of maintaining multiple, identical databases where each database is assigned to one client.</p>
<p>Alembic does not currently have explicit multi-tenant support; typically, the approach must involve running Alembic multiple times against different database URLs.</p>
<p>One common approach to multi-tenancy, particularly on the PostgreSQL database, is to install tenants within individual PostgreSQL schemas. When using PostgreSQL’s schemas, a special variable <code>search_path</code> is offered that is intended to assist with targeting of different schemas.</p>
<blockquote>
<p><strong>Note:</strong> SQLAlchemy includes a system of directing a common set of <code>Table</code> metadata to many schemas called <strong><a href="https://docs.sqlalchemy.org/core/connections.html#translation-of-schema-names">schema_translate_map</a></strong>. Alembic at the time of this writing lacks adequate support for this feature. The recipe below should be considered <strong>interim</strong> until Alembic has more first-class support for schema-level multi-tenancy.</p>
</blockquote>
<p>The recipe below can be altered for flexibility. The primary purpose of this recipe is to illustrate how to point the Alembic process towards one PostgreSQL schema or another.</p>
<ol>
<li>
<p>The model metadata used as the target for autogenerate must not include any schema name for tables; the schema must be non-present or set to <code>None</code>. Otherwise, Alembic autogenerate will still attempt to compare and render tables in terms of this schema:</p>
<pre><code class="language-python">class A(Base):
    __tablename__ = 'a'

    id = Column(Integer, primary_key=True)
    data = Column(UnicodeText())
    foo = Column(Integer)

    __table_args__ = {
        &quot;schema&quot;: None
    }

</code></pre>
</li>
<li>
<p>The <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> flag must also be False or not included.</p>
</li>
<li>
<p>The “tenant” will be a schema name passed to Alembic using the “-x” flag. In <code>env.py</code> an approach like the following allows <code>-xtenant=some_schema</code> to be supported by making use of <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_x_argument">EnvironmentContext.get_x_argument()</a></strong>:</p>
<pre><code class="language-python">def run_migrations_online():
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix=&quot;sqlalchemy.&quot;,
        poolclass=pool.NullPool,
    )

    current_tenant = context.get_x_argument(as_dictionary=True).get(&quot;tenant&quot;)
    with connectable.connect() as connection:

        # set search path on the connection, which ensures that
        # PostgreSQL will emit all CREATE / ALTER / DROP statements
        # in terms of this schema by default
        connection.execute(&quot;set search_path to %s&quot; % current_tenant)

        # make use of non-supported SQLAlchemy attribute to ensure
        # the dialect reflects tables in terms of the current tenant name
        connection.dialect.default_schema_name = current_tenant

        context.configure(
            connection=connection,
            target_metadata=target_metadata,
        )

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p>The current tenant is set using the PostgreSQL <code>search_path</code> variable on the connection. Note above we must employ a <strong>non-supported SQLAlchemy workaround</strong> at the moment which is to hardcode the SQLAlchemy dialect’s default schema name to our target schema.</p>
<p>It is also important to note that the above changes remain on the connection permanently unless reversed explicitly. If the alembic application simply exits above, there is no issue. However if the application attempts to continue using the above connection for other purposes, it may be necessary to reset these variables back to the default, which for PostgreSQL is usually the name “public” however may be different based on configuration.</p>
</li>
<li>
<p>Alembic operations will now proceed in terms of whichever schema we pass on the command line. All logged SQL will show no schema, except for reflection operations which will make use of the <code>default_schema_name</code> attribute:</p>
<pre><code class="language-bash">[]$ alembic -x tenant=some_schema revision -m &quot;rev1&quot; --autogenerate
</code></pre>
</li>
<li>
<p>Since <strong>all</strong> schemas are to be maintained in sync, autogenerate should be run against only <strong>one</strong> schema, generating new Alembic migration files. Autogenerate migratin operations are then run against <strong>all</strong> schemas.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dont-generate-empty-migrations-with-autogenerate"><a class="header" href="#dont-generate-empty-migrations-with-autogenerate">Don’t Generate Empty Migrations with Autogenerate</a></h1>
<p><strong>不要使用 Autogenerate 生成空迁移</strong></p>
<p>A common request is to have the <code>alembic revision --autogenerate</code> command not actually generate a revision file if no changes to the schema is detected. Using the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> hook, this is straightforward; place a <code>process_revision_directives</code> hook in <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext.configure">MigrationContext.configure()</a></strong> which removes the single <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> directive if it is empty of any operations:</p>
<pre><code class="language-python">def run_migrations_online():

    # ...

    def process_revision_directives(context, revision, directives):
        if config.cmd_opts.autogenerate:
            script = directives[0]
            if script.upgrade_ops.is_empty():
                directives[:] = []


    # connectable = ...

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata,
            process_revision_directives=process_revision_directives
        )

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dont-emit-drop-index-when-the-table-is-to-be-dropped-as-well"><a class="header" href="#dont-emit-drop-index-when-the-table-is-to-be-dropped-as-well">Don’t emit DROP INDEX when the table is to be dropped as well</a></h1>
<p>MySQL may complain when dropping an index that is against a column that also has a foreign key constraint on it. If the table is to be dropped in any case, the DROP INDEX isn’t necessary. This recipe will process the set of autogenerate directives such that all <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.DropIndexOp">DropIndexOp</a></strong> directives are removed against tables that themselves are to be dropped:</p>
<pre><code class="language-python">def run_migrations_online():

    # ...

    from alembic.operations import ops

    def process_revision_directives(context, revision, directives):
        script = directives[0]

        # process both &quot;def upgrade()&quot;, &quot;def downgrade()&quot;
        for directive in (script.upgrade_ops, script.downgrade_ops):

            # make a set of tables that are being dropped within
            # the migration function
            tables_dropped = set()
            for op in directive.ops:
                if isinstance(op, ops.DropTableOp):
                    tables_dropped.add((op.table_name, op.schema))

            # now rewrite the list of &quot;ops&quot; such that DropIndexOp
            # is removed for those tables.   Needs a recursive function.
            directive.ops = list(
                _filter_drop_indexes(directive.ops, tables_dropped)
            )

    def _filter_drop_indexes(directives, tables_dropped):
        # given a set of (tablename, schemaname) to be dropped, filter
        # out DropIndexOp from the list of directives and yield the result.

        for directive in directives:
            # ModifyTableOps is a container of ALTER TABLE types of
            # commands.  process those in place recursively.
            if isinstance(directive, ops.ModifyTableOps) and \
                    (directive.table_name, directive.schema) in tables_dropped:
                directive.ops = list(
                    _filter_drop_indexes(directive.ops, tables_dropped)
                )

                # if we emptied out the directives, then skip the
                # container altogether.
                if not directive.ops:
                    continue
            elif isinstance(directive, ops.DropIndexOp) and \
                    (directive.table_name, directive.schema) in tables_dropped:
                # we found a target DropIndexOp.   keep looping
                continue

            # otherwise if not filtered, yield out the directive
            yield directive

    # connectable = ...

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata,
            process_revision_directives=process_revision_directives
        )

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p>Whereas autogenerate, when dropping two tables with a foreign key and an index, would previously generate something like:</p>
<pre><code class="language-python">def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_b_aid'), table_name='b')
    op.drop_table('b')
    op.drop_table('a')
    # ### end Alembic commands ###
</code></pre>
<p>With the above rewriter, it generates as:</p>
<pre><code class="language-python">def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('b')
    op.drop_table('a')
    # ### end Alembic commands ###
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dont-generate-any-drop-table-directives-with-autogenerate"><a class="header" href="#dont-generate-any-drop-table-directives-with-autogenerate">Don’t generate any DROP TABLE directives with autogenerate</a></h1>
<p>When running autogenerate against a database that has existing tables outside of the application’s autogenerated metadata, it may be desirable to prevent autogenerate from considering any of those existing tables to be dropped. This will prevent autogenerate from detecting tables removed from the local metadata as well however this is only a small caveat.</p>
<p>The most direct way to achieve this using the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> hook. There is no need to hardcode a fixed “whitelist” of table names; the hook gives enough information in the given arguments to determine if a particular table name is not part of the local <code>MetaData</code> being autogenerated, by checking first that the type of object is <code>&quot;table&quot;</code>, then that <code>reflected</code> is <code>True</code>, indicating this table name is from the local database connection, not the <code>MetaData</code>, and finally that <code>compare_to</code> is <code>None</code>, indicating autogenerate is not comparing this <code>Table</code> to any <code>Table</code> in the local <code>MetaData</code> collection:</p>
<pre><code class="language-python"># in env.py

def include_object(object, name, type_, reflected, compare_to):
    if type_ == &quot;table&quot; and reflected and compare_to is None:
        return False
    else:
        return True


context.configure(
    # ...
    include_object = include_object
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="apply-custom-sorting-to-table-columns-within-create-table"><a class="header" href="#apply-custom-sorting-to-table-columns-within-create-table">Apply Custom Sorting to Table Columns within CREATE TABLE</a></h1>
<p>This example illustrates use of the <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> object introduced at <strong><a href="zh/../en/api/autogenerate.html#autogen-rewriter">Fine-Grained Autogenerate Generation with Rewriters</a></strong>. While the rewriter grants access to the individual <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.MigrateOperation">ops.MigrateOperation</a></strong> objects, there are sometimes some special techniques required to get around some structural limitations that are present.</p>
<p>One is when trying to reorganize the order of columns in a table within a <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.CreateTableOp">ops.CreateTableOp</a></strong> directive. This directive, when generated by autogenerate, actually holds onto the original <code>Table</code> object as the source of its information, so attempting to reorder the <code>ops.CreateTableOp.columns</code> collection will usually have no effect. Instead, a new <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.CreateTableOp">ops.CreateTableOp</a></strong> object may be constructed with the new ordering. However, a second issue is that the <code>Column</code> objects inside will already be associated with the <code>Table</code> that is from the model being autogenerated, meaning they can’t be reassigned directly to a new <code>Table</code>. To get around this, we can copy all the columns and constraints using methods like <code>Column</code>.copy().</p>
<p>Below we use <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> to create a new <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.CreateTableOp">ops.CreateTableOp</a></strong> directive and to copy the <code>Column</code> objects from one into another, copying each column or constraint object and applying a new sorting scheme:</p>
<pre><code class="language-python"># in env.py

from alembic.operations import ops
from alembic.autogenerate import rewriter

writer = rewriter.Rewriter()

@writer.rewrites(ops.CreateTableOp)
def order_columns(context, revision, op):

    special_names = {&quot;id&quot;: -100, &quot;created_at&quot;: 1001, &quot;updated_at&quot;: 1002}

    cols_by_key = [
        (
            special_names.get(col.key, index)
            if isinstance(col, Column)
            else 2000,
            col.copy(),
        )
        for index, col in enumerate(op.columns)
    ]

    columns = [
        col for idx, col in sorted(cols_by_key, key=lambda entry: entry[0])
    ]
    return ops.CreateTableOp(
        op.table_name, columns, schema=op.schema, **op.kw)


# ...

context.configure(
    # ...
    process_revision_directives=writer
)
</code></pre>
<p>Above, when we apply the <code>writer</code> to a table such as:</p>
<pre><code class="language-python">Table(
    &quot;my_table&quot;,
    m,
    Column(&quot;data&quot;, String(50)),
    Column(&quot;created_at&quot;, DateTime),
    Column(&quot;id&quot;, Integer, primary_key=True),
    Column(&quot;updated_at&quot;, DateTime),
    UniqueConstraint(&quot;data&quot;, name=&quot;uq_data&quot;)
)
</code></pre>
<p>This will render in the autogenerated file as:</p>
<pre><code class="language-python">def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        &quot;my_table&quot;,
        sa.Column(&quot;id&quot;, sa.Integer(), nullable=False),
        sa.Column(&quot;data&quot;, sa.String(length=50), nullable=True),
        sa.Column(&quot;created_at&quot;, sa.DateTime(), nullable=True),
        sa.Column(&quot;updated_at&quot;, sa.DateTime(), nullable=True),
        sa.PrimaryKeyConstraint(&quot;id&quot;),
        sa.UniqueConstraint(&quot;data&quot;, name=&quot;uq_data&quot;),
    )
    # ### end Alembic commands ###
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dont-emit-create-table-statements-for-views"><a class="header" href="#dont-emit-create-table-statements-for-views">Don’t emit CREATE TABLE statements for Views</a></h1>
<p>It is sometimes convenient to create <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> instances for views so that they can be queried using normal SQLAlchemy techniques. Unfortunately this causes Alembic to treat them as tables in need of creation and to generate spurious <code>create_table()</code> operations. This is easily fixable by flagging such Tables and using the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">include_object</a></strong> hook to exclude them:</p>
<pre><code class="language-python">my_view = Table('my_view', metadata, autoload=True, info=dict(is_view=True))    # Flag this as a view
</code></pre>
<p>Then define <code>include_object</code> as:</p>
<pre><code class="language-python">def include_object(object, name, type_, reflected, compare_to):
    &quot;&quot;&quot;
    Exclude views from Alembic's consideration.
    &quot;&quot;&quot;

    return not object.info.get('is_view', False)
</code></pre>
<p>Finally, in <code>env.py</code> pass your <code>include_object</code> as a keyword argument to <strong><a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-multiple-alembic-environments-from-one-ini-file"><a class="header" href="#run-multiple-alembic-environments-from-one-ini-file">Run Multiple Alembic Environments from one .ini file</a></h1>
<p>Long before Alembic had the “multiple bases” feature described in <strong><a href="zh/../en/branches.html#multiple-bases">Working with Multiple Bases</a></strong>, projects had a need to maintain more than one Alembic version history in a single project, where these version histories are completely independent of each other and each refer to their own alembic_version table, either across multiple databases, schemas, or namespaces. A simple approach was added to support this, the <code>--name</code> flag on the commandline.</p>
<p>First, one would create an alembic.ini file of this form:</p>
<pre><code class="language-ini">[DEFAULT]
# all defaults shared between environments go here

sqlalchemy.url = postgresql://scott:tiger@hostname/mydatabase


[schema1]
# path to env.py and migration scripts for schema1
script_location = myproject/revisions/schema1

[schema2]
# path to env.py and migration scripts for schema2
script_location = myproject/revisions/schema2

[schema3]
# path to env.py and migration scripts for schema3
script_location = myproject/revisions/db2

# this schema uses a different database URL as well
sqlalchemy.url = postgresql://scott:tiger@hostname/myotherdatabase
</code></pre>
<p>Above, in the <code>[DEFAULT]</code> section we set up a default database URL. Then we create three sections corresponding to different revision lineages in our project. Each of these directories would have its own <code>env.py</code> and set of versioning files. Then when we run the <code>alembic</code> command, we simply give it the name of the configuration we want to use:</p>
<pre><code class="language-bash">alembic --name schema2 revision -m &quot;new rev for schema 2&quot; --autogenerate
</code></pre>
<p>Above, the <code>alembic</code> command makes use of the configuration in <code>[schema2]</code>, populated with defaults from the <code>[DEFAULT]</code> section.</p>
<p>The above approach can be automated by creating a custom front-end to the Alembic commandline as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-python-code-to-generate-particular-database-tables"><a class="header" href="#print-python-code-to-generate-particular-database-tables">Print Python Code to Generate Particular Database Tables</a></h1>
<p>Suppose you have a database already, and want to generate some <code>op.create_table()</code> and other directives that you’d have in a migration file. How can we automate generating that code? Suppose the database schema looks like (assume MySQL):</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS `users` (
    `id` int(11) NOT NULL,
    KEY `id` (`id`)
);

CREATE TABLE IF NOT EXISTS `user_properties` (
  `users_id` int(11) NOT NULL,
  `property_name` varchar(255) NOT NULL,
  `property_value` mediumtext NOT NULL,
  UNIQUE KEY `property_name_users_id` (`property_name`,`users_id`),
  KEY `users_id` (`users_id`),
  CONSTRAINT `user_properties_ibfk_1` FOREIGN KEY (`users_id`)
  REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

</code></pre>
<p>Using <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.UpgradeOps">ops.UpgradeOps</a></strong>, <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.CreateTableOp">ops.CreateTableOp</a></strong>, and <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.CreateIndexOp">ops.CreateIndexOp</a></strong>, we create a migration file structure, using <code>Table</code> objects that we get from SQLAlchemy reflection. The structure is passed to <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.render_python_code">autogenerate.render_python_code()</a></strong> to produce the Python code for a migration file:</p>
<pre><code class="language-python">from sqlalchemy import create_engine
from sqlalchemy import MetaData, Table
from alembic import autogenerate
from alembic.operations import ops

e = create_engine(&quot;mysql://scott:tiger@localhost/test&quot;)

with e.connect() as conn:
    m = MetaData()
    user_table = Table('users', m, autoload_with=conn)
    user_property_table = Table('user_properties', m, autoload_with=conn)

print(autogenerate.render_python_code(
    ops.UpgradeOps(
        ops=[
            ops.CreateTableOp.from_table(table) for table in m.tables.values()
        ] + [
            ops.CreateIndexOp.from_index(idx) for table in m.tables.values()
            for idx in table.indexes
        ]
    ))
)
</code></pre>
<p>Output:</p>
<pre><code class="language-python"># ### commands auto generated by Alembic - please adjust! ###
op.create_table('users',
sa.Column('id', mysql.INTEGER(display_width=11), autoincrement=False, nullable=False),
mysql_default_charset='latin1',
mysql_engine='InnoDB'
)
op.create_table('user_properties',
sa.Column('users_id', mysql.INTEGER(display_width=11), autoincrement=False, nullable=False),
sa.Column('property_name', mysql.VARCHAR(length=255), nullable=False),
sa.Column('property_value', mysql.MEDIUMTEXT(), nullable=False),
sa.ForeignKeyConstraint(['users_id'], ['users.id'], name='user_properties_ibfk_1', ondelete='CASCADE'),
mysql_comment='user properties',
mysql_default_charset='utf8',
mysql_engine='InnoDB'
)
op.create_index('id', 'users', ['id'], unique=False)
op.create_index('users_id', 'user_properties', ['users_id'], unique=False)
op.create_index('property_name_users_id', 'user_properties', ['property_name', 'users_id'], unique=True)
# ### end Alembic commands ###
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-alembic-operation-objects-directly-as-in-from-autogenerate"><a class="header" href="#run-alembic-operation-objects-directly-as-in-from-autogenerate">Run Alembic Operation Objects Directly (as in from autogenerate)</a></h1>
<p>The <strong><a href="zh/../en/ops.html#alembic.operations.Operations">Operations</a></strong> object has a method known as <strong><a href="zh/../en/ops.html#alembic.operations.Operations">Operations</a></strong>.invoke() that will generically invoke a particular operation object. We can therefore use the <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.produce_migrations">autogenerate.produce_migrations()</a></strong> function to run an autogenerate comparison, get back a <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.MigrationScript">ops.MigrationScript</a></strong> structure representing the changes, and with a little bit of insider information we can invoke them directly.</p>
<p>The traversal through the <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.MigrationScript">ops.MigrationScript</a></strong> structure is as follows:</p>
<pre><code class="language-python">use_batch = engine.name == &quot;sqlite&quot;

stack = [migrations.upgrade_ops]
while stack:
    elem = stack.pop(0)

    if use_batch and isinstance(elem, ModifyTableOps):
        with operations.batch_alter_table(
            elem.table_name, schema=elem.schema
        ) as batch_ops:
            for table_elem in elem.ops:
                # work around Alembic issue #753 (fixed in 1.5.0)
                if hasattr(table_elem, &quot;column&quot;):
                    table_elem.column = table_elem.column.copy()
                batch_ops.invoke(table_elem)

    elif hasattr(elem, &quot;ops&quot;):
        stack.extend(elem.ops)
    else:
        # work around Alembic issue #753 (fixed in 1.5.0)
        if hasattr(elem, &quot;column&quot;):
            elem.column = elem.column.copy()
        operations.invoke(elem)
</code></pre>
<p>Above, we detect elements that have a collection of operations by looking for the <code>.ops</code> attribute. A check for <strong><a href="zh/../en/api/operations.html#alembic.operations.ops.ModifyTableOps">ModifyTableOps</a></strong> allows us to use a batch context if we are supporting that. Finally there’s a workaround for an Alembic issue that exists for SQLAlchemy 1.3.20 and greater combined with Alembic older than 1.5.</p>
<p>A full example follows. The overall setup here is copied from the example at <strong><a href="zh/../en/api/autogenerate.html#alembic.autogenerate.compare_metadata">autogenerate.compare_metadata()</a></strong>:</p>
<pre><code class="language-python">from sqlalchemy import Column
from sqlalchemy import create_engine
from sqlalchemy import Integer
from sqlalchemy import MetaData
from sqlalchemy import String
from sqlalchemy import Table

from alembic.autogenerate import produce_migrations
from alembic.migration import MigrationContext
from alembic.operations import Operations
from alembic.operations.ops import ModifyTableOps


engine = create_engine(&quot;sqlite://&quot;, echo=True)

with engine.connect() as conn:
    conn.execute(
        &quot;&quot;&quot;
        create table foo (
            id integer not null primary key,
            old_data varchar(50),
            x integer
        )&quot;&quot;&quot;
    )

    conn.execute(
        &quot;&quot;&quot;
        create table bar (
            data varchar(50)
        )&quot;&quot;&quot;
    )

metadata = MetaData()
Table(
    &quot;foo&quot;,
    metadata,
    Column(&quot;id&quot;, Integer, primary_key=True),
    Column(&quot;data&quot;, Integer),
    Column(&quot;x&quot;, Integer, nullable=False),
)
Table(&quot;bat&quot;, metadata, Column(&quot;info&quot;, String(100)))

mc = MigrationContext.configure(engine.connect())

migrations = produce_migrations(mc, metadata)

operations = Operations(mc)

use_batch = engine.name == &quot;sqlite&quot;

stack = [migrations.upgrade_ops]
while stack:
    elem = stack.pop(0)

    if use_batch and isinstance(elem, ModifyTableOps):
        with operations.batch_alter_table(
            elem.table_name, schema=elem.schema
        ) as batch_ops:
            for table_elem in elem.ops:
                # work around Alembic issue #753 (fixed in 1.5.0)
                if hasattr(table_elem, &quot;column&quot;):
                    table_elem.column = table_elem.column.copy()
                batch_ops.invoke(table_elem)

    elif hasattr(elem, &quot;ops&quot;):
        stack.extend(elem.ops)
    else:
        # work around Alembic issue #753 (fixed in 1.5.0)
        if hasattr(elem, &quot;column&quot;):
            elem.column = elem.column.copy()
        operations.invoke(elem)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-current-database-revision-is-at-heads"><a class="header" href="#test-current-database-revision-is-at-heads">Test current database revision is at head(s)</a></h1>
<p>A recipe to determine if a database schema is up to date in terms of applying Alembic migrations. May be useful for test or installation suites to determine if the target database is up to date. Makes use of the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext.get_current_heads">MigrationContext.get_current_heads()</a></strong> as well as <strong><a href="zh/../en/api/script.html#alembic.script.ScriptDirectory.get_heads">ScriptDirectory.get_heads()</a></strong> methods so that it accommodates for a branched revision tree:</p>
<pre><code class="language-python">from alembic import config, script
from alembic.runtime import migration
from sqlalchemy import engine


def check_current_head(alembic_cfg, connectable):
    # type: (config.Config, engine.Engine) -&gt; bool
    directory = script.ScriptDirectory.from_config(alembic_cfg)
    with connectable.begin() as connection:
        context = migration.MigrationContext.configure(connection)
        return set(context.get_current_heads()) == set(directory.get_heads())

e = engine.create_engine(&quot;mysql://scott:tiger@localhost/test&quot;, echo=True)
cfg = config.Config(&quot;alembic.ini&quot;)
print(check_current_head(cfg, e))
</code></pre>
<p><strong>See also:</strong></p>
<ul>
<li>
<p><strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext.get_current_heads">MigrationContext.get_current_heads()</a></strong></p>
</li>
<li>
<p><strong><a href="zh/../en/api/script.html#alembic.script.ScriptDirectory.get_heads">ScriptDirectory.get_heads()</a></strong></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-asyncio-with-alembic"><a class="header" href="#using-asyncio-with-alembic">Using Asyncio with Alembic</a></h1>
<p>SQLAlchemy version 1.4 introduced experimental support for asyncio, allowing use of most of its interface from async applications. Alembic currently does not provide an async api directly, but it can use an use SQLAlchemy Async engine to run the migrations and autogenerate.</p>
<p>New configurations can use the template “async” to bootstrap an environment which can be used with async DBAPI like asyncpg, running the command:</p>
<pre><code class="language-bash">alembic init -t async &lt;script_directory_here&gt;
</code></pre>
<p>Existing configurations can be updated to use an async DBAPI by updating the <code>env.py</code> file that’s used by Alembic to start its operations. In particular only <code>run_migrations_online</code> will need to be updated to be something like the example below:</p>
<pre><code class="language-python">import asyncio

# ... no change required to the rest of the code


def do_run_migrations(connection):
    context.configure(connection=connection, target_metadata=target_metadata)

    with context.begin_transaction():
        context.run_migrations()


async def run_migrations_online():
    &quot;&quot;&quot;Run migrations in 'online' mode.

    In this scenario we need to create an Engine
    and associate a connection with the context.

    &quot;&quot;&quot;
    connectable = AsyncEngine(
        engine_from_config(
            config.get_section(config.config_ini_section),
            prefix=&quot;sqlalchemy.&quot;,
            poolclass=pool.NullPool,
            future=True,
        )
    )

    async with connectable.connect() as connection:
        await connection.run_sync(do_run_migrations)


if context.is_offline_mode():
    run_migrations_offline()
else:
    asyncio.run(run_migrations_online())
</code></pre>
<p>An asnyc application can also interact with the Alembic api directly by using the SQLAlchemy <code>run_sync</code> method to adapt the non-async api of Alembic to an async consumer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="api-details"><a class="header" href="#api-details">API Details</a></h1>
<p><strong>API详细</strong></p>
<p>Alembic’s internal API has many public integration points that can be used to extend Alembic’s functionality as well as to re-use its functionality in new ways. As the project has grown, more APIs are created and exposed for this purpose.</p>
<p>Direct use of the vast majority of API details discussed here is not needed for rudimentary use of Alembic; the only API that is used normally by end users is the methods provided by the <strong><a href="zh/../en/ops.html#alembic.operations.Operations">Operations</a></strong> class, which is discussed outside of this subsection, and the parameters that can be passed to the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> method, used when configuring one’s <code>env.py</code> environment. However, real-world applications will usually end up using more of the internal API, in particular being able to run commands programmatically, as discussed in the section <strong><a href="zh/../en/commands.html">Commands</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<blockquote>
<p><strong>Note:</strong> this section is a technical overview of the <strong>internal API of Alembic</strong>. This section is only useful for developers who wish to extend the capabilities of Alembic; for regular users, reading this section is <strong>not necessary</strong>.</p>
</blockquote>
<p>A visualization of the primary features of Alembic’s internals is presented in the following figure. The module and class boxes do not list out all the operations provided by each unit; only a small set of representative elements intended to convey the primary purpose of each system.</p>
<p><img src="zh/../zh/images/api_overview.png" alt="api overview" /></p>
<p>The script runner for Alembic is present in the <strong><a href="zh/../en/config.html#alembic-config-toplevel">Configuration</a></strong> module. This module produces a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object and passes it to the appropriate function in <strong><a href="zh/../en/commands.html#alembic-command-toplevel">Commands</a></strong>. Functions within <strong><a href="zh/../en/commands.html#alembic-command-toplevel">Commands</a></strong> will typically instantiate an <strong><a href="zh/../en/script.html#alembic.script.ScriptDirectory">ScriptDirectory</a></strong> instance, which represents the collection of version files, and an <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong>, which is a configurational facade passed to the environment’s <code>env.py</code> script.</p>
<p>The <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> object is the primary object used within the <code>env.py</code> script, whose main purpose is that of a facade for creating and using a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> object, which is the actual migration engine that refers to a database implementation. The primary method called on this object within an <code>env.py</code> script is the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong>.configure() method, which sets up the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> with database connectivity and behavioral configuration. It also supplies methods for transaction demarcation and migration running, but these methods ultimately call upon the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> that’s been configured.</p>
<p>MigrationContext is the gateway to the database for other parts of the application, and produces a <strong><a href="zh/../en/ddl.html#alembic.ddl.impl.DefaultImpl">DefaultImpl</a></strong> object which does the actual database communication, and knows how to create the specific SQL text of the various DDL directives such as ALTER TABLE; <strong><a href="zh/../en/ddl.html#alembic.ddl.impl.DefaultImpl">DefaultImpl</a></strong> has subclasses that are per-database-backend. In “offline” mode (e.g. <code>--sql</code>), the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> will produce SQL to a file output stream instead of a database.</p>
<p>During an upgrade or downgrade operation, a specific series of migration scripts are invoked starting with the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> in conjunction with the ScriptDirectory; the actual scripts themselves make use of the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> object, which provide the end-user interface to specific database operations. The <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> object is generated based on a series of “operation directive” objects that are user-extensible, and start out in the <strong><a href="zh/../en/operations.html#alembic-operations-ops-toplevel">Built-in Operation Objects</a></strong> module.</p>
<p>Another prominent feature of Alembic is the “autogenerate” feature, which produces new migration scripts that contain Python code. The autogenerate feature starts in <strong><a href="zh/../en/autogenerate.html#alembic-autogenerate-toplevel">Autogeneration</a></strong>, and is used exclusively by the <strong><a href="zh/../en/commands.html#alembic.command.revision">alembic.command.revision()</a></strong> command when the <code>--autogenerate</code> flag is passed. Autogenerate refers to the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> and <strong><a href="zh/../en/ddl.html#alembic.ddl.impl.DefaultImpl">DefaultImpl</a></strong> in order to access database connectivity and access per-backend rules for autogenerate comparisons. It also makes use of <strong><a href="zh/../en/operations.html#alembic-operations-ops-toplevel">Built-in Operation Objects</a></strong> in order to represent the operations that it will render into scripts.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="runtime-objects"><a class="header" href="#runtime-objects">Runtime Objects</a></h1>
<p>The “runtime” of Alembic involves the <strong><a href="zh/08_02_runtime_objects.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> and <strong><a href="zh/08_02_runtime_objects.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> objects. These are the objects that are in play once the <code>env.py</code> script is loaded up by a command and a migration operation proceeds.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="the-environment-context"><a class="header" href="#the-environment-context">The Environment Context</a></h2>
<p>The <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> class provides most of the API used within an <code>env.py</code> script. Within <code>env.py</code>, the instantated <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> is made available via a special proxy module called <code>alembic.context</code>. That is, you can import <code>alembic.context</code> like a regular Python module, and each name you call upon it is ultimately routed towards the current <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> in use.</p>
<p>In particular, the key method used within <code>env.py</code> is <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong>, which establishes all the details about how the database will be accessed.</p>
<h3 id="class-alembicruntimeenvironmentenvironmentcontextconfig-config-script-scriptdirectory-kw"><a class="header" href="#class-alembicruntimeenvironmentenvironmentcontextconfig-config-script-scriptdirectory-kw"><em>class</em> alembic.runtime.environment.<strong>EnvironmentContext</strong>(<em>config</em>: Config, <em>script</em>: ScriptDirectory, <em>**kw</em>)</a></h3>
<p>A configurational facade made available in an <code>env.py</code> script.</p>
<p>The <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> acts as a facade to the more nuts-and-bolts objects of <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> as well as certain aspects of <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong>, within the context of the <code>env.py</code> script that is invoked by most Alembic commands.</p>
<p>EnvironmentContext is normally instantiated when a command in <strong><a href="zh/../en/commands.html#module-alembic.command">alembic.command</a></strong> is run. It then makes itself available in the <code>alembic.context</code> module for the scope of the command. From within an <code>env.py</code> script, the current <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> is available by importing this module.</p>
<p>EnvironmentContext also supports programmatic usage. At this level, it acts as a Python context manager, that is, is intended to be used using the <code>with:</code> statement. A typical use of <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong>:</p>
<pre><code class="language-python">from alembic.config import Config
from alembic.script import ScriptDirectory

config = Config()
config.set_main_option(&quot;script_location&quot;, &quot;myapp:migrations&quot;)
script = ScriptDirectory.from_config(config)

def my_function(rev, context):
    '''do something with revision &quot;rev&quot;, which
    will be the current database revision,
    and &quot;context&quot;, which is the MigrationContext
    that the env.py will create'''

with EnvironmentContext(
    config,
    script,
    fn = my_function,
    as_sql = False,
    starting_rev = 'base',
    destination_rev = 'head',
    tag = &quot;sometag&quot;
):
    script.run_env()
</code></pre>
<p>The above script will invoke the <code>env.py</code> script within the migration environment. If and when <code>env.py</code> calls <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.migration.MigrationContext.run_migrations">MigrationContext.run_migrations()</a></strong>, the <code>my_function()</code> function above will be called by the <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>, given the context itself as well as the current revision in the database.</p>
<blockquote>
<p><strong>Note:</strong> For most API usages other than full blown invocation of migration scripts, the <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> and <strong><a href="zh/../en/script.html#alembic.script.ScriptDirectory">ScriptDirectory</a></strong> objects can be created and used directly. The <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> object is only needed when you need to actually invoke the <code>env.py</code> module present in the migration environment.</p>
</blockquote>
<p>Construct a new <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong>.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>script</strong></em> – a <strong><a href="zh/../en/script.html#alembic.script.ScriptDirectory">ScriptDirectory</a></strong> instance.</li>
<li><em><strong>**kw</strong></em> – keyword options that will be ultimately passed along to the <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> when <strong><a href="zh/08_02_01_the_environment_context.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> is called.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="begin_transaction"><a class="header" href="#begin_transaction">begin_transaction</a></h1>
<p><strong>begin_transaction</strong>() → Union[_ProxyTransaction, AbstractContextManager]</p>
<p>Return a context manager that will enclose an operation within a “transaction”, as defined by the environment’s offline and transactional DDL settings.</p>
<p>e.g.:</p>
<pre><code class="language-python">with context.begin_transaction():
    context.run_migrations()
</code></pre>
<p>begin_transaction() is intended to “do the right thing” regardless of calling context:</p>
<ul>
<li>If <strong><a href="zh/08_02_01_01_begin_transaction.html#alembic.runtime.environment.EnvironmentContext.is_transactional_ddl">is_transactional_ddl()</a></strong> is <code>False</code>, returns a “do nothing” context manager which otherwise produces no transactional state or directives.</li>
<li>If <strong><a href="zh/08_02_01_01_begin_transaction.html#alembic.runtime.environment.EnvironmentContext.is_offline_mode">is_offline_mode()</a></strong> is <code>True</code>, returns a context manager that will invoke the <strong><a href="zh/../en/ddl.html#alembic.ddl.impl.DefaultImpl.emit_begin">DefaultImpl.emit_begin()</a></strong> and <strong><a href="zh/../en/ddl.html#alembic.ddl.impl.DefaultImpl.emit_commit">DefaultImpl.emit_commit()</a></strong> methods, which will produce the string directives <code>BEGIN</code> and <code>COMMIT</code> on the output stream, as rendered by the target backend (e.g. SQL Server would emit <code>BEGIN</code> TRANSACTION).</li>
<li>Otherwise, calls <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection.begin">sqlalchemy.engine.Connection.begin()</a></strong> on the current online connection, which returns a <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Transaction">sqlalchemy.engine.Transaction</a></strong> object. This object demarcates a real transaction and is itself a context manager, which will roll back if an exception is raised.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> that a custom <code>env.py</code> script which has more specific transactional needs can of course manipulate the <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> directly to produce transactional state in “online” mode.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config"><a class="header" href="#config">config</a></h1>
<p><strong>config</strong>: Config = None</p>
<p>An instance of <a href="zh/../en/api/config.html#alembic.config.Config">Config</a> representing the configuration file contents as well as other variables set programmatically within it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configure"><a class="header" href="#configure">configure</a></h1>
<p><strong>configure</strong>(<em>connection</em>:  Optional[Connection] = None, <em>url</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>dialect_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>dialect_opts</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>] = None, <em>transactional_ddl</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>transaction_per_migration</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>output_buffer</em>:  Optional[TextIO] = None, <em>starting_rev</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>tag</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>template_args</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>] = None, <em>render_as_batch</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>target_metadata</em>:  Optional[MetaData] = None, <em>include_name</em>:  Optional[Callable] = None, <em>include_object</em>:  Optional[Callable] = None, <em>include_schemas</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>process_revision_directives</em>:  Optional[Callable] = None, <em>compare_type</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>compare_server_default</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>render_item</em>:  Optional[Callable] = None, <em>literal_binds</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>upgrade_token</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'upgrades', <em>downgrade_token</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'downgrades', <em>alembic_module_prefix</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'op.', <em>sqlalchemy_module_prefix</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'sa.', <em>user_module_prefix</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>on_version_apply</em>:  Optional[Callable] = None, **kw) → None</p>
<p>Configure a <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> within this <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> which will provide database connectivity and other configuration to a series of migration scripts.</p>
<p>Many methods on <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong> require that this method has been called in order to function, as they ultimately need to have database access or at least access to the dialect in use. Those which do are documented as such.</p>
<p>The important thing needed by <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure">configure()</a></strong> is a means to determine what kind of database dialect is in use. An actual connection to that database is needed only if the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> is to be used in “online” mode.</p>
<p>If the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.is_offline_mode">is_offline_mode()</a></strong> function returns <code>True</code>, then no <code>connection</code> is needed here. Otherwise, the <code>connection</code> parameter should be present as an instance of <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">sqlalchemy.engine.Connection</a></strong>.</p>
<p>This function is typically called from the <code>env.py</code> script within a migration environment. It can be called multiple times for an invocation. The most recent <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> for which it was called is the one that will be operated upon by the next call to <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.run_migrations">run_migrations()</a></strong>.</p>
<p><strong>General parameters</strong>:</p>
<ul>
<li><em><strong>connection</strong></em> – a <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> to use for SQL execution in “online” mode. When present, is also used to determine the type of dialect in use.</li>
<li><em><strong>url</strong></em> – a string database <strong>url</strong>, or a <strong><a href="https://docs.sqlalchemy.org/en/14/core/engines.html#sqlalchemy.engine.URL">sqlalchemy.engine.url.URL</a></strong> object. The type of dialect to be used will be derived from this if <code>connection</code> is not passed.</li>
<li><em><strong>dialect_name</strong></em> – string name of a dialect, such as “postgresql”, “mssql”, etc. The type of dialect to be used will be derived from this if <code>connection</code> and <code>url</code> are not passed.</li>
<li><em><strong>dialect_opts</strong></em> – dictionary of options to be passed to dialect constructor.
<blockquote>
<p><em>New in version 1.0.12.</em></p>
</blockquote>
</li>
<li><em><strong>transactional_ddl</strong></em> – Force the usage of “transactional” DDL on or off; this otherwise defaults to whether or not the dialect in use supports it.</li>
<li><em><strong>transaction_per_migration</strong></em> – if True, nest each migration script in a transaction rather than the full series of migrations to run.</li>
<li><em><strong>output_buffer</strong></em> – a file-like object that will be used for textual output when the <code>--sql</code> option is used to generate SQL scripts. Defaults to <code>sys.stdout</code> if not passed here and also not present on the <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object. The value here overrides that of the <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object.</li>
<li><em><strong>output_encoding</strong></em> – when using <code>--sql</code> to generate SQL scripts, apply this encoding to the string output.</li>
<li><em><strong>literal_binds</strong></em> – when using <code>--sql</code> to generate SQL scripts, pass through the <code>literal_binds</code> flag to the compiler so that any literal values that would ordinarily be bound parameters are converted to plain strings.
<blockquote>
<p><strong>Warning:</strong> Dialects can typically only handle simple datatypes like strings and numbers for auto-literal generation. Datatypes like dates, intervals, and others may still require manual formatting, typically using <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.inline_literal">Operations.inline_literal()</a></strong>.</p>
<p><strong>Note:</strong> the <code>literal_binds</code> flag is ignored on SQLAlchemy versions prior to 0.8 where this feature is not supported.</p>
<p><strong>See also:</strong> <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.inline_literal">Operations.inline_literal()</a></strong></p>
</blockquote>
</li>
<li><em><strong>starting_rev</strong></em> – Override the “starting revision” argument when using <code>--sql</code> mode.</li>
<li><em><strong>tag</strong></em> – a string <strong>tag</strong> for usage by custom <code>env.py</code> scripts. Set via the <code>--tag</code> option, can be overridden here.</li>
<li><em><strong>template_args</strong></em> – dictionary of template arguments which will be added to the template argument environment when running the “revision” command. Note that the script environment is only run within the “revision” command if the –autogenerate option is used, or if the option “revision_environment=true” is present in the alembic.ini file.</li>
<li><em><strong>version_table</strong></em> – The name of the Alembic version table. The default is <code>'alembic_version'</code>.</li>
<li><em><strong>version_table_schema</strong></em> – Optional schema to place version table within.</li>
<li><em><strong>version_table_pk</strong></em> – boolean, whether the Alembic version table should use a primary key constraint for the “value” column; this only takes effect when the table is first created. Defaults to True; setting to False should not be necessary and is here for backwards compatibility reasons.</li>
<li><em><strong>on_version_apply</strong></em> – a callable or collection of callables to be run for each migration step. The callables will be run in the order they are given, once for each migration step, after the respective operation has been applied but before its transaction is finalized. Each callable accepts no positional arguments and the following keyword arguments:
<ul>
<li>ctx: the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> running the migration,</li>
<li>step: a <code>MigrationInfo</code> representing the <code>step</code> currently being applied,</li>
<li>heads: a collection of version strings representing the current <code>heads</code>,</li>
<li>run_args: the <code>**kwargs</code> passed to <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.run_migrations">run_migrations()</a></strong>.</li>
</ul>
</li>
</ul>
<p><strong>Parameters specific</strong> to the autogenerate feature, when <code>alembic revision</code> is run with the <code>--autogenerate</code> feature:</p>
<ul>
<li>
<p><em><strong>target_metadata</strong></em> – a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">sqlalchemy.schema.MetaData</a></strong> object, or a sequence of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> objects, that will be consulted during autogeneration. The tables present in each <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> will be compared against what is locally available on the target <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> to produce candidate upgrade/downgrade operations.</p>
</li>
<li>
<p><em><strong>compare_type</strong></em> – Indicates type comparison behavior during an autogenerate operation. Defaults to <code>False</code> which disables type comparison. Set to <code>True</code> to turn on default type comparison, which has varied accuracy depending on backend. See <strong><a href="zh/../en/../autogenerate.html#compare-types">Comparing Types</a></strong> for an example as well as information on other type comparison options.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#compare-types">Comparing Types</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_server_default">EnvironmentContext.configure.compare_server_default</a></strong></p>
</blockquote>
</li>
<li>
<p><em><strong>compare_server_default</strong></em> – Indicates server default comparison behavior during an autogenerate operation. Defaults to <code>False</code> which disables server default comparison. Set to <code>True</code> to turn on server default comparison, which has varied accuracy depending on backend.</p>
<p>To customize server default comparison behavior, a callable may be specified which can filter server default comparisons during an autogenerate operation. defaults during an autogenerate operation. The format of this callable is:</p>
<pre><code class="language-python">def my_compare_server_default(context, inspected_column,
            metadata_column, inspected_default, metadata_default,
            rendered_metadata_default):
    # return True if the defaults are different,
    # False if not, or None to allow the default implementation
    # to compare these defaults
    return None

context.configure(
    # ...
    compare_server_default = my_compare_server_default
)
</code></pre>
<p>inspected_column is a dictionary structure as returned by <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_columns">sqlalchemy.engine.reflection.Inspector.get_columns()</a></strong>, whereas <code>metadata_column</code> is a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">sqlalchemy.schema.Column</a></strong> from the local model environment.</p>
<p>A return value of <code>None</code> indicates to allow default server default comparison to proceed. Note that some backends such as Postgresql actually execute the two defaults on the database side to compare for equivalence.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">EnvironmentContext.configure.compare_type</a></strong></p>
</blockquote>
</li>
<li>
<p><em><strong>include_name</strong></em> – A callable function which is given the chance to return <code>True</code> or <code>False</code> for any database reflected object based on its name, including database schema names when the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> flag is set to <code>True</code>.</p>
<p>The function accepts the following positional arguments:</p>
<ul>
<li>
<p>name: the <code>name</code> of the object, such as schema <code>name</code> or table <code>name</code>. Will be <code>None</code> when indicating the default schema <code>name</code> of the database connection.</p>
</li>
<li>
<p>type: a string describing the <code>type</code> of object; currently <code>&quot;schema&quot;</code>, <code>&quot;table&quot;</code>, <code>&quot;column&quot;</code>, <code>&quot;index&quot;</code>, <code>&quot;unique_constraint&quot;</code>, or &quot;foreign_key_constraint&quot;</p>
</li>
<li>
<p>parent_names: a dictionary of “parent” object names, that are relative to the name being given. Keys in this dictionary may include: <code>&quot;schema_name&quot;</code>, <code>&quot;table_name&quot;</code>.</p>
<p>E.g.:</p>
<pre><code class="language-python">def include_name(name, type_, parent_names):
    if type_ == &quot;schema&quot;:
        return name in [&quot;schema_one&quot;, &quot;schema_two&quot;]
    else:
        return True

context.configure(
    # ...
    include_schemas = True,
    include_name = include_name
)
</code></pre>
<blockquote>
<p><em>New in version 1.5.</em></p>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#autogenerate-include-hooks">Controlling What to be Autogenerated</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><em><strong>include_object</strong></em> – A callable function which is given the chance to return <code>True</code> or <code>False</code> for any object, indicating if the given object should be considered in the autogenerate sweep.</p>
<p>The function accepts the following positional arguments:</p>
<ul>
<li>
<p>object: a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.SchemaItem">SchemaItem</a></strong> <code>object</code> such as a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.Index">Index</a></strong> <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.UniqueConstraint">UniqueConstraint</a></strong>, or <strong><a href="https://docs.sqlalchemy.org/en/14/core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint">ForeignKeyConstraint</a></strong> object</p>
</li>
<li>
<p>name: the <code>name</code> of the object. This is typically available via <code>object.name</code>.</p>
</li>
<li>
<p>type: a string describing the <code>type</code> of object; currently <code>&quot;table&quot;</code>, <code>&quot;column&quot;</code>, <code>&quot;index&quot;</code>, <code>&quot;unique_constraint&quot;</code>, or &quot;foreign_key_constraint&quot;</p>
</li>
<li>
<p>reflected: <code>True</code> if the given object was produced based on table reflection, <code>False</code> if it’s from a local <code>MetaData</code> object.</p>
</li>
<li>
<p>compare_to: the object being compared against, if available, else <code>None</code>.
E.g.:</p>
<pre><code class="language-python">def include_object(object, name, type_, reflected, compare_to):
    if (type_ == &quot;column&quot; and
        not reflected and
        object.info.get(&quot;skip_autogenerate&quot;, False)):
        return False
    else:
        return True

context.configure(
    # ...
    include_object = include_object
)
</code></pre>
<p>For the use case of omitting specific schemas from a target database when <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong> is set to <code>True</code>, the <code>schema</code> attribute can be checked for each <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> object passed to the hook, however it is much more efficient to filter on schemas before reflection of objects takes place using the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> hook.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#autogenerate-include-hooks">Controlling What to be Autogenerated</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">EnvironmentContext.configure.include_schemas</a></strong></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><em><strong>render_as_batch</strong></em> <a name="render_as_batch"></a> – if True, commands which alter elements within a table will be placed under a <code>with batch_alter_table():</code> directive, so that batch migrations will take place.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/../batch.html#batch-migrations">Running “Batch” Migrations for SQLite and Other Databases</a></strong></p>
</blockquote>
</li>
<li>
<p><em><strong>include_schemas</strong></em> – If True, autogenerate will scan across all schemas located by the SQLAlchemy <strong><a href="https://docs.sqlalchemy.org/en/14/core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_schema_names">get_schema_names()</a></strong> method, and include all differences in tables found across all those schemas. When using this option, you may want to also use the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> parameter to specify a callable which can filter the tables/schemas that get included.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#autogenerate-include-hooks">Controlling What to be Autogenerated</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong></p>
<p><strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong></p>
</blockquote>
</li>
<li>
<p><em><strong>render_item</strong></em> – Callable that can be used to override how any schema item, i.e. column, constraint, type, etc., is rendered for autogenerate. The callable receives a string describing the type of object, the object, and the autogen context. If it returns False, the default rendering method will be used. If it returns None, the item will not be rendered in the context of a Table construct, that is, can be used to skip columns or constraints within op.create_table():</p>
<pre><code class="language-python">def my_render_column(type_, col, autogen_context):
    if type_ == &quot;column&quot; and isinstance(col, MySpecialCol):
        return repr(col)
    else:
        return False

context.configure(
    # ...
    render_item = my_render_column
)
</code></pre>
<p>Available values for the type string include: <code>&quot;column&quot;</code>, <code>&quot;primary_key&quot;</code>, <code>&quot;foreign_key&quot;</code>, <code>&quot;unique&quot;</code>, <code>&quot;check&quot;</code>, <code>&quot;type&quot;</code>, <code>&quot;server_default&quot;</code>.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#autogen-render-types">Affecting the Rendering of Types Themselves</a></strong></p>
</blockquote>
</li>
<li>
<p><em><strong>upgrade_token</strong></em> – When autogenerate completes, the text of the candidate upgrade operations will be present in this template variable when <code>script.py.mako</code> is rendered. Defaults to <code>upgrades</code>.</p>
</li>
<li>
<p><em><strong>downgrade_token</strong></em> – When autogenerate completes, the text of the candidate downgrade operations will be present in this template variable when <code>script.py.mako</code> is rendered. Defaults to <code>downgrades</code>.</p>
</li>
<li>
<p><em><strong>alembic_module_prefix</strong></em> – When autogenerate refers to Alembic <strong><a href="zh/../en/../ops.html#module-alembic.operations">alembic.operations</a></strong> constructs, this prefix will be used (i.e. op.create_table) Defaults to “op.”. Can be <code>None</code> to indicate no prefix.</p>
</li>
<li>
<p><em><strong>sqlalchemy_module_prefix</strong></em> – When autogenerate refers to SQLAlchemy <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> or type classes, this prefix will be used (i.e. sa.Column(&quot;somename&quot;, sa.Integer)) Defaults to “sa.”. Can be <code>None</code> to indicate no prefix. Note that when dialect-specific types are rendered, autogenerate will render them using the dialect module name, i.e. <code>mssql.BIT()</code>, <code>postgresql.UUID()</code>.</p>
</li>
<li>
<p><em><strong>user_module_prefix</strong></em> – When autogenerate refers to a SQLAlchemy type (e.g. TypeEngine) where the module name is not under the <code>sqlalchemy</code> namespace, this prefix will be used within autogenerate. If left at its default of <code>None</code>, the <code>__module__</code> attribute of the type is used to render the import module. It’s a good practice to set this and to have all custom types be available from a fixed module space, in order to future-proof migration files against reorganizations in modules.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#autogen-module-prefix">Controlling the Module Prefix</a></strong></p>
</blockquote>
</li>
<li>
<p><em><strong>process_revision_directives</strong></em> <a name="process_revision_directives"></a> – a callable function that will be passed a structure representing the end result of an autogenerate or plain “revision” operation, which can be manipulated to affect how the <code>alembic revision</code> command ultimately outputs new revision scripts. The structure of the callable is:</p>
<pre><code class="language-python">def process_revision_directives(context, revision, directives):
    pass
</code></pre>
<p>The <code>directives</code> parameter is a Python list containing a single <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> directive, which represents the <code>revision</code> file to be generated. This list as well as its contents may be freely modified to produce any set of commands. The section <strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong> shows an example of doing this. The <code>context</code> parameter is the <strong><a href="zh/08_02_01_02_configure.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> in use, and <code>revision</code> is a tuple of <code>revision</code> identifiers representing the current <code>revision</code> of the database.</p>
<p>The callable is invoked at all times when the <code>--autogenerate</code> option is passed to <code>alembic revision</code>. If <code>--autogenerate</code> is not passed, the callable is invoked only if the <code>revision_environment</code> variable is set to True in the Alembic configuration, in which case the given <code>directives</code> collection will contain empty <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> and <strong><a href="zh/../en/operations.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> collections for <code>.upgrade_ops</code> and <code>.downgrade_ops</code>. The <code>--autogenerate</code> option itself can be inferred by inspecting <code>context.config.cmd_opts.autogenerate</code>.</p>
<p>The callable function may optionally be an instance of a <strong><a href="zh/../en/autogenerate.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> object. This is a helper object that assists in the production of autogenerate-stream rewriter functions.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong></p>
<p><strong><a href="zh/../en/autogenerate.html#autogen-rewriter">Fine-Grained Autogenerate Generation with Rewriters</a></strong></p>
<p><strong><a href="zh/../en/commands.html#alembic.command.revision.params.process_revision_directives">command.revision.process_revision_directives</a></strong></p>
</blockquote>
</li>
</ul>
<p><strong>Parameters specific</strong> to individual backends:</p>
<ul>
<li><em><strong>mssql_batch_separator</strong></em> – The “batch separator” which will be placed between each statement when generating offline SQL Server migrations. Defaults to <code>GO</code>. Note this is in addition to the customary semicolon <code>;</code> at the end of each statement; SQL Server considers the “batch separator” to denote the end of an individual statement execution, and cannot group certain dependent operations in one step.</li>
<li><em><strong>oracle_batch_separator</strong></em> – The “batch separator” which will be placed between each statement when generating offline Oracle migrations. Defaults to <code>/</code>. Oracle doesn’t add a semicolon between statements like most other backends.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execute-1"><a class="header" href="#execute-1">execute</a></h1>
<p><strong>execute</strong>(sql, execution_options=None)</p>
<p>Execute the given SQL using the current change context.</p>
<p>The behavior of <strong><a href="zh/08_02_01_03_execute.html#alembic.runtime.environment.EnvironmentContext.execute">execute()</a></strong> is the same as that of <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.execute">Operations.execute()</a></strong>. Please see that function’s documentation for full detail including caveats and limitations.</p>
<p>This function requires that a <strong><a href="zh/08_02_01_03_execute.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has first been made available via <strong><a href="zh/08_02_01_03_execute.html#alembic.runtime.environment.EnvironmentContext.configure">configure()</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_bind-1"><a class="header" href="#get_bind-1">get_bind</a></h1>
<p><strong>get_bind</strong>()</p>
<p>Return the current ‘bind’.</p>
<p>In “online” mode, this is the <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">sqlalchemy.engine.Connection</a></strong> currently being used to emit SQL to the database.</p>
<p>This function requires that a <strong><a href="zh/08_02_01_04_get_bind.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has first been made available via <strong><a href="zh/08_02_01_04_get_bind.html#alembic.runtime.environment.EnvironmentContext.configure">configure()</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_context-1"><a class="header" href="#get_context-1">get_context</a></h1>
<p><strong>get_context</strong>() → alembic.runtime.migration.MigrationContext</p>
<p>Return the current <strong><a href="zh/08_02_01_05_get_context.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> object.</p>
<p>If <strong><a href="zh/08_02_01_05_get_context.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> has not been called yet, raises an exception.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_head_revision"><a class="header" href="#get_head_revision">get_head_revision</a></h1>
<p><strong>get_head_revision</strong>() → Optional[Union[str, Tuple[str, ...]]]</p>
<p>Return the hex identifier of the ‘head’ script revision.</p>
<p>If the script directory has multiple heads, this method raises a CommandError; <strong><a href="zh/08_02_01_06_get_head_revision.html#alembic.runtime.environment.EnvironmentContext.get_head_revisions">EnvironmentContext.get_head_revisions()</a></strong> should be preferred.</p>
<p>This function does not require that the <strong><a href="zh/08_02_01_06_get_head_revision.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/08_02_01_06_get_head_revision.html#alembic.runtime.environment.EnvironmentContext.get_head_revisions">EnvironmentContext.get_head_revisions()</a></strong> </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_head_revisions"><a class="header" href="#get_head_revisions">get_head_revisions</a></h1>
<p><strong>get_head_revisions</strong>() → Optional[Union[str, Tuple[str, ...]]]</p>
<p>Return the hex identifier of the ‘heads’ script revision(s).</p>
<p>This returns a tuple containing the version number of all heads in the script directory.</p>
<p>This function does not require that the <strong><a href="zh/08_02_01_07_get_head_revisions.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_revision_argument"><a class="header" href="#get_revision_argument">get_revision_argument</a></h1>
<p><strong>get_revision_argument</strong>() → Optional[Union[str, Tuple[str, ...]]]</p>
<p>Get the ‘destination’ revision argument.</p>
<p>This is typically the argument passed to the <code>upgrade</code> or <code>downgrade</code> command.</p>
<p>If it was specified as <code>head</code>, the actual version number is returned; if specified as <code>base</code>, <code>None</code> is returned.</p>
<p>This function does not require that the <strong><a href="zh/08_02_01_08_get_revision_argument.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_starting_revision_argument"><a class="header" href="#get_starting_revision_argument">get_starting_revision_argument</a></h1>
<p><strong>get_starting_revision_argument</strong>() → Optional[Union[str, Tuple[str, ...]]]</p>
<p>Return the ‘starting revision’ argument, if the revision was passed using <code>start:end</code>.</p>
<p>This is only meaningful in “offline” mode. Returns <code>None</code> if no value is available or was configured.</p>
<p>This function does not require that the <strong><a href="zh/08_02_01_09_get_starting_revision_argument.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_tag_argument"><a class="header" href="#get_tag_argument">get_tag_argument</a></h1>
<p><strong>get_tag_argument</strong>() → Optional[str]</p>
<p>Return the value passed for the <code>--tag</code> argument, if any.</p>
<p>The <code>--tag</code> argument is not used directly by Alembic, but is available for custom <code>env.py</code> configurations that wish to use it; particularly for offline generation scripts that wish to generate tagged filenames.</p>
<p>This function does not require that the <strong><a href="zh/08_02_01_10_get_tag_argument.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<p><strong>See also:</strong></p>
<p><a href="zh/08_02_01_10_get_tag_argument.html#alembic.runtime.environment.EnvironmentContext.get_x_argument">EnvironmentContext.get_x_argument()</a> - a newer and more open ended system of extending <code>env.py</code> scripts via the command line.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_x_argument"><a class="header" href="#get_x_argument">get_x_argument</a></h1>
<p><strong>get_x_argument</strong>(<em>as_dictionary</em>:  Literal[False] = False) → List[str]</p>
<p><strong>get_x_argument</strong>(<em>as_dictionary</em>:  Literal[True] = False) → Dict[str, str]</p>
<p>Return the value(s) passed for the <code>-x</code> argument, if any.</p>
<p>The <code>-x</code> argument is an open ended flag that allows any user-defined value or values to be passed on the command line, then available here for consumption by a custom <code>env.py</code> script.</p>
<p>The return value is a list, returned directly from the <code>argparse</code> structure. If <code>as_dictionary=True</code> is passed, the <code>x</code> arguments are parsed using <code>key=value</code> format into a dictionary that is then returned.</p>
<p>For example, to support passing a database URL on the command line, the standard <code>env.py</code> script can be modified like this:</p>
<pre><code class="language-python">cmd_line_url = context.get_x_argument(
    as_dictionary=True).get('dbname')
if cmd_line_url:
    engine = create_engine(cmd_line_url)
else:
    engine = engine_from_config(
            config.get_section(config.config_ini_section),
            prefix='sqlalchemy.',
            poolclass=pool.NullPool)
</code></pre>
<p>This then takes effect by running the <code>alembic</code> script as:</p>
<pre><code class="language-bash">alembic -x dbname=postgresql://user:pass@host/dbname upgrade head
</code></pre>
<p>This function does not require that the <strong><a href="zh/08_02_01_11_get_x_argument.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/08_02_01_11_get_x_argument.html#alembic.runtime.environment.EnvironmentContext.get_tag_argument">EnvironmentContext.get_tag_argument()</a></strong></li>
<li><strong><a href="zh/../en/config.html#alembic.config.Config.cmd_opts">Config.cmd_opts</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="is_offline_mode"><a class="header" href="#is_offline_mode">is_offline_mode</a></h1>
<p><strong>is_offline_mode</strong>() → bool</p>
<p>Return True if the current migrations environment is running in “offline mode”.</p>
<p>This is <code>True</code> or <code>False</code> depending on the <code>--sql</code> flag passed.</p>
<p>This function does not require that the <strong><a href="zh/08_02_01_12_is_offline_mode.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has been configured.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="is_transactional_ddl"><a class="header" href="#is_transactional_ddl">is_transactional_ddl</a></h1>
<p><strong>is_transactional_ddl</strong>()</p>
<p>Return True if the context is configured to expect a transactional DDL capable backend.</p>
<p>This defaults to the type of database in use, and can be overridden by the <code>transactional_ddl</code> argument to configure()</p>
<p>This function requires that a <strong><a href="zh/08_02_01_13_is_transactional_ddl.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has first been made available via <strong><a href="zh/08_02_01_13_is_transactional_ddl.html#alembic.runtime.environment.EnvironmentContext.configure">configure()</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run_migrations"><a class="header" href="#run_migrations">run_migrations</a></h1>
<p><strong>run_migrations</strong>(**kw) → None</p>
<p>Run migrations as determined by the current command line configuration as well as versioning information present (or not) in the current database connection (if one is present).</p>
<p>The function accepts optional <code>**kw</code> arguments. If these are passed, they are sent directly to the <code>upgrade()</code> and <code>downgrade()</code> functions within each target revision file. By modifying the <code>script.py.mako</code> file so that the <code>upgrade()</code> and <code>downgrade()</code> functions accept arguments, parameters can be passed here so that contextual information, usually information to identify a particular database in use, can be passed from a custom <code>env.py</code> script to the migration functions.</p>
<p>This function requires that a <strong><a href="zh/08_02_01_14_run_migrations.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> has first been made available via <strong><a href="zh/08_02_01_14_run_migrations.html#alembic.runtime.environment.EnvironmentContext.configure">configure()</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script"><a class="header" href="#script">script</a></h1>
<p>An instance of <a href="zh/../en/api/script.html#alembic.script.ScriptDirectory">ScriptDirectory</a> which provides programmatic access to version files within the <code>versions/</code> directory.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="static_output"><a class="header" href="#static_output">static_output</a></h1>
<p><strong>static_output</strong>(text)</p>
<p>Emit text directly to the “offline” SQL stream.</p>
<p>Typically this is for emitting comments that start with –. The statement is not treated as a SQL execution, no ; or batch separator is added, etc.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="the-migration-context"><a class="header" href="#the-migration-context">The Migration Context</a></h2>
<p>The <a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a> handles the actual work to be performed against a database backend as migration operations proceed. It is generally not exposed to the end-user, except when the <a href="zh/../en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.on_version_apply">on_version_apply</a> callback hook is used.</p>
<h3 id="class-alembicruntimemigrationmigrationcontextdialect-dialect-connection-optionalconnection-opts-dicta-hrefhttpsdocspythonorg3librarystdtypeshtmlstrstra-any-environment_context-optionalenvironmentcontext--none"><a class="header" href="#class-alembicruntimemigrationmigrationcontextdialect-dialect-connection-optionalconnection-opts-dicta-hrefhttpsdocspythonorg3librarystdtypeshtmlstrstra-any-environment_context-optionalenvironmentcontext--none"><em>class</em> alembic.runtime.migration.MigrationContext(<em>dialect</em>: Dialect, <em>connection</em>: Optional[Connection], <em>opts</em>: Dict[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, Any], <em>environment_context</em>: Optional[EnvironmentContext] = None)</a></h3>
<p>Represent the database state made available to a migration script.</p>
<p>MigrationContext is the front end to an actual database connection, or alternatively a string output stream given a particular database dialect, from an Alembic perspective.</p>
<p>When inside the <code>env.py</code> script, the <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> is available via the <strong><a href="zh/08_02_02_the_migration_context.html#alembic.runtime.environment.EnvironmentContext.get_context">EnvironmentContext.get_context()</a></strong> method, which is available at <code>alembic.context</code>:</p>
<pre><code class="language-python"># from within env.py script
from alembic import context
migration_context = context.get_context()
</code></pre>
<p>For usage outside of an <code>env.py</code> script, such as for utility routines that want to check the current version in the database, the <strong><a href="zh/08_02_02_the_migration_context.html#alembic.runtime.migration.MigrationContext.configure">MigrationContext.configure()</a></strong> method to create new <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> objects. For example, to get at the current revision in the database using <strong><a href="zh/../en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>.get_current_revision():</p>
<pre><code class="language-python"># in any application, outside of an env.py script
from alembic.migration import MigrationContext
from sqlalchemy import create_engine

engine = create_engine(&quot;postgresql://mydatabase&quot;)
conn = engine.connect()

context = MigrationContext.configure(conn)
current_rev = context.get_current_revision()
</code></pre>
<p>The above context can also be used to produce Alembic migration operations with an <strong><a href="zh/../en/ops.html#alembic.operations.Operations">Operations</a></strong> instance:</p>
<pre><code class="language-python"># in any application, outside of the normal Alembic environment
from alembic.operations import Operations
op = Operations(context)
op.alter_column(&quot;mytable&quot;, &quot;somecolumn&quot;, nullable=True)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="autocommit_block"><a class="header" href="#autocommit_block">autocommit_block</a></h1>
<p><strong>autocommit_block</strong>() → Iterator[None]</p>
<p>Enter an “autocommit” block, for databases that support AUTOCOMMIT isolation levels.</p>
<p>This special directive is intended to support the occasional database DDL or system operation that specifically has to be run outside of any kind of transaction block. The PostgreSQL database platform is the most common target for this style of operation, as many of its DDL operations must be run outside of transaction blocks, even though the database overall supports transactional DDL.</p>
<p>The method is used as a context manager within a migration script, by calling on <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.get_context">Operations.get_context()</a></strong> to retrieve the <strong><a href="zh/08_02_02_01_autocommit_block.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>, then invoking <strong><a href="zh/08_02_02_01_autocommit_block.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>.autocommit_block() using the <code>with:</code> statement:</p>
<pre><code class="language-python">def upgrade():
    with op.get_context().autocommit_block():
        op.execute(&quot;ALTER TYPE mood ADD VALUE 'soso'&quot;)
</code></pre>
<p>Above, a PostgreSQL “ALTER TYPE..ADD VALUE” directive is emitted, which must be run outside of a transaction block at the database level. The <strong><a href="zh/08_02_02_01_autocommit_block.html#alembic.runtime.migration.MigrationContext.autocommit_block">MigrationContext.autocommit_block()</a></strong> method makes use of the SQLAlchemy <code>AUTOCOMMIT</code> isolation level setting, which against the psycogp2 DBAPI corresponds to the <code>connection.autocommit</code> setting, to ensure that the database driver is not inside of a DBAPI level transaction block.</p>
<blockquote>
<p><strong>Warning:</strong> As is necessary, the database transaction preceding the block is unconditionally committed. This means that the run of migrations preceding the operation will be committed, before the overall migration operation is complete.</p>
<p>It is recommended that when an application includes migrations with “autocommit” blocks, that <strong><a href="zh/08_02_02_01_autocommit_block.html#alembic.runtime.environment.EnvironmentContext.params.transaction_per_migration">EnvironmentContext.transaction_per_migration</a></strong> be used so that the calling environment is tuned to expect short per-file migrations whether or not one of them has an autocommit block.</p>
</blockquote>
<blockquote>
<p><em>New in version 1.2.0.</em></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="begin_transaction-1"><a class="header" href="#begin_transaction-1">begin_transaction</a></h1>
<p><strong>begin_transaction</strong>(<em>_per_migration</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False) → Union[alembic.runtime.migration._ProxyTransaction, AbstractContextManager]</p>
<p>Begin a logical transaction for migration operations.</p>
<p>This method is used within an <code>env.py</code> script to demarcate where the outer “transaction” for a series of migrations begins. Example:</p>
<pre><code class="language-python">def run_migrations_online():
    connectable = create_engine(...)

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p>Above, <strong><a href="zh/08_02_02_02_begin_transaction.html#alembic.runtime.migration.MigrationContext.begin_transaction">MigrationContext.begin_transaction()</a></strong> is used to demarcate where the outer logical transaction occurs around the <strong><a href="zh/08_02_02_02_begin_transaction.html#alembic.runtime.migration.MigrationContext.run_migrations">MigrationContext.run_migrations()</a></strong> operation.</p>
<p>A “Logical” transaction means that the operation may or may not correspond to a real database transaction. If the target database supports transactional DDL (or <strong><a href="zh/08_02_02_02_begin_transaction.html#alembic.runtime.environment.EnvironmentContext.configure.params.transactional_ddl">EnvironmentContext.configure.transactional_ddl</a></strong> is true), the <strong><a href="zh/08_02_02_02_begin_transaction.html#alembic.runtime.environment.EnvironmentContext.configure.params.transaction_per_migration">EnvironmentContext.configure.transaction_per_migration</a></strong> flag is not set, and the migration is against a real database connection (as opposed to using “offline” <code>--sql</code> mode), a real transaction will be started. If <code>--sql</code> mode is in effect, the operation would instead correspond to a string such as “BEGIN” being emitted to the string output.</p>
<p>The returned object is a Python context manager that should only be used in the context of a <code>with:</code> statement as indicated above. The object has no other guaranteed API features present.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/08_02_02_02_begin_transaction.html#alembic.runtime.migration.MigrationContext.autocommit_block">MigrationContext.autocommit_block()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bind"><a class="header" href="#bind">bind</a></h1>
<p><em>property</em> <strong>bind</strong>: <em>Optional[Connection]</em></p>
<p>Return the current “bind”.</p>
<p>In online mode, this is an instance of <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">sqlalchemy.engine.Connection</a></strong>, and is suitable for ad-hoc execution of any kind of usage described in <strong><a href="https://docs.sqlalchemy.org/en/14/core/tutorial.html#sqlexpression-toplevel">SQL Expression Language Tutorial (1.x API)</a></strong> as well as for usage with the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table.create">sqlalchemy.schema.Table.create()</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData.create_all">sqlalchemy.schema.MetaData.create_all()</a></strong> methods of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong>, <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong>.</p>
<blockquote>
<p><strong>Note:</strong> that when “standard output” mode is enabled, this bind will be a “mock” connection handler that cannot return results and is only appropriate for a very limited subset of commands.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config-1"><a class="header" href="#config-1">config</a></h1>
<p><em>property</em> <strong>config</strong>: <em>Optional<a href="zh/../en/api/config.html#alembic.config.Config">Config</a></em></p>
<p>Return the <a href="zh/../en/api/config.html#alembic.config.Config">Config</a> used by the current environment, if any.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configure-1"><a class="header" href="#configure-1">configure</a></h1>
<p><strong>configure</strong>(<em>connection</em>:  Optional[Connection] = None, <em>url</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>dialect_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>dialect</em>:  Optional[Dialect] = None, <em>environment_context</em>:  Optional[EnvironmentContext] = None, <em>dialect_opts</em>:  Optional[Dict[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]] = None, <em>opts</em>:  Optional[Any] = None) → MigrationContext</p>
<p>Create a new <strong><a href="zh/08_02_02_03_configure.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>.</p>
<p>This is a factory method usually called by <strong><a href="zh/08_02_02_03_configure.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong>.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>connection</strong></em> – a <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> to use for SQL execution in “online” mode. When present, is also used to determine the type of dialect in use.</li>
<li><em><strong>url</strong></em> – a string database <strong>url</strong>, or a <strong><a href="https://docs.sqlalchemy.org/en/14/core/engines.html#sqlalchemy.engine.URL">sqlalchemy.engine.url.URL</a></strong> object. The type of dialect to be used will be derived from this if <code>connection</code> is not passed.</li>
<li><em><strong>dialect_name</strong></em> – string name of a dialect, such as “postgresql”, “mssql”, etc. The type of dialect to be used will be derived from this if <code>connection</code> and <code>url</code> are not passed.</li>
<li><em><strong>opts</strong></em> – dictionary of options. Most other options accepted by <strong><a href="zh/08_02_02_03_configure.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> are passed via this dictionary.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execute-2"><a class="header" href="#execute-2">execute</a></h1>
<p><strong>execute</strong>(<em>sql</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>execution_options</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>) → None</p>
<p>Execute a SQL construct or string statement.</p>
<p>The underlying execution mechanics are used, that is if this is “offline mode” the SQL is written to the output buffer, otherwise the SQL is emitted on the current SQLAlchemy connection.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_current_heads"><a class="header" href="#get_current_heads">get_current_heads</a></h1>
<p><strong>get_current_heads</strong>() → Tuple[str, ...]</p>
<p>Return a tuple of the current ‘head versions’ that are represented in the target database.</p>
<p>For a migration stream without branches, this will be a single value, synonymous with that of <strong><a href="zh/08_02_02_05_get_current_heads.html#alembic.runtime.migration.MigrationContext.get_current_revision">MigrationContext.get_current_revision()</a></strong>. However when multiple unmerged branches exist within the target database, the returned tuple will contain a value for each head.</p>
<p>If this <strong><a href="zh/08_02_02_05_get_current_heads.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> was configured in “offline” mode, that is with <code>as_sql=True</code>, the <code>starting_rev</code> parameter is returned in a one-length tuple.</p>
<p>If no version table is present, or if there are no revisions present, an empty tuple is returned.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_current_revision"><a class="header" href="#get_current_revision">get_current_revision</a></h1>
<p><strong>get_current_revision</strong>() → Optional[str]</p>
<p>Return the current revision, usually that which is present in the <code>alembic_version</code> table in the database.</p>
<p>This method intends to be used only for a migration stream that does not contain unmerged branches in the target database; if there are multiple branches present, an exception is raised. The <strong><a href="zh/08_02_02_06_get_current_revision.html#alembic.runtime.migration.MigrationContext.get_current_heads">MigrationContext.get_current_heads()</a></strong> should be preferred over this method going forward in order to be compatible with branch migration support.</p>
<p>If this <strong><a href="zh/08_02_02_06_get_current_revision.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> was configured in “offline” mode, that is with <code>as_sql=True</code>, the <code>starting_rev</code> parameter is returned instead, if any.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run_migrations-1"><a class="header" href="#run_migrations-1">run_migrations</a></h1>
<p><strong>run_migrations</strong>(**kw) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>Run the migration scripts established for this <strong><a href="zh/08_02_02_07_run_migrations.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>, if any.</p>
<p>The commands in <strong><a href="zh/../en/commands.html#module-alembic.command">alembic.command</a></strong> will set up a function that is ultimately passed to the <strong><a href="zh/08_02_02_07_run_migrations.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> as the <code>fn</code> argument. This function represents the “work” that will be done when <strong><a href="zh/08_02_02_07_run_migrations.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>.run_migrations() is called, typically from within the <code>env.py</code> script of the migration environment. The “work function” then provides an iterable of version callables and other version information which in the case of the <code>upgrade</code> or <code>downgrade</code> commands are the list of version scripts to invoke. Other commands yield nothing, in the case that a command wants to run some other operation against the database such as the <code>current</code> or <code>stamp</code> commands.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>**<em><strong>kw</strong></em> – keyword arguments here will be passed to each migration callable, that is the <code>upgrade()</code> or <code>downgrade()</code> method within revision scripts.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stamp"><a class="header" href="#stamp">stamp</a></h1>
<p><strong>stamp</strong>(<em>script_directory</em>:  ScriptDirectory, <em>revision</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>Stamp the version table with a specific revision.</p>
<p>This method calculates those branches to which the given revision can apply, and updates those branches as though they were migrated towards that revision (either up or down). If no current branches include the revision, it is added as a new branch head.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<blockquote>
<p><strong>Note:</strong> this section discusses the <strong>internal API of Alembic</strong> as regards internal configuration constructs. This section is only useful for developers who wish to extend the capabilities of Alembic. For documentation on configuration of an Alembic environment, please see <strong><a href="zh/../en/../tutorial.html">Tutorial</a></strong>.</p>
</blockquote>
<p>The <strong><a href="zh/08_03_configuration.html#alembic.config.Config">Config</a></strong> object represents the configuration passed to the Alembic environment. From an API usage perspective, it is needed for the following use cases:</p>
<ul>
<li>to create a <strong><a href="zh/../en/script.html#alembic.script.ScriptDirectory">ScriptDirectory</a></strong>, which allows you to work with the actual script files in a migration environment</li>
<li>to create an <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext</a></strong>, which allows you to actually run the <code>env.py</code> module within the migration environment</li>
<li>to programmatically run any of the commands in the <strong><a href="zh/../en/commands.html#alembic-command-toplevel">Commands</a></strong> module.</li>
</ul>
<p>The <strong><a href="zh/08_03_configuration.html#alembic.config.Config">Config</a></strong> is not needed for these cases:</p>
<ul>
<li>to instantiate a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> directly - this object only needs a SQLAlchemy connection or dialect name.</li>
<li>to instantiate a <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> object - this object only needs a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>.</li>
</ul>
<p><strong>Config</strong>(<em>file_</em>:  Optional[str] = None, <em>ini_section</em>:  str = 'alembic', <em>output_buffer</em>:  Optional[TextIO] = None, <em>stdout</em>:  TextIO = &lt;_io.TextIOWrapper name='<stdout>' mode='w' encoding='UTF-8'&gt;, <em>cmd_opts</em>:  Optional[argparse.Namespace] = None,<em>config_args</em>:  sqlalchemy.util._collections._immutabledict_py_fallback.<locals>.immutabledict = {}, <em>attributes</em>:  Optional[dict] = None)</p>
<p>Represent an Alembic configuration.</p>
<p>Within an <code>env.py</code> script, this is available via the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.config">EnvironmentContext.config</a></strong> attribute, which in turn is available at <code>alembic.context</code>:</p>
<pre><code class="language-python">from alembic import context

some_param = context.config.get_main_option(&quot;my option&quot;)
</code></pre>
<p>When invoking Alembic programatically, a new <strong><a href="zh/08_03_configuration.html#alembic.config.Config">Config</a></strong> can be created by passing the name of an .ini file to the constructor:</p>
<pre><code class="language-python">from alembic.config import Config
alembic_cfg = Config(&quot;/path/to/yourapp/alembic.ini&quot;)
</code></pre>
<p>With a <strong><a href="zh/08_03_configuration.html#alembic.config.Config">Config</a></strong> object, you can then run Alembic commands programmatically using the directives in <strong><a href="zh/../en/commands.html#module-alembic.command">alembic.command</a></strong>.</p>
<p>The <strong><a href="zh/08_03_configuration.html#alembic.config.Config">Config</a></strong> object can also be constructed without a filename. Values can be set programmatically, and new sections will be created as needed:</p>
<pre><code class="language-python">from alembic.config import Config
alembic_cfg = Config()
alembic_cfg.set_main_option(&quot;script_location&quot;, &quot;myapp:migrations&quot;)
alembic_cfg.set_main_option(&quot;sqlalchemy.url&quot;, &quot;postgresql://foo/bar&quot;)
alembic_cfg.set_section_option(&quot;mysection&quot;, &quot;foo&quot;, &quot;bar&quot;)
</code></pre>
<blockquote>
<p><strong>Warning:</strong> When using programmatic configuration, make sure the <code>env.py</code> file in use is compatible with the target configuration; including that the call to Python <code>logging.fileConfig()</code> is omitted if the programmatic configuration doesn’t actually include logging directives.</p>
</blockquote>
<p>For passing non-string values to environments, such as connections and engines, use the <strong><a href="zh/08_03_configuration.html#alembic.config.Config.attributes">Config.attributes</a></strong> dictionary:</p>
<pre><code class="language-python">with engine.begin() as connection:
    alembic_cfg.attributes['connection'] = connection
    command.upgrade(alembic_cfg, &quot;head&quot;)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>file_</strong></em> – name of the .ini file to open.</li>
<li><em><strong>ini_section</strong></em> – name of the main Alembic section within the .ini file</li>
<li><em><strong>output_buffer</strong></em> – optional file-like input buffer which will be passed to the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> - used to redirect the output of “offline generation” when using Alembic programmatically.</li>
<li><em><strong>stdout</strong></em> – buffer where the “print” output of commands will be sent. Defaults to <code>sys.stdout</code>.</li>
<li><em><strong>config_args</strong></em> – A dictionary of keys and values that will be used for substitution in the alembic config file. The dictionary as given is <strong>copied</strong> to a new one, stored locally as the attribute <code>.config_args</code>. When the <strong><a href="zh/08_03_configuration.html#alembic.config.Config.file_config">Config.file_config</a></strong> attribute is first invoked, the replacement variable <code>here</code> will be added to this dictionary before the dictionary is passed to <code>ConfigParser()</code> to parse the .ini file.</li>
<li><em><strong>attributes</strong></em> – optional dictionary of arbitrary Python keys/values, which will be populated into the <strong><a href="zh/08_03_configuration.html#alembic.config.Config.attributes">Config.attributes</a></strong> dictionary.</li>
</ul>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../en/../cookbook.html#connection-sharing">Sharing a Connection with a Series of Migration Commands and Environments</a></strong></li>
</ul>
<p>Construct a new <a href="zh/08_03_configuration.html#alembic.config.Config">Config</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="attributes"><a class="header" href="#attributes">attributes</a></h1>
<p><strong>attributes</strong></p>
<p>A Python dictionary for storage of additional state.</p>
<p>This is a utility dictionary which can include not just strings but engines, connections, schema objects, or anything else. Use this to pass objects into an env.py script, such as passing a <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">sqlalchemy.engine.base.Connection</a></strong> when calling commands from <strong><a href="zh/../en/commands.html#module-alembic.command">alembic.command</a></strong> programmatically.</p>
<p><strong>See also:</strong> <strong><a href="zh/../en/../cookbook.html#connection-sharing">Sharing a Connection with a Series of Migration Commands and Environments</a></strong></p>
<ul>
<li><strong><a href="zh/08_03_01_attributes.html#alembic.config.Config.params.attributes">Config.attributes</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cmd_opts"><a class="header" href="#cmd_opts">cmd_opts</a></h1>
<p><strong>cmd_opts</strong></p>
<p>The command-line options passed to the <code>alembic</code> script.</p>
<p>Within an <code>env.py</code> script this can be accessed via the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.config">EnvironmentContext.config</a></strong> attribute.</p>
<p><strong>See also:</strong></p>
<ul>
<li><strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.get_x_argument">EnvironmentContext.get_x_argument()</a></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config_file_name"><a class="header" href="#config_file_name">config_file_name</a></h1>
<p><strong>config_file_name</strong></p>
<p>Filesystem path to the .ini file in use.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config_ini_section"><a class="header" href="#config_ini_section">config_ini_section</a></h1>
<p><strong>config_ini_section</strong></p>
<p>Name of the config file section to read basic configuration from. Defaults to <code>alembic</code>, that is the <code>[alembic]</code> section of the .ini file. This value is modified using the <code>-n/--name</code> option to the Alembic runner.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="file_config"><a class="header" href="#file_config">file_config</a></h1>
<p><strong>file_config</strong></p>
<p>Return the underlying <code>ConfigParser</code> object.</p>
<p>Direct access to the .ini file is available here, though the <strong><a href="zh/08_03_05_file_config.html#alembic.config.Config.get_section">Config.get_section()</a></strong> and <strong><a href="zh/08_03_05_file_config.html#alembic.config.Config.get_main_option">Config.get_main_option()</a></strong> methods provide a possibly simpler interface.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_main_option"><a class="header" href="#get_main_option">get_main_option</a></h1>
<p><strong>get_main_option</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>default</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>) → <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a></p>
<p><strong>get_main_option</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>default</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</p>
<p>Return an option from the ‘main’ section of the .ini file.</p>
<p>This defaults to being a key from the <code>[alembic]</code> section, unless the <code>-n/--name</code> flag were used to indicate a different section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_section"><a class="header" href="#get_section">get_section</a></h1>
<p><strong>get_section get_section</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>default</em>:  Dict[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]) → Dict[str, str]</p>
<p><strong>get_section get_section</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>default</em>:  Optional[Dict[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]] = None) → Optional[Dict[str, str]]</p>
<p>Return all the configuration options from a given .ini file section as a dictionary.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_section_option"><a class="header" href="#get_section_option">get_section_option</a></h1>
<p><strong>get_section_option</strong>(<em>section</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>default</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[str]</p>
<p>Return an option from the given section of the .ini file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get_template_directory"><a class="header" href="#get_template_directory">get_template_directory</a></h1>
<p><strong>get_template_directory</strong>() → <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a></p>
<p>Return the directory where Alembic setup templates are found.</p>
<p>This method is used by the alembic <code>init</code> and <code>list_templates</code> commands.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print_stdout"><a class="header" href="#print_stdout">print_stdout</a></h1>
<p><strong>print_stdout</strong>(<em>text</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, *arg) → None</p>
<p>Render a message to standard out.</p>
<p>When <strong><a href="zh/08_03_10_print_stdout.html#alembic.config.Config.print_stdout">Config.print_stdout()</a></strong> is called with additional args those arguments will formatted against the provided text, otherwise we simply output the provided text verbatim.</p>
<p>e.g.:</p>
<pre><code class="language-python">&gt;&gt;&gt; config.print_stdout('Some text %s', 'arg')
Some Text arg
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set_main_option"><a class="header" href="#set_main_option">set_main_option</a></h1>
<p><strong>set_main_option</strong>(<em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>value</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>Set an option programmatically within the ‘main’ section.</p>
<p>This overrides whatever was in the .ini file.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>name</strong></em> – <strong>name</strong> of the value</li>
<li><em><strong>value</strong></em> – the value. Note that this <strong>value</strong> is passed to <code>ConfigParser.set</code>, which supports variable interpolation using pyformat (e.g. %(some_value)s). A raw percent sign not part of an interpolation symbol must therefore be escaped, e.g. <code>%%</code>. The given <strong>value</strong> may refer to another <strong>value</strong> already in the file using the interpolation format.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set_section_option"><a class="header" href="#set_section_option">set_section_option</a></h1>
<p><strong>set_section_option</strong>(<em>section</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>value</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>Set an option programmatically within the given section.</p>
<p>The section is created if it doesn’t exist already. The value here will override whatever was in the .ini file.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>section</strong></em> – name of the section</li>
<li><em><strong>name</strong></em> – <strong>name</strong> of the value</li>
<li><em><strong>value</strong></em> – the value. Note that this <strong>value</strong> is passed to <code>ConfigParser.set</code>, which supports variable interpolation using pyformat (e.g. %(some_value)s). A raw percent sign not part of an interpolation symbol must therefore be escaped, e.g. <code>%%</code>. The given <strong>value</strong> may refer to another <strong>value</strong> already in the file using the interpolation format.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="main"><a class="header" href="#main">main</a></h1>
<p>alembic.config.<strong>main</strong>(<em>argv</em>=None, <em>prog</em>=None, **kwargs)</p>
<p>The console runner function for Alembic.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<blockquote>
<p><strong>Note:</strong> this section discusses the <strong>internal API of Alembic</strong> as regards its command invocation system. This section is only useful for developers who wish to extend the capabilities of Alembic. For documentation on using Alembic commands, please see <strong><a href="zh/../zh/00_tutorial.html">Tutorial</a></strong>.</p>
</blockquote>
<blockquote>
<p><strong>注意</strong>：本节讨论 <strong>Alembic的内部API</strong> 关于其命令调用系统。 本节仅对希望扩展 Alembic 功能的开发人员有用。 有关使用 Alembic 命令的文档，请参阅 <strong><a href="zh/../zh/00_tutorial.html">教程</a></strong>.</p>
</blockquote>
<p>Alembic commands are all represented by functions in the <strong><a href="zh/../zh/08_04_commands.html">Commands</a></strong> package. They all accept the same style of usage, being sent the <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object as the first argument.</p>
<blockquote>
<p>Alembic 命令全部由 <strong><a href="zh/../zh/08_04_commands.html">Commands</a></strong> 包中的函数表示。 它们都接受相同的使用方式，将 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 对象作为第一个参数发送。</p>
</blockquote>
<p>Commands can be run programmatically, by first constructing a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object, as in:</p>
<blockquote>
<p>命令可以通过首先构造一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 对象以编程方式运行，如下所示：</p>
</blockquote>
<pre><code class="language-python">from alembic.config import Config
from alembic import command
alembic_cfg = Config(&quot;/path/to/yourapp/alembic.ini&quot;)
command.upgrade(alembic_cfg, &quot;head&quot;)
</code></pre>
<p>In many cases, and perhaps more often than not, an application will wish to call upon a series of Alembic commands and/or other features. It is usually a good idea to link multiple commands along a single connection and transaction, if feasible. This can be achieved using the <strong><a href="zh/../en/config.html#alembic.config.Config.attributes">Config.attributes</a></strong> dictionary in order to share a connection:</p>
<blockquote>
<p>在许多情况下，也许更多时候，应用程序会希望调用一系列 Alembic 的命令以及其他功能。 如果可行，沿单个连接和事务并链接多个命令通常是一个好主意。 这可以使用 <strong><a href="zh/../en/config.html#alembic.config.Config.attributes">Config.attributes</a></strong> 字典来实现，以便共享连接：</p>
</blockquote>
<pre><code class="language-python">with engine.begin() as connection:
    alembic_cfg.attributes['connection'] = connection
    command.upgrade(alembic_cfg, &quot;head&quot;)
</code></pre>
<p>This recipe requires that <code>env.py</code> consumes this connection argument; see the example in <strong><a href="zh/../zh/07_03_sharing_a_connection_with_a_series_of_migration_commands_and_environments.html">Sharing a Connection with a Series of Migration Commands and Environments</a></strong> for details.</p>
<blockquote>
<p>这个示例片段要求 <code>env.py</code> 使用这个 <code>connection</code> 参数； 有关详细信息，请参阅<a href="zh/../zh/07_03_sharing_a_connection_with_a_series_of_migration_commands_and_environments.html">与一系列迁移命令和环境共享连接</a>中的示例。</p>
</blockquote>
<p>To write small API functions that make direct use of database and script directory information, rather than just running one of the built-in commands, use the <strong><a href="zh/../zh/08_07_script_directory.html">ScriptDirectory</a></strong> and <strong><a href="zh/../zh/08_02_02_the_migration_context.html">MigrationContext</a></strong> classes directly.</p>
<blockquote>
<p>要编写直接使用数据库和脚本目录信息的小型 API 函数，而不仅仅是运行内置命令之一，请直接使用 <strong><a href="zh/../zh/08_07_script_directory.html">ScriptDirectory</a></strong> 和 <strong><a href="zh/../zh/08_02_02_the_migration_context.html">MigrationContext</a></strong> 类。</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="branches"><a class="header" href="#branches">branches</a></h1>
<p>alembic.command.<strong>branches</strong>(config, verbose=False)</p>
<p>Show current branch points.</p>
<blockquote>
<p>显示当前分支点。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>verbose</strong></em> – output in <strong>verbose</strong> mode.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>verbose</strong></em> – 以 <strong>详细</strong> 模式输出。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="current"><a class="header" href="#current">current</a></h1>
<p>alembic.command.<strong>current</strong>(<em>config</em>:  Config, <em>verbose</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False) → None</p>
<p>Display the current revision for a database.</p>
<blockquote>
<p>显示数据库的当前版本。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>verbose</strong></em> – output in <strong>verbose</strong> mode.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>verbose</strong></em> – 以 <strong>详细</strong> 模式输出。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="downgrade"><a class="header" href="#downgrade">downgrade</a></h1>
<p>alembic.command.<strong>downgrade</strong>(<em>config</em>:  Config, <em>revision</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>sql</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>tag</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → None</p>
<p>Revert to a previous version.</p>
<blockquote>
<p>恢复到以前的版本。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>revision</strong></em> – string <strong>revision</strong> target or range for –sql mode</li>
<li><em><strong>sql</strong></em> – if True, use <code>--sql</code> mode</li>
<li><em><strong>tag</strong></em> – an arbitrary “tag” that can be intercepted by custom <code>env.py</code> scripts via the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.get_tag_argument">EnvironmentContext.get_tag_argument()</a></strong> method.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>revision</strong></em> – <code>–sql</code> 模式的字符串 <strong>修订</strong> 目标或范围</li>
<li><em><strong>sql</strong></em> – 如果为 <code>True</code>, 使用 <code>--sql</code> 模式</li>
<li><em><strong>tag</strong></em> – 一个可以通过定义 <code>env.py</code> 脚本的 <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.get_tag_argument">EnvironmentContext.get_tag_argument()</a></strong> 方法 获取的任意”标签“=</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="edit"><a class="header" href="#edit">edit</a></h1>
<p>alembic.command.<strong>edit</strong>(<em>config</em>:  Config, <em>rev</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>) → None</p>
<p>Edit revision script(s) using $EDITOR.</p>
<blockquote>
<p>使用 $EDITOR 编辑修订脚本。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>rev</strong></em> – target revision.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>rev</strong></em> – 目标修订.</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ensure_version"><a class="header" href="#ensure_version">ensure_version</a></h1>
<p>alembic.command.<strong>ensure_version</strong>(<em>config</em>:  Config, <em>sql</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False) → None</p>
<p>Create the alembic version table if it doesn’t exist already .</p>
<blockquote>
<p>如果 alembic 版本表不存在，则创建它。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</p>
</li>
<li>
<p><em><strong>sql</strong></em> – use <code>--sql</code> mode</p>
<p>New in version 1.7.6.</p>
</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li>
<p><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</p>
</li>
<li>
<p><em><strong>sql</strong></em> – 使用 <code>--sql</code> 模式</p>
<p>1.7.6版本中新增</p>
</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="heads"><a class="header" href="#heads">heads</a></h1>
<p>alembic.command.<strong>heads</strong>(config, verbose=False, resolve_dependencies=False)</p>
<p>Show current available heads in the script directory.</p>
<blockquote>
<p>在脚本目录中显示当前可用的head。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>verbose</strong></em> – output in <strong>verbose</strong> mode.</li>
<li><em><strong>resolve_dependencies</strong></em> – treat dependency version as down revisions.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>verbose</strong></em> – 以 <strong>详细</strong> 模式输出。</li>
<li><em><strong>resolve_dependencies</strong></em> – 将依赖版本视为向下修订。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="history"><a class="header" href="#history">history</a></h1>
<p>alembic.command.<strong>history</strong>(<em>config</em>:  Config, <em>rev_range</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>verbose</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>indicate_current</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False) → None</p>
<p>List changeset scripts in chronological order.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>rev_range</strong></em> – string revision range</li>
<li><em><strong>verbose</strong></em> – output in <strong>verbose</strong> mode.</li>
<li><em><strong>indicate_current</strong></em> – indicate current revision.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>rev_range</strong></em> – 字符串的修订范围</li>
<li><em><strong>verbose</strong></em> – 以 <strong>详细</strong> 模式输出。</li>
<li><em><strong>indicate_current</strong></em> – 表示当前版本。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="init"><a class="header" href="#init">init</a></h1>
<p>alembic.command.<strong>init</strong>(<em>config</em>:  Config, <em>directory</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>template</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'generic', <em>package</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False) → None</p>
<p>Initialize a new scripts directory.</p>
<blockquote>
<p>初始化一个新的脚本目录。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object.</p>
</li>
<li>
<p><em><strong>directory</strong></em> – string path of the target directory</p>
</li>
<li>
<p><em><strong>template</strong></em> – string name of the migration environment <strong>template</strong> to use.</p>
</li>
<li>
<p><em><strong>package</strong></em> – when True, write <code>__init__.py</code> files into the environment location as well as the <code>versions/</code> location.</p>
<p><em>New in version 1.2.</em></p>
</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li>
<p><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</p>
</li>
<li>
<p><em><strong>directory</strong></em> – 目标目录的字符串路径</p>
</li>
<li>
<p><em><strong>template</strong></em> – 要使用的迁移环境 <strong>模板</strong> 的字符串名称。</p>
</li>
<li>
<p><em><strong>package</strong></em> – 如果为 <code>True</code> ，则将 <code>__init__.py</code> 文件写入环境位置以及 <strong>版本目录</strong> 位置。</p>
<p><em>1.2.版本中新增</em></p>
</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="list_templates"><a class="header" href="#list_templates">list_templates</a></h1>
<p>alembic.command.<strong>list_templates</strong>(config)</p>
<p>List available templates.</p>
<blockquote>
<p>列出可用模板。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="merge"><a class="header" href="#merge">merge</a></h1>
<p>alembic.command.<strong>merge</strong>(<em>config</em>:  Config, <em>revisions</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>message</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = None, <em>branch_label</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = None, <em>rev_id</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = None) → Optional[Script]</p>
<p>Merge two revisions together. Creates a new migration file.</p>
<blockquote>
<p>将两个修订合并在一起。 创建一个新的迁移文件。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance</li>
<li><em><strong>message</strong></em> – string <strong>message</strong> to apply to the revision</li>
<li><em><strong>branch_label</strong></em> – string label name to apply to the new revision</li>
<li><em><strong>rev_id</strong></em> – hardcoded revision identifier instead of generating a new one.</li>
</ul>
<p><strong>See also:</strong>  <strong><a href="zh/../zh/05_working_with_branches.html">Working with Branches</a></strong></p>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>message</strong></em> – 应用于修订的字符串 <strong>消息</strong> 。</li>
<li><em><strong>branch_label</strong></em> – 应用于新修订的字符串标签名称</li>
<li><em><strong>rev_id</strong></em> – 硬编码的修订标识符，而不是生成一个新的。</li>
</ul>
</blockquote>
<p><strong>同样参考:</strong>  <strong><a href="zh/../zh/05_working_with_branches.html">使用分支</a></strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="revision"><a class="header" href="#revision">revision</a></h1>
<p>alembic.command.<strong>revision</strong>(<em>config</em>:  Config, <em>message</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>autogenerate</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>sql</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>head</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'head', <em>splice</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>branch_label</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>version_path</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>rev_id</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>depends_on</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>process_revision_directives</em>:  Callable = None) → Union[Script, None, List[Optional[Script]]]</p>
<p>Create a new revision file.</p>
<blockquote>
<p>创建一个新的修订文件。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> object.</li>
<li><em><strong>message</strong></em> – string <strong>message</strong> to apply to the revision; this is the <code>-m</code> option to <code>alembic revision</code>.</li>
<li><em><strong>autogenerate</strong></em> – whether or not to <strong>autogenerate</strong> the script from the database; this is the <code>--autogenerate</code> option to <code>alembic revision</code>.</li>
<li><em><strong>sql</strong></em> – whether to dump the script out as a SQL string; when specified, the script is dumped to stdout. This is the <code>--sql</code> option to <code>alembic revision</code>.</li>
<li><em><strong>head</strong></em> – <strong>head</strong> revision to build the new revision upon as a parent; this is the <code>--head</code> option to <code>alembic revision</code>.</li>
<li><em><strong>splice</strong></em> – whether or not the new revision should be made into a new <code>head</code> of its own; is required when the given <code>head</code> is not itself a <code>head</code>. This is the <code>--splice</code> option to <code>alembic revision</code>.</li>
<li><em><strong>branch_label</strong></em> – string label to apply to the branch; this is the <code>--branch-label</code> option to <code>alembic revision</code>.</li>
<li><em><strong>version_path</strong></em> – string symbol identifying a specific version path from the configuration; this is the <code>--version-path</code> option to <code>alembic revision</code>.</li>
<li><em><strong>rev_id</strong></em> – optional revision identifier to use instead of having one generated; this is the <code>--rev-id</code> option to <code>alembic revision</code>.</li>
<li><em><strong>depends_on</strong></em> – optional list of “depends on” identifiers; this is the <code>--depends-on</code> option to <code>alembic revision</code>.</li>
<li><em><strong>process_revision_directives</strong></em> – this is a callable that takes the same form as the callable described at EnvironmentContext.configure.process_revision_directives; will be applied to the structure generated by the revision process where it can be altered programmatically. Note that unlike all the other parameters, this option is only available via programmatic use of command.revision()</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>message</strong></em> – 应用于修订的字符串 <strong>消息</strong> ； 这是 <code>alembic revision</code> 命令的 <code>-m</code> 选项。</li>
<li><em><strong>autogenerate</strong></em> – 是否从数据库 <strong>自动生成</strong> 脚本； 这是 <code>alembic revision</code> 命令的 <code>--autogenerate</code> 选项。</li>
<li><em><strong>sql</strong></em> – 是否将脚本作为 SQL 字符串转储； 指定时，脚本被转储到标准输出。 这是 <code>alembic revision</code> 命令的 <code>--sql</code> 选项。</li>
<li><em><strong>head</strong></em> – <strong>head</strong> 修订，以作为父版本构建新修订； 这是 <code>alembic revision</code> 命令的 <code>--head</code> 选项。</li>
<li><em><strong>splice</strong></em> – 新的修订是否应该成为的新 <strong>head</strong>； 当给定的 <code>head</code> 本身不是 <code>head</code> 时是必需的。 这是 <code>alembic revision</code>命令的 <code>--splice</code> 选项。</li>
<li><em><strong>branch_label</strong></em> – 应用于分支的字符串标签； 这是 <code>alembic revision</code>命令的 <code>--branch-label</code> 选项。</li>
<li><em><strong>version_path</strong></em> – 标识配置中特定版本路径的字符串符号；  这是 <code>alembic revision</code>命令的 <code>--version-path</code> 选项。</li>
<li><em><strong>rev_id</strong></em> – 要使用的可选修订标识符，而不是生成一个； 这是 <code>alembic revision</code>命令的 <code>--rev-id</code> 选项。</li>
<li><em><strong>depends_on</strong></em> – “依赖于xxx”标识符的可选列表； 这是 <code>alembic revision</code>命令的 <code>--depends-on</code> 选项。</li>
<li><em><strong>process_revision_directives</strong></em> – 这是一个可调用对象，其形式与 <strong><a href="zh/../zh/08_02_01_02_configure.html#process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> 中描述的可调用对象相同； 将应用于由修订过程生成的结构，可以通过编程方式对其进行更改。 请注意，与所有其他参数不同，此选项仅可通过以编程方式使用 <strong><a href="zh/../zh/08_04_11_revision.html">command.revision()</a></strong></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="show"><a class="header" href="#show">show</a></h1>
<p>alembic.command.<strong>show</strong>(config, rev)</p>
<p>Show the revision(s) denoted by the given symbol.</p>
<blockquote>
<p>显示由给定符号表示的修订。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>revision</strong></em> – string <strong>revision</strong> target</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>revision</strong></em> – 字符串的目标 <strong>修订</strong></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stamp-1"><a class="header" href="#stamp-1">stamp</a></h1>
<p>alembic.command.<strong>stamp</strong>(<em>config</em>:  Config, <em>revision</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>sql</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>tag</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>purge</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False) → None</p>
<p>‘stamp’ the revision table with the given revision; don’t run any migrations.</p>
<blockquote>
<p>用给定的修订“标记”修订表； 不要运行任何迁移。</p>
</blockquote>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</p>
</li>
<li>
<p><em><strong>revision</strong></em> – target revision or list of revisions. May be a list to indicate stamping of multiple branch heads.</p>
<p><strong>Note:</strong> this parameter is called “revisions” in the command line interface.</p>
<p><em>Changed in version 1.2</em>: The revision may be a single revision or list of revisions when stamping multiple branch heads.</p>
</li>
<li>
<p><em><strong>sql</strong></em> – use <code>--sql</code> mode</p>
</li>
<li>
<p><em><strong>tag</strong></em> – an arbitrary “tag” that can be intercepted by custom <code>env.py</code> scripts via the <strong>[EnvironmentContext.get_tag_argument]</strong> method.</p>
</li>
<li>
<p><em><strong>purge</strong></em> – delete all entries in the version table before stamping.</p>
<p><em>New in version 1.2.</em></p>
</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li>
<p><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</p>
</li>
<li>
<p><em><strong>revision</strong></em> – 目标修订或修订列表。 可能是一个列表，表明多个分支head的标记。</p>
<p><strong>注意:</strong> 此参数在命令行界面中称为 “revisions”。</p>
<p><em>版本1.2更新</em>: 当标记多个分支head时，修订可以是单个修订或修订列表。</p>
</li>
<li>
<p><em><strong>sql</strong></em> – 使用 <code>--sql</code> 模式</p>
</li>
<li>
<p><em><strong>tag</strong></em> – 一个任意&quot;标签&quot;, 可以通过 <code>env.py</code> 文件中的 <strong>[EnvironmentContext.get_tag_argument]</strong> 方法定义。</p>
</li>
<li>
<p><em><strong>purge</strong></em> – 在标记之前删除版本表中的所有条目。</p>
<p><em>版本 1.2.中新增</em></p>
</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="upgrade"><a class="header" href="#upgrade">upgrade</a></h1>
<p>alembic.command.<strong>upgrade</strong>(<em>config</em>:  Config, <em>revision</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>sql</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>tag</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → None</p>
<p>Upgrade to a later version.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><em><strong>config</strong></em> – a <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> instance.</li>
<li><em><strong>revision</strong></em> – string <strong>revision</strong> target or range for –sql mode</li>
<li><em><strong>sql</strong></em> – if True, use <code>--sql</code> mode</li>
<li><em><strong>tag</strong></em> – an arbitrary “tag” that can be intercepted by custom <code>env.py</code> scripts via the <strong><a href="zh/../zh/08_02_01_10_get_tag_argument.html">EnvironmentContext.get_tag_argument()</a></strong> method.</li>
</ul>
<blockquote>
<p>参数:</p>
<ul>
<li><em><strong>config</strong></em> – 一个 <strong><a href="zh/../zh/08_03_configuration.html">Config</a></strong> 实例.</li>
<li><em><strong>revision</strong></em> – <code>–sql</code> 模式的字符串 <strong>修订</strong> 目标或范围</li>
<li><em><strong>sql</strong></em> – 如果为 <code>True</code> , 使用 <code>--sql</code> 模式</li>
<li><em><strong>tag</strong></em> – 一个任意&quot;标签&quot;, 可以通过 <code>env.py</code> 文件中的 <strong>[EnvironmentContext.get_tag_argument]</strong> 方法定义。</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operation-directives"><a class="header" href="#operation-directives">Operation Directives</a></h1>
<blockquote>
<p><strong>Note:</strong> this section discusses the <strong>internal API of Alembic</strong> as regards the internal system of defining migration operation directives. This section is only useful for developers who wish to extend the capabilities of Alembic. For end-user guidance on Alembic migration operations, please see <strong><a href="zh/../en/../ops.html#ops">Operation Reference</a></strong>.</p>
</blockquote>
<p>Within migration scripts, actual database migration operations are handled via an instance of <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong>. The <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class lists out available migration operations that are linked to a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>, which communicates instructions originated by the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> object into SQL that is sent to a database or SQL output stream.</p>
<p>Most methods on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class are generated dynamically using a “plugin” system, described in the next section <strong><a href="zh/08_05_operation_directives.html#operation-plugins">Operation Plugins</a></strong>. Additionally, when Alembic migration scripts actually run, the methods on the current <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> object are proxied out to the <code>alembic.op</code> module, so that they are available using module-style access.</p>
<p>For an overview of how to use an <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> object directly in programs, as well as for reference to the standard operation methods as well as “batch” methods, see <strong><a href="zh/../en/../ops.html#ops">Operation Reference</a></strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operation-plugins"><a class="header" href="#operation-plugins">Operation Plugins</a></h1>
<p>The Operations object is extensible using a plugin system. This system allows one to add new <code>op.&lt;some_operation&gt;</code> methods at runtime. The steps to use this system are to first create a subclass of <strong><a href="zh/08_05_01_operation_plugins.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong>, register it using the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.register_operation">Operations.register_operation()</a></strong> class decorator, then build a default “implementation” function which is established using the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.implementation_for">Operations.implementation_for()</a></strong> decorator.</p>
<p>Below we illustrate a very simple operation <code>CreateSequenceOp</code> which will implement a new method <code>op.create_sequence()</code> for use in migration scripts:</p>
<pre><code class="language-python">from alembic.operations import Operations, MigrateOperation

@Operations.register_operation(&quot;create_sequence&quot;)
class CreateSequenceOp(MigrateOperation):
    &quot;&quot;&quot;Create a SEQUENCE.&quot;&quot;&quot;

    def __init__(self, sequence_name, schema=None):
        self.sequence_name = sequence_name
        self.schema = schema

    @classmethod
    def create_sequence(cls, operations, sequence_name, **kw):
        &quot;&quot;&quot;Issue a &quot;CREATE SEQUENCE&quot; instruction.&quot;&quot;&quot;

        op = CreateSequenceOp(sequence_name, **kw)
        return operations.invoke(op)

    def reverse(self):
        # only needed to support autogenerate
        return DropSequenceOp(self.sequence_name, schema=self.schema)

@Operations.register_operation(&quot;drop_sequence&quot;)
class DropSequenceOp(MigrateOperation):
    &quot;&quot;&quot;Drop a SEQUENCE.&quot;&quot;&quot;

    def __init__(self, sequence_name, schema=None):
        self.sequence_name = sequence_name
        self.schema = schema

    @classmethod
    def drop_sequence(cls, operations, sequence_name, **kw):
        &quot;&quot;&quot;Issue a &quot;DROP SEQUENCE&quot; instruction.&quot;&quot;&quot;

        op = DropSequenceOp(sequence_name, **kw)
        return operations.invoke(op)

    def reverse(self):
        # only needed to support autogenerate
        return CreateSequenceOp(self.sequence_name, schema=self.schema)
</code></pre>
<p>Above, the <code>CreateSequenceOp</code> and <code>DropSequenceOp</code> classes represent new operations that will be available as <code>op.create_sequence()</code> and <code>op.drop_sequence()</code>. The reason the operations are represented as stateful classes is so that an operation and a specific set of arguments can be represented generically; the state can then correspond to different kinds of operations, such as invoking the instruction against a database, or autogenerating Python code for the operation into a script.</p>
<p>In order to establish the migrate-script behavior of the new operations, we use the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.implementation_for">Operations.implementation_for()</a></strong> decorator:</p>
<pre><code class="language-python">@Operations.implementation_for(CreateSequenceOp)
def create_sequence(operations, operation):
    if operation.schema is not None:
        name = &quot;%s.%s&quot; % (operation.schema, operation.sequence_name)
    else:
        name = operation.sequence_name
    operations.execute(&quot;CREATE SEQUENCE %s&quot; % name)


@Operations.implementation_for(DropSequenceOp)
def drop_sequence(operations, operation):
    if operation.schema is not None:
        name = &quot;%s.%s&quot; % (operation.schema, operation.sequence_name)
    else:
        name = operation.sequence_name
    operations.execute(&quot;DROP SEQUENCE %s&quot; % name)
</code></pre>
<p>Above, we use the simplest possible technique of invoking our DDL, which is just to call <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.execute">Operations.execute()</a></strong> with literal SQL. If this is all a custom operation needs, then this is fine. However, options for more comprehensive support include building out a custom SQL construct, as documented at <strong><a href="https://docs.sqlalchemy.org/en/14/core/compiler.html#sqlalchemy-ext-compiler-toplevel">Custom SQL Constructs and Compilation Extension</a></strong>.</p>
<p>With the above two steps, a migration script can now use new methods <code>op.create_sequence()</code> and <code>op.drop_sequence()</code> that will proxy to our object as a classmethod:</p>
<pre><code class="language-python">def upgrade():
    op.create_sequence(&quot;my_sequence&quot;)

def downgrade():
    op.drop_sequence(&quot;my_sequence&quot;)
</code></pre>
<p>The registration of new operations only needs to occur in time for the <code>env.py</code> script to invoke MigrationContext.run_migrations(); within the module level of the <code>env.py</code> script is sufficient.</p>
<p><strong>See also:</strong></p>
<p><a href="zh/../en/autogenerate.html#autogen-custom-ops">Autogenerating Custom Operation Directives</a> - how to add autogenerate support to custom operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="built-in-operation-objects"><a class="header" href="#built-in-operation-objects">Built-in Operation Objects</a></h1>
<p>The migration operations present on <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> are themselves delivered via operation objects that represent an operation and its arguments. All operations descend from the <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> class, and are registered with the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class using the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong>.register_operation() class decorator. The <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> objects also serve as the basis for how the autogenerate system renders new migration scripts.</p>
<p><strong>See also:</strong></p>
<ul>
<li>
<p><strong><a href="zh/08_05_02_built_in_operation_objects.html#operation-plugins">Operation Plugins</a></strong></p>
</li>
<li>
<p><strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong></p>
</li>
</ul>
<p>The built-in operation objects are listed below.</p>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>AddColumnOp</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column</em>:  Column, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Optional[Table] Optional[Table]</p>
<p>Represent an add column operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>add_column</strong>(<em>operations</em>:  Operations, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column</em>:  Column, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.add_column">Operations.add_column()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>batch_add_column</strong>(<em>operations</em>:  BatchOperations, <em>column</em>:  Column, <em>insert_before</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>insert_after</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.add_column">BatchOperations.add_column()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>AddConstraintOp</strong></p>
<p>Represent an add constraint operation.</p>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>AlterColumnOp</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>existing_type</em>:  Optional[Any] = None, <em>existing_server_default</em>:  Any = False, <em>existing_nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>modify_nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>modify_comment</em>:  Optional[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>]] = False, <em>modify_server_default</em>:  Any = False, <em>modify_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>modify_type</em>:  Optional[Any] = None, **kw)</p>
<p>Represent an alter column operation.</p>
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>alter_column batch_alter_column</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.Operations">alembic.operations.base.Operations</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>comment</em>:  Optional[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>]] = False, <em>server_default</em>:  Any = False, <em>new_column_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>type_</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_type</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_server_default</em>:  Optional[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>, Identity, Computed]] = False, <em>existing_nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,**kw) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.alter_column">Operations.alter_column()</a></strong> method.</p>
</li>
<li>
<p><em>class</em> alembic.operations.ops.<strong>batch_alter_column</strong>(  <em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.BatchOperations">alembic.operations.base.BatchOperations</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>nullable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>comment</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>server_default</em>:  Union[Function, <a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = False, <em>new_column_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>type_</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_type</em>:  Optional[Union[TypeEngine, Type[TypeEngine]]] = None, <em>existing_server_default</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>existing_nullable</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>existing_comment</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>insert_before</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>insert_after</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>,**kw) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.alter_column">BatchOperations.alter_column()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>AlterTableOp</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None)</p>
<p>Represent an alter table operation.</p>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>BulkInsertOp</strong>(<em>table</em>:  Union[Table, TableClause], <em>rows</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>], <em>multiinsert</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = True) → None</p>
<p>Represent a bulk insert operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>bulk_insert</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.Operations">alembic.operations.base.Operations</a>, <em>table</em>:  Union[Table, TableClause], <em>rows</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>], <em>multiinsert</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = True) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.bulk_insert">Operations.bulk_insert()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreateCheckConstraintOp</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>condition</em>:  Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, TextClause, ColumnElement[Any]], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw)</p>
<p>Represent a create check constraint operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>batch_create_check_constraint</strong>(<em>operations</em>:  BatchOperations, <em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>condition</em>:  TextClause, **kw) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.create_check_constraint">BatchOperations.create_check_constraint()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>create_check_constraint</strong>(<em>operations</em>:  Operations, <em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>condition</em>:  Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, BinaryExpression], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → <a href="https://docs.python.org/3/library/constants.html#None">None</a></p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_check_constraint">Operations.create_check_constraint()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreateForeignKeyOp</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>source_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>referent_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>local_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>remote_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], **kw)</p>
<p>Represent a create foreign key constraint operation.</p>
<ul>
<li>
<p><em>class</em> <strong>batch_create_foreign_key</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.BatchOperations">alembic.operations.base.BatchOperations</a>, <em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>referent_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>local_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>remote_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>referent_schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>onupdate</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>ondelete</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>deferrable</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>initially</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>match</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>,**dialect_kw) → None Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.create_foreign_key">BatchOperations.create_foreign_key()</a></strong> method.</p>
</li>
<li>
<p><em>class</em> <strong>create_foreign_key</strong>(<em>operations</em>:  Operations, <em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>],<em>source_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>referent_table</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>local_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>remote_cols</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>],<em>onupdate</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,<em>ondelete</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,<em>deferrable</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None,<em>initially</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,<em>match</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,<em>source_schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>referent_schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **dialect_kw) → None Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_foreign_key">Operations.create_foreign_key()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreateIndexOp batch_create_index create_index</strong>(<em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, TextClause, ColumnElement[Any]]], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>unique</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, **kw)
Represent a create index operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>CreateIndexOp</strong>(kw, <em>operations</em>:  BatchOperations, <em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], **kw, ) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.create_index">BatchOperations.create_index()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>create_index</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.Operations">alembic.operations.base.Operations</a>, <em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, TextClause, Function]], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>unique</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, **kw) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_index">Operations.create_index()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreatePrimaryKeyOp</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw)</p>
<p>Represent a create primary key operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>batch_create_primary_key</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.BatchOperations">alembic.operations.base.BatchOperations</a>, <em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>columns</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>],) → None</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.create_primary_key">BatchOperations.create_primary_key()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>create_primary_key</strong>(<em>operations</em>:  Operations,<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>columns</em>:  List[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>],<em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_primary_key">Operations.create_primary_key()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreateTableCommentOp</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, operations, comment, existing_comment=None)</p>
<p>Represent a COMMENT ON table operation.</p>
<ul>
<li>
<p><em>classmethod</em>  <strong>batch_create_table_comment</strong>(operations, comment, existing_comment=None)</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.create_table_comment">BatchOperations.create_table_comment()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em>  <strong>create_table_comment</strong>(<em>operations</em>:  Operations, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>],<em>existing_comment</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_table_comment">Operations.create_table_comment()</a></strong> method.</p>
</li>
<li>
<p><strong>reverse</strong>()</p>
<p>Reverses the COMMENT ON operation against a table.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreateTableOp</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[Union[Column, Constraint]], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>_namespace_metadata</em>:  Optional[MetaData] = None, <em>_constraints_included</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, **kw)</p>
<p>Represent a create table operation.</p>
<ul>
<li>
<p><em>classmethod</em>  <strong>create_table</strong>(<em>operations</em>:  Operations,<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, *columns, **kw) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_table">Operations.create_table()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>CreateUniqueConstraintOp</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw)</p>
<p>Represent a create unique constraint operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>batch_create_unique_constraint</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.BatchOperations">alembic.operations.base.BatchOperations</a>, <em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>columns</em>:  Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], **kw) → Any</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.create_unique_constraint">BatchOperations.create_unique_constraint()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>create_unique_constraint</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.Operations">alembic.operations.base.Operations</a>, <em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>columns</em>:  Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,**kw) → Any</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.create_unique_constraint">Operations.create_unique_constraint()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>DowngradeOps</strong>(<em>ops</em>:  Sequence[[alembic.operations.ops.MigrateOperation]] = (), <em>downgrade_token</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'downgrades')</p>
<p>contains a sequence of operations that would apply to the ‘downgrade’ stream of a script.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong></p>
</blockquote>
</li>
</ul>
<hr />
<p><em>class</em> alembic.operations.ops.<strong>DropColumnOp batch_drop_column drop_column</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>_reverse</em>:  Optional[[alembic.operations.ops.AddColumnOp]] = None, **kw)</p>
<pre><code>Represent a drop column operation.
</code></pre>
<ul>
<li><em>classmethod</em> <strong>batch_drop_column</strong>(<em>operations</em>:  BatchOperations, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, **kw) → Optional[Table]</li>
</ul>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.drop_column">BatchOperations.drop_column()</a></strong> method.</p>
<ul>
<li><em>classmethod</em> <strong>drop_column</strong>(<em>operations</em>:  Operations, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>column_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw) → Optional[Table]</li>
</ul>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.drop_column">Operations.drop_column()</a></strong> method.</p>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>DropConstraintOp</strong>(<em>constraint_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>type_</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>_reverse</em>:  Optional[[alembic.operations.ops.AddConstraintOp]] = None)</p>
<p>Represent a drop constraint operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>batch_drop_constraint drop_constraint</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.BatchOperations">alembic.operations.base.BatchOperations</a>, <em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>type_</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → None</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.drop_constraint">BatchOperations.drop_constraint()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>batch_drop_constraint drop_constraint</strong>(<em>operations</em>:  Operations, <em>constraint_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>type_</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.drop_constraint">Operations.drop_constraint()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>DropIndexOp</strong>(<em>index_name</em>:  Union[quoted_name, <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, conv], <em>table_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>_reverse</em>:  Optional[[CreateIndexOp]] = None, **kw)</p>
<p>Represent a drop index operation.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>batch_drop_index</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.BatchOperations">alembic.operations.base.BatchOperations</a>, <em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, **kw) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations.drop_index">BatchOperations.drop_index()</a></strong> method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>drop_index</strong>(<em>operations</em>:  Operations, <em>index_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>table_name</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None,**kw) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.drop_index">Operations.drop_index()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>DropTableCommentOp batch_drop_table_comment drop_table_comment reverse</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None)</p>
<p>Represent an operation to remove the comment from a table.</p>
<ul>
<li>
<p><em>classmethod</em> <strong>batch_drop_table_comment</strong>(operations, existing_comment=None)</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.BatchOperations">BatchOperations</a></strong>.drop_table_comment() method.</p>
</li>
<li>
<p><em>classmethod</em> <strong>drop_table_comment</strong>(<em>operations</em>:  Operations, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>existing_comment</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong>.drop_table_comment() method.</p>
</li>
<li>
<p><strong>reverse</strong>()</p>
<p>Reverses the COMMENT ON operation against a table.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>DropTableOp drop_table</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>table_kw</em>:  Optional[MutableMapping[Any, Any]] = None, <em>_reverse</em>:  Optional[[alembic.operations.ops.CreateTableOp]] = None) → None</p>
<p>Represent a drop table operation.</p>
</li>
<li>
<p><em>classmethod</em>  <strong>drop_table</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.Operations">alembic.operations.base.Operations</a>, <em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>,<em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, **kw: Any) → None</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.drop_table">Operations.drop_table()</a></strong> method.</p>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>ExecuteSQLOp execute</strong>(<em>sqltext</em>:  Union[Update, <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, Insert, TextClause], <em>execution_options</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>)</p>
<p>Represent an execute SQL operation.</p>
<ul>
<li>
<p><strong>execute</strong>(<em>operations</em>:  <a href="zh/../en/../ops.html#alembic.operations.Operations">alembic.operations.base.Operations</a>, <em>sqltext</em>:  Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, TextClause, Update], <em>execution_options</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations.execute">Operations.execute()</a></strong> method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>MigrateOperation</strong></p>
<p>base class for migration command and organization objects.</p>
<p>This system is part of the operation extensibility API.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/08_05_02_built_in_operation_objects.html#operation-objects">Built-in Operation Objects</a></strong></p>
<ul>
<li>
<p><strong><a href="zh/08_05_02_built_in_operation_objects.html#operation-plugins">Operation Plugins</a></strong></p>
</li>
<li>
<p><strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong></p>
</li>
</ul>
</blockquote>
<ul>
<li>
<p><strong>info</strong></p>
<p>A dictionary that may be used to store arbitrary information along with this <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> object.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>MigrationScript</strong>(<em>rev_id</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <em>upgrade_ops</em>:  [alembic.operations.ops.UpgradeOps], <em>downgrade_ops</em>:  [alembic.operations.ops.DowngradeOps], <em>message</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>imports</em>:  Set[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = {}, <em>head</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>splice</em>:  Optional[<a href="https://docs.python.org/3/library/functions.html#bool">bool</a>] = None, <em>branch_label</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>version_path</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None, <em>depends_on</em>:  Optional[Union[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, Sequence[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]]] = None)</p>
<p>represents a migration script.</p>
<p>E.g. when autogenerate encounters this object, this corresponds to the production of an actual script file.</p>
<p>A normal <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> object would contain a single <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> and a single <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> directive. These are accessible via the <code>.upgrade_ops</code> and <code>.downgrade_ops</code> attributes.</p>
<p>In the case of an autogenerate operation that runs multiple times, such as the multiple database example in the “multidb” template, the <code>.upgrade_ops</code> and <code>.downgrade_ops</code> attributes are disabled, and instead these objects should be accessed via the <code>.upgrade_ops_list</code> and <code>.downgrade_ops_list</code> list-based attributes. These latter attributes are always available at the very least as single-element lists.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong></p>
</blockquote>
<ul>
<li>
<p><em>property</em> <strong>downgrade_ops</strong></p>
<p>An instance of <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong>.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrationScript.downgrade_ops_list">MigrationScript.downgrade_ops_list</a></strong></p>
</blockquote>
</li>
<li>
<p><em>property</em> <strong>downgrade_ops_list:</strong> List[[alembic.operations.ops.DowngradeOps]]</p>
<p>A list of <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> instances.</p>
<p>This is used in place of the <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrationScript.downgrade_ops">MigrationScript.downgrade_ops</a></strong> attribute when dealing with a revision operation that does multiple autogenerate passes.</p>
</li>
<li>
<p><em>property</em> <strong>upgrade_ops</strong></p>
<p>An instance of <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong>.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrationScript.upgrade_ops_list">MigrationScript.upgrade_ops_list</a></strong></p>
</blockquote>
</li>
<li>
<p><em>property</em> <strong>upgrade_ops_list</strong></p>
<p>A list of <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> instances.</p>
<p>This is used in place of the <strong><a href="zh/08_05_02_built_in_operation_objects.html#alembic.operations.ops.MigrationScript.upgrade_ops">MigrationScript.upgrade_ops</a></strong> attribute when dealing with a revision operation that does multiple autogenerate passes.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>ModifyTableOps</strong>(<em>table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>ops</em>:  Sequence[[alembic.operations.ops.MigrateOperation]], <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None)</p>
<p>Contains a sequence of operations that all apply to a single Table.</p>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>OpContainer</strong>(<em>ops</em>:  Sequence[[alembic.operations.ops.MigrateOperation]] = ())</p>
<p>Represent a sequence of operations operation.</p>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>RenameTableOp rename_table</strong>(<em>old_table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>new_table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None)</p>
<p>Represent a rename table operation.</p>
<ul>
<li>
<p><strong>rename_table</strong>(<em>operations</em>:  Operations, <em>old_table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>new_table_name</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <em>schema</em>:  Optional[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] = None) → Optional[Table]</p>
<p>This method is proxied on the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong> class, via the <strong><a href="zh/../en/../ops.html#alembic.operations.Operations">Operations</a></strong>.rename_table() method.</p>
</li>
</ul>
</li>
</ul>
<hr />
<ul>
<li>
<p><em>class</em> alembic.operations.ops.<strong>UpgradeOps</strong>(<em>ops</em>:  Sequence[[alembic.operations.ops.MigrateOperation]] = (), <em>upgrade_token</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'upgrades')</p>
<p>contains a sequence of operations that would apply to the ‘upgrade’ stream of a script.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/../en/autogenerate.html#customizing-revision">Customizing Revision Generation</a></strong></p>
</blockquote>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="autogeneration"><a class="header" href="#autogeneration">Autogeneration</a></h1>
<blockquote>
<p><strong>Note:</strong> this section discusses the <strong>internal API of Alembic</strong> as regards the autogeneration feature of the <code>alembic revision</code> command. This section is only useful for developers who wish to extend the capabilities of Alembic. For general documentation on the autogenerate feature, please see <strong><a href="zh/../en/../autogenerate.html">Auto Generating Migrations</a></strong>.</p>
</blockquote>
<p>The autogeneration system has a wide degree of public API, including the following areas:</p>
<ol>
<li>The ability to do a “diff” of a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object against a database, and receive a data structure back. This structure is available either as a rudimentary list of changes, or as a <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> structure.</li>
<li>The ability to alter how the <code>alembic revision</code> command generates revision scripts, including support for multiple revision scripts generated in one pass.</li>
<li>The ability to add new operation directives to autogeneration, including custom schema/model comparison functions and revision script rendering.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-diffs"><a class="header" href="#getting-diffs">Getting Diffs</a></h1>
<p>The simplest API autogenerate provides is the “schema comparison” API; these are simple functions that will run all registered “comparison” functions between a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object and a database backend to produce a structure showing how they differ. The two functions provided are <strong><a href="zh/08_06_01_getting_diffs.html#alembic.autogenerate.compare_metadata">compare_metadata()</a></strong>, which is more of the “legacy” function that produces diff tuples, and <strong><a href="zh/08_06_01_getting_diffs.html#alembic.autogenerate.produce_migrations">produce_migrations()</a></strong>, which produces a structure consisting of operation directives detailed in <strong><a href="zh/../en/operations.html#alembic-operations-toplevel">Operation Directives</a></strong>.</p>
<ul>
<li>
<p><em>class</em> alembic.autogenerate.<strong>compare_metadata</strong>(<em>context</em>:  MigrationContext, <em>metadata</em>:  MetaData) → Any</p>
<p>Compare a database schema to that given in a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> instance.</p>
<p>The database connection is presented in the context of a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> object, which provides database connectivity as well as optional comparison functions to use for datatypes and server defaults - see the “autogenerate” arguments at <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">EnvironmentContext.configure()</a></strong> for details on these.</p>
<p>The return format is a list of “diff” directives, each representing individual differences:</p>
<pre><code class="language-python">from alembic.migration import MigrationContext
from alembic.autogenerate import compare_metadata
from sqlalchemy.schema import SchemaItem
from sqlalchemy.types import TypeEngine
from sqlalchemy import (create_engine, MetaData, Column,
        Integer, String, Table, text)
import pprint

engine = create_engine(&quot;sqlite://&quot;)

with engine.begin() as conn:
    conn.execute(text('''
        create table foo (
            id integer not null primary key,
            old_data varchar,
            x integer
        )'''))

    conn.execute(text('''
        create table bar (
            data varchar
        )'''))

metadata = MetaData()
Table('foo', metadata,
    Column('id', Integer, primary_key=True),
    Column('data', Integer),
    Column('x', Integer, nullable=False)
)
Table('bat', metadata,
    Column('info', String)
)

mc = MigrationContext.configure(engine.connect())

diff = compare_metadata(mc, metadata)
pprint.pprint(diff, indent=2, width=20)
</code></pre>
<p>Output:</p>
<pre><code class="language-python">[ ( 'add_table',
    Table('bat', MetaData(bind=None),
        Column('info', String(), table=&lt;bat&gt;), schema=None)),
( 'remove_table',
    Table(u'bar', MetaData(bind=None),
        Column(u'data', VARCHAR(), table=&lt;bar&gt;), schema=None)),
( 'add_column',
    None,
    'foo',
    Column('data', Integer(), table=&lt;foo&gt;)),
( 'remove_column',
    None,
    'foo',
    Column(u'old_data', VARCHAR(), table=None)),
[ ( 'modify_nullable',
    None,
    'foo',
    u'x',
    { 'existing_server_default': None,
        'existing_type': INTEGER()},
    True,
    False)]]
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><em><strong>context</strong></em> – a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> instance.</p>
</li>
<li>
<p><em><strong>metadata</strong></em> – a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> instance.</p>
<blockquote>
<p><strong>See also:</strong> <strong><a href="zh/08_06_01_getting_diffs.html#alembic.autogenerate.produce_migrations">produce_migrations()</a></strong> - produces a <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> structure based on metadata comparison.</p>
<ul>
<li><em><strong>context</strong></em> – a <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> instance.</li>
<li><em><strong>metadata</strong></em> – a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> instance.</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li>
<p><em>class</em> alembic.autogenerate.<strong>produce_migrations</strong>(<em>context</em>:  MigrationContext, <em>metadata</em>:  MetaData) → MigrationScript</p>
<p>Produce a <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> structure based on schema comparison.</p>
<p>This function does essentially what <strong><a href="zh/08_06_01_getting_diffs.html#alembic.autogenerate.compare_metadata">compare_metadata()</a></strong> does, but then runs the resulting list of diffs to produce the full <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> object. For an example of what this looks like, see the example in <strong><a href="zh/08_06_01_getting_diffs.html#customizing-revision">Customizing Revision Generation</a></strong>.</p>
<p><strong>See also:</strong> <strong><a href="zh/08_06_01_getting_diffs.html#alembic.autogenerate.compare_metadata">compare_metadata()</a></strong> - returns more fundamental “diff” data from comparing a schema.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="customizing-revision-generation"><a class="header" href="#customizing-revision-generation">Customizing Revision Generation</a></h1>
<p>The <code>alembic revision</code> command, also available programmatically via <strong><a href="zh/../en/commands.html#alembic.command.revision">command.revision()</a></strong>, essentially produces a single migration script after being run. Whether or not the <code>--autogenerate</code> option was specified basically determines if this script is a blank revision script with empty <code>upgrade()</code> and <code>downgrade()</code> functions, or was produced with alembic operation directives as the result of autogenerate.</p>
<p>In either case, the system creates a full plan of what is to be done in the form of a <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> structure, which is then used to produce the script.</p>
<p>For example, suppose we ran <code>alembic revision --autogenerate</code>, and the end result was that it produced a new revision <code>'eced083f5df'</code> with the following contents:</p>
<pre><code class="language-python">&quot;&quot;&quot;create the organization table.&quot;&quot;&quot;

# revision identifiers, used by Alembic.
revision = 'eced083f5df'
down_revision = 'beafc7d709f'

from alembic import op
import sqlalchemy as sa


def upgrade():
    op.create_table(
        'organization',
        sa.Column('id', sa.Integer(), primary_key=True),
        sa.Column('name', sa.String(50), nullable=False)
    )
    op.add_column(
        'user',
        sa.Column('organization_id', sa.Integer())
    )
    op.create_foreign_key(
        'org_fk', 'user', 'organization', ['organization_id'], ['id']
    )

def downgrade():
    op.drop_constraint('org_fk', 'user')
    op.drop_column('user', 'organization_id')
    op.drop_table('organization')
</code></pre>
<p>The above script is generated by a <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> structure that looks like this:</p>
<pre><code class="language-python">from alembic.operations import ops
import sqlalchemy as sa

migration_script = ops.MigrationScript(
    'eced083f5df',
    ops.UpgradeOps(
        ops=[
            ops.CreateTableOp(
                'organization',
                [
                    sa.Column('id', sa.Integer(), primary_key=True),
                    sa.Column('name', sa.String(50), nullable=False)
                ]
            ),
            ops.ModifyTableOps(
                'user',
                ops=[
                    ops.AddColumnOp(
                        'user',
                        sa.Column('organization_id', sa.Integer())
                    ),
                    ops.CreateForeignKeyOp(
                        'org_fk', 'user', 'organization',
                        ['organization_id'], ['id']
                    )
                ]
            )
        ]
    ),
    ops.DowngradeOps(
        ops=[
            ops.ModifyTableOps(
                'user',
                ops=[
                    ops.DropConstraintOp('org_fk', 'user'),
                    ops.DropColumnOp('user', 'organization_id')
                ]
            ),
            ops.DropTableOp('organization')
        ]
    ),
    message='create the organization table.'
)
</code></pre>
<p>When we deal with a <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> structure, we can render the upgrade/downgrade sections into strings for debugging purposes using the <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.render_python_code">render_python_code()</a></strong> helper function:</p>
<pre><code class="language-python">from alembic.autogenerate import render_python_code
print(render_python_code(migration_script.upgrade_ops))
</code></pre>
<p>Renders:</p>
<pre><code class="language-python">### commands auto generated by Alembic - please adjust! ###
    op.create_table('organization',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.add_column('user', sa.Column('organization_id', sa.Integer(), nullable=True))
    op.create_foreign_key('org_fk', 'user', 'organization', ['organization_id'], ['id'])
    ### end Alembic commands ###
</code></pre>
<p>Given that structures like the above are used to generate new revision files, and that we’d like to be able to alter these as they are created, we then need a system to access this structure when the <strong><a href="zh/../en/commands.html#alembic.command.revision">command.revision()</a></strong> command is used. The <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> parameter gives us a way to alter this. This is a function that is passed the above structure as generated by Alembic, giving us a chance to alter it. For example, if we wanted to put all the “upgrade” operations into a certain branch, and we wanted our script to not have any “downgrade” operations at all, we could build an extension as follows, illustrated within an <code>env.py</code> script:</p>
<pre><code class="language-python">def process_revision_directives(context, revision, directives):
    script = directives[0]

    # set specific branch
    script.head = &quot;mybranch@head&quot;

    # erase downgrade operations
    script.downgrade_ops.ops[:] = []

# ...

def run_migrations_online():

    # ...
    with engine.connect() as connection:

        context.configure(
            connection=connection,
            target_metadata=target_metadata,
            process_revision_directives=process_revision_directives)

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p>Above, the <code>directives</code> argument is a Python list. We may alter the given structure within this list in-place, or replace it with a new structure consisting of zero or more <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> <code>directives</code>. The <strong><a href="zh/../en/commands.html#alembic.command.revision">command.revision()</a></strong> command will then produce scripts corresponding to whatever is in this list.</p>
<blockquote>
<p><strong>See also:</strong> More examples of using <a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></p>
<ul>
<li><strong><a href="zh/../en/../cookbook.html#cookbook-no-empty-migrations">Don’t Generate Empty Migrations with Autogenerate</a></strong></li>
<li><strong><a href="zh/../en/../cookbook.html#cookbook-dont-emit-drop-index">Don’t emit DROP INDEX when the table is to be dropped as well</a></strong></li>
<li><strong><a href="zh/../en/../cookbook.html#cookbook-custom-sorting-create-table">Apply Custom Sorting to Table Columns within CREATE TABLE</a></strong></li>
</ul>
</blockquote>
<ul>
<li>
<p>alembic.autogenerate.<strong>render_python_code</strong>(<em>up_or_down_op</em>:  UpgradeOps, <em>sqlalchemy_module_prefix</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'sa.', <em>alembic_module_prefix</em>:  <a href="https://docs.python.org/3/library/stdtypes.html#str">str</a> = 'op.', <em>render_as_batch</em>:  <a href="https://docs.python.org/3/library/functions.html#bool">bool</a> = False, <em>imports</em>:  Tuple[<a href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, ...] = (), <em>render_item</em>:  <a href="https://docs.python.org/3/library/constants.html#None">None</a> = <a href="https://docs.python.org/3/library/constants.html#None">None</a>, <em>migration_context</em>:  Optional[MigrationContext] = None) → str</p>
<p>Render Python code given an <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> or <strong><a href="zh/../en/operations.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> object.</p>
<p>This is a convenience function that can be used to test the autogenerate output of a user-defined <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> structure.</p>
</li>
</ul>
<h2 id="fine-grained-autogenerate-generation-with-rewriters"><a class="header" href="#fine-grained-autogenerate-generation-with-rewriters">Fine-Grained Autogenerate Generation with Rewriters</a></h2>
<p><strong>带有重写器的细粒度自动生成</strong></p>
<p>The preceding example illustrated how we can make a simple change to the structure of the operation directives to produce new autogenerate output. For the case where we want to affect very specific parts of the autogenerate stream, we can make a function for <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> which traverses through the whole <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">MigrationScript</a></strong> structure, locates the elements we care about and modifies them in-place as needed. However, to reduce the boilerplate associated with this task, we can use the <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> object to make this easier. <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> gives us an object that we can pass directly to <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> which we can also attach handler functions onto, keyed to specific types of constructs.</p>
<p>Below is an example where we rewrite <strong><a href="zh/../en/operations.html#alembic.operations.ops.AddColumnOp">ops.AddColumnOp</a></strong> directives; based on whether or not the new column is “nullable”, we either return the existing directive, or we return the existing directive with the nullable flag changed, inside of a list with a second directive to alter the nullable flag in a second step:</p>
<pre><code class="language-python"># ... fragmented env.py script ....

from alembic.autogenerate import rewriter
from alembic.operations import ops

writer = rewriter.Rewriter()

@writer.rewrites(ops.AddColumnOp)
def add_column(context, revision, op):
    if op.column.nullable:
        return op
    else:
        op.column.nullable = True
        return [
            op,
            ops.AlterColumnOp(
                op.table_name,
                op.column.name,
                modify_nullable=False,
                existing_type=op.column.type,
            )
        ]

# ... later ...

def run_migrations_online():
    # ...

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata,
            process_revision_directives=writer
        )

        with context.begin_transaction():
            context.run_migrations()
</code></pre>
<p>Above, in a full <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript">ops.MigrationScript</a></strong> structure, the <strong><a href="zh/../en/ddl.html#alembic.ddl.base.AddColumn">AddColumn</a></strong> directives would be present within the paths <code>MigrationScript-&gt;UpgradeOps-&gt;ModifyTableOps</code> and <code>MigrationScript-&gt;DowngradeOps-&gt;ModifyTableOps</code>. The <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> handles traversing into these structures as well as rewriting them as needed so that we only need to code for the specific object we care about.</p>
<ul>
<li>
<p><em>class</em> alembic.autogenerate.rewriter.<strong>Rewriter</strong></p>
<p>A helper object that allows easy ‘rewriting’ of ops streams.</p>
<p>The <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> object is intended to be passed along to the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> parameter in an <code>env.py</code> script. Once constructed, any number of “rewrites” functions can be associated with it, which will be given the opportunity to modify the structure without having to have explicit knowledge of the overall structure.</p>
<p>The function is passed the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> object and <code>revision</code> tuple that are passed to the <code>Environment Context.configure.process_revision_directives</code> function normally, and the third argument is an individual directive of the type noted in the decorator. The function has the choice of returning a single op directive, which normally can be the directive that was actually passed, or a new directive to replace it, or a list of zero or more directives to replace it.</p>
<blockquote>
<p><strong>See also:</strong> [Fine-Grained Autogenerate Generation with Rewriters - usage example]</p>
</blockquote>
<ul>
<li>
<p><strong>chain</strong>(other: [alembic.autogenerate.rewriter.Rewriter]) → [alembic.autogenerate.rewriter.Rewriter]</p>
<p>Produce a “chain” of this <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> to another.</p>
<p>This allows two rewriters to operate serially on a stream, e.g.:</p>
<pre><code class="language-python">writer1 = autogenerate.Rewriter()
writer2 = autogenerate.Rewriter()

@writer1.rewrites(ops.AddColumnOp)
def add_column_nullable(context, revision, op):
    op.column.nullable = True
    return op

@writer2.rewrites(ops.AddColumnOp)
def add_column_idx(context, revision, op):
    idx_op = ops.CreateIndexOp(
        'ixc', op.table_name, [op.column.name])
    return [
        op,
        idx_op
    ]

writer = writer1.chain(writer2)
</code></pre>
<p><strong>Parameters:</strong> <em><strong>other</strong></em> – a <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> instance</p>
<p><strong>Returns:</strong> a new <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> that will run the operations of this writer, then the “other” writer, in succession.</p>
</li>
<li>
<p><strong>rewrites</strong>(operator: Union[Type[AddColumnOp], Type[MigrateOperation], Type[AlterColumnOp], Type[CreateTableOp], Type[ModifyTableOps]]) → Callable</p>
<p>Register a function as rewriter for a given type.</p>
<p>The function should receive three arguments, which are the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong>, a <code>revision</code> tuple, and an op directive of the type indicated. E.g.:</p>
<pre><code class="language-python">@writer1.rewrites(ops.AddColumnOp)
def add_column_nullable(context, revision, op):
    op.column.nullable = True
    return op
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="revision-generation-with-multiple-engines--run_migrations-calls"><a class="header" href="#revision-generation-with-multiple-engines--run_migrations-calls">Revision Generation with Multiple Engines / run_migrations() calls</a></h2>
<p>A lesser-used technique which allows autogenerated migrations to run against multiple database backends at once, generating changes into a single migration script, is illustrated in the provided <code>multidb</code> template. This template features a special <code>env.py</code> which iterates through multiple <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Engine">Engine</a></strong> instances and calls upon <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext.run_migrations">MigrationContext.run_migrations()</a></strong> for each:</p>
<pre><code class="language-python">for name, rec in engines.items():
    logger.info(&quot;Migrating database %s&quot; % name)
    context.configure(
        connection=rec['connection'],
        upgrade_token=&quot;%s_upgrades&quot; % name,
        downgrade_token=&quot;%s_downgrades&quot; % name,
        target_metadata=target_metadata.get(name)
    )
    context.run_migrations(engine_name=name)
</code></pre>
<p>Above, <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext.run_migrations">MigrationContext.run_migrations()</a></strong> is run multiple times, once for each engine. Within the context of autogeneration, each time the method is called the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.upgrade_token">upgrade_token</a></strong> and <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.downgrade_token">downgrade_token</a></strong> parameters are changed, so that the collection of template variables gains distinct entries for each engine, which are then referred to explicitly within <code>script.py.mako</code>.</p>
<p>In terms of the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives">EnvironmentContext.configure.process_revision_directives</a></strong> hook, the behavior here is that the <code>process_revision_directives</code> hook is invoked multiple times, once for each call to context.run_migrations(). This means that if a multi-run_migrations() approach is to be combined with the <code>process_revision_directives</code> hook, care must be taken to use the hook appropriately.</p>
<p>The first point to note is that when a <strong>second</strong> call to <code>run_migrations()</code> occurs, the <code>.upgrade_ops</code> and <code>.downgrade_ops</code> attributes are <strong>converted into Python lists</strong>, and new <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> and <strong><a href="zh/../en/operations.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> objects are appended to these lists. Each <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> and <strong><a href="zh/../en/operations.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> object maintains an <code>.upgrade_token</code> and a <code>.downgrade_token</code> attribute respectively, which serves to render their contents into the appropriate template token.</p>
<p>For example, a multi-engine run that has the engine names <code>engine1</code> and <code>engine2</code> will generate tokens of <code>engine1_upgrades</code>, <code>engine1_downgrades</code>, <code>engine2_upgrades</code> and <code>engine2_downgrades</code> as it runs. The resulting migration structure would look like this:</p>
<pre><code class="language-python">from alembic.operations import ops
import sqlalchemy as sa

migration_script = ops.MigrationScript(
    'eced083f5df',
    [
        ops.UpgradeOps(
            ops=[
                # upgrade operations for &quot;engine1&quot;
            ],
            upgrade_token=&quot;engine1_upgrades&quot;
        ),
        ops.UpgradeOps(
            ops=[
                # upgrade operations for &quot;engine2&quot;
            ],
            upgrade_token=&quot;engine2_upgrades&quot;
        ),
    ],
    [
        ops.DowngradeOps(
            ops=[
                # downgrade operations for &quot;engine1&quot;
            ],
            downgrade_token=&quot;engine1_downgrades&quot;
        ),
        ops.DowngradeOps(
            ops=[
                # downgrade operations for &quot;engine2&quot;
            ],
            downgrade_token=&quot;engine2_downgrades&quot;
        )
    ],
    message='migration message'
)
</code></pre>
<p>Given the above, the following guidelines should be considered when the <code>env.py</code> script calls upon <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext.run_migrations">MigrationContext.run_migrations()</a></strong> multiple times when running autogenerate:</p>
<ul>
<li>If the <code>process_revision_directives</code> hook aims to <strong>add elements based on inspection of the current database / connection</strong>, it should do its operation on each iteration. This is so that each time the hook runs, the database is available.</li>
<li>Alternatively, if the <code>process_revision_directives</code> hook aims to <strong>modify the list of migration directives in place</strong>, this should be called only on the last iteration. This is so that the hook isn’t being given an ever-growing structure each time which it has already modified previously.</li>
<li>The <strong><a href="zh/08_06_02_customizing_revision_generation.html#alembic.autogenerate.rewriter.Rewriter">Rewriter</a></strong> object, if used, should be called <strong>only on the last iteration</strong>, because it will always deliver all directives every time, so again to avoid double/triple/etc. processing of directives it should be called only when the structure is complete.</li>
<li>The <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript.upgrade_ops_list">MigrationScript.upgrade_ops_list</a></strong> and <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrationScript.downgrade_ops_list">MigrationScript.downgrade_ops_list</a></strong> attributes should be consulted when referring to the collection of <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> and <strong><a href="zh/../en/operations.html#alembic.operations.ops.DowngradeOps">DowngradeOps</a></strong> objects.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="autogenerating-custom-operation-directives"><a class="header" href="#autogenerating-custom-operation-directives">Autogenerating Custom Operation Directives</a></h1>
<p>In the section <strong><a href="zh/../en/operations.html#operation-plugins">Operation Plugins</a></strong>, we talked about adding new subclasses of <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> in order to add new <code>op.</code> directives. In the preceding section <strong><a href="zh/08_06_03_autogenerating_custom_operation_directives.html#customizing-revision">Customizing Revision Generation</a></strong>, we also learned that these same <strong><a href="zh/../en/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation</a></strong> structures are at the base of how the autogenerate system knows what Python code to render. Using this knowledge, we can create additional functions that plug into the autogenerate system so that our new operations can be generated into migration scripts when <code>alembic revision --autogenerate</code> is run.</p>
<p>The following sections will detail an example of this using the the <code>CreateSequenceOp</code> and <code>DropSequenceOp</code> directives we created in <strong><a href="zh/../en/operations.html#operation-plugins">Operation Plugins</a></strong>, which correspond to the SQLAlchemy <strong><a href="https://docs.sqlalchemy.org/en/14/core/defaults.html#sqlalchemy.schema.Sequence">Sequence</a></strong> construct.</p>
<h2 id="tracking-our-object-with-the-model"><a class="header" href="#tracking-our-object-with-the-model">Tracking our Object with the Model</a></h2>
<p>The basic job of an autogenerate comparison function is to inspect a series of objects in the database and compare them against a series of objects defined in our model. By “in our model”, we mean anything defined in Python code that we want to track, however most commonly we’re talking about a series of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> objects present in a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> collection.</p>
<p>Let’s propose a simple way of seeing what <strong><a href="https://docs.sqlalchemy.org/en/14/core/defaults.html#sqlalchemy.schema.Sequence">Sequence</a></strong> objects we want to ensure exist in the database when autogenerate runs. While these objects do have some integrations with <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> and <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> already, let’s assume they don’t, as the example here intends to illustrate how we would do this for most any kind of custom construct. We associate the object with the <code>info</code> collection of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong>, which is a dictionary we can use for anything, which we also know will be passed to the autogenerate process:</p>
<pre><code class="language-python">from sqlalchemy.schema import Sequence

def add_sequence_to_model(sequence, metadata):
    metadata.info.setdefault(&quot;sequences&quot;, set()).add(
        (sequence.schema, sequence.name)
    )

my_seq = Sequence(&quot;my_sequence&quot;)
add_sequence_to_model(my_seq, model_metadata)
</code></pre>
<p>The <code>info</code> dictionary is a good place to put things that we want our autogeneration routines to be able to locate, which can include any object such as custom DDL objects representing views, triggers, special constraints, or anything else we want to support.</p>
<h2 id="registering-a-comparison-function"><a class="header" href="#registering-a-comparison-function">Registering a Comparison Function</a></h2>
<p>We now need to register a comparison hook, which will be used to compare the database to our model and produce <code>CreateSequenceOp</code> and <code>DropSequenceOp</code> directives to be included in our migration script. Note that we are assuming a Postgresql backend:</p>
<pre><code class="language-python">from alembic.autogenerate import comparators

@comparators.dispatch_for(&quot;schema&quot;)
def compare_sequences(autogen_context, upgrade_ops, schemas):
    all_conn_sequences = set()

    for sch in schemas:

        all_conn_sequences.update([
            (sch, row[0]) for row in
            autogen_context.connection.execute(
                &quot;SELECT relname FROM pg_class c join &quot;
                &quot;pg_namespace n on n.oid=c.relnamespace where &quot;
                &quot;relkind='S' and n.nspname=%(nspname)s&quot;,

                # note that we consider a schema of 'None' in our
                # model to be the &quot;default&quot; name in the PG database;
                # this usually is the name 'public'
                nspname=autogen_context.dialect.default_schema_name
                if sch is None else sch
            )
        ])

    # get the collection of Sequence objects we're storing with
    # our MetaData
    metadata_sequences = autogen_context.metadata.info.setdefault(
        &quot;sequences&quot;, set())

    # for new names, produce CreateSequenceOp directives
    for sch, name in metadata_sequences.difference(all_conn_sequences):
        upgrade_ops.ops.append(
            CreateSequenceOp(name, schema=sch)
        )

    # for names that are going away, produce DropSequenceOp
    # directives
    for sch, name in all_conn_sequences.difference(metadata_sequences):
        upgrade_ops.ops.append(
            DropSequenceOp(name, schema=sch)
        )
</code></pre>
<p>Above, we’ve built a new function <code>compare_sequences()</code> and registered it as a “schema” level comparison function with autogenerate. The job that it performs is that it compares the list of sequence names present in each database schema with that of a list of sequence names that we are maintaining in our <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object.</p>
<p>When autogenerate completes, it will have a series of <code>CreateSequenceOp</code> and <code>DropSequenceOp</code> directives in the list of “upgrade” operations; the list of “downgrade” operations is generated directly from these using the <code>CreateSequenceOp</code>.reverse() and <code>DropSequenceOp</code>.reverse() methods that we’ve implemented on these objects.</p>
<p>The registration of our function at the scope of “schema” means our autogenerate comparison function is called outside of the context of any specific table or column. The three available scopes are “schema”, “table”, and “column”, summarized as follows:</p>
<ol>
<li>
<p><strong>Schema level</strong> - these hooks are passed a <strong><a href="zh/08_06_03_autogenerating_custom_operation_directives.html#alembic.autogenerate.api.AutogenContext">AutogenContext</a></strong>, an <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> collection, and a collection of string schema names to be operated upon. If the <strong><a href="zh/../en/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps</a></strong> collection contains changes after all hooks are run, it is included in the migration script:</p>
<pre><code class="language-python">@comparators.dispatch_for(&quot;schema&quot;)
def compare_schema_level(autogen_context, upgrade_ops, schemas):
    pass
</code></pre>
</li>
<li>
<p><strong>Table level</strong> - these hooks are passed a <strong><a href="zh/08_06_03_autogenerating_custom_operation_directives.html#alembic.autogenerate.api.AutogenContext">AutogenContext</a></strong>, a <strong><a href="zh/../en/operations.html#alembic.operations.ops.ModifyTableOps">ModifyTableOps</a></strong> collection, a schema name, table name, a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> reflected from the database if any or <code>None</code>, and a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> present in the local <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong>. If the <strong><a href="zh/../en/operations.html#alembic.operations.ops.ModifyTableOps">ModifyTableOps</a></strong> collection contains changes after all hooks are run, it is included in the migration script:</p>
<pre><code class="language-python">@comparators.dispatch_for(&quot;table&quot;)
def compare_table_level(autogen_context, modify_ops,
    schemaname, tablename, conn_table, metadata_table):
    pass
</code></pre>
</li>
<li>
<p><strong>Column level</strong> - these hooks are passed a <strong><a href="zh/08_06_03_autogenerating_custom_operation_directives.html#alembic.autogenerate.api.AutogenContext">AutogenContext</a></strong>, an <strong><a href="zh/../en/operations.html#alembic.operations.ops.AlterColumnOp">AlterColumnOp</a></strong> object, a schema name, table name, column name, a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> reflected from the database and a <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Column">Column</a></strong> present in the local table. If the <strong><a href="zh/../en/operations.html#alembic.operations.ops.AlterColumnOp">AlterColumnOp</a></strong> contains changes after all hooks are run, it is included in the migration script; a “change” is considered to be present if any of the <code>modify_</code> attributes are set to a non-default value, or there are any keys in the <code>.kw</code> collection with the prefix <code>&quot;modify_&quot;</code>:</p>
<pre><code class="language-python">@comparators.dispatch_for(&quot;column&quot;)
def compare_column_level(autogen_context, alter_column_op,
    schemaname, tname, cname, conn_col, metadata_col):
    pass
</code></pre>
</li>
</ol>
<p>The <strong><a href="zh/08_06_03_autogenerating_custom_operation_directives.html#alembic.autogenerate.api.AutogenContext">AutogenContext</a></strong> passed to these hooks is documented below.</p>
<ul>
<li>
<p><em>class</em> alembic.autogenerate.api.<strong>AutogenContext</strong>(migration_context: MigrationContext, metadata: Optional<a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a> = None, opts: Optional[dict] = None, autogenerate: bool = True)</p>
<p>Maintains configuration and state that’s specific to an autogenerate operation.</p>
<ul>
<li>
<p><strong>connection</strong>: <em>Optional</em>[Connection] = None</p>
<p>The <strong><a href="https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Connection">Connection</a></strong> object currently connected to the database backend being compared.</p>
<p>This is obtained from the <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext.bind">MigrationContext.bind</a></strong> and is ultimately set up in the <code>env.py</code> script.</p>
</li>
<li>
<p><strong>dialect</strong>: <em>Optional</em>[Dialect] = None</p>
<p>The <strong><a href="https://docs.sqlalchemy.org/en/14/core/internals.html#sqlalchemy.engine.Dialect">Dialect</a></strong> object currently in use.</p>
<p>This is normally obtained from the <code>dialect</code> attribute.</p>
</li>
<li>
<p><strong>imports</strong>: <em>Set</em>[[str]] = None</p>
<p>A <code>set()</code> which contains string Python import directives.</p>
<p>The directives are to be rendered into the <code>${imports}</code> section of a script template. The set is normally empty and can be modified within hooks such as the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_item">EnvironmentContext.configure.render_item</a></strong> hook.</p>
<p><strong>See also:</strong> <strong><a href="zh/../en/../autogenerate.html#autogen-render-types">Affecting the Rendering of Types Themselves</a></strong></p>
</li>
<li>
<p><strong>metadata</strong>: <em>Optional</em>[MetaData] = None</p>
<p>The <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object representing the destination.</p>
<p>This object is the one that is passed within <code>env.py</code> to the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.target_metadata">EnvironmentContext.configure.target_metadata</a></strong> parameter. It represents the structure of <code>Table</code> and other objects as stated in the current database model, and represents the destination structure for the database being examined.</p>
<p>While the <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.MetaData">MetaData</a></strong> object is primarily known as a collection of <strong><a href="https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table">Table</a></strong> objects, it also has an <code>info</code> dictionary that may be used by end-user schemes to store additional schema-level objects that are to be compared in custom autogeneration schemes.</p>
</li>
<li>
<p><strong>migration_context</strong>: <em>MigrationContext</em> = None</p>
<p>The <strong><a href="zh/../en/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext</a></strong> established by the <code>env.py</code> script.</p>
</li>
<li>
<p><strong>run_filters</strong>(object_: Union[Table, Index, Column, UniqueConstraint, ForeignKeyConstraint], name: Optional[[str]], type_: [str], reflected: [bool], compare_to: Optional[Union[Table, Index, Column, UniqueConstraint]]) → [bool]</p>
<p>Run the context’s object filters and return True if the targets should be part of the autogenerate operation.</p>
<p>This method should be run for every kind of object encountered within an autogenerate operation, giving the environment the chance to filter what objects should be included in the comparison. The filters here are produced directly via the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> parameter.</p>
</li>
<li>
<p><strong>run_name_filters</strong>(name: Optional[[str]], type_: [str], parent_names: Dict[str, Optional[[str]]]) → [bool]</p>
<p>Run the context’s name filters and return True if the targets should be part of the autogenerate operation.</p>
<p>This method should be run for every kind of name encountered within the reflection side of an autogenerate operation, giving the environment the chance to filter what names should be reflected as database objects. The filters here are produced directly via the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">EnvironmentContext.configure.include_name</a></strong> parameter.</p>
</li>
<li>
<p><strong>run_object_filters</strong>(object_: Union[Table, Index, Column, UniqueConstraint, ForeignKeyConstraint], name: Optional[<strong>str</strong>], type_: [str], reflected: [bool], compare_to: Optional[Union[Table, Index, Column, UniqueConstraint]]) → [bool]</p>
<p>Run the context’s object filters and return True if the targets should be part of the autogenerate operation.</p>
<p>This method should be run for every kind of object encountered within an autogenerate operation, giving the environment the chance to filter what objects should be included in the comparison. The filters here are produced directly via the <strong><a href="zh/../en/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">EnvironmentContext.configure.include_object</a></strong> parameter.</p>
</li>
<li>
<p><strong>sorted_tables</strong></p>
<p>Return an aggregate of the <code>MetaData.sorted_tables</code> collection(s).</p>
<p>For a sequence of <code>MetaData</code> objects, this concatenates the <code>MetaData</code>.sorted_tables collection for each individual <code>MetaData</code> in the order of the sequence. It does <strong>not</strong> collate the sorted tables collections.</p>
</li>
<li>
<p><strong>table_key_to_table</strong></p>
<p>Return an aggregate of the <code>MetaData.tables</code> dictionaries.</p>
<p>The <code>MetaData.tables</code> collection is a dictionary of table key to Table; this method aggregates the dictionary across multiple <code>MetaData</code> objects into one dictionary.</p>
<p>Duplicate table keys are <strong>not</strong> supported; if two <code>MetaData</code> objects contain the same table key, an exception is raised.</p>
</li>
</ul>
</li>
</ul>
<h2 id="creating-a-render-function"><a class="header" href="#creating-a-render-function">Creating a Render Function</a></h2>
<p>The second autogenerate integration hook is to provide a “render” function; since the autogenerate system renders Python code, we need to build a function that renders the correct “op” instructions for our directive:</p>
<pre><code class="language-python">from alembic.autogenerate import renderers

@renderers.dispatch_for(CreateSequenceOp)
def render_create_sequence(autogen_context, op):
    return &quot;op.create_sequence(%r, **%r)&quot; % (
        op.sequence_name,
        {&quot;schema&quot;: op.schema}
    )


@renderers.dispatch_for(DropSequenceOp)
def render_drop_sequence(autogen_context, op):
    return &quot;op.drop_sequence(%r, **%r)&quot; % (
        op.sequence_name,
        {&quot;schema&quot;: op.schema}
    )
</code></pre>
<p>The above functions will render Python code corresponding to the presence of <code>CreateSequenceOp</code> and <code>DropSequenceOp</code> instructions in the list that our comparison function generates.</p>
<h2 id="running-it"><a class="header" href="#running-it">Running It</a></h2>
<p>All the above code can be organized however the developer sees fit; the only thing that needs to make it work is that when the Alembic environment <code>env.py</code> is invoked, it either imports modules which contain all the above routines, or they are locally present, or some combination thereof.</p>
<p>If we then have code in our model (which of course also needs to be invoked when <code>env.py</code> runs!) like this:</p>
<pre><code class="language-python">from sqlalchemy.schema import Sequence

my_seq_1 = Sequence(&quot;my_sequence_1&quot;)
add_sequence_to_model(my_seq_1, target_metadata)
</code></pre>
<p>When we first run <code>alembic revision --autogenerate</code>, we’ll see this in our migration file:</p>
<pre><code class="language-python">def upgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.create_sequence('my_sequence_1', **{'schema': None})
    ### end Alembic commands ###


def downgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.drop_sequence('my_sequence_1', **{'schema': None})
    ### end Alembic commands ###
</code></pre>
<p>These are our custom directives that will invoke when <code>alembic upgrade</code> or <code>alembic downgrade</code> is run.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script-directory"><a class="header" href="#script-directory">Script Directory</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="revision-1"><a class="header" href="#revision-1">Revision</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="write-hooks"><a class="header" href="#write-hooks">Write Hooks</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ddl-internals"><a class="header" href="#ddl-internals">DDL Internals</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mysql"><a class="header" href="#mysql">MySQL</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ms-sql"><a class="header" href="#ms-sql">MS-SQL</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql"><a class="header" href="#postgresql">Postgresql</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sqlite"><a class="header" href="#sqlite">SQLite</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p><strong>更新历史</strong></p>
<p>参考原文: <a href="zh/../en/changelog.html">Changelog</a></p>
<div style="break-before: page; page-break-before: always;"></div><!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Index &#8212; Alembic 1.7.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature_override.css" />
    <link rel="stylesheet" type="text/css" href="_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_paramlinks.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="#" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3 id="navigation"><a class="header" href="#navigation">Navigation</a></h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="en/genindex.html#" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="en/py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="en/index.html">Alembic 1.7.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Index</a></li> 
      </ul>
    </div>  
<pre><code>&lt;div class=&quot;document&quot;&gt;
  &lt;div class=&quot;documentwrapper&quot;&gt;
    &lt;div class=&quot;bodywrapper&quot;&gt;
      &lt;div class=&quot;body&quot; role=&quot;main&quot;&gt;
</code></pre>
<h1 id="index">Index</h1>
<div class="genindex-jumpbox">
 <a href="en/genindex.html#Symbols"><strong>Symbols</strong></a>
 | <a href="en/genindex.html#A"><strong>A</strong></a>
 | <a href="en/genindex.html#B"><strong>B</strong></a>
 | <a href="en/genindex.html#C"><strong>C</strong></a>
 | <a href="en/genindex.html#D"><strong>D</strong></a>
 | <a href="en/genindex.html#E"><strong>E</strong></a>
 | <a href="en/genindex.html#F"><strong>F</strong></a>
 | <a href="en/genindex.html#G"><strong>G</strong></a>
 | <a href="en/genindex.html#H"><strong>H</strong></a>
 | <a href="en/genindex.html#I"><strong>I</strong></a>
 | <a href="en/genindex.html#K"><strong>K</strong></a>
 | <a href="en/genindex.html#L"><strong>L</strong></a>
 | <a href="en/genindex.html#M"><strong>M</strong></a>
 | <a href="en/genindex.html#N"><strong>N</strong></a>
 | <a href="en/genindex.html#O"><strong>O</strong></a>
 | <a href="en/genindex.html#P"><strong>P</strong></a>
 | <a href="en/genindex.html#Q"><strong>Q</strong></a>
 | <a href="en/genindex.html#R"><strong>R</strong></a>
 | <a href="en/genindex.html#S"><strong>S</strong></a>
 | <a href="en/genindex.html#T"><strong>T</strong></a>
 | <a href="en/genindex.html#U"><strong>U</strong></a>
 | <a href="en/genindex.html#V"><strong>V</strong></a>
 | <a href="en/genindex.html#W"><strong>W</strong></a>
</div>
<h2 id="Symbols">Symbols</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.**kw">**kw (alembic.operations.Operations.create_index parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_table.params.**kw&quot;&gt;(alembic.operations.Operations.create_table parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_index.params.**kw">(alembic.operations.Operations.drop_index parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_table.params.**kw">(alembic.operations.Operations.drop_table parameter)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.params.**kw">(alembic.runtime.environment.EnvironmentContext parameter)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.run_migrations.params.**kw">(alembic.runtime.migration.MigrationContext.run_migrations parameter)</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.create_table.params.*columns">*columns (alembic.operations.Operations.create_table parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="A">A</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.add_column">add_column() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.add_column&quot;&gt;(alembic.operations.BatchOperations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.add_column">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.AddColumnOp.add_column">(alembic.operations.ops.AddColumnOp class method)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.base.add_column">(in module alembic.ddl.base)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.add_constraint">add_constraint() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.add_constraint&quot;&gt;(alembic.ddl.sqlite.SQLiteImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.add_revision">add_revision() (alembic.script.revision.RevisionMap method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.AddColumn">AddColumn (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.AddColumnOp">AddColumnOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.AddConstraintOp">AddConstraintOp (class in alembic.operations.ops)</a>
</li>
      <li>
    alembic.command
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#module-alembic.command&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.config
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/config.html#module-alembic.config&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl.base
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl.base&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl.impl
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl.impl&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl.mssql
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl.mssql&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl.mysql
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl.mysql&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl.postgresql
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl.postgresql&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.ddl.sqlite
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#module-alembic.ddl.sqlite&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.operations
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#module-alembic.operations&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.operations.ops
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/operations.html#module-alembic.operations.ops&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.runtime.environment
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#module-alembic.runtime.environment&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li>
    alembic.runtime.migration
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#module-alembic.runtime.migration&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.script
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#module-alembic.script&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.script.revision
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#module-alembic.script.revision&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li>
    alembic.script.write_hooks
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#module-alembic.script.write_hooks&quot;&gt;module&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.alembic_module_prefix">alembic_module_prefix (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.alter_column">alter_column() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.alter_column&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLImpl.alter_column">(alembic.ddl.mysql.MySQLImpl method)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.alter_column">(alembic.ddl.postgresql.PostgresqlImpl method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.BatchOperations.alter_column">(alembic.operations.BatchOperations method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.alter_column">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.AlterColumnOp.alter_column">(alembic.operations.ops.AlterColumnOp class method)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.base.alter_column">(in module alembic.ddl.base)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.alter_table">alter_table() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.AlterColumn">AlterColumn (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.AlterColumnOp">AlterColumnOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.AlterTable">AlterTable (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.AlterTableOp">AlterTableOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.Params.args">args (alembic.ddl.impl.Params property)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.as_revision_number">as_revision_number() (alembic.script.ScriptDirectory method)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.attributes">attributes (alembic.config.Config attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/config.html#alembic.config.Config.params.attributes&quot;&gt;(alembic.config.Config parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.autocommit_block">autocommit_block() (alembic.runtime.migration.MigrationContext method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.autogen_column_reflect">autogen_column_reflect() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.autogen_column_reflect&quot;&gt;(alembic.ddl.postgresql.PostgresqlImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.autogen_column_reflect">(alembic.ddl.sqlite.SQLiteImpl method)</a>
</li>
      </ul></li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext">AutogenContext (class in alembic.autogenerate.api)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.revision.params.autogenerate">autogenerate (alembic.command.revision parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.autoincrement">autoincrement (alembic.operations.Operations.alter_column parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="B">B</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.walk_revisions.params.base">base (alembic.script.ScriptDirectory.walk_revisions parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.bases">bases (alembic.script.revision.RevisionMap attribute)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.AddColumnOp.batch_add_column">batch_add_column() (alembic.operations.ops.AddColumnOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.AlterColumnOp.batch_alter_column">batch_alter_column() (alembic.operations.ops.AlterColumnOp class method)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table">batch_alter_table() (alembic.operations.Operations method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateCheckConstraintOp.batch_create_check_constraint">batch_create_check_constraint() (alembic.operations.ops.CreateCheckConstraintOp class method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.CreateExcludeConstraintOp.batch_create_exclude_constraint">batch_create_exclude_constraint() (alembic.ddl.postgresql.CreateExcludeConstraintOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateForeignKeyOp.batch_create_foreign_key">batch_create_foreign_key() (alembic.operations.ops.CreateForeignKeyOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateIndexOp.batch_create_index">batch_create_index() (alembic.operations.ops.CreateIndexOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreatePrimaryKeyOp.batch_create_primary_key">batch_create_primary_key() (alembic.operations.ops.CreatePrimaryKeyOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateTableCommentOp.batch_create_table_comment">batch_create_table_comment() (alembic.operations.ops.CreateTableCommentOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateUniqueConstraintOp.batch_create_unique_constraint">batch_create_unique_constraint() (alembic.operations.ops.CreateUniqueConstraintOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropColumnOp.batch_drop_column">batch_drop_column() (alembic.operations.ops.DropColumnOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropConstraintOp.batch_drop_constraint">batch_drop_constraint() (alembic.operations.ops.DropConstraintOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropIndexOp.batch_drop_index">batch_drop_index() (alembic.operations.ops.DropIndexOp class method)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropTableCommentOp.batch_drop_table_comment">batch_drop_table_comment() (alembic.operations.ops.DropTableCommentOp class method)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.mssql.MSSQLImpl.batch_separator">batch_separator (alembic.ddl.mssql.MSSQLImpl attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations">BatchOperations (class in alembic.operations)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.begin_transaction">begin_transaction() (alembic.runtime.environment.EnvironmentContext method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.migration.MigrationContext.begin_transaction&quot;&gt;(alembic.runtime.migration.MigrationContext method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.bind">bind (alembic.ddl.impl.DefaultImpl property)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.migration.MigrationContext.bind&quot;&gt;(alembic.runtime.migration.MigrationContext property)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.merge.params.branch_label">branch_label (alembic.command.merge parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.revision.params.branch_label&quot;&gt;(alembic.command.revision parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.get_current_head.params.branch_label">(alembic.script.revision.RevisionMap.get_current_head parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.branch_labels">branch_labels (alembic.script.revision.Revision attribute)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.branches">branches() (in module alembic.command)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.bulk_insert">bulk_insert() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.bulk_insert&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.bulk_insert">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.BulkInsertOp.bulk_insert">(alembic.operations.ops.BulkInsertOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/operations.html#alembic.operations.ops.BulkInsertOp">BulkInsertOp (class in alembic.operations.ops)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="C">C</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.cast_for_batch_migrate">cast_for_batch_migrate() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.cast_for_batch_migrate&quot;&gt;(alembic.ddl.sqlite.SQLiteImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter.chain">chain() (alembic.autogenerate.rewriter.Rewriter method)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.cmd_opts">cmd_opts (alembic.config.Config attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.add_column.params.column">column (alembic.operations.Operations.add_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.column_name">column_name (alembic.operations.Operations.alter_column parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.drop_column.params.column_name&quot;&gt;(alembic.operations.Operations.drop_column parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.ColumnComment">ColumnComment (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.ColumnDefault">ColumnDefault (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.ColumnName">ColumnName (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.ColumnNullable">ColumnNullable (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.columns">columns (alembic.operations.Operations.create_index parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_primary_key.params.columns&quot;&gt;(alembic.operations.Operations.create_primary_key parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_unique_constraint.params.columns">(alembic.operations.Operations.create_unique_constraint parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.ColumnType">ColumnType (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.command_terminator">command_terminator (alembic.ddl.impl.DefaultImpl attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.create_table_comment.params.comment">comment (alembic.operations.BatchOperations.create_table_comment parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.alter_column.params.comment&quot;&gt;(alembic.operations.Operations.alter_column parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_table_comment.params.comment">(alembic.operations.Operations.create_table_comment parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.compare_metadata">compare_metadata() (in module alembic.autogenerate)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_server_default">compare_server_default (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.compare_server_default">compare_server_default() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.compare_server_default&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLImpl.compare_server_default">(alembic.ddl.mysql.MySQLImpl method)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.compare_server_default">(alembic.ddl.postgresql.PostgresqlImpl method)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.compare_server_default">(alembic.ddl.sqlite.SQLiteImpl method)</a>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.compare_type">compare_type (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.compare_type">compare_type() (alembic.ddl.impl.DefaultImpl method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.ComputedColumnDefault">ComputedColumnDefault (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_check_constraint.params.condition">condition (alembic.operations.Operations.create_check_constraint parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.branches.params.config">config (alembic.command.branches parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.current.params.config&quot;&gt;(alembic.command.current parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/commands.html#alembic.command.downgrade.params.config">(alembic.command.downgrade parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.edit.params.config">(alembic.command.edit parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.ensure_version.params.config">(alembic.command.ensure_version parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.heads.params.config">(alembic.command.heads parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.history.params.config">(alembic.command.history parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.init.params.config">(alembic.command.init parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.list_templates.params.config">(alembic.command.list_templates parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.merge.params.config">(alembic.command.merge parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.revision.params.config">(alembic.command.revision parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.show.params.config">(alembic.command.show parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.stamp.params.config">(alembic.command.stamp parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.upgrade.params.config">(alembic.command.upgrade parameter)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.config">(alembic.runtime.environment.EnvironmentContext attribute)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.params.config">(alembic.runtime.environment.EnvironmentContext parameter)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.config">(alembic.runtime.migration.MigrationContext property)</a>
</li>
      </ul></li>
      <li><a href="en/api/config.html#alembic.config.Config">Config (class in alembic.config)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.params.config_args">config_args (alembic.config.Config parameter)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.config_file_name">config_file_name (alembic.config.Config attribute)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.config_ini_section">config_ini_section (alembic.config.Config attribute)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure">configure() (alembic.runtime.environment.EnvironmentContext method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.migration.MigrationContext.configure&quot;&gt;(alembic.runtime.migration.MigrationContext class method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.connection">connection (alembic.autogenerate.api.AutogenContext attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.connection&quot;&gt;(alembic.runtime.environment.EnvironmentContext.configure parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.configure.params.connection">(alembic.runtime.migration.MigrationContext.configure parameter)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.constraint_name">constraint_name (alembic.operations.Operations.create_foreign_key parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_primary_key.params.constraint_name&quot;&gt;(alembic.operations.Operations.create_primary_key parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_constraint.params.constraint_name">(alembic.operations.Operations.drop_constraint parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.CreateExcludeConstraintOp.constraint_type">constraint_type (alembic.ddl.postgresql.CreateExcludeConstraintOp attribute)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.compare_metadata.params.context">context (alembic.autogenerate.compare_metadata parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.copy_from">copy_from (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.correct_for_autogen_constraints">correct_for_autogen_constraints() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mysql.MySQLImpl.correct_for_autogen_constraints&quot;&gt;(alembic.ddl.mysql.MySQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.correct_for_autogen_constraints">(alembic.ddl.postgresql.PostgresqlImpl method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.correct_for_autogen_foreignkeys">correct_for_autogen_foreignkeys() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mysql.MySQLImpl.correct_for_autogen_foreignkeys&quot;&gt;(alembic.ddl.mysql.MySQLImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.create_check_constraint">create_check_constraint() (alembic.operations.BatchOperations method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_check_constraint&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreateCheckConstraintOp.create_check_constraint">(alembic.operations.ops.CreateCheckConstraintOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.create_column_comment">create_column_comment() (alembic.ddl.impl.DefaultImpl method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.CreateExcludeConstraintOp.create_exclude_constraint">create_exclude_constraint() (alembic.ddl.postgresql.CreateExcludeConstraintOp class method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.create_exclude_constraint&quot;&gt;(alembic.operations.BatchOperations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_exclude_constraint">(alembic.operations.Operations method)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.create_foreign_key">create_foreign_key() (alembic.operations.BatchOperations method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_foreign_key&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreateForeignKeyOp.create_foreign_key">(alembic.operations.ops.CreateForeignKeyOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.create_index">create_index() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.create_index&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.create_index">(alembic.ddl.postgresql.PostgresqlImpl method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.BatchOperations.create_index">(alembic.operations.BatchOperations method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_index">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreateIndexOp.create_index">(alembic.operations.ops.CreateIndexOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.create_primary_key">create_primary_key() (alembic.operations.BatchOperations method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_primary_key&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreatePrimaryKeyOp.create_primary_key">(alembic.operations.ops.CreatePrimaryKeyOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.create_table">create_table() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_table&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreateTableOp.create_table">(alembic.operations.ops.CreateTableOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.create_table_comment">create_table_comment() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.create_table_comment&quot;&gt;(alembic.operations.BatchOperations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_table_comment">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreateTableCommentOp.create_table_comment">(alembic.operations.ops.CreateTableCommentOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.create_unique_constraint">create_unique_constraint() (alembic.operations.BatchOperations method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_unique_constraint&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.CreateUniqueConstraintOp.create_unique_constraint">(alembic.operations.ops.CreateUniqueConstraintOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateCheckConstraintOp">CreateCheckConstraintOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.CreateExcludeConstraintOp">CreateExcludeConstraintOp (class in alembic.ddl.postgresql)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateForeignKeyOp">CreateForeignKeyOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateIndexOp">CreateIndexOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreatePrimaryKeyOp">CreatePrimaryKeyOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateTableCommentOp">CreateTableCommentOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateTableOp">CreateTableOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateUniqueConstraintOp">CreateUniqueConstraintOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.current">current() (in module alembic.command)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.CycleDetected">CycleDetected</a>
</li>
  </ul></td>
</tr></table>
<h2 id="D">D</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl">DefaultImpl (class in alembic.ddl.impl)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_check_constraint.params.deferrable">deferrable (alembic.operations.Operations.create_check_constraint parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_exclude_constraint.params.deferrable&quot;&gt;(alembic.operations.Operations.create_exclude_constraint parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.deferrable">(alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_unique_constraint.params.deferrable">(alembic.operations.Operations.create_unique_constraint parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.dependencies">dependencies (alembic.script.revision.Revision attribute)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.DependencyCycleDetected">DependencyCycleDetected</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.DependencyLoopDetected">DependencyLoopDetected</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.revision.params.depends_on">depends_on (alembic.command.revision parameter)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.dialect">dialect (alembic.autogenerate.api.AutogenContext attribute)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.dialect_name">dialect_name (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.migration.MigrationContext.configure.params.dialect_name&quot;&gt;(alembic.runtime.migration.MigrationContext.configure parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.dialect_opts">dialect_opts (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.init.params.directory">directory (alembic.command.init parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.Script.doc">doc (alembic.script.Script property)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.down_revision">down_revision (alembic.script.revision.Revision attribute)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.downgrade">downgrade() (in module alembic.command)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrationScript.downgrade_ops">downgrade_ops (alembic.operations.ops.MigrationScript property)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrationScript.downgrade_ops_list">downgrade_ops_list (alembic.operations.ops.MigrationScript property)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.downgrade_token">downgrade_token (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DowngradeOps">DowngradeOps (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.drop_column">drop_column() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.drop_column&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.BatchOperations.drop_column">(alembic.operations.BatchOperations method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_column">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.DropColumnOp.drop_column">(alembic.operations.ops.DropColumnOp class method)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.base.drop_column">(in module alembic.ddl.base)</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.drop_constraint">drop_constraint() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mysql.MySQLImpl.drop_constraint&quot;&gt;(alembic.ddl.mysql.MySQLImpl method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.drop_constraint">(alembic.ddl.sqlite.SQLiteImpl method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.BatchOperations.drop_constraint">(alembic.operations.BatchOperations method)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_constraint">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.DropConstraintOp.drop_constraint">(alembic.operations.ops.DropConstraintOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.drop_index">drop_index() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.drop_index&quot;&gt;(alembic.operations.BatchOperations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_index">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.DropIndexOp.drop_index">(alembic.operations.ops.DropIndexOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.drop_table">drop_table() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.drop_table&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.DropTableOp.drop_table">(alembic.operations.ops.DropTableOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.drop_table_comment">drop_table_comment() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.drop_table_comment&quot;&gt;(alembic.operations.BatchOperations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_table_comment">(alembic.operations.Operations method)</a>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.DropTableCommentOp.drop_table_comment">(alembic.operations.ops.DropTableCommentOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.DropColumn">DropColumn (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropColumnOp">DropColumnOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropConstraintOp">DropConstraintOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropIndexOp">DropIndexOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropTableCommentOp">DropTableCommentOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.DropTableOp">DropTableOp (class in alembic.operations.ops)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="E">E</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/commands.html#alembic.command.edit">edit() (in module alembic.command)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_exclude_constraint.params.elements">elements (alembic.operations.Operations.create_exclude_constraint parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.emit_begin">emit_begin() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.emit_begin&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.emit_commit">emit_commit() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.emit_commit&quot;&gt;(alembic.ddl.mssql.MSSQLImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.ensure_version">ensure_version() (in module alembic.command)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext">EnvironmentContext (class in alembic.runtime.environment)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.execute">execute() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.execute&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.ExecuteSQLOp.execute">(alembic.operations.ops.ExecuteSQLOp class method)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.execute">(alembic.runtime.environment.EnvironmentContext method)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.execute">(alembic.runtime.migration.MigrationContext method)</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/operations.html#alembic.operations.ops.ExecuteSQLOp">ExecuteSQLOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.execute.params.execution_options">execution_options (alembic.operations.Operations.execute parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.existing_autoincrement">existing_autoincrement (alembic.operations.Operations.alter_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.create_table_comment.params.existing_comment">existing_comment (alembic.operations.BatchOperations.create_table_comment parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.drop_table_comment.params.existing_comment&quot;&gt;(alembic.operations.BatchOperations.drop_table_comment parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.existing_comment">(alembic.operations.Operations.alter_column parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_table_comment.params.existing_comment">(alembic.operations.Operations.create_table_comment parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_table_comment.params.existing_comment">(alembic.operations.Operations.drop_table_comment parameter)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.existing_nullable">existing_nullable (alembic.operations.Operations.alter_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.existing_server_default">existing_server_default (alembic.operations.Operations.alter_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.existing_type">existing_type (alembic.operations.Operations.alter_column parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="F">F</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.f">f() (alembic.operations.Operations method)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.params.file_">file_ (alembic.config.Config parameter)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.file_config">file_config (alembic.config.Config attribute)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.format_column_name">format_column_name() (in module alembic.ddl.base)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.base.format_server_default">format_server_default() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.format_table_name">format_table_name() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.format_type">format_type() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.from_config">from_config() (alembic.script.ScriptDirectory class method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.CreateExcludeConstraintOp.from_constraint">from_constraint() (alembic.ddl.postgresql.CreateExcludeConstraintOp class method)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="G">G</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.generate_revision">generate_revision() (alembic.script.ScriptDirectory method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.params.generator">generator (alembic.script.revision.RevisionMap parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.get_base">get_base() (alembic.script.ScriptDirectory method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.get_bases">get_bases() (alembic.script.ScriptDirectory method)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.get_bind">get_bind() (alembic.operations.Operations method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_bind&quot;&gt;(alembic.runtime.environment.EnvironmentContext method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.get_by_dialect">get_by_dialect() (alembic.ddl.impl.DefaultImpl class method)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.get_context">get_context() (alembic.operations.Operations method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_context&quot;&gt;(alembic.runtime.environment.EnvironmentContext method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.get_current_head">get_current_head() (alembic.script.revision.RevisionMap method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#alembic.script.ScriptDirectory.get_current_head&quot;&gt;(alembic.script.ScriptDirectory method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.get_current_heads">get_current_heads() (alembic.runtime.migration.MigrationContext method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.get_current_revision">get_current_revision() (alembic.runtime.migration.MigrationContext method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_head_revision">get_head_revision() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_head_revisions">get_head_revisions() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.get_heads">get_heads() (alembic.script.ScriptDirectory method)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.get_main_option">get_main_option() (alembic.config.Config method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.get_revision">get_revision() (alembic.script.revision.RevisionMap method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#alembic.script.ScriptDirectory.get_revision&quot;&gt;(alembic.script.ScriptDirectory method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_revision_argument">get_revision_argument() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.get_revisions">get_revisions() (alembic.script.revision.RevisionMap method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#alembic.script.ScriptDirectory.get_revisions&quot;&gt;(alembic.script.ScriptDirectory method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/config.html#alembic.config.Config.get_section">get_section() (alembic.config.Config method)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.get_section_option">get_section_option() (alembic.config.Config method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_starting_revision_argument">get_starting_revision_argument() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_tag_argument">get_tag_argument() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.get_template_directory">get_template_directory() (alembic.config.Config method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.get_x_argument">get_x_argument() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="H">H</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/commands.html#alembic.command.revision.params.head">head (alembic.command.revision parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#alembic.script.ScriptDirectory.generate_revision.params.head&quot;&gt;(alembic.script.ScriptDirectory.generate_revision parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/script.html#alembic.script.ScriptDirectory.walk_revisions.params.head">(alembic.script.ScriptDirectory.walk_revisions parameter)</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.heads">heads (alembic.script.revision.RevisionMap attribute)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.heads">heads() (in module alembic.command)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.history">history() (in module alembic.command)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="I">I</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.identity_attrs_ignore">identity_attrs_ignore (alembic.ddl.impl.DefaultImpl attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.identity_attrs_ignore&quot;&gt;(alembic.ddl.mssql.MSSQLImpl attribute)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.identity_attrs_ignore">(alembic.ddl.postgresql.PostgresqlImpl attribute)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.IdentityColumnDefault">IdentityColumnDefault (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.implementation_for">implementation_for() (alembic.operations.Operations class method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.ImplMeta">ImplMeta (class in alembic.ddl.impl)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.imports">imports (alembic.autogenerate.api.AutogenContext attribute)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_name">include_name (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_object">include_object (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.include_schemas">include_schemas (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.index_name">index_name (alembic.operations.Operations.create_index parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.drop_index.params.index_name&quot;&gt;(alembic.operations.Operations.drop_index parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.history.params.indicate_current">indicate_current (alembic.command.history parameter)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrateOperation.info">info (alembic.operations.ops.MigrateOperation attribute)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.params.ini_section">ini_section (alembic.config.Config parameter)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/commands.html#alembic.command.init">init() (in module alembic.command)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_check_constraint.params.initially">initially (alembic.operations.Operations.create_check_constraint parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.create_exclude_constraint.params.initially&quot;&gt;(alembic.operations.Operations.create_exclude_constraint parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_unique_constraint.params.initially">(alembic.operations.Operations.create_unique_constraint parameter)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.Operations.inline_literal">inline_literal() (alembic.operations.Operations method)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.BatchOperations.alter_column.params.insert_before">insert_before (alembic.operations.BatchOperations.alter_column parameter)</a>, <a href="en/ops.html#alembic.operations.BatchOperations.alter_column.params.insert_before">[1]</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.invoke">invoke() (alembic.operations.Operations method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.is_base">is_base (alembic.script.revision.Revision property)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.is_branch_point">is_branch_point (alembic.script.revision.Revision property)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.is_head">is_head (alembic.script.revision.Revision property)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.is_merge_point">is_merge_point (alembic.script.revision.Revision property)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.is_offline_mode">is_offline_mode() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.is_transactional_ddl">is_transactional_ddl() (alembic.runtime.environment.EnvironmentContext method)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap.iterate_revisions">iterate_revisions() (alembic.script.revision.RevisionMap method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#alembic.script.ScriptDirectory.iterate_revisions&quot;&gt;(alembic.script.ScriptDirectory method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
  </ul></td>
</tr></table>
<h2 id="K">K</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.Params.kwargs">kwargs (alembic.ddl.impl.Params property)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="L">L</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/commands.html#alembic.command.list_templates">list_templates() (in module alembic.command)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.literal_binds">literal_binds (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.local_cols">local_cols (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.Script.longdoc">longdoc (alembic.script.Script property)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.LoopDetected">LoopDetected</a>
</li>
  </ul></td>
</tr></table>
<h2 id="M">M</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/config.html#alembic.config.main">main() (in module alembic.config)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mysql.MariaDBImpl">MariaDBImpl (class in alembic.ddl.mysql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mssql.MSSQLImpl.memo">memo (alembic.ddl.mssql.MSSQLImpl attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mysql.MariaDBImpl.memo&quot;&gt;(alembic.ddl.mysql.MariaDBImpl attribute)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLImpl.memo">(alembic.ddl.mysql.MySQLImpl attribute)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.memo">(alembic.ddl.postgresql.PostgresqlImpl attribute)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.memo">(alembic.ddl.sqlite.SQLiteImpl attribute)</a>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.merge">merge() (in module alembic.command)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.merge.params.message">message (alembic.command.merge parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.revision.params.message&quot;&gt;(alembic.command.revision parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/script.html#alembic.script.ScriptDirectory.generate_revision.params.message">(alembic.script.ScriptDirectory.generate_revision parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.metadata">metadata (alembic.autogenerate.api.AutogenContext attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/autogenerate.html#alembic.autogenerate.compare_metadata.params.metadata&quot;&gt;(alembic.autogenerate.compare_metadata parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrateOperation">MigrateOperation (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.migration_context">migration_context (alembic.autogenerate.api.AutogenContext attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.BatchOperations.params.migration_context&quot;&gt;(alembic.operations.BatchOperations parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.params.migration_context">(alembic.operations.Operations parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext">MigrationContext (class in alembic.runtime.migration)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrationScript">MigrationScript (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.ModifyTableOps">ModifyTableOps (class in alembic.operations.ops)</a>
</li>
      <li>
    module
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#module-alembic.command&quot;&gt;alembic.command&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/config.html#module-alembic.config">alembic.config</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl">alembic.ddl</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl.base">alembic.ddl.base</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl.impl">alembic.ddl.impl</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl.mssql">alembic.ddl.mssql</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl.mysql">alembic.ddl.mysql</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl.postgresql">alembic.ddl.postgresql</a>
</li>
        <li><a href="en/api/ddl.html#module-alembic.ddl.sqlite">alembic.ddl.sqlite</a>
</li>
        <li><a href="en/ops.html#module-alembic.operations">alembic.operations</a>
</li>
        <li><a href="en/api/operations.html#module-alembic.operations.ops">alembic.operations.ops</a>
</li>
        <li><a href="en/api/runtime.html#module-alembic.runtime.environment">alembic.runtime.environment</a>
</li>
        <li><a href="en/api/runtime.html#module-alembic.runtime.migration">alembic.runtime.migration</a>
</li>
        <li><a href="en/api/script.html#module-alembic.script">alembic.script</a>
</li>
        <li><a href="en/api/script.html#module-alembic.script.revision">alembic.script.revision</a>
</li>
        <li><a href="en/api/script.html#module-alembic.script.write_hooks">alembic.script.write_hooks</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/script.html#alembic.script.Script.module">module (alembic.script.Script attribute)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mssql.mssql_add_column">mssql_add_column() (in module alembic.ddl.mssql)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.mssql_batch_separator">mssql_batch_separator (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.drop_column.params.mssql_drop_check">mssql_drop_check (alembic.operations.Operations.drop_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.drop_column.params.mssql_drop_default">mssql_drop_default (alembic.operations.Operations.drop_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.drop_column.params.mssql_drop_foreign_key">mssql_drop_foreign_key (alembic.operations.Operations.drop_column parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mssql.MSSQLImpl">MSSQLImpl (class in alembic.ddl.mssql)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.bulk_insert.params.multiinsert">multiinsert (alembic.operations.Operations.bulk_insert parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.MultipleHeads">MultipleHeads</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLAlterDefault">MySQLAlterDefault (class in alembic.ddl.mysql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLChangeColumn">MySQLChangeColumn (class in alembic.ddl.mysql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLImpl">MySQLImpl (class in alembic.ddl.mysql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLModifyColumn">MySQLModifyColumn (class in alembic.ddl.mysql)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="N">N</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/config.html#alembic.config.Config.set_main_option.params.name">name (alembic.config.Config.set_main_option parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/config.html#alembic.config.Config.set_section_option.params.name&quot;&gt;(alembic.config.Config.set_section_option parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_check_constraint.params.name">(alembic.operations.Operations.create_check_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_exclude_constraint.params.name">(alembic.operations.Operations.create_exclude_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_unique_constraint.params.name">(alembic.operations.Operations.create_unique_constraint parameter)</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.naming_convention">naming_convention (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.new_column_name">new_column_name (alembic.operations.Operations.alter_column parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.rename_table.params.new_table_name">new_table_name (alembic.operations.Operations.rename_table parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision.nextrev">nextrev (alembic.script.revision.Revision attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.nullable">nullable (alembic.operations.Operations.alter_column parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="O">O</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.rename_table.params.old_table_name">old_table_name (alembic.operations.Operations.rename_table parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.on_version_apply">on_version_apply (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.ondelete">ondelete (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.onupdate">onupdate (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.OpContainer">OpContainer (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations">Operations (class in alembic.operations)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.configure.params.opts">opts (alembic.runtime.migration.MigrationContext.configure parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.oracle_batch_separator">oracle_batch_separator (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter.chain.params.other">other (alembic.autogenerate.rewriter.Rewriter.chain parameter)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.params.output_buffer">output_buffer (alembic.config.Config parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.output_buffer&quot;&gt;(alembic.runtime.environment.EnvironmentContext.configure parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.output_encoding">output_encoding (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="P">P</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/commands.html#alembic.command.init.params.package">package (alembic.command.init parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.Params">Params (class in alembic.ddl.impl)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.partial_reordering">partial_reordering (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.Script.path">path (alembic.script.Script attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.postgresql_using">postgresql_using (alembic.operations.Operations.alter_column parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlColumnType">PostgresqlColumnType (class in alembic.ddl.postgresql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl">PostgresqlImpl (class in alembic.ddl.postgresql)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.prep_table_for_batch">prep_table_for_batch() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.prep_table_for_batch&quot;&gt;(alembic.ddl.postgresql.PostgresqlImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/config.html#alembic.config.Config.print_stdout">print_stdout() (alembic.config.Config method)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.revision.params.process_revision_directives">process_revision_directives (alembic.command.revision parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.process_revision_directives&quot;&gt;(alembic.runtime.environment.EnvironmentContext.configure parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.produce_migrations">produce_migrations() (in module alembic.autogenerate)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.stamp.params.purge">purge (alembic.command.stamp parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="Q">Q</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.quote">quote (alembic.operations.Operations.create_index parameter)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.base.quote_dotted">quote_dotted() (in module alembic.ddl.base)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="R">R</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/script.html#alembic.script.revision.RangeNotAncestorError">RangeNotAncestorError</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.recreate">recreate (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.referent_schema">referent_schema (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.referent_table">referent_table (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.reflect_args">reflect_args (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.reflect_kwargs">reflect_kwargs (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.generate_revision.params.refresh">refresh (alembic.script.ScriptDirectory.generate_revision parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.write_hooks.register">register() (in module alembic.script.write_hooks)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.register_operation">register_operation() (alembic.operations.Operations class method)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.remote_cols">remote_cols (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.rename_table">rename_table() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.rename_table&quot;&gt;(alembic.operations.Operations method)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/operations.html#alembic.operations.ops.RenameTableOp.rename_table">(alembic.operations.ops.RenameTableOp class method)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.RenameTable">RenameTable (class in alembic.ddl.base)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.RenameTableOp">RenameTableOp (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_as_batch">render_as_batch (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.render_ddl_sql_expr">render_ddl_sql_expr() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.render_ddl_sql_expr&quot;&gt;(alembic.ddl.sqlite.SQLiteImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.render_item">render_item (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.render_python_code">render_python_code() (in module alembic.autogenerate)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.render_type">render_type() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.render_type&quot;&gt;(alembic.ddl.postgresql.PostgresqlImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.requires_recreate_in_batch">requires_recreate_in_batch() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.requires_recreate_in_batch&quot;&gt;(alembic.ddl.sqlite.SQLiteImpl method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.revision.ResolutionError">ResolutionError</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/commands.html#alembic.command.heads.params.resolve_dependencies">resolve_dependencies (alembic.command.heads parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.edit.params.rev">rev (alembic.command.edit parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.merge.params.rev_id">rev_id (alembic.command.merge parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.revision.params.rev_id&quot;&gt;(alembic.command.revision parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.history.params.rev_range">rev_range (alembic.command.history parameter)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.CreateTableCommentOp.reverse">reverse() (alembic.operations.ops.CreateTableCommentOp method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/operations.html#alembic.operations.ops.DropTableCommentOp.reverse&quot;&gt;(alembic.operations.ops.DropTableCommentOp method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.generate_revision.params.revid">revid (alembic.script.ScriptDirectory.generate_revision parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.downgrade.params.revision">revision (alembic.command.downgrade parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.show.params.revision&quot;&gt;(alembic.command.show parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/commands.html#alembic.command.stamp.params.revision">(alembic.command.stamp parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.upgrade.params.revision">(alembic.command.upgrade parameter)</a>
</li>
        <li><a href="en/api/script.html#alembic.script.revision.Revision.revision">(alembic.script.revision.Revision attribute)</a>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.revision.Revision">Revision (class in alembic.script.revision)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.revision">revision() (in module alembic.command)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionError">RevisionError</a>
</li>
      <li><a href="en/api/script.html#alembic.script.revision.RevisionMap">RevisionMap (class in alembic.script.revision)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter">Rewriter (class in alembic.autogenerate.rewriter)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter.rewrites">rewrites() (alembic.autogenerate.rewriter.Rewriter method)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.bulk_insert.params.rows">rows (alembic.operations.Operations.bulk_insert parameter)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.run_env">run_env() (alembic.script.ScriptDirectory method)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.run_filters">run_filters() (alembic.autogenerate.api.AutogenContext method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.run_migrations">run_migrations() (alembic.runtime.environment.EnvironmentContext method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.migration.MigrationContext.run_migrations&quot;&gt;(alembic.runtime.migration.MigrationContext method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.run_name_filters">run_name_filters() (alembic.autogenerate.api.AutogenContext method)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.run_object_filters">run_object_filters() (alembic.autogenerate.api.AutogenContext method)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="S">S</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.add_column.params.schema">schema (alembic.operations.Operations.add_column parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.alter_column.params.schema&quot;&gt;(alembic.operations.Operations.alter_column parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.schema">(alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_check_constraint.params.schema">(alembic.operations.Operations.create_check_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_exclude_constraint.params.schema">(alembic.operations.Operations.create_exclude_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.schema">(alembic.operations.Operations.create_index parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_primary_key.params.schema">(alembic.operations.Operations.create_primary_key parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_table.params.schema">(alembic.operations.Operations.create_table parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_unique_constraint.params.schema">(alembic.operations.Operations.create_unique_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_column.params.schema">(alembic.operations.Operations.drop_column parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_constraint.params.schema">(alembic.operations.Operations.drop_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_index.params.schema">(alembic.operations.Operations.drop_index parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_table.params.schema">(alembic.operations.Operations.drop_table parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.rename_table.params.schema">(alembic.operations.Operations.rename_table parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.script">script (alembic.runtime.environment.EnvironmentContext attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.params.script&quot;&gt;(alembic.runtime.environment.EnvironmentContext parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/script.html#alembic.script.Script">Script (class in alembic.script)</a>
</li>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory">ScriptDirectory (class in alembic.script)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.set_section_option.params.section">section (alembic.config.Config.set_section_option parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.server_default">server_default (alembic.operations.Operations.alter_column parameter)</a>
</li>
      <li><a href="en/api/config.html#alembic.config.Config.set_main_option">set_main_option() (alembic.config.Config method)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/config.html#alembic.config.Config.set_section_option">set_section_option() (alembic.config.Config method)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.show">show() (in module alembic.command)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.sorted_tables">sorted_tables (alembic.autogenerate.api.AutogenContext attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.source_schema">source_schema (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.create_foreign_key.params.source_table">source_table (alembic.operations.Operations.create_foreign_key parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.revision.params.splice">splice (alembic.command.revision parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/script.html#alembic.script.ScriptDirectory.generate_revision.params.splice&quot;&gt;(alembic.script.ScriptDirectory.generate_revision parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.downgrade.params.sql">sql (alembic.command.downgrade parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.ensure_version.params.sql&quot;&gt;(alembic.command.ensure_version parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/commands.html#alembic.command.revision.params.sql">(alembic.command.revision parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.stamp.params.sql">(alembic.command.stamp parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.upgrade.params.sql">(alembic.command.upgrade parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.sqlalchemy_module_prefix">sqlalchemy_module_prefix (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.sqlite.SQLiteImpl">SQLiteImpl (class in alembic.ddl.sqlite)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.execute.params.sqltext">sqltext (alembic.operations.Operations.execute parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.migration.MigrationContext.stamp">stamp() (alembic.runtime.migration.MigrationContext method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.stamp&quot;&gt;(in module alembic.command)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.start_migrations">start_migrations() (alembic.ddl.impl.DefaultImpl method)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.starting_rev">starting_rev (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.static_output">static_output() (alembic.ddl.impl.DefaultImpl method)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.environment.EnvironmentContext.static_output&quot;&gt;(alembic.runtime.environment.EnvironmentContext method)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/config.html#alembic.config.Config.params.stdout">stdout (alembic.config.Config parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="T">T</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.bulk_insert.params.table">table (alembic.operations.Operations.bulk_insert parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.table_args">table_args (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/api/autogenerate.html#alembic.autogenerate.api.AutogenContext.table_key_to_table">table_key_to_table (alembic.autogenerate.api.AutogenContext attribute)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.table_kwargs">table_kwargs (alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
      <li><a href="en/ops.html#alembic.operations.Operations.add_column.params.table_name">table_name (alembic.operations.Operations.add_column parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.alter_column.params.table_name&quot;&gt;(alembic.operations.Operations.alter_column parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.batch_alter_table.params.table_name">(alembic.operations.Operations.batch_alter_table parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_check_constraint.params.table_name">(alembic.operations.Operations.create_check_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_exclude_constraint.params.table_name">(alembic.operations.Operations.create_exclude_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.table_name">(alembic.operations.Operations.create_index parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_primary_key.params.table_name">(alembic.operations.Operations.create_primary_key parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_table.params.table_name">(alembic.operations.Operations.create_table parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_table_comment.params.table_name">(alembic.operations.Operations.create_table_comment parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.create_unique_constraint.params.table_name">(alembic.operations.Operations.create_unique_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_column.params.table_name">(alembic.operations.Operations.drop_column parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_constraint.params.table_name">(alembic.operations.Operations.drop_constraint parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_index.params.table_name">(alembic.operations.Operations.drop_index parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_table.params.table_name">(alembic.operations.Operations.drop_table parameter)</a>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.drop_table_comment.params.table_name">(alembic.operations.Operations.drop_table_comment parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.downgrade.params.tag">tag (alembic.command.downgrade parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.stamp.params.tag&quot;&gt;(alembic.command.stamp parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/commands.html#alembic.command.upgrade.params.tag">(alembic.command.upgrade parameter)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.tag">(alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.target_metadata">target_metadata (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.init.params.template">template (alembic.command.init parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.template_args">template_args (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.CreateExcludeConstraintOp.to_constraint">to_constraint() (alembic.ddl.postgresql.CreateExcludeConstraintOp method)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.Params.token0">token0 (alembic.ddl.impl.Params property)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.Params.tokens">tokens (alembic.ddl.impl.Params property)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.transaction_per_migration">transaction_per_migration (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.transactional_ddl">transactional_ddl (alembic.ddl.impl.DefaultImpl attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.transactional_ddl&quot;&gt;(alembic.ddl.mssql.MSSQLImpl attribute)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLImpl.transactional_ddl">(alembic.ddl.mysql.MySQLImpl attribute)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.transactional_ddl">(alembic.ddl.postgresql.PostgresqlImpl attribute)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.sqlite.SQLiteImpl.transactional_ddl">(alembic.ddl.sqlite.SQLiteImpl attribute)</a>
</li>
        <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.transactional_ddl">(alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      </ul></li>
      <li><a href="en/ops.html#alembic.operations.Operations.alter_column.params.type_">type_ (alembic.operations.Operations.alter_column parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;ops.html#alembic.operations.Operations.drop_constraint.params.type_&quot;&gt;(alembic.operations.Operations.drop_constraint parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.inline_literal.params.type_">(alembic.operations.Operations.inline_literal parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.type_arg_extract">type_arg_extract (alembic.ddl.impl.DefaultImpl attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mysql.MySQLImpl.type_arg_extract&quot;&gt;(alembic.ddl.mysql.MySQLImpl attribute)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.impl.DefaultImpl.type_synonyms">type_synonyms (alembic.ddl.impl.DefaultImpl attribute)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.MSSQLImpl.type_synonyms&quot;&gt;(alembic.ddl.mssql.MSSQLImpl attribute)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.mysql.MySQLImpl.type_synonyms">(alembic.ddl.mysql.MySQLImpl attribute)</a>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.PostgresqlImpl.type_synonyms">(alembic.ddl.postgresql.PostgresqlImpl attribute)</a>
</li>
      </ul></li>
  </ul></td>
</tr></table>
<h2 id="U">U</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.create_index.params.unique">unique (alembic.operations.Operations.create_index parameter)</a>
</li>
      <li><a href="en/api/commands.html#alembic.command.upgrade">upgrade() (in module alembic.command)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrationScript.upgrade_ops">upgrade_ops (alembic.operations.ops.MigrationScript property)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.MigrationScript.upgrade_ops_list">upgrade_ops_list (alembic.operations.ops.MigrationScript property)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.upgrade_token">upgrade_token (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/operations.html#alembic.operations.ops.UpgradeOps">UpgradeOps (class in alembic.operations.ops)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.url">url (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/runtime.html#alembic.runtime.migration.MigrationContext.configure.params.url&quot;&gt;(alembic.runtime.migration.MigrationContext.configure parameter)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.user_module_prefix">user_module_prefix (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
  </ul></td>
</tr></table>
<h2 id="V">V</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/config.html#alembic.config.Config.set_main_option.params.value">value (alembic.config.Config.set_main_option parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/config.html#alembic.config.Config.set_section_option.params.value&quot;&gt;(alembic.config.Config.set_section_option parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/ops.html#alembic.operations.Operations.inline_literal.params.value">(alembic.operations.Operations.inline_literal parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.branches.params.verbose">verbose (alembic.command.branches parameter)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/commands.html#alembic.command.current.params.verbose&quot;&gt;(alembic.command.current parameter)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/commands.html#alembic.command.heads.params.verbose">(alembic.command.heads parameter)</a>
</li>
        <li><a href="en/api/commands.html#alembic.command.history.params.verbose">(alembic.command.history parameter)</a>
</li>
      </ul></li>
      <li><a href="en/api/commands.html#alembic.command.revision.params.version_path">version_path (alembic.command.revision parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.version_table">version_table (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.version_table_pk">version_table_pk (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/runtime.html#alembic.runtime.environment.EnvironmentContext.configure.params.version_table_schema">version_table_schema (alembic.runtime.environment.EnvironmentContext.configure parameter)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_add_column">visit_add_column() (in module alembic.ddl.base)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.visit_add_column&quot;&gt;(in module alembic.ddl.mssql)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.postgresql.visit_column_comment">visit_column_comment() (in module alembic.ddl.postgresql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_column_default">visit_column_default() (in module alembic.ddl.base)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.visit_column_default&quot;&gt;(in module alembic.ddl.mssql)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_column_name">visit_column_name() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_column_nullable">visit_column_nullable() (in module alembic.ddl.base)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.visit_column_nullable&quot;&gt;(in module alembic.ddl.mssql)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_column_type">visit_column_type() (in module alembic.ddl.base)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.visit_column_type&quot;&gt;(in module alembic.ddl.mssql)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.visit_column_type">(in module alembic.ddl.postgresql)</a>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_computed_column">visit_computed_column() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_drop_column">visit_drop_column() (in module alembic.ddl.base)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_identity_column">visit_identity_column() (in module alembic.ddl.base)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.postgresql.visit_identity_column&quot;&gt;(in module alembic.ddl.postgresql)&lt;/a&gt;
</code></pre>
</li>
      </ul></li>
      <li><a href="en/api/ddl.html#alembic.ddl.mssql.visit_rename_column">visit_rename_column() (in module alembic.ddl.mssql)</a>
</li>
      <li><a href="en/api/ddl.html#alembic.ddl.base.visit_rename_table">visit_rename_table() (in module alembic.ddl.base)</a>
<pre><code>  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;api/ddl.html#alembic.ddl.mssql.visit_rename_table&quot;&gt;(in module alembic.ddl.mssql)&lt;/a&gt;
</code></pre>
</li>
        <li><a href="en/api/ddl.html#alembic.ddl.postgresql.visit_rename_table">(in module alembic.ddl.postgresql)</a>
</li>
      </ul></li>
  </ul></td>
</tr></table>
<h2 id="W">W</h2>
<table style="width: 100%" class="indextable genindextable"><tr>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/api/script.html#alembic.script.ScriptDirectory.walk_revisions">walk_revisions() (alembic.script.ScriptDirectory method)</a>
</li>
  </ul></td>
  <td style="width: 33%; vertical-align: top;"><ul>
      <li><a href="en/ops.html#alembic.operations.Operations.create_exclude_constraint.params.where">where (alembic.operations.Operations.create_exclude_constraint parameter)</a>
</li>
  </ul></td>
</tr></table>
<pre><code>        &lt;div class=&quot;clearer&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;sphinxsidebar&quot; role=&quot;navigation&quot; aria-label=&quot;main navigation&quot;&gt;
    &lt;div class=&quot;sphinxsidebarwrapper&quot;&gt;&lt;script async type=&quot;text/javascript&quot; src=&quot;//cdn.carbonads.com/carbon.js?serve=CKYIL23W&amp;placement=alembiczzzcomputingcom&quot; id=&quot;_carbonads_js&quot;&gt;&lt;/script&gt;
</code></pre>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28532944-2', 'auto');
  ga('send', 'pageview');

</script>
<p>
<a href="en/alembic_latest.zip">Download documentation as ZIP file</a>
</p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3 id="navigation-1"><a class="header" href="#navigation-1">Navigation</a></h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="en/genindex.html#" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="en/py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="en/index.html">Alembic 1.7.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Index</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2021, Mike Bayer.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html><div style="break-before: page; page-break-before: always;"></div><!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Module Index &#8212; Alembic 1.7.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature_override.css" />
    <link rel="stylesheet" type="text/css" href="_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_paramlinks.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
</head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3 id="navigation-2"><a class="header" href="#navigation-2">Navigation</a></h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="en/genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="en/py-modindex.html#" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="en/index.html">Alembic 1.7.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python Module Index</a></li> 
      </ul>
    </div>  
<pre><code>&lt;div class=&quot;document&quot;&gt;
  &lt;div class=&quot;documentwrapper&quot;&gt;
    &lt;div class=&quot;bodywrapper&quot;&gt;
      &lt;div class=&quot;body&quot; role=&quot;main&quot;&gt;
</code></pre>
<h1 id="python-module-index"><a class="header" href="#python-module-index">Python Module Index</a></h1>
<div class="modindex-jumpbox">
   <a href="en/py-modindex.html#cap-a"><strong>a</strong></a>
   </div>
<table class="indextable modindextable">
     <tr class="pcap"><td></td><td>&#160;</td><td></td></tr>
     <tr class="cap" id="cap-a"><td></td><td>
       <strong>a</strong></td><td></td></tr>
     <tr>
       <td><img src="en/_static/minus.png" class="toggler"
              id="toggle-1" style="display: none" alt="-" /></td>
       <td>
       <code class="xref">alembic</code></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/commands.html#module-alembic.command"><code class="xref">alembic.command</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/config.html#module-alembic.config"><code class="xref">alembic.config</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl"><code class="xref">alembic.ddl</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl.base"><code class="xref">alembic.ddl.base</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl.impl"><code class="xref">alembic.ddl.impl</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl.mssql"><code class="xref">alembic.ddl.mssql</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl.mysql"><code class="xref">alembic.ddl.mysql</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl.postgresql"><code class="xref">alembic.ddl.postgresql</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/ddl.html#module-alembic.ddl.sqlite"><code class="xref">alembic.ddl.sqlite</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/ops.html#module-alembic.operations"><code class="xref">alembic.operations</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/operations.html#module-alembic.operations.ops"><code class="xref">alembic.operations.ops</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/runtime.html#module-alembic.runtime.environment"><code class="xref">alembic.runtime.environment</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/runtime.html#module-alembic.runtime.migration"><code class="xref">alembic.runtime.migration</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/script.html#module-alembic.script"><code class="xref">alembic.script</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/script.html#module-alembic.script.revision"><code class="xref">alembic.script.revision</code></a></td><td>
       <em></em></td></tr>
     <tr class="cg-1">
       <td></td>
       <td>&#160;&#160;&#160;
       <a href="en/api/script.html#module-alembic.script.write_hooks"><code class="xref">alembic.script.write_hooks</code></a></td><td>
       <em></em></td></tr>
   </table>
<pre><code>        &lt;div class=&quot;clearer&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;sphinxsidebar&quot; role=&quot;navigation&quot; aria-label=&quot;main navigation&quot;&gt;
    &lt;div class=&quot;sphinxsidebarwrapper&quot;&gt;&lt;script async type=&quot;text/javascript&quot; src=&quot;//cdn.carbonads.com/carbon.js?serve=CKYIL23W&amp;placement=alembiczzzcomputingcom&quot; id=&quot;_carbonads_js&quot;&gt;&lt;/script&gt;
</code></pre>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28532944-2', 'auto');
  ga('send', 'pageview');

</script>
<p>
<a href="en/alembic_latest.zip">Download documentation as ZIP file</a>
</p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3 id="navigation-3"><a class="header" href="#navigation-3">Navigation</a></h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="en/genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="en/py-modindex.html#" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="en/index.html">Alembic 1.7.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python Module Index</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2021, Mike Bayer.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html><div style="break-before: page; page-break-before: always;"></div><!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<pre><code>&lt;title&gt;Welcome to Alembic’s documentation! &amp;#8212; Alembic 1.7.5 documentation&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;_static/pygments.css&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;_static/nature_override.css&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;_static/changelog.css&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;_static/sphinx_paramlinks.css&quot; /&gt;
&lt;script data-url_root=&quot;./&quot; id=&quot;documentation_options&quot; src=&quot;_static/documentation_options.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;_static/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;_static/underscore.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;_static/doctools.js&quot;&gt;&lt;/script&gt;
&lt;link rel=&quot;index&quot; title=&quot;Index&quot; href=&quot;genindex.html&quot; /&gt;
&lt;link rel=&quot;search&quot; title=&quot;Search&quot; href=&quot;search.html&quot; /&gt;
&lt;link rel=&quot;next&quot; title=&quot;Front Matter&quot; href=&quot;front.html&quot; /&gt; 
</code></pre>
</head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3 id="navigation-4"><a class="header" href="#navigation-4">Navigation</a></h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="en/genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="en/py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="en/front.html" title="Front Matter"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="en/index.html#">Alembic 1.7.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to Alembic’s documentation!</a></li> 
      </ul>
    </div>  
<pre><code>&lt;div class=&quot;document&quot;&gt;
  &lt;div class=&quot;documentwrapper&quot;&gt;
    &lt;div class=&quot;bodywrapper&quot;&gt;
      &lt;div class=&quot;body&quot; role=&quot;main&quot;&gt;
</code></pre>
<section id="welcome-to-alembic-s-documentation">
<h1 id="welcome-to-alembics-documentationa-classheaderlink-hrefenindexhtmlwelcome-to-alembic-s-documentation-titlepermalink-to-this-headlinea"><a class="header" href="#welcome-to-alembics-documentationa-classheaderlink-hrefenindexhtmlwelcome-to-alembic-s-documentation-titlepermalink-to-this-headlinea">Welcome to Alembic’s documentation!<a class="headerlink" href="en/index.html#welcome-to-alembic-s-documentation" title="Permalink to this headline">¶</a></a></h1>
<p><a class="reference external" href="https://alembic.sqlalchemy.org">Alembic</a> is a lightweight database migration tool for usage
with the <a class="reference external" href="https://www.sqlalchemy.org">SQLAlchemy</a> Database Toolkit for Python.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="en/front.html">Front Matter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/front.html#project-homepage">Project Homepage</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/front.html#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/front.html#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/front.html#community">Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/front.html#bugs">Bugs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#the-migration-environment">The Migration Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#creating-an-environment">Creating an Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#editing-the-ini-file">Editing the .ini File</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#create-a-migration-script">Create a Migration Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#running-our-first-migration">Running our First Migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#running-our-second-migration">Running our Second Migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#partial-revision-identifiers">Partial Revision Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#relative-migration-identifiers">Relative Migration Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#getting-information">Getting Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/tutorial.html#viewing-history-ranges">Viewing History Ranges</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#downgrading">Downgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/tutorial.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/autogenerate.html">Auto Generating Migrations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/autogenerate.html#what-does-autogenerate-detect-and-what-does-it-not-detect">What does Autogenerate Detect (and what does it <em>not</em> detect?)</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/autogenerate.html#autogenerating-multiple-metadata-collections">Autogenerating Multiple MetaData collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/autogenerate.html#controlling-what-to-be-autogenerated">Controlling What to be Autogenerated</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#omitting-schema-names-from-the-autogenerate-process">Omitting Schema Names from the Autogenerate Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#omitting-table-names-from-the-autogenerate-process">Omitting Table Names from the Autogenerate Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#omitting-based-on-object">Omitting Based on Object</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/autogenerate.html#comparing-and-rendering-types">Comparing and Rendering Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#controlling-the-module-prefix">Controlling the Module Prefix</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#affecting-the-rendering-of-types-themselves">Affecting the Rendering of Types Themselves</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#comparing-types">Comparing Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/autogenerate.html#applying-post-processing-and-python-code-formatters-to-generated-revisions">Applying Post Processing and Python Code Formatters to Generated Revisions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#basic-formatter-configuration">Basic Formatter Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/autogenerate.html#writing-custom-hooks-as-python-functions">Writing Custom Hooks as Python Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/offline.html">Generating SQL Scripts (a.k.a. “Offline Mode”)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/offline.html#getting-the-start-version">Getting the Start Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/offline.html#writing-migration-scripts-to-support-script-generation">Writing Migration Scripts to Support Script Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/offline.html#customizing-the-environment">Customizing the Environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/naming.html">The Importance of Naming Constraints</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/naming.html#integration-of-naming-conventions-into-operations-autogenerate">Integration of Naming Conventions into Operations, Autogenerate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/batch.html">Running “Batch” Migrations for SQLite and Other Databases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/batch.html#controlling-table-reflection">Controlling Table Reflection</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/batch.html#dealing-with-constraints">Dealing with Constraints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/batch.html#dropping-unnamed-or-named-foreign-key-constraints">Dropping Unnamed or Named Foreign Key Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/batch.html#including-unnamed-unique-constraints">Including unnamed UNIQUE constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/batch.html#changing-the-type-of-boolean-enum-and-other-implicit-check-datatypes">Changing the Type of Boolean, Enum and other implicit CHECK datatypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/batch.html#including-check-constraints">Including CHECK constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/batch.html#dealing-with-referencing-foreign-keys">Dealing with Referencing Foreign Keys</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/batch.html#working-in-offline-mode">Working in Offline Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/batch.html#batch-mode-with-autogenerate">Batch mode with Autogenerate</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/batch.html#batch-mode-with-databases-other-than-sqlite">Batch mode with databases other than SQLite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/branches.html">Working with Branches</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/branches.html#merging-branches">Merging Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/branches.html#working-with-explicit-branches">Working with Explicit Branches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#referring-to-all-heads-at-once">Referring to all heads at once</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#referring-to-a-specific-version">Referring to a Specific Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#working-with-branch-labels">Working with Branch Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#more-label-syntaxes">More Label Syntaxes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/branches.html#working-with-multiple-bases">Working with Multiple Bases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#setting-up-multiple-version-directories">Setting up Multiple Version Directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#creating-a-labeled-base-revision">Creating a Labeled Base Revision</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/branches.html#running-with-multiple-bases">Running with Multiple Bases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/branches.html#branch-dependencies">Branch Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/ops.html">Operation Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="en/cookbook.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#building-an-up-to-date-database-from-scratch">Building an Up to Date Database from Scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#conditional-migration-elements">Conditional Migration Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#sharing-a-connection-with-a-series-of-migration-commands-and-environments">Sharing a Connection with a Series of Migration Commands and Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#replaceable-objects">Replaceable Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/cookbook.html#the-replaceable-object-structure">The Replaceable Object Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/cookbook.html#create-operations-for-the-target-objects">Create Operations for the Target Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/cookbook.html#create-initial-migrations">Create Initial Migrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/cookbook.html#create-revision-migrations">Create Revision Migrations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#rudimental-schema-level-multi-tenancy-for-postgresql-databases">Rudimental Schema-Level Multi Tenancy for PostgreSQL Databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#don-t-generate-empty-migrations-with-autogenerate">Don’t Generate Empty Migrations with Autogenerate</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#don-t-emit-drop-index-when-the-table-is-to-be-dropped-as-well">Don’t emit DROP INDEX when the table is to be dropped as well</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#don-t-generate-any-drop-table-directives-with-autogenerate">Don’t generate any DROP TABLE directives with autogenerate</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#apply-custom-sorting-to-table-columns-within-create-table">Apply Custom Sorting to Table Columns within CREATE TABLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#don-t-emit-create-table-statements-for-views">Don’t emit CREATE TABLE statements for Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#run-multiple-alembic-environments-from-one-ini-file">Run Multiple Alembic Environments from one .ini file</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#print-python-code-to-generate-particular-database-tables">Print Python Code to Generate Particular Database Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#run-alembic-operation-objects-directly-as-in-from-autogenerate">Run Alembic Operation Objects Directly (as in from autogenerate)</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#test-current-database-revision-is-at-head-s">Test current database revision is at head(s)</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/cookbook.html#using-asyncio-with-alembic">Using Asyncio with Alembic</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/api/index.html">API Details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/api/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/api/runtime.html">Runtime Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/api/runtime.html#the-environment-context">The Environment Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/runtime.html#the-migration-context">The Migration Context</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/api/config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/api/commands.html">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/api/operations.html">Operation Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/api/operations.html#operation-plugins">Operation Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/operations.html#built-in-operation-objects">Built-in Operation Objects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/api/autogenerate.html">Autogeneration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/api/autogenerate.html#getting-diffs">Getting Diffs</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/autogenerate.html#customizing-revision-generation">Customizing Revision Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/autogenerate.html#autogenerating-custom-operation-directives">Autogenerating Custom Operation Directives</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/api/script.html">Script Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/api/script.html#revision">Revision</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/script.html#module-alembic.script.write_hooks">Write Hooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/api/ddl.html">DDL Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/api/ddl.html#module-alembic.ddl.mysql">MySQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/ddl.html#module-alembic.ddl.mssql">MS-SQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/ddl.html#module-alembic.ddl.postgresql">Postgresql</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/api/ddl.html#module-alembic.ddl.sqlite">SQLite</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="en/changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.6">1.7.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.6-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.6-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.5">1.7.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.4">1.7.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.3">1.7.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.2">1.7.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.1">1.7.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.7.0">1.7.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.0-changed">changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.0-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.7.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.6.5">1.6.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.6.4">1.6.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.6.3">1.6.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.6.2">1.6.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.6.1">1.6.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.6.0">1.6.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.6.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.8">1.5.8</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.8-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.7">1.5.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.7-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.6">1.5.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.6-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.6-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.5">1.5.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.4">1.5.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.3">1.5.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.2">1.5.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.1">1.5.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.5.0">1.5.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.0-changed">changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.0-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.5.0-removed">removed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.4.3">1.4.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.4.2">1.4.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.2-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.4.1">1.4.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.4.0">1.4.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.0-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.4.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.3.3">1.3.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.3-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.3.2">1.3.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.3.1">1.3.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.3.0">1.3.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.3.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.2.1">1.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.2.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.2.0">1.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.2.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.2.0-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.2.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.2.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.1.0">1.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.1.0-usecase">usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.1.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.1.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.11">1.0.11</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.11-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.10">1.0.10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.10-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.9">1.0.9</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.9-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.8">1.0.8</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.8-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.7">1.0.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.7-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.6">1.0.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.6-feature">feature</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.5">1.0.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.4">1.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.3">1.0.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.2">1.0.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.1">1.0.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-1.0.0">1.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-1.0.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.10">0.9.10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.10-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.9">0.9.9</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.9-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.9-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.8">0.9.8</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.8-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.7">0.9.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.7-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.6">0.9.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.6-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.6-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.5">0.9.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.4">0.9.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.3">0.9.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.3-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.2">0.9.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.2-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.2-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.2-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.1">0.9.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.9.0">0.9.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.9.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.10">0.8.10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.10-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.9">0.8.9</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.9-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.8">0.8.8</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.8-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.8-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.7">0.8.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.7-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.6">0.8.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.6-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.5">0.8.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.4">0.8.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.4-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.3">0.8.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.2">0.8.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.1">0.8.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.1-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.8.0">0.8.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.8.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.7">0.7.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.7-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.7-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.6">0.7.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.6-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.6-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.5">0.7.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.5-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.4">0.7.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.3">0.7.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.2">0.7.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.1">0.7.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.1-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.7.0">0.7.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.0-changed">changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.7.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.7">0.6.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.7-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.7-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.6">0.6.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.6-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.6-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.6-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.5">0.6.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.5-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.4">0.6.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.4-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.3">0.6.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.3-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.2">0.6.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.2-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.1">0.6.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.1-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.6.0">0.6.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.6.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.5.0">0.5.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.5.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.5.0-bug">bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.5.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.4.2">0.4.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.4.2-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.4.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.4.1">0.4.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.4.1-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.4.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.4.0">0.4.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.4.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.4.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.6">0.3.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.6-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.6-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.5">0.3.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.5-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.5-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.4">0.3.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.4-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.3">0.3.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.3-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.3-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.2">0.3.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.2-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.1">0.3.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.3.0">0.3.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.3.0-misc">misc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.2.2">0.2.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.2.2-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.2.2-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.2.1">0.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.2.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.2.0">0.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.2.0-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.2.0-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.1.1">0.1.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.1.1-feature">feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="en/changelog.html#change-0.1.1-bug">bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="en/changelog.html#change-0.1.0">0.1.0</a></li>
</ul>
</li>
</ul>
</div>
<section id="indices-and-tables">
<h2 id="indices-and-tablesa-classheaderlink-hrefenindexhtmlindices-and-tables-titlepermalink-to-this-headlinea"><a class="header" href="#indices-and-tablesa-classheaderlink-hrefenindexhtmlindices-and-tables-titlepermalink-to-this-headlinea">Indices and tables<a class="headerlink" href="en/index.html#indices-and-tables" title="Permalink to this headline">¶</a></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="en/genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="en/py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="en/search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>
<pre><code>        &lt;div class=&quot;clearer&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;sphinxsidebar&quot; role=&quot;navigation&quot; aria-label=&quot;main navigation&quot;&gt;
    &lt;div class=&quot;sphinxsidebarwrapper&quot;&gt;&lt;script async type=&quot;text/javascript&quot; src=&quot;//cdn.carbonads.com/carbon.js?serve=CKYIL23W&amp;placement=alembiczzzcomputingcom&quot; id=&quot;_carbonads_js&quot;&gt;&lt;/script&gt;
</code></pre>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28532944-2', 'auto');
  ga('send', 'pageview');

</script>
<p>
<a href="en/alembic_latest.zip">Download documentation as ZIP file</a>
</p>
<h3 id="a-hrefenindexhtmltable-of-contentsa"><a class="header" href="#a-hrefenindexhtmltable-of-contentsa"><a href="en/index.html#">Table of Contents</a></a></h3>
  <ul>
<li><a class="reference internal" href="en/index.html#">Welcome to Alembic’s documentation!</a><ul>
<li><a class="reference internal" href="en/index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h4 id="next-topic"><a class="header" href="#next-topic">Next topic</a></h4>
  <p class="topless"><a href="en/front.html"
                        title="next chapter">Front Matter</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3 id="navigation-5"><a class="header" href="#navigation-5">Navigation</a></h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="en/genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="en/py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="en/front.html" title="Front Matter"
             >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="en/index.html#">Alembic 1.7.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to Alembic’s documentation!</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2021, Mike Bayer.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
