<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>åŸºæœ¬æ ¼å¼åŒ–ç¨‹åºé…ç½® - alembic ä¸­æ–‡æ–‡æ¡£</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../zh/_front_matter.html">å‰è¨€</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../zh/00_tutorial.html"><strong aria-hidden="true">1.</strong> æŒ‡å—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../zh/00_01_the_migration_enviroment.html"><strong aria-hidden="true">1.1.</strong> è¿ç§»ç¯å¢ƒ</a></li><li class="chapter-item "><a href="../zh/00_02_creating_an_enviroment.html"><strong aria-hidden="true">1.2.</strong> åˆ›å»ºç¯å¢ƒ</a></li><li class="chapter-item "><a href="../zh/00_03_Editing_the_ini_file.html"><strong aria-hidden="true">1.3.</strong> ç¼–è¾‘.iniæ–‡ä»¶</a></li><li class="chapter-item "><a href="../zh/00_04_create_a_migration_script.html"><strong aria-hidden="true">1.4.</strong> åˆ›å»ºè¿ç§»è„šæœ¬</a></li><li class="chapter-item "><a href="../zh/00_05_Running_our_first_migration.html"><strong aria-hidden="true">1.5.</strong> åˆæ¬¡è¿è¡Œè¿ç§»</a></li><li class="chapter-item "><a href="../zh/00_06_Running_our_second_migration.html"><strong aria-hidden="true">1.6.</strong> å†æ¬¡è¿è¡Œè¿ç§»</a></li><li class="chapter-item "><a href="../zh/00_07_partial_revision_identifiers.html"><strong aria-hidden="true">1.7.</strong> éƒ¨åˆ†ä¿®è®¢æ ‡è¯†ç¬¦</a></li><li class="chapter-item "><a href="../zh/00_08_relative_migration_identifiers.html"><strong aria-hidden="true">1.8.</strong> ç›¸å¯¹è¿ç§»æ ‡è¯†ç¬¦</a></li><li class="chapter-item "><a href="../zh/00_09_getting_information.html"><strong aria-hidden="true">1.9.</strong> è·å–ä¿¡æ¯</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../zh/00_09_01_viewing_history_ranges.html"><strong aria-hidden="true">1.9.1.</strong> æŸ¥çœ‹å†å²èŒƒå›´</a></li></ol></li><li class="chapter-item "><a href="../zh/00_10_downgrading.html"><strong aria-hidden="true">1.10.</strong> é™çº§</a></li><li class="chapter-item "><a href="../zh/00_11_next_steps.html"><strong aria-hidden="true">1.11.</strong> ä¸‹ä¸€æ­¥</a></li></ol></li><li class="chapter-item expanded "><a href="../zh/01_auto_generating_migrations.html"><strong aria-hidden="true">2.</strong> è‡ªåŠ¨ç”Ÿæˆè¿ç§»</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../zh/01_01_what_does_autogenerate_detect.html"><strong aria-hidden="true">2.1.</strong> Autogenerate æ£€æµ‹ä»€ä¹ˆ</a></li><li class="chapter-item "><a href="../zh/01_02_autogenerating_multiple_metadata_collections.html"><strong aria-hidden="true">2.2.</strong> è‡ªåŠ¨ç”Ÿæˆå¤šä¸ªå…ƒæ•°æ®é›†åˆ</a></li><li class="chapter-item "><a href="../zh/01_03_controlling_what_to_be_autogenerated.html"><strong aria-hidden="true">2.3.</strong> æ§åˆ¶è¦è‡ªåŠ¨ç”Ÿæˆçš„å†…å®¹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../zh/01_03_01_omitting_schema_names_from_the_autogenerate_process.html"><strong aria-hidden="true">2.3.1.</strong> ä»è‡ªåŠ¨ç”Ÿæˆè¿‡ç¨‹ä¸­çœç•¥æ¨¡å¼åç§°</a></li><li class="chapter-item "><a href="../zh/01_03_02_omitting_table_names_from_the_autogenerate_process.html"><strong aria-hidden="true">2.3.2.</strong> ä»è‡ªåŠ¨ç”Ÿæˆè¿‡ç¨‹ä¸­çœç•¥è¡¨å</a></li><li class="chapter-item "><a href="../zh/01_03_03_omitting_based_on_object.html"><strong aria-hidden="true">2.3.3.</strong> åŸºäºå¯¹è±¡çš„çœç•¥</a></li></ol></li><li class="chapter-item "><a href="../zh/01_04_comparing_and_rendering_types.html"><strong aria-hidden="true">2.4.</strong> æ¯”è¾ƒå’Œæ¸²æŸ“ç±»å‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../zh/01_04_01_controlling_the_module_prefix.html"><strong aria-hidden="true">2.4.1.</strong> æ§åˆ¶æ¨¡å—å‰ç¼€</a></li><li class="chapter-item "><a href="../zh/01_04_02_affecting_the_rendering_of_types_themselves.html"><strong aria-hidden="true">2.4.2.</strong> å½±å“ç±»å‹æœ¬èº«çš„æ¸²æŸ“</a></li><li class="chapter-item "><a href="../zh/01_04_03_comparing_types.html"><strong aria-hidden="true">2.4.3.</strong> æ¯”è¾ƒç±»å‹</a></li></ol></li><li class="chapter-item expanded "><a href="../zh/01_05_applying_post_processing.html"><strong aria-hidden="true">2.5.</strong> å°†æäº¤å¤„ç†è¿‡ç¨‹å’Œ Python ä»£ç æ ¼å¼åŒ–ç¨‹åºåº”ç”¨äºç”Ÿæˆçš„ä¿®è®¢</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../zh/01_05_01_basic_formatter_configuration.html" class="active"><strong aria-hidden="true">2.5.1.</strong> åŸºæœ¬æ ¼å¼åŒ–ç¨‹åºé…ç½®</a></li><li class="chapter-item "><a href="../zh/01_05_02_writing_custom_hooks_as_python_functions.html"><strong aria-hidden="true">2.5.2.</strong> è‡ªå®šä¹‰Pythonå‡½æ•°é’©å­</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../zh/02_generating_sql_scripts.html"><strong aria-hidden="true">3.</strong> ç”ŸæˆSQLè„šæœ¬(åˆç§°ç¦»çº¿æ¨¡å¼)</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../zh/02_01_getting_the_start_version.html"><strong aria-hidden="true">3.1.</strong> Getting the Start Version</a></li><li class="chapter-item "><a href="../zh/02_02_writing_migration_scripts_to_support_script_generation.html"><strong aria-hidden="true">3.2.</strong> Writing Migration Scripts to Support Script Generation</a></li><li class="chapter-item "><a href="../zh/02_03_customizing_the_environment.html"><strong aria-hidden="true">3.3.</strong> Customizing the Environment</a></li></ol></li><li class="chapter-item expanded "><a href="../zh/03_the_importance_of_naming_constraints.html"><strong aria-hidden="true">4.</strong> å‘½åçº¦æŸçš„é‡è¦æ€§</a></li><li class="chapter-item expanded "><a href="../zh/04_running_batch_migrations_for_sqlite_and_other_databases.html"><strong aria-hidden="true">5.</strong> åœ¨SQLiteå’Œå…¶ä»–æ•°æ®ä¸­è¿è¡Œ&quot;Batch&quot;è¿ç§»è„šæœ¬</a></li><li class="chapter-item expanded "><a href="../zh/05_working_with_branches.html"><strong aria-hidden="true">6.</strong> å·¥ä½œåˆ†æ”¯</a></li><li class="chapter-item expanded "><a href="../zh/06_operation_reference.html"><strong aria-hidden="true">7.</strong> æ“ä½œå‚è€ƒ</a></li><li class="chapter-item expanded "><a href="../zh/07_cook_book.html"><strong aria-hidden="true">8.</strong> cookbook</a></li><li class="chapter-item expanded "><a href="../zh/08_api_details.html"><strong aria-hidden="true">9.</strong> APIè¯¦ç»†</a></li><li class="chapter-item expanded "><a href="../zh/09_change_log.html"><strong aria-hidden="true">10.</strong> æ›´æ–°å†å²</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../en/index.html">åŸæ–‡ - è‹±æ–‡</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">alembic ä¸­æ–‡æ–‡æ¡£</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="basic-formatter-configuration"><a class="header" href="#basic-formatter-configuration">Basic Formatter Configuration</a></h1>
<p>The <code>alembic.ini</code> samples now include commented-out configuration illustrating how to configure code-formatting tools to run against the newly generated file path. Example:</p>
<pre><code class="language-ini">[post_write_hooks]

# format using &quot;black&quot;
hooks=black

black.type = console_scripts
black.entrypoint = black
black.options = -l 79
</code></pre>
<p>Above, we configure <code>hooks</code> to be a single post write hook labeled <code>&quot;black&quot;</code>. Note that this label is arbitrary. We then define the configuration for the <code>&quot;black&quot;</code> post write hook, which includes:</p>
<ul>
<li><code>type</code> - this is the type of hook we are running. Alembic includes a hook runner called <code>&quot;console_scripts&quot;</code>, which is specifically a Python function that uses <code>subprocess.run()</code> to invoke a separate Python script against the revision file. For a custom-written hook function, this configuration variable would refer to the name under which the custom hook was registered; see the next section for an example.</li>
</ul>
<p>The following configuration options are specific to the <code>&quot;console_scripts&quot;</code> hook runner:</p>
<ul>
<li>
<p><code>entrypoint</code> - the name of the <a href="https://setuptools.readthedocs.io/en/latest/pkg_resources.html#entry-points">setuptools entrypoint</a> that is used to define the console script. Within the scope of standard Python console scripts, this name will match the name of the shell command that is usually run for the code formatting tool, in this case <code>black</code>.</p>
</li>
<li>
<p><code>options</code> - a line of command-line options that will be passed to the code formatting tool. In this case, we want to run the command <code>black /path/to/revision.py -l 79</code>. By default, the revision path is positioned as the first argument. In order specify a different position, we can use the <code>REVISION_SCRIPT_FILENAME</code> token as illustrated by the subsequent examples.</p>
<p><strong>Note</strong>: Make sure options for the script are provided such that it will rewrite the input file <strong>in place</strong>. For example, when running autopep8, the <code>--in-place</code> option should be provided:</p>
<pre><code class="language-ini">[post_write_hooks]
hooks = autopep8
autopep8.type = console_scripts
autopep8.entrypoint = autopep8
autopep8.options = --in-place REVISION_SCRIPT_FILENAME
</code></pre>
</li>
<li>
<p><code>cwd</code> - optional working directory from which the console script is run.</p>
</li>
</ul>
<p>When running <code>alembic revision -m &quot;rev1&quot;</code>, we will now see the <code>black</code> toolâ€™s output as well:</p>
<pre><code class="language-bash">$ alembic revision -m &quot;rev1&quot;
  Generating /path/to/project/versions/481b13bc369a_rev1.py ... done
  Running post write hook &quot;black&quot; ...
reformatted /path/to/project/versions/481b13bc369a_rev1.py
All done! âœ¨ ğŸ° âœ¨
1 file reformatted.
  done
</code></pre>
<p>Hooks may also be specified as a list of names, which correspond to hook runners that will run sequentially. As an example, we can also run the <a href="https://pypi.org/project/zimports/">zimports</a> import rewriting tool (written by Alembicâ€™s author) subsequent to running the <code>black</code> tool, using a configuration as follows:</p>
<pre><code class="language-ini">[post_write_hooks]

# format using &quot;black&quot;, then &quot;zimports&quot;
hooks=black, zimports

black.type = console_scripts
black.entrypoint = black
black.options = -l 79 REVISION_SCRIPT_FILENAME

zimports.type = console_scripts
zimports.entrypoint = zimports
zimports.options = --style google REVISION_SCRIPT_FILENAME
</code></pre>
<p>When using the above configuration, a newly generated revision file will be processed first by the â€œblackâ€ tool, then by the â€œzimportsâ€ tool.</p>
<p>Alternatively, one can run pre-commit itself as follows:</p>
<pre><code class="language-ini">[post_write_hooks]

hooks = pre-commit

pre-commit.type = console_scripts
pre-commit.entrypoint = pre-commit
pre-commit.options = run --files REVISION_SCRIPT_FILENAME
pre-commit.cwd = %(here)s
</code></pre>
<p>(The last line helps to ensure that the <code>.pre-commit-config.yaml</code> file will always be found, regardless of from where the hook was called.)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../zh/01_05_applying_post_processing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../zh/01_05_02_writing_custom_hooks_as_python_functions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../zh/01_05_applying_post_processing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../zh/01_05_02_writing_custom_hooks_as_python_functions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
