# Apply Custom Sorting to Table Columns within CREATE TABLE

[Rewriter]: ../en/api/autogenerate.html#alembic.autogenerate.rewriter.Rewriter
[Fine-Grained Autogenerate Generation with Rewriters]: ../en/api/autogenerate.html#autogen-rewriter
[ops.MigrateOperation]: ../en/api/operations.html#alembic.operations.ops.MigrateOperation
[ops.CreateTableOp]: ../en/api/operations.html#alembic.operations.ops.CreateTableOp

This example illustrates use of the **[Rewriter]** object introduced at **[Fine-Grained Autogenerate Generation with Rewriters]**. While the rewriter grants access to the individual **[ops.MigrateOperation]** objects, there are sometimes some special techniques required to get around some structural limitations that are present.

One is when trying to reorganize the order of columns in a table within a **[ops.CreateTableOp]** directive. This directive, when generated by autogenerate, actually holds onto the original `Table` object as the source of its information, so attempting to reorder the `ops.CreateTableOp.columns` collection will usually have no effect. Instead, a new **[ops.CreateTableOp]** object may be constructed with the new ordering. However, a second issue is that the `Column` objects inside will already be associated with the `Table` that is from the model being autogenerated, meaning they canâ€™t be reassigned directly to a new `Table`. To get around this, we can copy all the columns and constraints using methods like `Column`.copy().

Below we use **[Rewriter]** to create a new **[ops.CreateTableOp]** directive and to copy the `Column` objects from one into another, copying each column or constraint object and applying a new sorting scheme:

```python
# in env.py

from alembic.operations import ops
from alembic.autogenerate import rewriter

writer = rewriter.Rewriter()

@writer.rewrites(ops.CreateTableOp)
def order_columns(context, revision, op):

    special_names = {"id": -100, "created_at": 1001, "updated_at": 1002}

    cols_by_key = [
        (
            special_names.get(col.key, index)
            if isinstance(col, Column)
            else 2000,
            col.copy(),
        )
        for index, col in enumerate(op.columns)
    ]

    columns = [
        col for idx, col in sorted(cols_by_key, key=lambda entry: entry[0])
    ]
    return ops.CreateTableOp(
        op.table_name, columns, schema=op.schema, **op.kw)


# ...

context.configure(
    # ...
    process_revision_directives=writer
)
```

Above, when we apply the `writer` to a table such as:

```python
Table(
    "my_table",
    m,
    Column("data", String(50)),
    Column("created_at", DateTime),
    Column("id", Integer, primary_key=True),
    Column("updated_at", DateTime),
    UniqueConstraint("data", name="uq_data")
)
```

This will render in the autogenerated file as:

```python
def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "my_table",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("data", sa.String(length=50), nullable=True),
        sa.Column("created_at", sa.DateTime(), nullable=True),
        sa.Column("updated_at", sa.DateTime(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("data", name="uq_data"),
    )
    # ### end Alembic commands ###
```
